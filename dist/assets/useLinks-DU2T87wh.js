import{b as i,u as e,d as n}from"./data-ChU7VID-.js";import{u as t,s as r}from"./index-DxTo7WPx.js";function s(){const{user:s}=t(),a=i(),{data:o=[],isLoading:d}=e({queryKey:["links",null==s?void 0:s.id],queryFn:async()=>{if(!(null==s?void 0:s.id))return[];const{data:i,error:e}=await r.from("links").select("*").eq("user_id",s.id).order("position",{ascending:!0});if(e)throw e;return i},enabled:!!(null==s?void 0:s.id)}),l=n({mutationFn:async i=>{if(!(null==s?void 0:s.id))throw new Error("User not authenticated");const e=o.length>0?Math.max(...o.map(i=>i.position)):-1,{data:n,error:t}=await r.from("links").insert({user_id:s.id,title:i.title,url:i.url,icon:i.icon,position:e+1,is_active:i.active}).select().single();if(t)throw t;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",null==s?void 0:s.id]})}}),u=n({mutationFn:async({id:i,...e})=>{const{data:n,error:t}=await r.from("links").update(e).eq("id",i).select().single();if(t)throw t;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",null==s?void 0:s.id]})}}),c=n({mutationFn:async i=>{const{error:e}=await r.from("links").delete().eq("id",i);if(e)throw e},onSuccess:()=>{a.invalidateQueries({queryKey:["links",null==s?void 0:s.id]})}}),v=n({mutationFn:async({id:i,is_active:e})=>{const{error:n}=await r.from("links").update({is_active:e}).eq("id",i);if(n)throw n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",null==s?void 0:s.id]})}});return{links:o,isLoading:d,addLink:l,updateLink:u,deleteLink:c,toggleActive:v}}export{s as u};
