import{b as y,u as f,c as a}from"./data-15YcDnrk.js";import{s as r}from"./supabase-Ba7v9dZh.js";import{u as m}from"./state-stores-BuSRU7CA.js";function p(){const{user:e}=m(),n=y(),{data:u=[],isLoading:d}=f({queryKey:["listings",e?.id],queryFn:async()=>{if(!e?.id)return[];const{data:t,error:i}=await r.from("listings").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(i)throw i;return t},enabled:!!e?.id}),c=a({mutationFn:async t=>{if(!e?.id)throw new Error("User not authenticated");const{data:i,error:s}=await r.from("listings").insert({user_id:e.id,...t}).select().single();if(s)throw s;return i},onSuccess:()=>{n.invalidateQueries({queryKey:["listings",e?.id]})}}),l=a({mutationFn:async({id:t,...i})=>{const{data:s,error:o}=await r.from("listings").update(i).eq("id",t).select().single();if(o)throw o;return s},onSuccess:()=>{n.invalidateQueries({queryKey:["listings",e?.id]})}}),g=a({mutationFn:async t=>{const{error:i}=await r.from("listings").delete().eq("id",t);if(i)throw i},onSuccess:()=>{n.invalidateQueries({queryKey:["listings",e?.id]})}});return{listings:u,isLoading:d,addListing:c,updateListing:l,deleteListing:g}}export{p as u};
