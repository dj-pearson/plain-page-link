import{r as h,af as Q,j as e,aj as D,ak as $,aw as L,al as O,am as z,h as n,I as N,S as P,T as F,a3 as B,aD as W,B as x,aE as X,aF as K,bI as Z,aJ as ee,aH as R,aI as te,b as H,k as I,ar as J,ax as se,M as re,ad as ae,C as ie,f as le,ag as ne,bJ as oe}from"./index-CbXwE5cx.js";import{U as de}from"./upload-YjgxdHDt.js";import{u as ce}from"./useTestimonials-3wSKqC69.js";import{u as me,U as xe}from"./UpgradeModal-Cg2AY7Oo.js";import{L as ue}from"./LimitBanner-Dtf4s0MV.js";import{C as q}from"./copy-C-cOfMrI.js";import{u as he}from"./useProfile-tLOZ5k95.js";import{P as U}from"./plus-Dcgfotg9.js";import{R as pe}from"./refresh-cw-CocrRiDF.js";import{S as ge}from"./square-pen-OnIE3C0b.js";import{T as je}from"./trash-2-c493bXwf.js";import"./useMutation-BeLtmIn6.js";import"./alert-DjLXQ2LG.js";import"./progress-C3xrte5I.js";import"./triangle-alert-ChnMGm3n.js";const fe=K({clientName:R().min(2,"Client name must be at least 2 characters"),rating:te().min(1,"Rating is required").max(5,"Rating must be between 1 and 5"),review:R().min(10,"Review must be at least 10 characters").max(500,"Review must be less than 500 characters"),propertyType:R().min(1,"Property type is required"),clientPhoto:ee(File).optional(),featured:Z()});function be({open:w,onOpenChange:d,onSave:i}){const[o,a]=h.useState(null),[l,p]=h.useState(null),{register:s,handleSubmit:g,formState:{errors:t},reset:j,setValue:u,watch:f}=Q({resolver:X(fe),defaultValues:{clientName:"",rating:5,review:"",propertyType:"",featured:!1}}),T=f("rating"),C=f("review"),S=f("featured"),c=m=>{const b=m.target.files?.[0];if(b){u("clientPhoto",b);const _=new FileReader;_.onloadend=()=>{p(_.result)},_.readAsDataURL(b)}},v=()=>{u("clientPhoto",void 0),p(null)},k=async m=>{try{a(null),await i?.(m),d(!1),j(),p(null)}catch(b){console.error("Failed to add testimonial:",b),a("Failed to add testimonial. Please try again.")}};return e.jsx(D,{open:w,onOpenChange:d,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsxs(L,{children:[e.jsx(O,{children:"Add Client Testimonial"}),e.jsx(z,{children:"Share feedback from satisfied clients to build credibility"})]}),e.jsxs("form",{onSubmit:g(k),className:"space-y-6",children:[o&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm",children:o}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(N,{id:"clientName",...s("clientName"),placeholder:"John Smith"}),t.clientName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.clientName.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'You can use initials for privacy (e.g., "John S.")'})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"propertyType",children:"Property Type *"}),e.jsx(N,{id:"propertyType",...s("propertyType"),placeholder:"Single Family Home, Condo, etc."}),t.propertyType&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.propertyType.message})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(m=>e.jsx("button",{type:"button",onClick:()=>u("rating",m),className:"focus:outline-none",children:e.jsx(P,{className:`h-8 w-8 transition-colors ${m<=T?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},m))}),t.rating&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.rating.message})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"review",children:"Testimonial Text *"}),e.jsx(F,{id:"review",...s("review"),rows:6,maxLength:500,placeholder:"Share what the client said about working with you..."}),t.review&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.review.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[C?.length||0,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Client Photo (Optional)"}),l?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:l,alt:"Client preview",className:"w-24 h-24 rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:v,className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full",children:e.jsx(B,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:c,className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx(de,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload client photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 2MB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"featured",checked:S,onChange:m=>u("featured",m.target.checked),className:"rounded border-border"}),e.jsx(n,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this testimonial on my profile"})]}),e.jsxs(W,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{type:"submit",children:"Add Testimonial"})]})]})]})})}function ve({isOpen:w,onClose:d,onSubmit:i,initialData:o}){const[a,l]=h.useState(o);if(h.useEffect(()=>{l(o)},[o]),!w)return null;const p=s=>{s.preventDefault(),i(a)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Testimonial"}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_name",children:"Client Name *"}),e.jsx(N,{id:"client_name",value:a.client_name,onChange:s=>l({...a,client_name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_title",children:"Client Title"}),e.jsx(N,{id:"client_title",value:a.client_title||"",onChange:s=>l({...a,client_title:s.target.value}),placeholder:"e.g., First-Time Homebuyer"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"rating",children:"Rating *"}),e.jsx(N,{id:"rating",type:"number",min:"1",max:"5",value:a.rating,onChange:s=>l({...a,rating:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"review",children:"Review *"}),e.jsx(F,{id:"review",value:a.review,onChange:s=>l({...a,review:s.target.value}),rows:6,required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"property_type",children:"Property Type"}),e.jsx(N,{id:"property_type",value:a.property_type||"",onChange:s=>l({...a,property_type:s.target.value}),placeholder:"e.g., Single Family Home"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:a.transaction_type||"",onChange:s=>l({...a,transaction_type:s.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:d,className:"flex-1",children:"Cancel"}),e.jsx(x,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function ye({open:w,onOpenChange:d,username:i,agentName:o}){const[a,l]=h.useState(!1),[p,s]=h.useState(!1),{toast:g}=H(),t=`${window.location.origin}/${i}/review`,j=`Hi there!

I hope you've been enjoying your new home! I wanted to reach out and ask if you'd be willing to share a brief review of your experience working with me.

Your feedback helps me improve my services and helps other clients find the right agent for their needs.

You can leave a review here:
${t}

It only takes a couple of minutes, and I really appreciate your time!

Best regards,
${o}`,u=`Hi! Would you mind leaving a quick review of your experience? It helps me serve clients better: ${t} Thanks! - ${o}`,f=async(c,v="url")=>{try{await navigator.clipboard.writeText(c),v==="url"?(l(!0),setTimeout(()=>l(!1),2e3)):(s(!0),setTimeout(()=>s(!1),2e3)),g({title:"Copied!",description:`${v==="url"?"Review link":"Email template"} copied to clipboard`})}catch{g({title:"Failed to copy",description:"Please copy manually",variant:"destructive"})}},T=()=>{const c=encodeURIComponent(`Request for Testimonial - ${o}`),v=encodeURIComponent(j);window.open(`mailto:?subject=${c}&body=${v}`)},C=()=>{const c=encodeURIComponent(u);window.open(`sms:?&body=${c}`)},S=async()=>{if(navigator.share)try{await navigator.share({title:"Leave a Review",text:"I'd appreciate if you could leave a review of your experience!",url:t})}catch{console.log("Share cancelled")}else f(t)};return e.jsx(D,{open:w,onOpenChange:d,children:e.jsxs($,{className:"sm:max-w-2xl",children:[e.jsxs(L,{children:[e.jsx(O,{className:"text-2xl",children:"Request Client Testimonial"}),e.jsx(z,{children:"Share this link with clients to collect reviews and testimonials"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold",children:"Your Review Link"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Send this link to clients so they can leave a review"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{value:t,readOnly:!0,className:"font-mono text-sm"}),e.jsx(x,{onClick:()=>f(t),variant:"outline",size:"icon",children:a?e.jsx(I,{className:"h-4 w-4 text-green-600"}):e.jsx(q,{className:"h-4 w-4"})}),e.jsx(x,{onClick:S,variant:"outline",size:"icon",title:"Share via...",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(x,{asChild:!0,variant:"outline",size:"icon",title:"Preview review page",children:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e.jsx(se,{className:"h-4 w-4"})})})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold mb-3 block",children:"Quick Send Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(x,{onClick:T,variant:"outline",className:"justify-start",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Send via Email"]}),e.jsxs(x,{onClick:C,variant:"outline",className:"justify-start",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Send via SMS"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(n,{className:"text-base font-semibold",children:"Email Template"}),e.jsx(x,{onClick:()=>f(j,"email"),variant:"ghost",size:"sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 text-green-600"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),e.jsx(F,{value:j,readOnly:!0,rows:12,className:"font-mono text-sm resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ’¡ Tip: Customize this template to match your personal style"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold mb-2 block",children:"SMS Template"}),e.jsx(F,{value:u,readOnly:!0,rows:3,className:"font-mono text-sm resize-none"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-900",children:"ðŸ“‹ Best Practices for Requesting Reviews"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Wait 1-2 weeks after closing for best results"}),e.jsx("li",{children:"â€¢ Send a personalized message, not just the link"}),e.jsx("li",{children:"â€¢ Follow up once if no response after 1 week"}),e.jsx("li",{children:"â€¢ Thank clients regardless of whether they leave a review"}),e.jsx("li",{children:"â€¢ Make it easy - include the direct link"})]})]})]})]})})}function Ue(){const[w,d]=h.useState(!1),[i,o]=h.useState(null),[a,l]=h.useState(!1),[p,s]=h.useState(!1),{toast:g}=H(),{testimonials:t,isError:j,error:u,refetch:f,addTestimonial:T,updateTestimonial:C,deleteTestimonial:S}=ce(),{subscription:c,canAdd:v,getLimit:k,getUsage:m}=me(),{profile:b}=he(),_=()=>{if(!v("testimonials")){l(!0);return}d(!0)},Y=async r=>{try{await T.mutateAsync(r),g({title:"Testimonial added!",description:"Client review has been added successfully."}),d(!1)}catch{g({title:"Error",description:"Failed to add testimonial. Please try again.",variant:"destructive"})}},V=async r=>{if(confirm("Are you sure you want to delete this testimonial?"))try{await S.mutateAsync(r),g({title:"Testimonial deleted",description:"Client review has been removed."})}catch{g({title:"Error",description:"Failed to delete testimonial.",variant:"destructive"})}},G=async r=>{if(i)try{await C.mutateAsync({id:i.id,client_name:r.client_name,client_title:r.client_title,rating:r.rating,review:r.review,property_type:r.property_type,transaction_type:r.transaction_type,updated_at:new Date().toISOString()}),o(null)}catch(y){console.error("Failed to update testimonial:",y)}},A=t.length>0?(t.reduce((r,y)=>r+y.rating,0)/t.length).toFixed(1):"0.0",E=r=>e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((y,M)=>e.jsx(P,{className:`h-4 w-4 ${M<r?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},M))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Testimonials"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Showcase client reviews and success stories"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>s(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors font-medium border border-border",children:[e.jsx(J,{className:"h-4 w-4"}),"Request Testimonial"]}),e.jsxs("button",{onClick:_,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(U,{className:"h-4 w-4"}),"Add Testimonial"]})]})]}),c&&k("testimonials")!==1/0&&e.jsx(ue,{feature:"testimonials",current:m("testimonials"),limit:k("testimonials")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:A}),e.jsx("div",{className:"flex",children:E(Math.round(parseFloat(A)))})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Rating"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]}),j&&e.jsx(ie,{children:e.jsxs(le,{className:"p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-red-100 rounded-full mb-3 sm:mb-4",children:e.jsx(ne,{className:"h-7 w-7 sm:h-8 sm:w-8 text-red-600"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 sm:mb-2",children:"Failed to load testimonials"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4 max-w-sm mx-auto",children:u instanceof Error?u.message:"An unexpected error occurred. Please try again."}),e.jsxs(x,{onClick:()=>f(),variant:"outline",className:"gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Try Again"]})]})}),!j&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.map(r=>e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-shadow relative",children:[e.jsx("div",{className:"mb-4",children:e.jsx(oe,{className:"h-8 w-8 text-primary opacity-20"})}),e.jsxs("p",{className:"text-foreground mb-6 leading-relaxed",children:['"',r.review,'"']}),e.jsx("div",{className:"mb-4",children:E(r.rating)}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold",children:r.client_name.split(" ").map(y=>y[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:r.client_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.property_type||"Client"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>o(r),className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("button",{onClick:()=>V(r.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(je,{className:"h-4 w-4 text-red-500"})})]})]})]},r.id))}),!j&&t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-accent rounded-full mb-4",children:e.jsx(P,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No testimonials yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Start building social proof by adding client reviews"}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(U,{className:"h-5 w-5"}),"Add Your First Testimonial"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Featured testimonials will be prominently displayed on your public profile. Ask satisfied clients for reviews after successful transactions!"]})}),e.jsx(be,{open:w,onOpenChange:d,onSave:Y}),i&&e.jsx(ve,{isOpen:!!i,onClose:()=>o(null),onSubmit:G,initialData:{client_name:i.client_name,review:i.review,rating:i.rating,client_title:i.client_title,property_type:i.property_type,transaction_type:i.transaction_type}}),e.jsx(xe,{open:a,onOpenChange:l,feature:"testimonials",currentPlan:c?.plan_name||"Free",requiredPlan:"Starter"}),b&&e.jsx(ye,{open:p,onOpenChange:s,username:b.username||"",agentName:b.full_name||""})]})}export{Ue as default};
