import{j as e}from"./ui-components-DtyTDbSg.js";import{h as s,r as t}from"./react-vendor-B_Chv4nK.js";import{c as a}from"./data-ChU7VID-.js";import{u as i}from"./utils-D6PrBqaA.js";import{s as l,u as r,B as o,C as c,l as n,I as d,L as u}from"./index-DxTo7WPx.js";import{aa as h,G as g,al as m,ac as p,E as x,N as y,ad as f,O as b,aD as w,aE as v,a3 as j,ae as k,ah as N,av as P,aF as B}from"./icons-K_BhWJ_Z.js";import{B as I}from"./BlockRenderer-OadHtmwd.js";import{T as C,a as S,b as D,c as A}from"./tabs-BI9P6yR1.js";import"./three-t2PEh41g.js";import"./charts-CeHnXkIf.js";import"./supabase-D4JaKbf_.js";import"./forms-yc2f2ZZT.js";const _=new class{createNewPage(e,s){return{id:this.generateId(),userId:e,slug:s,title:"My Link-in-Bio Page",description:"Real Estate Professional",blocks:[],theme:this.getDefaultTheme(),seo:{title:"My Link-in-Bio Page",description:"Real Estate Professional",keywords:["real estate","agent","properties"],twitterCard:"summary_large_image"},published:!1,createdAt:new Date,updatedAt:new Date}}getDefaultTheme(){return{name:"Default",preset:"modern",colors:{primary:"#2563eb",secondary:"#10b981",background:"#ffffff",text:"#1f2937",accent:"#f59e0b"},fonts:{heading:"Inter",body:"Inter"},borderRadius:"medium",spacing:"normal"}}addBlock(e,s,t){const a=this.getBlockTemplate(s);if(!a)throw new Error(`Unknown block type: ${s}`);const i={id:this.generateId(),type:s,order:void 0!==t?t:e.blocks.length,visible:!0,config:a.defaultConfig},l=[...e.blocks];return void 0!==t?(l.splice(t,0,i),l.forEach((e,s)=>{e.order=s})):l.push(i),{...e,blocks:l,updatedAt:new Date}}removeBlock(e,s){const t=e.blocks.filter(e=>e.id!==s).map((e,s)=>({...e,order:s}));return{...e,blocks:t,updatedAt:new Date}}updateBlock(e,s,t){const a=e.blocks.map(e=>e.id===s?{...e,config:{...e.config,...t}}:e);return{...e,blocks:a,updatedAt:new Date}}reorderBlocks(e,s,t){const a=[...e.blocks],[i]=a.splice(s,1);return a.splice(t,0,i),a.forEach((e,s)=>{e.order=s}),{...e,blocks:a,updatedAt:new Date}}toggleBlockVisibility(e,s){const t=e.blocks.map(e=>e.id===s?{...e,visible:!e.visible}:e);return{...e,blocks:t,updatedAt:new Date}}duplicateBlock(e,s){const t=e.blocks.find(e=>e.id===s);if(!t)return e;const a={...t,id:this.generateId(),order:t.order+1},i=[...e.blocks];return i.splice(t.order+1,0,a),i.forEach((e,s)=>{s>t.order&&(e.order=s)}),{...e,blocks:i,updatedAt:new Date}}getBlockTemplates(){return[{type:"bio",name:"Bio Section",description:"Your profile and introduction",icon:"User",category:"content",defaultConfig:{type:"bio",title:"Your Name",subtitle:"Real Estate Professional",description:"Helping clients find their dream homes in [Your City]. Licensed agent with [X] years of experience.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",name:"Property Listings",description:"Showcase your active listings",icon:"Home",category:"content",defaultConfig:{type:"listings",title:"Featured Properties",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!0}},{type:"link",name:"Link Button",description:"Add a custom link",icon:"Link",category:"content",defaultConfig:{type:"link",title:"Click Here",url:"https://example.com",style:"button",openInNewTab:!0}},{type:"contact",name:"Contact Form",description:"Let visitors reach out",icon:"Mail",category:"engagement",defaultConfig:{type:"contact",title:"Get In Touch",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"message",type:"textarea",label:"Message",placeholder:"How can I help you?",required:!0}],submitButtonText:"Send Message",successMessage:"Thank you! I'll get back to you soon."}},{type:"social",name:"Social Links",description:"Connect on social media",icon:"Share2",category:"engagement",defaultConfig:{type:"social",title:"Follow Me",links:[],layout:"horizontal",iconSize:"medium"}},{type:"video",name:"Video",description:"Embed a video",icon:"Video",category:"media",defaultConfig:{type:"video",title:"Watch My Introduction",videoUrl:"",autoplay:!1,muted:!0}},{type:"testimonial",name:"Testimonials",description:"Client reviews",icon:"MessageSquare",category:"content",defaultConfig:{type:"testimonial",title:"What Clients Say",testimonials:[],layout:"slider"}},{type:"spacer",name:"Spacer",description:"Add vertical space",icon:"MoveVertical",category:"content",defaultConfig:{type:"spacer",height:40}},{type:"image",name:"Image",description:"Add an image",icon:"Image",category:"media",defaultConfig:{type:"image",imageUrl:"",alt:"Image",size:"medium"}},{type:"text",name:"Text Block",description:"Add custom text",icon:"Type",category:"content",defaultConfig:{type:"text",content:"Your text here...",align:"left",fontSize:"medium"}}]}getBlockTemplate(e){return this.getBlockTemplates().find(s=>s.type===e)}generateId(){return`block_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}validatePage(e){const s=[];e.slug&&""!==e.slug.trim()||s.push("Page slug is required"),e.title&&""!==e.title.trim()||s.push("Page title is required"),/^[a-z0-9-]+$/i.test(e.slug)||s.push("Page slug must contain only letters, numbers, and hyphens");const t=e.blocks.map(e=>e.id),a=new Set(t);return t.length!==a.size&&s.push("Duplicate block IDs detected"),{valid:0===s.length,errors:s}}},M=_.createNewPage.bind(_),E=_.addBlock.bind(_),T=_.removeBlock.bind(_),z=_.updateBlock.bind(_),F=_.reorderBlocks.bind(_),q=_.toggleBlockVisibility.bind(_),L=_.duplicateBlock.bind(_),U=_.getBlockTemplates.bind(_);_.validatePage.bind(_);const V=a((e,s)=>({page:null,selectedBlockId:null,isDragging:!1,history:[],historyIndex:-1,isPreviewMode:!1,isSaving:!1,setPage:s=>{e({page:s,history:[s],historyIndex:0,selectedBlockId:null})},loadPage:async e=>{try{const{data:t,error:a}=await l.from("custom_pages").select("*").eq("id",e).single();if(a)throw a;if(!t)throw new Error("Page not found");const i={id:t.id,userId:t.user_id,slug:t.slug,title:t.title,description:t.description||"",blocks:t.blocks,theme:t.theme,seo:t.seo,published:t.published,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)};s().setPage(i)}catch(t){throw i.error("Failed to load page"),t}},loadUserPages:async()=>{try{const{data:{user:e}}=await l.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:s,error:t}=await l.from("custom_pages").select("*").eq("user_id",e.id).order("updated_at",{ascending:!1});if(t)throw t;return(s||[]).map(e=>({id:e.id,userId:e.user_id,slug:e.slug,title:e.title,description:e.description||"",blocks:e.blocks,theme:e.theme,seo:e.seo,published:e.published,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}catch(e){return[]}},selectBlock:s=>{e({selectedBlockId:s})},setIsDragging:s=>{e({isDragging:s})},addBlockToPage:(t,a)=>{var i;const{page:l,history:r,historyIndex:o}=s();if(!l)return;const c=E(l,t,a),n=r.slice(0,o+1);n.push(c),e({page:c,history:n,historyIndex:n.length-1,selectedBlockId:null==(i=c.blocks[c.blocks.length-1])?void 0:i.id})},removeBlockFromPage:t=>{const{page:a,history:i,historyIndex:l}=s();if(!a)return;const r=T(a,t),o=i.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1,selectedBlockId:null})},updateBlockConfig:(t,a)=>{const{page:i,history:l,historyIndex:r}=s();if(!i)return;const o=z(i,t,a),c=l.slice(0,r+1);c.push(o),e({page:o,history:c,historyIndex:c.length-1})},reorderPageBlocks:(t,a)=>{const{page:i,history:l,historyIndex:r}=s();if(!i)return;const o=F(i,t,a),c=l.slice(0,r+1);c.push(o),e({page:o,history:c,historyIndex:c.length-1})},toggleBlockVisible:t=>{const{page:a,history:i,historyIndex:l}=s();if(!a)return;const r=q(a,t),o=i.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1})},duplicatePageBlock:t=>{const{page:a,history:i,historyIndex:l}=s();if(!a)return;const r=L(a,t),o=i.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1})},updatePageMeta:t=>{const{page:a,history:i,historyIndex:l}=s();if(!a)return;const r={...a,...t,updatedAt:new Date},o=i.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1})},undo:()=>{const{history:t,historyIndex:a}=s();a>0&&e({page:t[a-1],historyIndex:a-1})},redo:()=>{const{history:t,historyIndex:a}=s();a<t.length-1&&e({page:t[a+1],historyIndex:a+1})},canUndo:()=>{const{historyIndex:e}=s();return e>0},canRedo:()=>{const{history:e,historyIndex:t}=s();return t<e.length-1},togglePreviewMode:()=>{e(e=>({isPreviewMode:!e.isPreviewMode,selectedBlockId:null}))},savePage:async()=>{const{page:t}=s();if(t){e({isSaving:!0});try{const{data:{user:e}}=await l.auth.getUser();if(!e)throw new Error("Not authenticated");const s={user_id:e.id,slug:t.slug,title:t.title,description:t.description,blocks:t.blocks,theme:t.theme,seo:t.seo,published:t.published},{data:a}=await l.from("custom_pages").select("id").eq("id",t.id).single();if(a){const{error:e}=await l.from("custom_pages").update(s).eq("id",t.id);if(e)throw e}else{const{error:e}=await l.from("custom_pages").insert({...s,id:t.id});if(e)throw e}i.success("Page saved successfully")}catch(a){throw i.error("Failed to save page"),a}finally{e({isSaving:!1})}}},publishPage:async()=>{const{page:e,updatePageMeta:t,savePage:a}=s();e&&(t({published:!0}),await a(),i.success("Page published successfully!"))},setAsActivePage:async e=>{try{const{data:{user:s}}=await l.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:t}=await l.from("custom_pages").update({is_active:!0}).eq("id",e).eq("user_id",s.id);if(t)throw t;i.success("This page is now your active profile")}catch(s){throw i.error("Failed to set active page"),s}},resetBuilder:()=>{e({page:null,selectedBlockId:null,isDragging:!1,history:[],historyIndex:-1,isPreviewMode:!1,isSaving:!1})}}));function Y(){const a=s(),{user:d,profile:u}=r(),{setPage:b,loadUserPages:w,setAsActivePage:v}=V(),[j,k]=t.useState([]),[N,P]=t.useState(!0),[B,I]=t.useState(null);t.useEffect(()=>{C()},[]);const C=async()=>{try{const e=await w();k(e)}catch(e){i.error("Failed to load pages")}finally{P(!1)}},S=()=>{if(!d||!u)return void i.error("Please log in to create a page");const e=M(d.id,u.username||"my-page");b(e),a("/dashboard/page-builder")};return N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading pages..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Your Pages"}),e.jsx("p",{className:"text-muted-foreground",children:"Create custom link-in-bio pages"})]}),e.jsxs(o,{onClick:S,className:"gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),"Create New Page"]})]}),0===j.length?e.jsx(c,{className:"p-12 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(g,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No pages yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Create your first custom page to get started"}),e.jsxs(o,{onClick:S,className:"gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),"Create Your First Page"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(s=>{const t=s.is_active||!1;return e.jsxs(c,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["/",s.slug]})]}),t&&e.jsxs(n,{variant:"default",className:"gap-1",children:[e.jsx(m,{className:"h-3 w-3"}),"Active"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:s.published?"default":"secondary",children:s.published?"Published":"Draft"}),e.jsxs(n,{variant:"outline",children:[s.blocks.length," blocks"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>(e=>{b(e),a("/dashboard/page-builder")})(s),className:"gap-2 w-full",children:[e.jsx(p,{className:"h-4 w-4"}),"Edit"]}),s.published&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",asChild:!0,className:"gap-2 w-full",children:e.jsxs("a",{href:`/p/${s.slug}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(x,{className:"h-4 w-4"}),"Preview",e.jsx(y,{className:"h-3 w-3 ml-auto"})]})}),!t&&e.jsxs(o,{variant:"default",size:"sm",onClick:()=>(async e=>{I(e);try{await v(e),await C()}catch(s){}finally{I(null)}})(s.id),disabled:B===s.id,className:"gap-2 w-full",children:[e.jsx(m,{className:"h-4 w-4"}),B===s.id?"Setting...":"Set as Active"]})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this page?"))try{const{error:s}=await l.from("custom_pages").delete().eq("id",e);if(s)throw s;i.success("Page deleted successfully"),await C()}catch(s){i.error("Failed to delete page")}})(s.id),className:"gap-2 w-full text-destructive hover:text-destructive",children:[e.jsx(f,{className:"h-4 w-4"}),"Delete"]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]},s.id)})})]})}function R(){const{user:s,profile:a}=r(),[l,c]=t.useState(!0),{page:m,selectedBlockId:p,isPreviewMode:y,isSaving:_,canUndo:M,canRedo:E,setPage:T,selectBlock:z,addBlockToPage:F,removeBlockFromPage:q,duplicatePageBlock:L,toggleBlockVisible:R,undo:H,redo:$,togglePreviewMode:G,savePage:W,publishPage:O,updatePageMeta:X}=V();t.useEffect(()=>{c(!m)},[m]);const J=null==m?void 0:m.blocks.find(e=>e.id===p),K=U();return l||!m?e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(Y,{})}):e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[!y&&e.jsxs("div",{className:"w-64 bg-white border-r flex flex-col",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"font-semibold text-lg",children:"Add Blocks"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:K.map(s=>e.jsx("button",{onClick:()=>F(s.type),className:"w-full p-3 text-left rounded-lg border hover:border-primary hover:bg-primary/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"w-5 h-5 text-gray-400 group-hover:text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]})},s.type))})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{T(null),c(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Back to Pages"]}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),e.jsx(o,{variant:"outline",size:"sm",onClick:H,disabled:!M(),children:e.jsx(w,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:$,disabled:!E(),children:e.jsx(v,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),e.jsx(d,{type:"text",value:m.title,onChange:e=>X({title:e.target.value}),className:"w-64",placeholder:"Page Title"}),e.jsx(n,{variant:m.published?"default":"secondary",children:m.published?"Published":"Draft"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:G,children:y?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Edit"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Preview"]})}),e.jsxs(o,{variant:"outline",size:"sm",onClick:async()=>{try{await W(),i.success("Page saved successfully!")}catch(e){i.error("Failed to save page")}},disabled:_,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),_?"Saving...":"Save"]}),e.jsxs(o,{size:"sm",onClick:async()=>{try{await O(),i.success("Page published successfully!")}catch(e){i.error("Failed to publish page")}},disabled:_,children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Publish"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:e.jsx("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-lg min-h-full",children:e.jsx("div",{className:"p-8 space-y-6",children:0===m.blocks.length?e.jsxs("div",{className:"text-center py-20 text-gray-500",children:[e.jsx(h,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"Your page is empty"}),e.jsx("p",{className:"text-sm mt-1",children:"Add blocks from the left sidebar to get started"})]}):m.blocks.map(s=>e.jsxs("div",{className:"relative group",children:[!y&&e.jsxs("div",{className:"absolute -left-12 top-0 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[e.jsx("button",{className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Drag to reorder",children:e.jsx(N,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(s.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Duplicate",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(s.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:s.visible?"Hide":"Show",children:s.visible?e.jsx(x,{className:"w-4 h-4"}):e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(s.id),className:"p-1 bg-white border rounded hover:bg-red-50 text-red-600",title:"Delete",children:e.jsx(f,{className:"w-4 h-4"})})]}),e.jsx(I,{block:s,isEditing:!y,isSelected:p===s.id,onSelect:()=>z(s.id)})]},s.id))})})})]}),!y&&J&&e.jsxs("div",{className:"w-80 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Block Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:J.type})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs(C,{defaultValue:"content",className:"w-full",children:[e.jsxs(S,{className:"grid w-full grid-cols-2",children:[e.jsx(D,{value:"content",children:"Content"}),e.jsx(D,{value:"style",children:"Style"})]}),e.jsxs(A,{value:"content",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Block Type"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:J.type})]}),e.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Block-specific settings will appear here"})]}),e.jsx(A,{value:"style",className:"space-y-4 mt-4",children:e.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Style settings coming soon"})})]})}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs(o,{variant:"outline",className:"w-full",onClick:()=>q(J.id),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Delete Block"]})})]})]})}export{R as default};
