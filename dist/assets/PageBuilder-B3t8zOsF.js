import{g as e,r as s,j as a}from"./react-vendor-CGQ4_CNL.js";import{u as l,a as t}from"./stores-Bwj68t5x.js";import{L as r,M as i,N as c,n as d,O as n,q as o}from"./libs-DEoVJxQ-.js";import{j as m,C as x,B as h,D as u,l as p,m as g,n as j,z as f,I as N,G as v,J as b,K as y,M as w,L as k}from"./ui-components-Dd2IjC0U.js";import{u as C}from"./utils-wmY8hpgz.js";import{s as P}from"./supabase-BYwji6mk.js";import{aw as S,G as B,n as z,ay as D,E as F,h as E,az as A,g as T,a2 as M,aV as I,aW as L,an as V,aH as Y,aI as $,aE as _,aJ as q,ae as G,a4 as H}from"./icons-BX9Iz4zT.js";import{B as J}from"./BlockRenderer-Cafm8yGc.js";import"./charts-D_q0pR-d.js";import"./data-O5cD9hjv.js";import"./forms-BzNDvv3d.js";function O(){const d=e(),{user:n,profile:o}=l(),{setPage:N,loadUserPages:v,setAsActivePage:b}=t(),[y,w]=s.useState([]),[k,M]=s.useState(!0),[I,L]=s.useState(null),[V,Y]=s.useState(!1);s.useEffect(()=>{$()},[]);const $=async()=>{try{const e=await v();w(e)}catch(e){C.error("Failed to load pages")}finally{M(!1)}},_=()=>{n&&o?Y(!0):C.error("Please log in to create a page")},q=e=>{if(!n||!o)return void C.error("Please log in to create a page");const s=i(n.id,o.username||"my-page");if(e){const a=r.find(s=>s.id===e);a&&(s.blocks=c(a,n.id,s.slug),C.success(`Created page from "${a.name}" template!`))}N(s),Y(!1),d("/dashboard/page-builder")};return k?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("p",{className:"text-muted-foreground",children:"Loading pages..."})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Your Pages"}),a.jsx("p",{className:"text-muted-foreground",children:"Create custom link-in-bio pages"})]}),a.jsxs(m,{onClick:_,className:"gap-2",children:[a.jsx(S,{className:"h-4 w-4"}),"Create New Page"]})]}),0===y.length?a.jsx(x,{className:"p-12 text-center",children:a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsx(B,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No pages yet"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"Create your first custom page to get started"}),a.jsxs(m,{onClick:_,className:"gap-2",children:[a.jsx(S,{className:"h-4 w-4"}),"Create Your First Page"]})]})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(e=>{const s=e.is_active||!1;return a.jsxs(x,{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-lg truncate",children:e.title}),a.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["/",e.slug]})]}),s&&a.jsxs(h,{variant:"default",className:"gap-1",children:[a.jsx(z,{className:"h-3 w-3"}),"Active"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(h,{variant:e.published?"default":"secondary",children:e.published?"Published":"Draft"}),a.jsxs(h,{variant:"outline",children:[e.blocks.length," blocks"]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs(m,{variant:"outline",size:"sm",onClick:()=>(e=>{N(e),d("/dashboard/page-builder")})(e),className:"gap-2 w-full",children:[a.jsx(D,{className:"h-4 w-4"}),"Edit"]}),e.published&&a.jsxs(a.Fragment,{children:[a.jsx(m,{variant:"outline",size:"sm",asChild:!0,className:"gap-2 w-full",children:a.jsxs("a",{href:`/p/${e.slug}`,target:"_blank",rel:"noopener noreferrer",children:[a.jsx(F,{className:"h-4 w-4"}),"Preview",a.jsx(E,{className:"h-3 w-3 ml-auto"})]})}),!s&&a.jsxs(m,{variant:"default",size:"sm",onClick:()=>(async e=>{L(e);try{await b(e),await $()}catch(s){}finally{L(null)}})(e.id),disabled:I===e.id,className:"gap-2 w-full",children:[a.jsx(z,{className:"h-4 w-4"}),I===e.id?"Setting...":"Set as Active"]})]}),a.jsxs(m,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this page?"))try{const{error:s}=await P.from("custom_pages").delete().eq("id",e);if(s)throw s;C.success("Page deleted successfully"),await $()}catch(s){C.error("Failed to delete page")}})(e.id),className:"gap-2 w-full text-destructive hover:text-destructive",children:[a.jsx(A,{className:"h-4 w-4"}),"Delete"]})]}),e.description&&a.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description})]},e.id)})}),a.jsx(u,{open:V,onOpenChange:Y,children:a.jsxs(p,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[a.jsxs(g,{children:[a.jsx(j,{children:"Choose a Template"}),a.jsx(f,{children:"Start with a pre-built template or create a blank page"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4",children:[a.jsx(x,{className:"p-6 cursor-pointer hover:border-primary transition-colors",onClick:()=>q(null),children:a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.jsx("div",{className:"p-2 bg-gray-100 rounded",children:a.jsx(S,{className:"h-6 w-6"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Blank Page"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Start from scratch"})]})]}),a.jsx("p",{className:"text-sm text-muted-foreground flex-1",children:"Create a completely custom page by adding blocks one at a time."})]})}),r.map(e=>a.jsx(x,{className:"p-6 cursor-pointer hover:border-primary transition-colors",onClick:()=>q(e.id),children:a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.jsx("div",{className:"p-2 bg-primary/10 rounded",children:a.jsx(T,{className:"h-6 w-6 text-primary"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:e.name}),a.jsxs(h,{variant:"outline",className:"mt-1",children:[e.blocks.length," blocks"]})]})]}),a.jsx("p",{className:"text-sm text-muted-foreground flex-1",children:e.description})]})},e.id))]})]})})]})}function R(){const{user:e,profile:r}=l(),[i,c]=s.useState(!0),[x,u]=s.useState(null),[p,g]=s.useState(!1),{page:j,selectedBlockId:f,isPreviewMode:P,isSaving:z,canUndo:D,canRedo:E,setPage:T,selectBlock:R,addBlockToPage:U,removeBlockFromPage:W,duplicatePageBlock:K,toggleBlockVisible:Q,undo:X,redo:Z,togglePreviewMode:ee,savePage:se,publishPage:ae,updatePageMeta:le}=t();s.useEffect(()=>{c(!j)},[j]),s.useEffect(()=>{j?.theme&&d(j.theme)},[j?.theme]),s.useEffect(()=>{if(!j||z)return;const e=setTimeout(async()=>{try{await se();u(new Date)}catch(e){C.error("Auto-save failed - please save manually")}},3e3);return()=>clearTimeout(e)},[j,z,se]);const te=j?.blocks.find(e=>e.id===f),re=n();return i||!j?a.jsx("div",{className:"container mx-auto py-8",children:a.jsx(O,{})}):a.jsxs("div",{className:"flex h-screen bg-gray-50",children:[!P&&a.jsxs("div",{className:"w-64 bg-white border-r flex flex-col",children:[a.jsx("div",{className:"p-4 border-b",children:a.jsx("h2",{className:"font-semibold text-lg",children:"Add Blocks"})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:re.map(e=>a.jsx("button",{onClick:()=>U(e.type),className:"w-full p-3 text-left rounded-lg border hover:border-primary hover:bg-primary/5 transition-colors group",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(S,{className:"w-5 h-5 text-gray-400 group-hover:text-primary"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",children:e.name}),a.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]})},e.type))})]}),a.jsxs("div",{className:"flex-1 flex flex-col",children:[a.jsxs("div",{className:"bg-white border-b p-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{T(null),c(!0)},children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),"Back to Pages"]}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),a.jsx(m,{variant:"outline",size:"sm",onClick:X,disabled:!D(),children:a.jsx(I,{className:"w-4 h-4"})}),a.jsx(m,{variant:"outline",size:"sm",onClick:Z,disabled:!E(),children:a.jsx(L,{className:"w-4 h-4"})}),a.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),a.jsx(N,{type:"text",value:j.title,onChange:e=>le({title:e.target.value}),className:"w-64",placeholder:"Page Title"}),a.jsx(h,{variant:j.published?"default":"secondary",children:j.published?"Published":"Draft"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(m,{variant:"outline",size:"sm",onClick:ee,children:P?a.jsxs(a.Fragment,{children:[a.jsx(V,{className:"w-4 h-4 mr-2"}),"Edit"]}):a.jsxs(a.Fragment,{children:[a.jsx(F,{className:"w-4 h-4 mr-2"}),"Preview"]})}),a.jsxs("div",{className:"flex border rounded-md",children:[a.jsx(m,{variant:p?"ghost":"default",size:"sm",onClick:()=>g(!1),className:"rounded-r-none",title:"Desktop Preview",children:a.jsx(Y,{className:"w-4 h-4"})}),a.jsx(m,{variant:p?"default":"ghost",size:"sm",onClick:()=>g(!0),className:"rounded-l-none",title:"Mobile Preview",children:a.jsx($,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(m,{variant:"outline",size:"sm",onClick:async()=>{try{await se(),u(new Date),C.success("Page saved successfully!")}catch(e){C.error("Failed to save page")}},disabled:z,children:[a.jsx(_,{className:"w-4 h-4 mr-2"}),z?"Saving...":"Save"]}),x&&!z&&a.jsxs("span",{className:"text-xs text-gray-500",children:["Saved ",x.toLocaleTimeString()]})]}),a.jsxs(m,{size:"sm",onClick:async()=>{try{await ae(),C.success("Page published successfully!")}catch(e){C.error("Failed to publish page")}},disabled:z,children:[a.jsx(B,{className:"w-4 h-4 mr-2"}),"Publish"]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:a.jsx("div",{className:"mx-auto rounded-lg shadow-lg min-h-full transition-all duration-300",style:{...o(j.theme),backgroundColor:j.theme.colors.background,color:j.theme.colors.text,fontFamily:`'${j.theme.fonts.body}', sans-serif`,maxWidth:p?"375px":"672px"},children:a.jsx("div",{className:"p-8",style:{display:"flex",flexDirection:"column",gap:"compact"===j.theme.spacing?"1rem":"spacious"===j.theme.spacing?"3rem":"2rem"},children:0===j.blocks.length?a.jsxs("div",{className:"text-center py-20 text-gray-500",children:[a.jsx(S,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),a.jsx("p",{className:"font-medium",children:"Your page is empty"}),a.jsx("p",{className:"text-sm mt-1",children:"Add blocks from the left sidebar to get started"})]}):j.blocks.map(e=>a.jsxs("div",{className:"relative group",children:[!P&&a.jsxs("div",{className:"absolute -left-12 top-0 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[a.jsx("button",{className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Drag to reorder",children:a.jsx(q,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>K(e.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Duplicate",children:a.jsx(G,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>Q(e.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:e.visible?"Hide":"Show",children:e.visible?a.jsx(F,{className:"w-4 h-4"}):a.jsx(H,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>W(e.id),className:"p-1 bg-white border rounded hover:bg-red-50 text-red-600",title:"Delete",children:a.jsx(A,{className:"w-4 h-4"})})]}),a.jsx(J,{block:e,isEditing:!P,isSelected:f===e.id,onSelect:()=>R(e.id),userId:j.userId})]},e.id))})})})]}),!P&&te&&a.jsxs("div",{className:"w-80 bg-white border-l flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b",children:[a.jsx("h2",{className:"font-semibold text-lg",children:"Block Settings"}),a.jsx("p",{className:"text-sm text-gray-600",children:te.type})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.jsxs(v,{defaultValue:"content",className:"w-full",children:[a.jsxs(b,{className:"grid w-full grid-cols-2",children:[a.jsx(y,{value:"content",children:"Content"}),a.jsx(y,{value:"style",children:"Style"})]}),a.jsxs(w,{value:"content",className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(k,{children:"Block Type"}),a.jsx("p",{className:"text-sm text-gray-600 capitalize",children:te.type})]}),a.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Block-specific settings will appear here"})]}),a.jsx(w,{value:"style",className:"space-y-4 mt-4",children:a.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Style settings coming soon"})})]})}),a.jsx("div",{className:"p-4 border-t",children:a.jsxs(m,{variant:"outline",className:"w-full",onClick:()=>W(te.id),children:[a.jsx(A,{className:"w-4 h-4 mr-2"}),"Delete Block"]})})]})]})}export{R as default};
