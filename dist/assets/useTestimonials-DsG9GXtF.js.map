{"version":3,"file":"useTestimonials-DsG9GXtF.js","sources":["../../src/hooks/useTestimonials.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuthStore } from \"@/stores/useAuthStore\";\nimport { useToast } from \"./use-toast\";\n\nexport interface Testimonial {\n  id: string;\n  user_id: string;\n  client_name: string;\n  rating: number;\n  review: string;\n  property_type?: string;\n  date: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport function useTestimonials() {\n  const { user } = useAuthStore();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const { data: testimonials = [], isLoading, isError, error, refetch } = useQuery({\n    queryKey: [\"testimonials\", user?.id],\n    queryFn: async () => {\n      if (!user?.id) return [];\n\n      const { data, error } = await supabase\n        .from(\"testimonials\")\n        .select(\"*\")\n        .eq(\"user_id\", user.id)\n        .order(\"date\", { ascending: false });\n\n      if (error) throw error;\n      return data as Testimonial[];\n    },\n    enabled: !!user?.id,\n  });\n\n  const addTestimonial = useMutation({\n    mutationFn: async (testimonialData: Omit<Testimonial, \"id\" | \"user_id\" | \"created_at\" | \"updated_at\">) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      const { data, error } = await supabase\n        .from(\"testimonials\")\n        .insert({\n          user_id: user.id,\n          ...testimonialData,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"testimonials\", user?.id] });\n      toast({\n        title: \"Testimonial Added\",\n        description: \"Your testimonial has been added successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to Add Testimonial\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTestimonial = useMutation({\n    mutationFn: async ({ id, ...updates }: Partial<Testimonial> & { id: string }) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      // Security: Verify user owns this testimonial by requiring both id and user_id match\n      const { data, error } = await supabase\n        .from(\"testimonials\")\n        .update(updates)\n        .eq(\"id\", id)\n        .eq(\"user_id\", user.id)\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"testimonials\", user?.id] });\n      toast({\n        title: \"Testimonial Updated\",\n        description: \"Your testimonial has been updated successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to Update Testimonial\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteTestimonial = useMutation({\n    mutationFn: async (id: string) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      // Security: Verify user owns this testimonial by requiring both id and user_id match\n      const { error } = await supabase\n        .from(\"testimonials\")\n        .delete()\n        .eq(\"id\", id)\n        .eq(\"user_id\", user.id);\n\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"testimonials\", user?.id] });\n      toast({\n        title: \"Testimonial Deleted\",\n        description: \"Your testimonial has been deleted successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to Delete Testimonial\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return {\n    testimonials,\n    isLoading,\n    isError,\n    error,\n    refetch,\n    addTestimonial,\n    updateTestimonial,\n    deleteTestimonial,\n  };\n}\n"],"names":["useTestimonials","user","useAuthStore","queryClient","useQueryClient","toast","useToast","testimonials","isLoading","isError","error","refetch","useQuery","data","supabase","addTestimonial","useMutation","testimonialData","updateTestimonial","id","updates","deleteTestimonial"],"mappings":"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"}