import{ab as I,r as v,j as e,B as j,Y as A,g as G,a0 as R,H as V,ai as g,U as F,a3 as J,h as $,K as P,N as z,O as B,Q as M,R as k,I as X,a5 as Y,n as _,a4 as Z,l as ee}from"./index-CjfB9Lcv.js";import{R as Q}from"./refresh-cw-Cth5bTg-.js";import{C as se}from"./circle-x-Ce6WofIf.js";import{f as W}from"./formatDistanceToNow-CkGXU38F.js";import{T as q}from"./triangle-alert-ZuZbnF8o.js";import{S as te}from"./square-check-big-Bj0QDZNt.js";import{S as ae}from"./square-2gsVhW7-.js";import{S as re}from"./square-pen-C975Qh0t.js";import{T as ne}from"./trash-2-DZwArYtj.js";import{S as le}from"./save-BlNK82d_.js";import{K as ie}from"./KeyboardShortcutsHelper-CIkKRThs.js";import{T as ce,a as de,b as O,c as H}from"./tabs-DNx-XvNW.js";import{u as oe}from"./useListings-aiqzu_Yg.js";import{u as he}from"./useAnalytics-CZF4WAYX.js";import"./index-BaY3E_kl.js";import"./useMutation-T5qVTYdw.js";const me=I("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);const ue=I("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);function xe({listings:s,onStatusChange:i,onRefresh:h,isLoading:d=!1}){const[m,o]=v.useState(new Set),[S,c]=v.useState(new Set),[u,p]=v.useState("all"),N=a=>Math.floor((Date.now()-new Date(a.updatedAt).getTime())/864e5)>=7&&a.status==="active",C=s.filter(a=>u==="all"?!0:u==="stale"?N(a):a.status===u),b={total:s.length,active:s.filter(a=>a.status==="active").length,pending:s.filter(a=>a.status==="pending").length,sold:s.filter(a=>a.status==="sold").length,stale:s.filter(a=>N(a)).length},f=async(a,t)=>{c(r=>new Set(r).add(a));try{await i(a,t),g.success(`Listing updated to ${t}`)}catch(r){console.error("Failed to update status:",r),g.error("Failed to update listing")}finally{c(r=>{const x=new Set(r);return x.delete(a),x})}},l=async a=>{if(m.size===0){g.warning("No listings selected");return}const t=m.size;g.info(`Updating ${t} listing(s)...`);const r=Array.from(m).map(x=>f(x,a));await Promise.all(r),o(new Set),g.success(`${t} listing(s) updated to ${a}`)},y=a=>{o(t=>{const r=new Set(t);return r.has(a)?r.delete(a):r.add(a),r})},D=()=>{o(new Set(C.map(a=>a.id)))},L=()=>{o(new Set)};return v.useEffect(()=>{const a=t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)&&m.size!==0)switch(t.key.toLowerCase()){case"s":t.preventDefault(),l("sold");break;case"p":t.preventDefault(),l("pending");break;case"a":t.preventDefault(),l("active");break;case"escape":L();break}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[m]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Quick Status Updates"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click listings to select, then use buttons or keyboard shortcuts"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:h,disabled:d,className:"gap-2",children:[e.jsx(Q,{className:A("w-4 h-4",d&&"animate-spin")}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(U,{label:"Total",count:b.total,active:u==="all",onClick:()=>p("all")}),e.jsx(U,{label:"Active",count:b.active,active:u==="active",onClick:()=>p("active"),color:"green"}),e.jsx(U,{label:"Pending",count:b.pending,active:u==="pending",onClick:()=>p("pending"),color:"yellow"}),e.jsx(U,{label:"Sold",count:b.sold,color:"blue"}),e.jsx(U,{label:"Stale",count:b.stale,active:u==="stale",onClick:()=>p("stale"),color:"orange",alert:b.stale>0})]}),m.size>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold",children:[m.size," selected"]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:D,children:"Select All"}),e.jsx(j,{variant:"ghost",size:"sm",onClick:L,children:"Clear"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>l("active"),className:"gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),"Active ",e.jsx("kbd",{className:"ml-1 text-xs",children:"A"})]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>l("pending"),className:"gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),"Pending ",e.jsx("kbd",{className:"ml-1 text-xs",children:"P"})]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>l("sold"),className:"gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),"Sold ",e.jsx("kbd",{className:"ml-1 text-xs",children:"S"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(a=>e.jsx(ge,{listing:a,isSelected:m.has(a.id),isUpdating:S.has(a.id),onSelect:()=>y(a.id),onStatusChange:f,isStale:N(a)},a.id))}),C.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No listings found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters"})]})]})}function U({label:s,count:i,active:h,onClick:d,color:m,alert:o}){const S={green:"text-green-600 bg-green-50 border-green-200",yellow:"text-yellow-600 bg-yellow-50 border-yellow-200",blue:"text-blue-600 bg-blue-50 border-blue-200",orange:"text-orange-600 bg-orange-50 border-orange-200"};return e.jsxs("button",{onClick:d,disabled:!d,className:A("relative p-4 rounded-lg border-2 transition-all",h?"border-primary bg-primary/5":"border-gray-200 bg-white",d&&"hover:border-primary/50 cursor-pointer",!d&&"cursor-default"),children:[o&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-orange-500 rounded-full animate-pulse"}),e.jsx("div",{className:"text-3xl font-bold",children:i}),e.jsx("div",{className:A("text-sm font-medium",m&&S[m]),children:s})]})}function ge({listing:s,isSelected:i,isUpdating:h,onSelect:d,onStatusChange:m,isStale:o}){const S={active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",sold:"bg-red-100 text-red-800",draft:"bg-gray-100 text-gray-800"};return e.jsxs("div",{onClick:d,className:A("relative group p-4 rounded-lg border-2 transition-all cursor-pointer",i?"border-primary bg-primary/5 shadow-md":"border-gray-200 bg-white hover:border-gray-300",h&&"opacity-50 pointer-events-none",o&&"border-l-4 border-l-orange-500"),children:[e.jsx("div",{className:A("absolute top-2 left-2 w-5 h-5 rounded border-2 flex items-center justify-center",i?"bg-primary border-primary":"border-gray-300 group-hover:border-primary"),children:i&&e.jsx(G,{className:"w-4 h-4 text-white"})}),o&&e.jsxs(F,{variant:"outline",className:"absolute top-2 right-2 bg-orange-100 text-orange-800 border-orange-300",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Stale"]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-sm truncate mb-1",children:s.title}),e.jsxs("p",{className:"text-lg font-bold text-primary mb-2",children:["$",s.price.toLocaleString()]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(F,{className:S[s.status],children:s.status.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500",children:W(new Date(s.updatedAt),{addSuffix:!0})})]}),(s.views!==void 0||s.leads!==void 0)&&e.jsxs("div",{className:"flex gap-3 text-xs text-gray-600 mb-3",children:[s.views!==void 0&&e.jsxs("span",{children:["ðŸ‘ï¸ ",s.views," views"]}),s.leads!==void 0&&e.jsxs("span",{children:["ðŸ‘¥ ",s.leads," leads"]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status!=="sold"&&e.jsx(j,{size:"sm",variant:"outline",onClick:c=>{c.stopPropagation(),m(s.id,"sold")},className:"flex-1 text-xs",children:"Mark Sold"}),s.status!=="pending"&&e.jsx(j,{size:"sm",variant:"outline",onClick:c=>{c.stopPropagation(),m(s.id,"pending")},className:"flex-1 text-xs",children:"Pending"})]})]}),h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 animate-spin text-primary"})})]})}function pe({staleListings:s,onDismiss:i,onRefresh:h,onDismissAll:d,className:m}){const[o,S]=v.useState(!0),[c,u]=v.useState(new Set);v.useEffect(()=>{const l=localStorage.getItem("dismissed-stale-alerts");if(l)try{u(new Set(JSON.parse(l)))}catch(y){console.error("Failed to parse dismissed alerts:",y)}},[]),v.useEffect(()=>{localStorage.setItem("dismissed-stale-alerts",JSON.stringify(Array.from(c)))},[c]);const p=s.filter(l=>!c.has(l.id));if(p.length===0)return null;const N=l=>{u(y=>new Set(y).add(l)),i?.(l)},C=()=>{u(new Set(s.map(l=>l.id))),d?.()},b=p.filter(l=>l.daysSinceUpdate>=14).length,f=p.length-b;return e.jsxs("div",{className:A("bg-orange-50 border-2 border-orange-200 rounded-lg",m),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:()=>S(!o),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"w-6 h-6 text-orange-600"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-orange-600 text-white text-xs rounded-full flex items-center justify-center font-bold",children:p.length})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-orange-900",children:"Stale Listings Need Attention"}),e.jsxs("p",{className:"text-sm text-orange-700",children:[b>0&&e.jsxs("span",{className:"font-medium",children:[b," critical (14+ days)"]}),b>0&&f>0&&" Â· ",f>0&&e.jsxs("span",{children:[f," warning (7+ days)"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:l=>{l.stopPropagation(),C()},className:"text-orange-700 hover:text-orange-900",children:"Dismiss All"}),e.jsx(j,{size:"sm",variant:"ghost",className:"text-orange-700",onClick:l=>l.stopPropagation(),children:o?"â–¼":"â–¶"})]})]}),o&&e.jsx("div",{className:"border-t border-orange-200 divide-y divide-orange-200",children:p.map(l=>e.jsx(je,{listing:l,onDismiss:()=>N(l.id),onRefresh:()=>h?.(l.id)},l.id))}),o&&e.jsxs("div",{className:"p-4 bg-orange-100/50 border-t border-orange-200",children:[e.jsx("p",{className:"text-xs text-orange-800 mb-2 font-medium",children:"ðŸ’¡ Quick Tips:"}),e.jsxs("ul",{className:"text-xs text-orange-700 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"Update listing descriptions with recent improvements or price changes"}),e.jsx("li",{children:"Add new photos to refresh your listing's appeal"}),e.jsx("li",{children:"Verify pricing is still competitive in current market"}),e.jsx("li",{children:"Check if property status has changed"})]})]})]})}function je({listing:s,onDismiss:i,onRefresh:h}){const d=s.daysSinceUpdate>=14;return e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-orange-100/30 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsx(F,{variant:"outline",className:A("text-xs",d?"bg-red-100 text-red-800 border-red-300":"bg-yellow-100 text-yellow-800 border-yellow-300"),children:d?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),"CRITICAL"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"WARNING"]})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Status: ",s.status]}),e.jsxs("span",{children:["Last updated:"," ",W(new Date(s.updatedAt),{addSuffix:!0})]}),e.jsxs("span",{className:"font-medium text-orange-700",children:[s.daysSinceUpdate," days old"]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(j,{size:"sm",variant:"outline",onClick:h,className:"gap-1 bg-white",children:[e.jsx(Q,{className:"w-3 h-3"}),"Update"]}),e.jsx(j,{size:"sm",variant:"ghost",onClick:i,children:e.jsx(J,{className:"w-4 h-4"})})]})]})}function fe({count:s}){return s===0?null:e.jsxs(F,{variant:"outline",className:"bg-orange-100 text-orange-800 border-orange-300 animate-pulse",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),s," Stale"]})}function ve({listings:s,selectedIds:i,onToggleSelect:h,onSelectAll:d,onClearSelection:m,onBulkUpdate:o,onBulkDelete:S}){const[c,u]=v.useState(!1),[p,N]=v.useState({}),[C,b]=v.useState("increase"),[f,l]=v.useState(""),[y,D]=v.useState("percent"),L=s.filter(n=>i.includes(n.id)),a=s.length>0&&i.length===s.length,t=async()=>{if(i.length===0){g.error("No listings selected");return}const n={...p};if(f&&(n.priceAdjustment={type:C,value:parseFloat(f),unit:y}),Object.keys(n).length===0){g.warning("No changes to apply");return}try{await o(n),g.success(`${i.length} listing(s) updated`),u(!1),N({}),l("")}catch(w){console.error("Bulk update failed:",w),g.error("Failed to update listings")}},r=async()=>{if(i.length===0){g.error("No listings selected");return}if(confirm(`Delete ${i.length} listing(s)? This cannot be undone.`))try{await S(i),g.success(`${i.length} listing(s) deleted`),m()}catch(n){console.error("Bulk delete failed:",n),g.error("Failed to delete listings")}},x=n=>{if(!f)return n.price;const w=parseFloat(f);if(isNaN(w))return n.price;switch(C){case"increase":return y==="percent"?n.price*(1+w/100):n.price+w;case"decrease":return y==="percent"?n.price*(1-w/100):n.price-w;case"set":return w;default:return n.price}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:a?m:d,className:"gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),"Select All"]})}),e.jsxs("span",{className:"text-sm font-medium",children:[i.length," of ",s.length," selected"]})]}),e.jsx("div",{className:"flex gap-2",children:i.length>0&&!c&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>u(!0),className:"gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Bulk Edit"]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:r,className:"gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Delete Selected"]})]})})]}),c&&i.length>0&&e.jsxs("div",{className:"p-6 bg-white rounded-lg border-2 border-primary shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Bulk Edit ",i.length," Listings"]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>u(!1),children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Update Status"}),e.jsxs(P,{value:p.status||"",onValueChange:n=>N({...p,status:n}),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Keep current status"})}),e.jsxs(M,{children:[e.jsx(k,{value:"active",children:"Active"}),e.jsx(k,{value:"pending",children:"Pending"}),e.jsx(k,{value:"sold",children:"Sold"}),e.jsx(k,{value:"draft",children:"Draft"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Update Category"}),e.jsxs(P,{value:p.category||"",onValueChange:n=>N({...p,category:n}),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Keep current category"})}),e.jsxs(M,{children:[e.jsx(k,{value:"residential",children:"Residential"}),e.jsx(k,{value:"commercial",children:"Commercial"}),e.jsx(k,{value:"land",children:"Land"}),e.jsx(k,{value:"rental",children:"Rental"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx($,{children:"Price Adjustment"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs(P,{value:C,onValueChange:n=>b(n),children:[e.jsx(z,{children:e.jsx(B,{})}),e.jsxs(M,{children:[e.jsx(k,{value:"increase",children:"Increase"}),e.jsx(k,{value:"decrease",children:"Decrease"}),e.jsx(k,{value:"set",children:"Set to"})]})]}),e.jsx(X,{type:"number",placeholder:"Value",value:f,onChange:n=>l(n.target.value)}),e.jsxs(P,{value:y,onValueChange:n=>D(n),children:[e.jsx(z,{children:e.jsx(B,{})}),e.jsxs(M,{children:[e.jsx(k,{value:"percent",children:"Percent"}),e.jsx(k,{value:"amount",children:"Amount"})]})]})]})]})]}),L.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Preview Changes"}),e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[L.slice(0,5).map(n=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 bg-white rounded",children:[e.jsx("span",{className:"truncate flex-1",children:n.title}),f&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 line-through",children:["$",n.price.toLocaleString()]}),e.jsxs("span",{className:"font-medium text-primary",children:["$",x(n).toLocaleString()]})]})]},n.id)),L.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["... and ",L.length-5," ","more"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(j,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(j,{onClick:t,className:"gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Apply Changes"]})]})]})]})}function be({stats:s,period:i="Last 30 days",className:h}){return e.jsxs("div",{className:A("space-y-4",h),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Analytics"}),e.jsx("span",{className:"text-sm text-gray-600",children:i})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:s.map((d,m)=>e.jsx(ye,{stat:d},m))})]})}function ye({stat:s}){const i=s.icon||V,h=s.trend==="up",d=s.trend==="down";return e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:A("p-2 rounded-lg",h&&"bg-green-100",d&&"bg-red-100",!h&&!d&&"bg-gray-100"),children:e.jsx(i,{className:A("w-4 h-4",h&&"text-green-600",d&&"text-red-600",!h&&!d&&"text-gray-600")})}),s.change!==void 0&&e.jsxs("div",{className:A("flex items-center gap-1 text-xs font-medium",h&&"text-green-600",d&&"text-red-600",!h&&!d&&"text-gray-600"),children:[h&&e.jsx(ue,{className:"w-3 h-3"}),d&&e.jsx(me,{className:"w-3 h-3"}),Math.abs(s.change),"%"]})]}),e.jsx("div",{className:"text-2xl font-bold mb-1",children:s.value}),e.jsx("div",{className:"text-sm text-gray-600",children:s.label}),s.changeLabel&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.changeLabel})]})}const Ne=s=>[{label:"Total Listings",value:s.totalListings,icon:V,trend:"neutral"},{label:"Active Listings",value:s.activeListings,icon:Y,trend:"up"},{label:"Total Views",value:s.totalViews.toLocaleString(),change:s.viewsChange,changeLabel:s.viewsChange?"vs last period":void 0,icon:_,trend:s.viewsChange&&s.viewsChange>0?"up":s.viewsChange&&s.viewsChange<0?"down":"neutral"},{label:"Total Leads",value:s.totalLeads,change:s.leadsChange,changeLabel:s.leadsChange?"vs last period":void 0,icon:Z,trend:s.leadsChange&&s.leadsChange>0?"up":s.leadsChange&&s.leadsChange<0?"down":"neutral"}];function Re(){const{listings:s,isLoading:i,updateListing:h,deleteListing:d}=oe(),{stats:m}=he("30d"),[o,S]=v.useState([]),c=v.useMemo(()=>s.map(t=>({id:t.id,title:`${t.address}, ${t.city}`,price:parseFloat(t.price)||0,status:t.status||"active",updatedAt:t.updated_at||t.created_at,views:0,leads:0})),[s]),u=v.useMemo(()=>c.filter(t=>Math.floor((Date.now()-new Date(t.updatedAt).getTime())/864e5)>=7&&t.status==="active").map(t=>({id:t.id,title:t.title,status:t.status,updatedAt:t.updatedAt,daysSinceUpdate:Math.floor((Date.now()-new Date(t.updatedAt).getTime())/(1e3*60*60*24))})),[c]),p=v.useMemo(()=>{const t=c.filter(r=>r.status==="active").length;return c.length>0&&Math.floor(c.reduce((r,x)=>r+x.price,0)/c.length),Ne({totalListings:c.length,activeListings:t,totalViews:m.totalViews,totalLeads:m.totalLeads,viewsChange:0,leadsChange:0})},[c,m]),N=async(t,r)=>{try{await h.mutateAsync({id:t,status:r}),g.success("Listing status updated")}catch{g.error("Failed to update listing status")}},C=async()=>{g.success("Listings refreshed")},b=async t=>{const r=c.find(x=>x.id===t);r&&g.info(`Opening editor for "${r.title}"`)},f=t=>{S(r=>r.includes(t)?r.filter(x=>x!==t):[...r,t])},l=()=>{S(c.map(t=>t.id))},y=()=>{S([])},D=async t=>{try{for(const r of o){const x=c.find(w=>w.id===r);if(!x)continue;let n={};if(t.status&&(n.status=t.status),t.priceAdjustment){const{type:w,value:T,unit:K}=t.priceAdjustment;let E=x.price;w==="increase"?E=K==="percent"?x.price*(1+T/100):x.price+T:w==="decrease"?E=K==="percent"?x.price*(1-T/100):x.price-T:w==="set"&&(E=T),n.price=E.toString()}Object.keys(n).length>0&&await h.mutateAsync({id:r,...n})}y(),g.success(`Updated ${o.length} listing(s)`)}catch{g.error("Failed to update listings")}},L=async t=>{try{for(const r of t)await d.mutateAsync(r);y(),g.success(`Deleted ${t.length} listing(s)`)}catch{g.error("Failed to delete listings")}},a=[{key:"?",description:"Show keyboard shortcuts",action:()=>{},category:"General"},{key:"s",description:"Mark selected as Sold",action:()=>{o.length>0&&o.forEach(t=>N(t,"sold"))},category:"Status"},{key:"p",description:"Mark selected as Pending",action:()=>{o.length>0&&o.forEach(t=>N(t,"pending"))},category:"Status"},{key:"a",description:"Mark selected as Active",action:()=>{o.length>0&&o.forEach(t=>N(t,"active"))},category:"Status"},{key:"Escape",description:"Clear selection",action:y,category:"Selection"}];return i?e.jsx("div",{className:"container mx-auto py-6 flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(ee,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-gray-600",children:"Loading listings..."})]})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Quick Actions Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your listings efficiently with keyboard shortcuts and bulk actions"})]}),u.length>0&&e.jsx(fe,{count:u.length})]}),c.length===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"No Listings Yet"}),e.jsx("p",{className:"text-blue-700",children:"Add your first listing to start managing your properties here."})]}),e.jsx(be,{stats:p,period:"Last 30 days"}),u.length>0&&e.jsx(pe,{staleListings:u,onRefresh:b}),c.length>0&&e.jsxs(ce,{defaultValue:"quick-status",className:"w-full",children:[e.jsxs(de,{className:"grid w-full grid-cols-2 max-w-md",children:[e.jsx(O,{value:"quick-status",children:"Quick Status"}),e.jsx(O,{value:"bulk-edit",children:"Bulk Edit"})]}),e.jsx(H,{value:"quick-status",className:"mt-6",children:e.jsx(xe,{listings:c,onStatusChange:N,onRefresh:C,isLoading:h.isPending})}),e.jsxs(H,{value:"bulk-edit",className:"mt-6",children:[e.jsx(ve,{listings:c,selectedIds:o,onToggleSelect:f,onSelectAll:l,onClearSelection:y,onBulkUpdate:D,onBulkDelete:L}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6",children:c.map(t=>e.jsxs("div",{onClick:()=>f(t.id),className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${o.includes(t.id)?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:t.title}),e.jsx("input",{type:"checkbox",checked:o.includes(t.id),onChange:()=>f(t.id),className:"mt-1"})]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",t.price.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:t.status})]},t.id))})]})]}),e.jsx(ie,{shortcuts:a})]})}export{Re as default};
