import{r as h,ad as V,j as e,ah as D,ai as $,au as L,aj as O,ak as z,L as n,I as N,S as P,T as F,a1 as B,aB as G,B as u,aC as J,aD as Q,bH as W,aH as X,aF as R,aG as K,b as H,i as E,ap as Y,av as Z,M as ee,ab as te,bI as se}from"./index-BYoWZjze.js";import{U as re}from"./upload-DxPuC3uF.js";import{u as ae}from"./useTestimonials-C7gOq9fx.js";import{u as ie,U as le}from"./UpgradeModal-WxyUFPVV.js";import{L as ne}from"./LimitBanner-B73b971T.js";import{C as I}from"./copy-DqrJunVY.js";import{u as oe}from"./useProfile-C-K3oywL.js";import{P as U}from"./plus-DBr6jWHn.js";import{S as de}from"./square-pen-CIGa-88u.js";import{T as ce}from"./trash-2-BruuVXyf.js";import"./useMutation-y82bgPXU.js";import"./alert-BCN6_zrj.js";import"./progress-MmYL92Z5.js";import"./triangle-alert-CO_e1T6O.js";const me=Q({clientName:R().min(2,"Client name must be at least 2 characters"),rating:K().min(1,"Rating is required").max(5,"Rating must be between 1 and 5"),review:R().min(10,"Review must be at least 10 characters").max(500,"Review must be less than 500 characters"),propertyType:R().min(1,"Property type is required"),clientPhoto:X(File).optional(),featured:W()});function xe({open:v,onOpenChange:d,onSave:i}){const[o,a]=h.useState(null),[l,p]=h.useState(null),{register:s,handleSubmit:g,formState:{errors:t},reset:y,setValue:j,watch:b}=V({resolver:J(me),defaultValues:{clientName:"",rating:5,review:"",propertyType:"",featured:!1}}),T=b("rating"),S=b("review"),C=b("featured"),m=c=>{const w=c.target.files?.[0];if(w){j("clientPhoto",w);const k=new FileReader;k.onloadend=()=>{p(k.result)},k.readAsDataURL(w)}},x=()=>{j("clientPhoto",void 0),p(null)},_=async c=>{try{a(null),await i?.(c),d(!1),y(),p(null)}catch(w){console.error("Failed to add testimonial:",w),a("Failed to add testimonial. Please try again.")}};return e.jsx(D,{open:v,onOpenChange:d,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsxs(L,{children:[e.jsx(O,{children:"Add Client Testimonial"}),e.jsx(z,{children:"Share feedback from satisfied clients to build credibility"})]}),e.jsxs("form",{onSubmit:g(_),className:"space-y-6",children:[o&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm",children:o}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(N,{id:"clientName",...s("clientName"),placeholder:"John Smith"}),t.clientName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.clientName.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'You can use initials for privacy (e.g., "John S.")'})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"propertyType",children:"Property Type *"}),e.jsx(N,{id:"propertyType",...s("propertyType"),placeholder:"Single Family Home, Condo, etc."}),t.propertyType&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.propertyType.message})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(c=>e.jsx("button",{type:"button",onClick:()=>j("rating",c),className:"focus:outline-none",children:e.jsx(P,{className:`h-8 w-8 transition-colors ${c<=T?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},c))}),t.rating&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.rating.message})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"review",children:"Testimonial Text *"}),e.jsx(F,{id:"review",...s("review"),rows:6,maxLength:500,placeholder:"Share what the client said about working with you..."}),t.review&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.review.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[S?.length||0,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Client Photo (Optional)"}),l?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:l,alt:"Client preview",className:"w-24 h-24 rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:x,className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full",children:e.jsx(B,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:m,className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx(re,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload client photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 2MB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"featured",checked:C,onChange:c=>j("featured",c.target.checked),className:"rounded border-border"}),e.jsx(n,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this testimonial on my profile"})]}),e.jsxs(G,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(u,{type:"submit",children:"Add Testimonial"})]})]})]})})}function ue({isOpen:v,onClose:d,onSubmit:i,initialData:o}){const[a,l]=h.useState(o);if(h.useEffect(()=>{l(o)},[o]),!v)return null;const p=s=>{s.preventDefault(),i(a)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Testimonial"}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(B,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_name",children:"Client Name *"}),e.jsx(N,{id:"client_name",value:a.client_name,onChange:s=>l({...a,client_name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_title",children:"Client Title"}),e.jsx(N,{id:"client_title",value:a.client_title||"",onChange:s=>l({...a,client_title:s.target.value}),placeholder:"e.g., First-Time Homebuyer"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"rating",children:"Rating *"}),e.jsx(N,{id:"rating",type:"number",min:"1",max:"5",value:a.rating,onChange:s=>l({...a,rating:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"review",children:"Review *"}),e.jsx(F,{id:"review",value:a.review,onChange:s=>l({...a,review:s.target.value}),rows:6,required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"property_type",children:"Property Type"}),e.jsx(N,{id:"property_type",value:a.property_type||"",onChange:s=>l({...a,property_type:s.target.value}),placeholder:"e.g., Single Family Home"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:a.transaction_type||"",onChange:s=>l({...a,transaction_type:s.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:d,className:"flex-1",children:"Cancel"}),e.jsx(u,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function he({open:v,onOpenChange:d,username:i,agentName:o}){const[a,l]=h.useState(!1),[p,s]=h.useState(!1),{toast:g}=H(),t=`${window.location.origin}/${i}/review`,y=`Hi there!

I hope you've been enjoying your new home! I wanted to reach out and ask if you'd be willing to share a brief review of your experience working with me.

Your feedback helps me improve my services and helps other clients find the right agent for their needs.

You can leave a review here:
${t}

It only takes a couple of minutes, and I really appreciate your time!

Best regards,
${o}`,j=`Hi! Would you mind leaving a quick review of your experience? It helps me serve clients better: ${t} Thanks! - ${o}`,b=async(m,x="url")=>{try{await navigator.clipboard.writeText(m),x==="url"?(l(!0),setTimeout(()=>l(!1),2e3)):(s(!0),setTimeout(()=>s(!1),2e3)),g({title:"Copied!",description:`${x==="url"?"Review link":"Email template"} copied to clipboard`})}catch{g({title:"Failed to copy",description:"Please copy manually",variant:"destructive"})}},T=()=>{const m=encodeURIComponent(`Request for Testimonial - ${o}`),x=encodeURIComponent(y);window.open(`mailto:?subject=${m}&body=${x}`)},S=()=>{const m=encodeURIComponent(j);window.open(`sms:?&body=${m}`)},C=async()=>{if(navigator.share)try{await navigator.share({title:"Leave a Review",text:"I'd appreciate if you could leave a review of your experience!",url:t})}catch{console.log("Share cancelled")}else b(t)};return e.jsx(D,{open:v,onOpenChange:d,children:e.jsxs($,{className:"sm:max-w-2xl",children:[e.jsxs(L,{children:[e.jsx(O,{className:"text-2xl",children:"Request Client Testimonial"}),e.jsx(z,{children:"Share this link with clients to collect reviews and testimonials"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold",children:"Your Review Link"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Send this link to clients so they can leave a review"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{value:t,readOnly:!0,className:"font-mono text-sm"}),e.jsx(u,{onClick:()=>b(t),variant:"outline",size:"icon",children:a?e.jsx(E,{className:"h-4 w-4 text-green-600"}):e.jsx(I,{className:"h-4 w-4"})}),e.jsx(u,{onClick:C,variant:"outline",size:"icon",title:"Share via...",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(u,{asChild:!0,variant:"outline",size:"icon",title:"Preview review page",children:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Z,{className:"h-4 w-4"})})})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold mb-3 block",children:"Quick Send Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(u,{onClick:T,variant:"outline",className:"justify-start",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Send via Email"]}),e.jsxs(u,{onClick:S,variant:"outline",className:"justify-start",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Send via SMS"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(n,{className:"text-base font-semibold",children:"Email Template"}),e.jsx(u,{onClick:()=>b(y,"email"),variant:"ghost",size:"sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 text-green-600"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),e.jsx(F,{value:y,readOnly:!0,rows:12,className:"font-mono text-sm resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ’¡ Tip: Customize this template to match your personal style"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold mb-2 block",children:"SMS Template"}),e.jsx(F,{value:j,readOnly:!0,rows:3,className:"font-mono text-sm resize-none"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-900",children:"ðŸ“‹ Best Practices for Requesting Reviews"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Wait 1-2 weeks after closing for best results"}),e.jsx("li",{children:"â€¢ Send a personalized message, not just the link"}),e.jsx("li",{children:"â€¢ Follow up once if no response after 1 week"}),e.jsx("li",{children:"â€¢ Thank clients regardless of whether they leave a review"}),e.jsx("li",{children:"â€¢ Make it easy - include the direct link"})]})]})]})]})})}function Fe(){const[v,d]=h.useState(!1),[i,o]=h.useState(null),[a,l]=h.useState(!1),[p,s]=h.useState(!1),{toast:g}=H(),{testimonials:t,addTestimonial:y,updateTestimonial:j,deleteTestimonial:b}=ae(),{subscription:T,canAdd:S,getLimit:C,getUsage:m}=ie(),{profile:x}=oe(),_=()=>{if(!S("testimonials")){l(!0);return}d(!0)},c=async r=>{try{await y.mutateAsync(r),g({title:"Testimonial added!",description:"Client review has been added successfully."}),d(!1)}catch{g({title:"Error",description:"Failed to add testimonial. Please try again.",variant:"destructive"})}},w=async r=>{if(confirm("Are you sure you want to delete this testimonial?"))try{await b.mutateAsync(r),g({title:"Testimonial deleted",description:"Client review has been removed."})}catch{g({title:"Error",description:"Failed to delete testimonial.",variant:"destructive"})}},k=async r=>{if(i)try{await j.mutateAsync({id:i.id,client_name:r.client_name,client_title:r.client_title,rating:r.rating,review:r.review,property_type:r.property_type,transaction_type:r.transaction_type,updated_at:new Date().toISOString()}),o(null)}catch(f){console.error("Failed to update testimonial:",f)}},M=t.length>0?(t.reduce((r,f)=>r+f.rating,0)/t.length).toFixed(1):"0.0",A=r=>e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((f,q)=>e.jsx(P,{className:`h-4 w-4 ${q<r?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},q))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Testimonials"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Showcase client reviews and success stories"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>s(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors font-medium border border-border",children:[e.jsx(Y,{className:"h-4 w-4"}),"Request Testimonial"]}),e.jsxs("button",{onClick:_,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(U,{className:"h-4 w-4"}),"Add Testimonial"]})]})]}),T&&C("testimonials")!==1/0&&e.jsx(ne,{feature:"testimonials",current:m("testimonials"),limit:C("testimonials")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:M}),e.jsx("div",{className:"flex",children:A(Math.round(parseFloat(M)))})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Rating"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.map(r=>e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-shadow relative",children:[e.jsx("div",{className:"mb-4",children:e.jsx(se,{className:"h-8 w-8 text-primary opacity-20"})}),e.jsxs("p",{className:"text-foreground mb-6 leading-relaxed",children:['"',r.review,'"']}),e.jsx("div",{className:"mb-4",children:A(r.rating)}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold",children:r.client_name.split(" ").map(f=>f[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:r.client_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.property_type||"Client"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>o(r),className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("button",{onClick:()=>w(r.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(ce,{className:"h-4 w-4 text-red-500"})})]})]})]},r.id))}),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-accent rounded-full mb-4",children:e.jsx(P,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No testimonials yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Start building social proof by adding client reviews"}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(U,{className:"h-5 w-5"}),"Add Your First Testimonial"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Featured testimonials will be prominently displayed on your public profile. Ask satisfied clients for reviews after successful transactions!"]})}),e.jsx(xe,{open:v,onOpenChange:d,onSave:c}),i&&e.jsx(ue,{isOpen:!!i,onClose:()=>o(null),onSubmit:k,initialData:{client_name:i.client_name,review:i.review,rating:i.rating,client_title:i.client_title,property_type:i.property_type,transaction_type:i.transaction_type}}),e.jsx(le,{open:a,onOpenChange:l,feature:"testimonials",currentPlan:T?.plan_name||"Free",requiredPlan:"Starter"}),x&&e.jsx(he,{open:p,onOpenChange:s,username:x.username||"",agentName:x.full_name||""})]})}export{Fe as default};
