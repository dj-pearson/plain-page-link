import{j as e,x as s,y as t,z as a,A as n,B as r,E as i,G as o,H as c,J as l,K as d,M as m,N as h}from"./ui-components-cnQr7CF8-1762802164755.js";import{a as x}from"./react-vendor-CmKLYqnR-1762802164755.js";import{u,s as p,C as g,a as f,b as j,c as y,d as v,n as w,B as N,L as b,o as _}from"./index-CJpEzai_-1762802164755.js";import{T as k,a as D,b as C,c as S}from"./tabs-D2xB4nZ2-1762802164755.js";import{b as A,d as $,u as P}from"./data-CuF6D63I-1762802164755.js";import{aB as F,a3 as T,ar as q,h as L,a$ as R,E as I,ad as z,B as E,U,ab as O,a4 as B,aN as K,T as W,e as G,ao as Q,aE as M,O as Y,ag as H}from"./icons-DrcTsquU-1762802164755.js";import{R as V,A as J,C as X,X as Z,Y as ee,T as se,d as te,c as ae,L as ne,a as re}from"./charts-wuw5sxMV-1762802164755.js";import{T as ie,a as oe,b as ce,c as le,d as de,e as me}from"./table-CpbGiK7O-1762802164755.js";import{P as he,a as xe,b as ue}from"./popover-BCqHfEI5-1762802164755.js";import{a as pe}from"./utils-BEAgWB1B-1762802164755.js";import{C as ge}from"./checkbox-CqgG4VOx-1762802164755.js";function fe(e){return P({queryKey:["unified-analytics",e],queryFn:async()=>{const{data:{user:s}}=await p.auth.getUser();if(!s)throw new Error("Not authenticated");let t=p.from("unified_search_analytics").select("*").eq("user_id",s.id).gte("date",e.startDate).lte("date",e.endDate);e.platforms&&e.platforms.length>0&&(t=t.in("source_platform",e.platforms));const{data:a,error:n}=await t.order("date",{ascending:!1});if(n)throw n;return a}})}const je={google_search_console:{name:"Google Search Console",description:"Search performance and indexing data",icon:"ðŸ”"},google_analytics:{name:"Google Analytics 4",description:"Website traffic and user behavior",icon:"ðŸ“Š"},bing_webmaster:{name:"Bing Webmaster Tools",description:"Bing search performance data",icon:"ðŸ…±ï¸"},yandex_webmaster:{name:"Yandex Webmaster",description:"Yandex search performance data",icon:"ðŸ‡·ðŸ‡º"}};function ye(){const{data:s,isLoading:t}=P({queryKey:["connected-platforms"],queryFn:async()=>{const{data:{user:e}}=await p.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:s,error:t}=await p.rpc("get_connected_search_platforms",{p_user_id:e.id});if(t)throw t;return s}}),a=function(){const{toast:e}=u();return $({mutationFn:async e=>{const s={google_analytics:`${window.location.origin}/admin/search-analytics/oauth/callback/google-analytics`,google_search_console:`${window.location.origin}/admin/search-analytics/oauth/callback/google-search-console`,bing_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/bing-webmaster`,yandex_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/yandex-webmaster`},t=new URLSearchParams({client_id:(e.includes("google"),""),redirect_uri:s[e],response_type:"code",scope:"google_analytics"===e?"https://www.googleapis.com/auth/analytics.readonly":"google_search_console"===e?"https://www.googleapis.com/auth/webmasters.readonly":"bing_webmaster"===e?"https://api.bing.microsoft.com/webmaster.read offline_access":"webmaster:read",access_type:"offline",prompt:"consent"}),a=`${{google_analytics:"https://accounts.google.com/o/oauth2/v2/auth",google_search_console:"https://accounts.google.com/o/oauth2/v2/auth",bing_webmaster:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",yandex_webmaster:"https://oauth.yandex.ru/authorize"}[e]}?${t.toString()}`;window.location.href=a},onError:s=>{e({title:"OAuth Error",description:s.message,variant:"destructive"})}})}(),n=function(){const{toast:e}=u(),s=A();return $({mutationFn:async({platform:e,property_id:s,site_id:t,start_date:a,end_date:n})=>{const{data:{session:r}}=await p.auth.getSession();if(!r)throw new Error("Not authenticated");const i="google_analytics"===e?"google-analytics-sync":"google_search_console"===e?"google-search-console-sync":"bing_webmaster"===e?"bing-webmaster-sync":"yandex-webmaster-sync",{data:o,error:c}=await p.functions.invoke(i,{body:{property_id:s,site_id:t,start_date:a,end_date:n},headers:{Authorization:`Bearer ${r.access_token}`}});if(c)throw c;return o},onSuccess:()=>{e({title:"Sync Started",description:"Data synchronization started successfully"}),s.invalidateQueries({queryKey:["search-analytics"]})},onError:s=>{e({title:"Sync Failed",description:s.message,variant:"destructive"})}})}();return t?e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Platform Connections"}),e.jsx(y,{children:"Loading connection status..."})]}),e.jsx(v,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Platform Connections"}),e.jsx(y,{children:"Connect and manage your analytics platforms"})]}),e.jsx(v,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:s?.map(s=>{const t=je[s.platform],r=s.is_connected,i="active"===s.credential_status,o="expired"===s.credential_status;return e.jsxs(g,{className:"relative",children:[e.jsxs(f,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsx("div",{children:e.jsx(j,{className:"text-sm",children:t.name})})]}),i&&e.jsxs(w,{variant:"default",className:"text-xs",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Connected"]}),o&&e.jsxs(w,{variant:"destructive",className:"text-xs",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Expired"]}),!r&&e.jsxs(w,{variant:"secondary",className:"text-xs",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Not Connected"]})]}),e.jsx(y,{className:"text-xs mt-1",children:t.description})]}),e.jsxs(v,{className:"pt-0",children:[s.last_sync&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Last sync: ",new Date(s.last_sync).toLocaleDateString()]}),e.jsx("div",{className:"flex flex-col gap-2",children:!r||o?e.jsxs(N,{size:"sm",onClick:()=>(e=>{a.mutate(e)})(s.platform),disabled:a.isPending,className:"w-full",children:[e.jsx(L,{className:"h-3 w-3 mr-2"}),o?"Reconnect":"Connect"]}):e.jsx(N,{size:"sm",variant:"outline",onClick:()=>(e=>{n.mutate({platform:e})})(s.platform),disabled:n.isPending,className:"w-full",children:"Sync Data"})})]})]},s.platform)})})})]})}function ve({startDate:s,endDate:t,platforms:a}){const n=function(e){const{data:s}=fe(e);return s?{total_clicks:s.reduce((e,s)=>e+(s.clicks||0),0),total_impressions:s.reduce((e,s)=>e+(s.impressions||0),0),total_sessions:s.reduce((e,s)=>e+(s.sessions||0),0),total_users:s.reduce((e,s)=>e+(s.users||0),0),total_pageviews:s.reduce((e,s)=>e+(s.pageviews||0),0),average_ctr:s.length>0?s.reduce((e,s)=>e+(s.ctr||0),0)/s.length:0,average_position:s.length>0?s.reduce((e,s)=>e+(s.average_position||0),0)/s.length:0,average_bounce_rate:s.length>0?s.reduce((e,s)=>e+(s.bounce_rate||0),0)/s.length:0,clicks_change:0,impressions_change:0,sessions_change:0}:null}({startDate:s,endDate:t,platforms:a});if(!n)return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(s=>e.jsxs(g,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Loading..."})}),e.jsx(v,{children:e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded"})})]},s))});const r=e=>`${(100*e).toFixed(2)}%`,i=[{title:"Total Clicks",value:n.total_clicks,change:n.clicks_change,icon:R,description:"Users who clicked through"},{title:"Total Impressions",value:n.total_impressions,change:n.impressions_change,icon:I,description:"Times your site appeared"},{title:"Avg. CTR",value:n.average_ctr,change:0,icon:z,description:"Click-through rate",isPercentage:!0},{title:"Avg. Position",value:n.average_position,change:0,icon:E,description:"Average search position",decimals:1},{title:"Total Sessions",value:n.total_sessions,change:n.sessions_change,icon:U,description:"Website sessions"},{title:"Total Users",value:n.total_users,change:0,icon:U,description:"Unique visitors"},{title:"Total Pageviews",value:n.total_pageviews,change:0,icon:O,description:"Pages viewed"},{title:"Bounce Rate",value:n.average_bounce_rate,change:0,icon:B,description:"Visitors who left quickly",isPercentage:!0}];return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:i.map(s=>{const t=(e=>{if(0===e)return{icon:K,color:"text-muted-foreground",text:"0%"};const s=e>0;return{icon:s?W:B,color:s?"text-green-600":"text-red-600",text:`${s?"+":""}${r(e/100)}`}})(s.change),a=s.icon,n=t.icon;return e.jsxs(g,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:s.title}),e.jsx(a,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.isPercentage?r(s.value):s.decimals?s.value.toFixed(s.decimals):(i=s.value,new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(i))}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(n,{className:`h-3 w-3 ${t.color}`}),e.jsx("span",{className:t.color,children:t.text}),e.jsx("span",{children:"vs. previous period"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]})]},s.title);var i})})}function we({startDate:s,endDate:t,platforms:a}){const n=function(e){const{data:s}=fe(e);if(!s)return null;const t=s.reduce((e,s)=>{const t=s.date;return e[t]||(e[t]={date:t,clicks:0,impressions:0,sessions:0,users:0,ctr:0,position:0,count:0}),e[t].clicks+=s.clicks||0,e[t].impressions+=s.impressions||0,e[t].sessions+=s.sessions||0,e[t].users+=s.users||0,e[t].ctr+=s.ctr||0,e[t].position+=s.average_position||0,e[t].count+=1,e},{});return Object.values(t).map(e=>({date:e.date,clicks:e.clicks,impressions:e.impressions,sessions:e.sessions,users:e.users,ctr:e.count>0?e.ctr/e.count:0,position:e.count>0?e.position/e.count:0}))}({startDate:s,endDate:t,platforms:a});return n&&0!==n.length?e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Performance Trends"}),e.jsx(y,{children:"Track your search and traffic metrics over time"})]}),e.jsx(v,{children:e.jsxs(k,{defaultValue:"traffic",className:"space-y-4",children:[e.jsxs(D,{children:[e.jsx(C,{value:"traffic",children:"Traffic"}),e.jsx(C,{value:"search",children:"Search Performance"}),e.jsx(C,{value:"engagement",children:"Engagement"})]}),e.jsx(S,{value:"traffic",className:"space-y-4",children:e.jsx(V,{width:"100%",height:350,children:e.jsxs(J,{data:n,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(ee,{}),e.jsx(se,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:e=>[(new Intl.NumberFormat).format(e),""]}),e.jsx(te,{}),e.jsx(ae,{type:"monotone",dataKey:"sessions",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Sessions"}),e.jsx(ae,{type:"monotone",dataKey:"users",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",name:"Users"}),e.jsx(ae,{type:"monotone",dataKey:"pageviews",stackId:"3",stroke:"#ffc658",fill:"#ffc658",name:"Pageviews"})]})})}),e.jsx(S,{value:"search",className:"space-y-4",children:e.jsx(V,{width:"100%",height:350,children:e.jsxs(ne,{data:n,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(ee,{yAxisId:"left"}),e.jsx(ee,{yAxisId:"right",orientation:"right"}),e.jsx(se,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:(e,s)=>"CTR"===s?[`${(100*e).toFixed(2)}%`,s]:"Avg Position"===s?[e.toFixed(1),s]:[(new Intl.NumberFormat).format(e),s]}),e.jsx(te,{}),e.jsx(re,{yAxisId:"left",type:"monotone",dataKey:"clicks",stroke:"#8884d8",name:"Clicks",strokeWidth:2}),e.jsx(re,{yAxisId:"left",type:"monotone",dataKey:"impressions",stroke:"#82ca9d",name:"Impressions",strokeWidth:2}),e.jsx(re,{yAxisId:"right",type:"monotone",dataKey:"ctr",stroke:"#ffc658",name:"CTR",strokeWidth:2})]})})}),e.jsxs(S,{value:"engagement",className:"space-y-4",children:[e.jsx(V,{width:"100%",height:350,children:e.jsxs(ne,{data:n,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(ee,{}),e.jsx(se,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:(e,s)=>"Avg Position"===s?[e.toFixed(1),s]:[(new Intl.NumberFormat).format(e),s]}),e.jsx(te,{}),e.jsx(re,{type:"monotone",dataKey:"position",stroke:"#8884d8",name:"Avg Position",strokeWidth:2})]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Lower position values are better (position 1 is the top result)"})]})]})})]}):e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Performance Trends"}),e.jsx(y,{children:"No data available for the selected period"})]}),e.jsx(v,{children:e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:e.jsx("p",{children:"Connect your platforms and sync data to see performance trends"})})})]})}function Ne({startDate:s,endDate:t,platforms:a,limit:n=10}){const r=function(e){const{data:s}=fe(e);if(!s)return null;const t=s.filter(e=>e.query).reduce((e,s)=>{const t=s.query;return e[t]||(e[t]={query:t,clicks:0,impressions:0,ctr:0,position:0,count:0,change:0}),e[t].clicks+=s.clicks||0,e[t].impressions+=s.impressions||0,e[t].ctr+=s.ctr||0,e[t].position+=s.average_position||0,e[t].count+=1,e},{});return Object.values(t).map(e=>({query:e.query,clicks:e.clicks,impressions:e.impressions,ctr:e.count>0?e.ctr/e.count:0,position:e.count>0?e.position/e.count:0,change:0})).sort((e,s)=>s.clicks-e.clicks).slice(0,e.limit||10)}({startDate:s,endDate:t,platforms:a,limit:n});if(!r||0===r.length)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No query data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top queries"})]});const i=e=>new Intl.NumberFormat("en-US").format(e);return e.jsx("div",{className:"rounded-md border",children:e.jsxs(ie,{children:[e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(le,{className:"w-[40%]",children:"Query"}),e.jsx(le,{className:"text-right",children:"Clicks"}),e.jsx(le,{className:"text-right",children:"Impressions"}),e.jsx(le,{className:"text-right",children:"CTR"}),e.jsx(le,{className:"text-right",children:"Position"}),e.jsx(le,{className:"text-right",children:"Trend"})]})}),e.jsx(de,{children:r.map((s,t)=>{return e.jsxs(ce,{children:[e.jsx(me,{className:"font-medium max-w-xs truncate",children:s.query}),e.jsx(me,{className:"text-right",children:i(s.clicks)}),e.jsx(me,{className:"text-right",children:i(s.impressions)}),e.jsx(me,{className:"text-right",children:e.jsx(w,{variant:"outline",children:(n=s.ctr,`${(100*n).toFixed(2)}%`)})}),e.jsx(me,{className:"text-right",children:e.jsx(w,{variant:"secondary",children:s.position.toFixed(1)})}),e.jsx(me,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:(a=s.change,a>0?e.jsx(W,{className:"h-3 w-3 text-green-600"}):a<0?e.jsx(B,{className:"h-3 w-3 text-red-600"}):e.jsx(K,{className:"h-3 w-3 text-muted-foreground"}))})})]},`${s.query}-${t}`);var a,n})})]})})}function be({startDate:s,endDate:t,platforms:a,limit:n=10}){const r=function(e){const{data:s}=fe(e);if(!s)return null;const t=s.filter(e=>e.page_url).reduce((e,s)=>{const t=s.page_url;return e[t]||(e[t]={url:t,title:s.page_title,clicks:0,impressions:0,sessions:0,ctr:0,position:0,count:0,change:0}),e[t].clicks+=s.clicks||0,e[t].impressions+=s.impressions||0,e[t].sessions+=s.sessions||0,e[t].ctr+=s.ctr||0,e[t].position+=s.average_position||0,e[t].count+=1,e},{});return Object.values(t).map(e=>({url:e.url,title:e.title,clicks:e.clicks,impressions:e.impressions,sessions:e.sessions,ctr:e.count>0?e.ctr/e.count:0,position:e.count>0?e.position/e.count:0,change:0})).sort((e,s)=>s.clicks-e.clicks).slice(0,e.limit||10)}({startDate:s,endDate:t,platforms:a,limit:n});if(!r||0===r.length)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No page data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top pages"})]});const i=e=>new Intl.NumberFormat("en-US").format(e),o=(e,s=50)=>e.length<=s?e:e.substring(0,s)+"...";return e.jsx("div",{className:"rounded-md border",children:e.jsxs(ie,{children:[e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(le,{className:"w-[35%]",children:"Page"}),e.jsx(le,{className:"text-right",children:"Clicks"}),e.jsx(le,{className:"text-right",children:"Sessions"}),e.jsx(le,{className:"text-right",children:"Impressions"}),e.jsx(le,{className:"text-right",children:"CTR"}),e.jsx(le,{className:"text-right",children:"Position"}),e.jsx(le,{className:"text-right",children:"Trend"}),e.jsx(le,{className:"w-[50px]"})]})}),e.jsx(de,{children:r.map((s,t)=>{return e.jsxs(ce,{children:[e.jsx(me,{className:"max-w-xs",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm truncate",title:s.url,children:o(s.url)}),s.title&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",title:s.title,children:s.title})]})}),e.jsx(me,{className:"text-right",children:i(s.clicks)}),e.jsx(me,{className:"text-right",children:i(s.sessions)}),e.jsx(me,{className:"text-right",children:i(s.impressions)}),e.jsx(me,{className:"text-right",children:e.jsx(w,{variant:"outline",children:(n=s.ctr,`${(100*n).toFixed(2)}%`)})}),e.jsx(me,{className:"text-right",children:e.jsx(w,{variant:"secondary",children:s.position.toFixed(1)})}),e.jsx(me,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:(a=s.change,a>0?e.jsx(W,{className:"h-3 w-3 text-green-600"}):a<0?e.jsx(B,{className:"h-3 w-3 text-red-600"}):e.jsx(K,{className:"h-3 w-3 text-muted-foreground"}))})}),e.jsx(me,{children:e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80",children:e.jsx(L,{className:"h-4 w-4"})})})]},`${s.url}-${t}`);var a,n})})]})})}function _e({startDate:s,endDate:t,onChange:a}){const[n,r]=x.useState(!1);return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(he,{open:n,onOpenChange:r,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),pe(new Date(s),"MMM dd, yyyy")," - ",pe(new Date(t),"MMM dd, yyyy")]})}),e.jsx(ue,{className:"w-auto p-4",align:"start",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Quick Select"}),e.jsx("div",{className:"grid gap-2",children:[{label:"Last 7 days",days:7},{label:"Last 30 days",days:30},{label:"Last 90 days",days:90},{label:"Last 6 months",days:180},{label:"Last year",days:365}].map(s=>e.jsx(N,{variant:"ghost",className:"justify-start",onClick:()=>(e=>{const s=new Date,t=new Date;t.setDate(t.getDate()-e),a(t.toISOString().split("T")[0],s.toISOString().split("T")[0]),r(!1)})(s.days),children:s.label},s.label))})]})})})]})})}const ke=[{value:"google_search_console",label:"Google Search Console"},{value:"google_analytics",label:"Google Analytics"},{value:"bing_webmaster",label:"Bing Webmaster"},{value:"yandex_webmaster",label:"Yandex Webmaster"}];function De({selectedPlatforms:s,onChange:t}){return e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Platforms (",s.length,")"]})}),e.jsx(ue,{className:"w-64",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Filter by Platform"}),e.jsx("div",{className:"space-y-3",children:ke.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{id:a.value,checked:s.includes(a.value),onCheckedChange:()=>(e=>{s.includes(e)?t(s.filter(s=>s!==e)):t([...s,e])})(a.value)}),e.jsx(b,{htmlFor:a.value,className:"text-sm font-normal cursor-pointer",children:a.label})]},a.value))})]})})]})}function Ce(e,s="Search Analytics Report",t){return{title:s,dateRange:t,headers:["Query","Clicks","Impressions","CTR","Avg. Position"],rows:e.map(e=>[e.query,e.clicks,e.impressions,`${(100*e.ctr).toFixed(2)}%`,e.position.toFixed(1)])}}const Se=s,Ae=t;x.forwardRef(({className:s,inset:t,children:a,...n},r)=>e.jsx(i,{ref:r,className:_("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100",t&&"pl-8",s),...n,children:a})).displayName=i.displayName;x.forwardRef(({className:s,...t},a)=>e.jsx(o,{ref:a,className:_("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-gray-900 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})).displayName=o.displayName;const $e=x.forwardRef(({className:s,sideOffset:t=4,...r},i)=>e.jsx(a,{children:e.jsx(n,{ref:i,sideOffset:t,className:_("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-gray-900 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}));$e.displayName=n.displayName;const Pe=x.forwardRef(({className:s,inset:t,...a},n)=>e.jsx(r,{ref:n,className:_("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...a}));Pe.displayName=r.displayName;x.forwardRef(({className:s,children:t,checked:a,...n},r)=>e.jsxs(c,{ref:r,className:_("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(l,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})})}),t]})).displayName=c.displayName;x.forwardRef(({className:s,children:t,...a},n)=>e.jsxs(d,{ref:n,className:_("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(l,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-2 w-2",children:e.jsx("circle",{cx:"12",cy:"12",r:"12"})})})}),t]})).displayName=d.displayName;x.forwardRef(({className:s,inset:t,...a},n)=>e.jsx(m,{ref:n,className:_("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a})).displayName=m.displayName;function Fe(){const{toast:s}=u(),[t,a]=x.useState({start:new Date(Date.now()-2592e6).toISOString().split("T")[0],end:(new Date).toISOString().split("T")[0]}),[n,r]=x.useState(["google_search_console","google_analytics"]),i=function(){const{toast:e}=u(),s=A();return $({mutationFn:async({start_date:e,end_date:s,force_refresh:t})=>{const{data:{session:a}}=await p.auth.getSession();if(!a)throw new Error("Not authenticated");const{data:n,error:r}=await p.functions.invoke("aggregate-search-analytics",{body:{start_date:e,end_date:s,force_refresh:t},headers:{Authorization:`Bearer ${a.access_token}`}});if(r)throw r;return n},onSuccess:()=>{e({title:"Aggregation Complete",description:"Analytics data aggregated successfully"}),s.invalidateQueries({queryKey:["unified-analytics"]})},onError:s=>{e({title:"Aggregation Failed",description:s.message,variant:"destructive"})}})}();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 flex-wrap",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:async()=>{try{await i.mutateAsync({start_date:t.start,end_date:t.end,force_refresh:!0})}catch(e){}},disabled:i.isPending,children:[e.jsx(M,{className:"h-4 w-4 mr-2 "+(i.isPending?"animate-spin":"")}),"Refresh Data"]}),e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs($e,{align:"end",children:[e.jsxs(Pe,{onClick:()=>{!function(e){const{headers:s,rows:t,title:a}=e;let n="";a&&(n+=`${a}\n\n`),n+=s.join(",")+"\n",t.forEach(e=>{const s=e.map(e=>{const s=String(e);return s.includes(",")||s.includes('"')||s.includes("\n")?`"${s.replace(/"/g,'""')}"`:s});n+=s.join(",")+"\n"});const r=new Blob([n],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),o=URL.createObjectURL(r),c=`${a?.replace(/\s+/g,"_")||"export"}_${(new Date).toISOString().split("T")[0]}.csv`;i.setAttribute("href",o),i.setAttribute("download",c),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}(Ce([{query:"luxury homes Los Angeles",clicks:245,impressions:1230,ctr:.199,position:3.2},{query:"real estate agent near me",clicks:189,impressions:2100,ctr:.09,position:5.8},{query:"homes for sale Beverly Hills",clicks:167,impressions:890,ctr:.188,position:2.1},{query:"best realtor LA",clicks:134,impressions:1500,ctr:.089,position:7.3},{query:"property listings California",clicks:98,impressions:670,ctr:.146,position:4.5}],"Search Analytics Report",`${t.start} to ${t.end}`)),s({title:"Exported to CSV",description:"Your analytics data has been downloaded."})},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Export to CSV"]}),e.jsxs(Pe,{onClick:()=>{!function(e){const{headers:s,rows:t,title:a,dateRange:n}=e;let r=`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="utf-8">\n            <title>${a||"Analytics Report"}</title>\n            <style>\n                body {\n                    font-family: Arial, sans-serif;\n                    padding: 40px;\n                    color: #333;\n                }\n                h1 {\n                    color: #2563eb;\n                    margin-bottom: 10px;\n                }\n                .date-range {\n                    color: #666;\n                    font-size: 14px;\n                    margin-bottom: 30px;\n                }\n                table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin-top: 20px;\n                }\n                th {\n                    background-color: #2563eb;\n                    color: white;\n                    padding: 12px;\n                    text-align: left;\n                    font-weight: 600;\n                }\n                td {\n                    padding: 10px 12px;\n                    border-bottom: 1px solid #e5e7eb;\n                }\n                tr:nth-child(even) {\n                    background-color: #f9fafb;\n                }\n                .footer {\n                    margin-top: 40px;\n                    padding-top: 20px;\n                    border-top: 1px solid #e5e7eb;\n                    color: #666;\n                    font-size: 12px;\n                    text-align: center;\n                }\n            </style>\n        </head>\n        <body>\n            <h1>${a||"Analytics Report"}</h1>\n            ${n?`<div class="date-range">${n}</div>`:""}\n            <table>\n                <thead>\n                    <tr>\n                        ${s.map(e=>`<th>${e}</th>`).join("")}\n                    </tr>\n                </thead>\n                <tbody>\n                    ${t.map(e=>`<tr>${e.map(e=>`<td>${e}</td>`).join("")}</tr>`).join("")}\n                </tbody>\n            </table>\n            <div class="footer">\n                Generated on ${(new Date).toLocaleString()} | AgentBio.net Analytics\n            </div>\n        </body>\n        </html>\n    `;const i=window.open("","","height=600,width=800");i&&(i.document.write(r),i.document.close(),i.onload=()=>{i.print(),setTimeout(()=>{i.close()},100)})}(Ce([{query:"luxury homes Los Angeles",clicks:245,impressions:1230,ctr:.199,position:3.2},{query:"real estate agent near me",clicks:189,impressions:2100,ctr:.09,position:5.8},{query:"homes for sale Beverly Hills",clicks:167,impressions:890,ctr:.188,position:2.1},{query:"best realtor LA",clicks:134,impressions:1500,ctr:.089,position:7.3},{query:"property listings California",clicks:98,impressions:670,ctr:.146,position:4.5}],"Search Analytics Report",`${t.start} to ${t.end}`)),s({title:"Opening PDF",description:"Your analytics report is being prepared for printing."})},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Export to PDF"]})]})]}),e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(ye,{}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Filters"}),e.jsx(y,{children:"Customize your analytics view"})]}),e.jsxs(v,{className:"flex flex-wrap gap-4",children:[e.jsx(_e,{startDate:t.start,endDate:t.end,onChange:(e,s)=>a({start:e,end:s})}),e.jsx(De,{selectedPlatforms:n,onChange:r})]})]}),e.jsxs(k,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(D,{children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"queries",children:"Top Queries"}),e.jsx(C,{value:"pages",children:"Top Pages"}),e.jsx(C,{value:"devices",children:"Devices"}),e.jsx(C,{value:"countries",children:"Countries"})]}),e.jsxs(S,{value:"overview",className:"space-y-4",children:[e.jsx(ve,{startDate:t.start,endDate:t.end,platforms:n}),e.jsx(we,{startDate:t.start,endDate:t.end,platforms:n}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Top 10 Queries"}),e.jsx(y,{children:"Highest performing search queries"})]}),e.jsx(v,{children:e.jsx(Ne,{startDate:t.start,endDate:t.end,platforms:n,limit:10})})]}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Top 10 Pages"}),e.jsx(y,{children:"Highest performing pages"})]}),e.jsx(v,{children:e.jsx(be,{startDate:t.start,endDate:t.end,platforms:n,limit:10})})]})]})]}),e.jsx(S,{value:"queries",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"All Search Queries"}),e.jsx(y,{children:"Complete list of search queries with performance metrics"})]}),e.jsx(v,{children:e.jsx(Ne,{startDate:t.start,endDate:t.end,platforms:n,limit:100})})]})}),e.jsx(S,{value:"pages",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"All Pages"}),e.jsx(y,{children:"Complete list of pages with traffic metrics"})]}),e.jsx(v,{children:e.jsx(be,{startDate:t.start,endDate:t.end,platforms:n,limit:100})})]})}),e.jsx(S,{value:"devices",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Device Breakdown"}),e.jsx(y,{children:"Performance metrics by device type"})]}),e.jsx(v,{children:e.jsx("p",{className:"text-muted-foreground",children:"Device analytics coming soon..."})})]})}),e.jsx(S,{value:"countries",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Geographic Distribution"}),e.jsx(y,{children:"Performance metrics by country"})]}),e.jsx(v,{children:e.jsx("p",{className:"text-muted-foreground",children:"Geographic analytics coming soon..."})})]})})]})]})}x.forwardRef(({className:s,...t},a)=>e.jsx(h,{ref:a,className:_("-mx-1 my-1 h-px bg-gray-200",s),...t})).displayName=h.displayName;export{Fe as S};
