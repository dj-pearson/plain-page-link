import{b as w,u as q,d}from"./state-vendor-BElgh7Si.js";import{l as L,u as g,s as o}from"./index-ChZTfseL.js";function A(){const{user:t}=L(),a=w(),{toast:i}=g(),{data:u=[],isLoading:c,isError:l,error:f,refetch:y}=q({queryKey:["links",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:e,error:r}=await o.from("links").select("*").eq("user_id",t.id).order("position",{ascending:!0});if(r)throw r;return e},enabled:!!t?.id}),k=d({mutationFn:async e=>{if(!t?.id)throw new Error("User not authenticated");const r=u.length>0?Math.max(...u.map(v=>v.position)):-1,{data:s,error:n}=await o.from("links").insert({user_id:t.id,title:e.title,url:e.url,icon:e.icon,position:r+1,is_active:e.active}).select().single();if(n)throw n;return s},onSuccess:()=>{a.invalidateQueries({queryKey:["links",t?.id]}),i({title:"Link Added",description:"Your custom link has been added successfully."})},onError:e=>{i({title:"Failed to Add Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),m=d({mutationFn:async({id:e,...r})=>{const{data:s,error:n}=await o.from("links").update(r).eq("id",e).select().single();if(n)throw n;return s},onSuccess:()=>{a.invalidateQueries({queryKey:["links",t?.id]}),i({title:"Link Updated",description:"Your link has been updated successfully."})},onError:e=>{i({title:"Failed to Update Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),p=d({mutationFn:async e=>{const{error:r}=await o.from("links").delete().eq("id",e);if(r)throw r},onSuccess:()=>{a.invalidateQueries({queryKey:["links",t?.id]}),i({title:"Link Deleted",description:"Your link has been deleted successfully."})},onError:e=>{i({title:"Failed to Delete Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),h=d({mutationFn:async({id:e,is_active:r})=>{const{error:s}=await o.from("links").update({is_active:r}).eq("id",e);if(s)throw s},onSuccess:()=>{a.invalidateQueries({queryKey:["links",t?.id]})}});return{links:u,isLoading:c,isError:l,error:f,refetch:y,addLink:k,updateLink:m,deleteLink:p,toggleActive:h}}export{A as u};
