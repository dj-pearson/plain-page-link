import{b as e,u as t,d as i}from"./data-O5cD9hjv.js";import{s}from"./supabase-BYwji6mk.js";import{u as r}from"./stores-DrVlQDHa.js";import{u as a}from"./index-BVsPZqG5.js";function o(){const{user:o}=r(),n=e(),{toast:d}=a(),{data:l=[],isLoading:u}=t({queryKey:["testimonials",o?.id],queryFn:async()=>{if(!o?.id)return[];const{data:e,error:t}=await s.from("testimonials").select("*").eq("user_id",o.id).order("date",{ascending:!1});if(t)throw t;return e},enabled:!!o?.id});return{testimonials:l,isLoading:u,addTestimonial:i({mutationFn:async e=>{if(!o?.id)throw new Error("User not authenticated");const{data:t,error:i}=await s.from("testimonials").insert({user_id:o.id,...e}).select().single();if(i)throw i;return t},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",o?.id]}),d({title:"Testimonial Added",description:"Your testimonial has been added successfully."})},onError:e=>{d({title:"Failed to Add Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),updateTestimonial:i({mutationFn:async({id:e,...t})=>{const{data:i,error:r}=await s.from("testimonials").update(t).eq("id",e).select().single();if(r)throw r;return i},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",o?.id]}),d({title:"Testimonial Updated",description:"Your testimonial has been updated successfully."})},onError:e=>{d({title:"Failed to Update Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),deleteTestimonial:i({mutationFn:async e=>{const{error:t}=await s.from("testimonials").delete().eq("id",e);if(t)throw t},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",o?.id]}),d({title:"Testimonial Deleted",description:"Your testimonial has been deleted successfully."})},onError:e=>{d({title:"Failed to Delete Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}})}}export{o as u};
