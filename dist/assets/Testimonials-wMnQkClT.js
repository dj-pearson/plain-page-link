import{j as e}from"./ui-components-ClhKjEhW.js";import{a as t}from"./react-vendor-CmKLYqnR.js";import{D as s,p as i,t as r,q as a,r as n,L as l,I as o,T as d,v as c,B as m,u as x,s as u}from"./index-bNgPkIHN.js";import{i as h,a3 as p,X as j,d as g,a8 as v,K as f,h as b,M as y,n as N,ao as w,Q as C,aq as k,ar as T}from"./icons-COCuBKKE.js";import{u as _}from"./useTestimonials-B8TtHZdW.js";import{u as S,U as F}from"./UpgradeModal-BGp5RF_6.js";import{L as R}from"./LimitBanner-Azj5mHGz.js";import{u as q}from"./useProfile-_ru3aDlV.js";import"./three-addons-Bi7cYlKH.js";import"./three-BxgHQpUo.js";import"./charts-D6IDAGAX.js";import"./utils-CwVVV8W2.js";import"./data-DkeJbMsV.js";import"./supabase-Bfq1IbS0.js";import"./forms-BQFHsYzL.js";import"./alert-ZxNhUk9s.js";import"./progress-CoyjAhlP.js";function O({open:x,onOpenChange:u,onSave:g}){const[v,f]=t.useState({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),[b,y]=t.useState(null),N=e=>{const{name:t,value:s}=e.target;f(e=>({...e,[t]:s}))};return e.jsx(s,{open:x,onOpenChange:u,children:e.jsxs(i,{className:"max-w-2xl",children:[e.jsxs(r,{children:[e.jsx(a,{children:"Add Client Testimonial"}),e.jsx(n,{children:"Share feedback from satisfied clients to build credibility"})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),g?.(v),u(!1),f({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),y(null)},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(o,{id:"clientName",name:"clientName",value:v.clientName,onChange:N,placeholder:"John Smith",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'You can use initials for privacy (e.g., "John S.")'})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"propertyType",children:"Property Type *"}),e.jsx(o,{id:"propertyType",name:"propertyType",value:v.propertyType,onChange:N,placeholder:"Single Family Home, Condo, etc.",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>f(e=>({...e,rating:t})),className:"focus:outline-none",children:e.jsx(h,{className:"h-8 w-8 transition-colors "+(t<=v.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")})},t))})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"review",children:"Testimonial Text *"}),e.jsx(d,{id:"review",name:"review",value:v.review,onChange:N,rows:6,maxLength:500,placeholder:"Share what the client said about working with you...",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.review.length,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"Client Photo (Optional)"}),b?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:b,alt:"Client preview",className:"w-24 h-24 rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{f(e=>({...e,clientPhoto:void 0})),y(null)},className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full",children:e.jsx(j,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){f(e=>({...e,clientPhoto:t}));const e=new FileReader;e.onloadend=()=>{y(e.result)},e.readAsDataURL(t)}},className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx(p,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload client photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 2MB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"featured",checked:v.featured,onChange:e=>f(t=>({...t,featured:e.target.checked})),className:"rounded border-border"}),e.jsx(l,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this testimonial on my profile"})]}),e.jsxs(c,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(m,{type:"submit",children:"Add Testimonial"})]})]})]})})}function P({isOpen:s,onClose:i,onSubmit:r,initialData:a}){const[n,c]=t.useState(a);if(t.useEffect(()=>{c(a)},[a]),!s)return null;return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Testimonial"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(j,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),r(n)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"client_name",children:"Client Name *"}),e.jsx(o,{id:"client_name",value:n.client_name,onChange:e=>c({...n,client_name:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"client_title",children:"Client Title"}),e.jsx(o,{id:"client_title",value:n.client_title||"",onChange:e=>c({...n,client_title:e.target.value}),placeholder:"e.g., First-Time Homebuyer"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"rating",children:"Rating *"}),e.jsx(o,{id:"rating",type:"number",min:"1",max:"5",value:n.rating,onChange:e=>c({...n,rating:parseInt(e.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"review",children:"Review *"}),e.jsx(d,{id:"review",value:n.review,onChange:e=>c({...n,review:e.target.value}),rows:6,required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"property_type",children:"Property Type"}),e.jsx(o,{id:"property_type",value:n.property_type||"",onChange:e=>c({...n,property_type:e.target.value}),placeholder:"e.g., Single Family Home"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:n.transaction_type||"",onChange:e=>c({...n,transaction_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:i,className:"flex-1",children:"Cancel"}),e.jsx(m,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function A({open:c,onOpenChange:u,username:h,agentName:p}){const[j,w]=t.useState(!1),[C,k]=t.useState(!1),{toast:T}=x(),_=`${window.location.origin}/${h}/review`,S=`Hi there!\n\nI hope you've been enjoying your new home! I wanted to reach out and ask if you'd be willing to share a brief review of your experience working with me.\n\nYour feedback helps me improve my services and helps other clients find the right agent for their needs.\n\nYou can leave a review here:\n${_}\n\nIt only takes a couple of minutes, and I really appreciate your time!\n\nBest regards,\n${p}`,F=`Hi! Would you mind leaving a quick review of your experience? It helps me serve clients better: ${_} Thanks! - ${p}`,R=async(e,t="url")=>{try{await navigator.clipboard.writeText(e),"url"===t?(w(!0),setTimeout(()=>w(!1),2e3)):(k(!0),setTimeout(()=>k(!1),2e3)),T({title:"Copied!",description:("url"===t?"Review link":"Email template")+" copied to clipboard"})}catch(s){T({title:"Failed to copy",description:"Please copy manually",variant:"destructive"})}};return e.jsx(s,{open:c,onOpenChange:u,children:e.jsxs(i,{className:"sm:max-w-2xl",children:[e.jsxs(r,{children:[e.jsx(a,{className:"text-2xl",children:"Request Client Testimonial"}),e.jsx(n,{children:"Share this link with clients to collect reviews and testimonials"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-base font-semibold",children:"Your Review Link"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Send this link to clients so they can leave a review"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{value:_,readOnly:!0,className:"font-mono text-sm"}),e.jsx(m,{onClick:()=>R(_),variant:"outline",size:"icon",children:j?e.jsx(g,{className:"h-4 w-4 text-green-600"}):e.jsx(v,{className:"h-4 w-4"})}),e.jsx(m,{onClick:async()=>{if(navigator.share)try{await navigator.share({title:"Leave a Review",text:"I'd appreciate if you could leave a review of your experience!",url:_})}catch(e){}else R(_)},variant:"outline",size:"icon",title:"Share via...",children:e.jsx(f,{className:"h-4 w-4"})}),e.jsx(m,{asChild:!0,variant:"outline",size:"icon",title:"Preview review page",children:e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",children:e.jsx(b,{className:"h-4 w-4"})})})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-base font-semibold mb-3 block",children:"Quick Send Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(m,{onClick:()=>{const e=encodeURIComponent(`Request for Testimonial - ${p}`),t=encodeURIComponent(S);window.open(`mailto:?subject=${e}&body=${t}`)},variant:"outline",className:"justify-start",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Send via Email"]}),e.jsxs(m,{onClick:()=>{const e=encodeURIComponent(F);window.open(`sms:?&body=${e}`)},variant:"outline",className:"justify-start",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Send via SMS"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(l,{className:"text-base font-semibold",children:"Email Template"}),e.jsx(m,{onClick:()=>R(S,"email"),variant:"ghost",size:"sm",children:C?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2 text-green-600"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),e.jsx(d,{value:S,readOnly:!0,rows:12,className:"font-mono text-sm resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ’¡ Tip: Customize this template to match your personal style"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-base font-semibold mb-2 block",children:"SMS Template"}),e.jsx(d,{value:F,readOnly:!0,rows:3,className:"font-mono text-sm resize-none"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-900",children:"ðŸ“‹ Best Practices for Requesting Reviews"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Wait 1-2 weeks after closing for best results"}),e.jsx("li",{children:"â€¢ Send a personalized message, not just the link"}),e.jsx("li",{children:"â€¢ Follow up once if no response after 1 week"}),e.jsx("li",{children:"â€¢ Thank clients regardless of whether they leave a review"}),e.jsx("li",{children:"â€¢ Make it easy - include the direct link"})]})]})]})]})})}function I(){const[s,i]=t.useState(!1),[r,a]=t.useState(null),[n,l]=t.useState(!1),[o,d]=t.useState(!1),{toast:c}=x(),{testimonials:m,addTestimonial:p,deleteTestimonial:j}=_(),{subscription:g,canAdd:v,getLimit:b,getUsage:y}=S(),{profile:N}=q(),I=m.length>0?(m.reduce((e,t)=>e+t.rating,0)/m.length).toFixed(1):"0.0",$=t=>e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((s,i)=>e.jsx(h,{className:"h-4 w-4 "+(i<t?"fill-yellow-400 text-yellow-400":"text-gray-300")},i))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Testimonials"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Showcase client reviews and success stories"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors font-medium border border-border",children:[e.jsx(f,{className:"h-4 w-4"}),"Request Testimonial"]}),e.jsxs("button",{onClick:()=>{v("testimonials")?i(!0):l(!0)},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(w,{className:"h-4 w-4"}),"Add Testimonial"]})]})]}),g&&b("testimonials")!==1/0&&e.jsx(R,{feature:"testimonials",current:y("testimonials"),limit:b("testimonials")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:m.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:I}),e.jsx("div",{className:"flex",children:$(Math.round(parseFloat(I)))})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Rating"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:m.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:m.map(t=>e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-shadow relative",children:[e.jsx("div",{className:"mb-4",children:e.jsx(C,{className:"h-8 w-8 text-primary opacity-20"})}),e.jsxs("p",{className:"text-foreground mb-6 leading-relaxed",children:['"',t.review,'"']}),e.jsx("div",{className:"mb-4",children:$(t.rating)}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold",children:t.client_name.split(" ").map(e=>e[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:t.client_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.property_type||"Client"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>a(t),className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this testimonial?"))try{await j.mutateAsync(e),c({title:"Testimonial deleted",description:"Client review has been removed."})}catch(t){c({title:"Error",description:"Failed to delete testimonial.",variant:"destructive"})}})(t.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(T,{className:"h-4 w-4 text-red-500"})})]})]})]},t.id))}),0===m.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-accent rounded-full mb-4",children:e.jsx(h,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No testimonials yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Start building social proof by adding client reviews"}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(w,{className:"h-5 w-5"}),"Add Your First Testimonial"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Featured testimonials will be prominently displayed on your public profile. Ask satisfied clients for reviews after successful transactions!"]})}),e.jsx(O,{open:s,onOpenChange:i,onSave:async e=>{try{await p.mutateAsync(e),c({title:"Testimonial added!",description:"Client review has been added successfully."}),i(!1)}catch(t){c({title:"Error",description:"Failed to add testimonial. Please try again.",variant:"destructive"})}}}),r&&e.jsx(P,{isOpen:!!r,onClose:()=>a(null),onSubmit:async e=>{if(r)try{const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:s}=await u.from("testimonials").update({client_name:e.client_name,client_title:e.client_title,rating:e.rating,review:e.review,property_type:e.property_type,transaction_type:e.transaction_type,updated_at:(new Date).toISOString()}).eq("id",r.id).eq("user_id",t.id);if(s)throw s;c({title:"Testimonial updated!",description:"Client review has been updated successfully."}),a(null),window.location.reload()}catch(t){c({title:"Error",description:"Failed to update testimonial. Please try again.",variant:"destructive"})}},initialData:{client_name:r.client_name,review:r.review,rating:r.rating,client_title:r.client_title,property_type:r.property_type,transaction_type:r.transaction_type}}),e.jsx(F,{open:n,onOpenChange:l,feature:"testimonials",currentPlan:g?.plan_name||"Free",requiredPlan:"Starter"}),N&&e.jsx(A,{open:o,onOpenChange:d,username:N.username||"",agentName:N.full_name||""})]})}export{I as default};
