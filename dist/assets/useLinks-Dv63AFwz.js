import{b as k,u as h,c as u}from"./data-15YcDnrk.js";import{s as o}from"./supabase-Ba7v9dZh.js";import{u as v}from"./state-stores-BuSRU7CA.js";import{u as w}from"./index-sCAK2lXW.js";function A(){const{user:i}=v(),a=k(),{toast:r}=w(),{data:d=[],isLoading:c}=h({queryKey:["links",i?.id],queryFn:async()=>{if(!i?.id)return[];const{data:e,error:t}=await o.from("links").select("*").eq("user_id",i.id).order("position",{ascending:!0});if(t)throw t;return e},enabled:!!i?.id}),l=u({mutationFn:async e=>{if(!i?.id)throw new Error("User not authenticated");const t=d.length>0?Math.max(...d.map(y=>y.position)):-1,{data:s,error:n}=await o.from("links").insert({user_id:i.id,title:e.title,url:e.url,icon:e.icon,position:t+1,is_active:e.active}).select().single();if(n)throw n;return s},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]}),r({title:"Link Added",description:"Your custom link has been added successfully."})},onError:e=>{r({title:"Failed to Add Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),m=u({mutationFn:async({id:e,...t})=>{const{data:s,error:n}=await o.from("links").update(t).eq("id",e).select().single();if(n)throw n;return s},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]}),r({title:"Link Updated",description:"Your link has been updated successfully."})},onError:e=>{r({title:"Failed to Update Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),f=u({mutationFn:async e=>{const{error:t}=await o.from("links").delete().eq("id",e);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]}),r({title:"Link Deleted",description:"Your link has been deleted successfully."})},onError:e=>{r({title:"Failed to Delete Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),p=u({mutationFn:async({id:e,is_active:t})=>{const{error:s}=await o.from("links").update({is_active:t}).eq("id",e);if(s)throw s},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]})}});return{links:d,isLoading:c,addLink:l,updateLink:m,deleteLink:f,toggleActive:p}}export{A as u};
