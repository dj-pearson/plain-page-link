import{u as H,a as B,b as Y,r as l,j as e,L as _,C as m,c as x,d as h,e as p,f,B as g,H as D,g as L,h as n,S as q,I as d,T as z,s as N}from"./index-BIuWzZUg.js";import{S as I}from"./send-iHCKoavq.js";function $(){const{username:u}=H(),j=B(),{toast:c}=Y(),[s,S]=l.useState(null),[C,T]=l.useState(!0),[v,y]=l.useState(!1),[F,k]=l.useState(!1),[i,E]=l.useState(0),[P,b]=l.useState(0),[r,o]=l.useState({client_name:"",client_email:"",client_title:"",review:"",property_type:"",transaction_type:"buyer"});l.useEffect(()=>{u&&(async()=>{try{const{data:a,error:w}=await N.from("profiles").select("id, full_name, avatar_url, bio").eq("username",u).single();if(w)throw w;S(a)}catch(a){console.error("Error fetching profile:",a),c({title:"Agent not found",description:"The agent profile could not be found.",variant:"destructive"})}finally{T(!1)}})()},[u,c]);const R=async t=>{if(t.preventDefault(),i===0){c({title:"Rating required",description:"Please select a star rating.",variant:"destructive"});return}y(!0);try{const{error:a}=await N.from("testimonials").insert({user_id:s.id,client_name:r.client_name,client_title:r.client_title||"",rating:i,review:r.review,property_type:r.property_type||"",transaction_type:r.transaction_type,date:new Date().toISOString()});if(a)throw a;k(!0),c({title:"Review submitted!",description:`Thank you for sharing your experience with ${s.full_name}!`})}catch(a){console.error("Error submitting review:",a),c({title:"Submission failed",description:"There was an error submitting your review. Please try again.",variant:"destructive"})}finally{y(!1)}};return C?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center",children:e.jsx(_,{size:"lg"})}):s?F?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsxs(x,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-10 h-10 text-green-600"})})}),e.jsx(h,{className:"text-2xl",children:"Thank You!"}),e.jsxs(p,{className:"text-base mt-2",children:["Your review has been submitted successfully. ",s.full_name," will be notified and may feature your testimonial on their profile."]})]}),e.jsx(f,{children:e.jsxs(g,{onClick:()=>j(`/${u}`),className:"w-full",variant:"outline",children:["View ",s.full_name,"'s Profile"]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-12 px-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s.avatar_url&&e.jsx("img",{src:s.avatar_url,alt:s.full_name,className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx(h,{className:"text-2xl",children:"Share Your Experience"}),e.jsxs(p,{className:"text-base",children:["Leave a review for ",s.full_name]})]})]}),s.bio&&e.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',s.bio,'"']})]}),e.jsx(f,{children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-semibold mb-3 block",children:"How would you rate your experience? *"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>E(t),onMouseEnter:()=>b(t),onMouseLeave:()=>b(0),className:"transition-transform hover:scale-110",children:e.jsx(q,{className:`w-10 h-10 ${t<=(P||i)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},t))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:i>0&&e.jsx("span",{className:"text-blue-600 font-medium",children:i===5?"Excellent!":i===4?"Great!":i===3?"Good":i===2?"Fair":"Poor"})})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_name",children:"Your Name *"}),e.jsx(d,{id:"client_name",value:r.client_name,onChange:t=>o({...r,client_name:t.target.value}),placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_email",children:"Your Email *"}),e.jsx(d,{id:"client_email",type:"email",value:r.client_email,onChange:t=>o({...r,client_email:t.target.value}),placeholder:"john@example.com",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Your email won't be published, it's for verification only."})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"client_title",children:"Title/Occupation (Optional)"}),e.jsx(d,{id:"client_title",value:r.client_title,onChange:t=>o({...r,client_title:t.target.value}),placeholder:"e.g., First-time Homebuyer, Real Estate Investor"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:r.transaction_type,onChange:t=>o({...r,transaction_type:t.target.value}),className:"w-full px-3 py-2 border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"both",children:"Both (Buyer & Seller)"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"property_type",children:"Property Type (Optional)"}),e.jsx(d,{id:"property_type",value:r.property_type,onChange:t=>o({...r,property_type:t.target.value}),placeholder:"e.g., Single Family Home, Condo, Townhouse"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"review",children:"Your Review *"}),e.jsx(z,{id:"review",value:r.review,onChange:t=>o({...r,review:t.target.value}),placeholder:"Share your experience working with this agent...",rows:6,required:!0,className:"resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please be specific about what made your experience positive."})]}),e.jsx(g,{type:"submit",disabled:v||i===0,className:"w-full",size:"lg",children:v?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"sm",className:"mr-2"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Submit Review"]})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["By submitting this review, you agree that it may be displayed publicly on ",s.full_name,"'s profile page."]})]})})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsxs(x,{className:"text-center",children:[e.jsx(h,{className:"text-2xl",children:"Agent Not Found"}),e.jsx(p,{children:"The agent profile you're looking for doesn't exist."})]}),e.jsx(f,{children:e.jsxs(g,{onClick:()=>j("/"),className:"w-full",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Go to Homepage"]})})]})})}export{$ as default};
