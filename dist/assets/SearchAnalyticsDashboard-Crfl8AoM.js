import{j as e,r as E}from"./react-vendor-CotwlNTQ.js";import{C as m,f as g,g as p,h as f,o as j,B as k,j as b,J as H,K as X,M as y,N as v,Z as J,_ as Z,$ as T,a0 as u,a1 as ee,a2 as x,U as se,V as te,W as ae,z as oe,L as ce,a3 as le,a4 as de,a5 as he,a6 as B}from"./ui-components-XxFWEsul.js";import{b as ne,c as O,u as re}from"./data-15YcDnrk.js";import{s as w}from"./supabase-Ba7v9dZh.js";import{u as P}from"./index-sCAK2lXW.js";import{n as ue,a8 as xe,aD as me,h as ie,ab as ge,E as pe,j as je,B as fe,U as K,aj as U,ac as S,aL as M,T as Q,e as ye,ax as ve,aM as be,a1 as we,an as Ne}from"./icons-CcUX9GkC.js";import{R as F,A as ke,C as $,X as L,Y as C,T as R,f as I,e as q,L as z,b as D}from"./charts-hR54p0E0.js";import{a as W}from"./utils-BpArqNZu.js";function _e(){return re({queryKey:["connected-platforms"],queryFn:async()=>{const{data:{user:i}}=await w.auth.getUser();if(!i)throw new Error("Not authenticated");const{data:a,error:d}=await w.rpc("get_connected_search_platforms",{p_user_id:i.id});if(d)throw d;return a}})}function Ce(){const{toast:i}=P();return O({mutationFn:async a=>{const d={google_analytics:`${window.location.origin}/admin/search-analytics/oauth/callback/google-analytics`,google_search_console:`${window.location.origin}/admin/search-analytics/oauth/callback/google-search-console`,bing_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/bing-webmaster`,yandex_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/yandex-webmaster`},s={google_analytics:"https://accounts.google.com/o/oauth2/v2/auth",google_search_console:"https://accounts.google.com/o/oauth2/v2/auth",bing_webmaster:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",yandex_webmaster:"https://oauth.yandex.ru/authorize"},n=new URLSearchParams({client_id:(a.includes("google"),""),redirect_uri:d[a],response_type:"code",scope:a==="google_analytics"?"https://www.googleapis.com/auth/analytics.readonly":a==="google_search_console"?"https://www.googleapis.com/auth/webmasters.readonly":a==="bing_webmaster"?"https://api.bing.microsoft.com/webmaster.read offline_access":"webmaster:read",access_type:"offline",prompt:"consent"}),t=`${s[a]}?${n.toString()}`;window.location.href=t},onError:a=>{i({title:"OAuth Error",description:a.message,variant:"destructive"})}})}function De(){const{toast:i}=P(),a=ne();return O({mutationFn:async({platform:d,property_id:s,site_id:n,start_date:t,end_date:r})=>{const{data:{session:l}}=await w.auth.getSession();if(!l)throw new Error("Not authenticated");const c=d==="google_analytics"?"google-analytics-sync":d==="google_search_console"?"google-search-console-sync":d==="bing_webmaster"?"bing-webmaster-sync":"yandex-webmaster-sync",{data:o,error:h}=await w.functions.invoke(c,{body:{property_id:s,site_id:n,start_date:t,end_date:r},headers:{Authorization:`Bearer ${l.access_token}`}});if(h)throw h;return o},onSuccess:()=>{i({title:"Sync Started",description:"Data synchronization started successfully"}),a.invalidateQueries({queryKey:["search-analytics"]})},onError:d=>{i({title:"Sync Failed",description:d.message,variant:"destructive"})}})}function Te(){const{toast:i}=P(),a=ne();return O({mutationFn:async({start_date:d,end_date:s,force_refresh:n})=>{const{data:{session:t}}=await w.auth.getSession();if(!t)throw new Error("Not authenticated");const{data:r,error:l}=await w.functions.invoke("aggregate-search-analytics",{body:{start_date:d,end_date:s,force_refresh:n},headers:{Authorization:`Bearer ${t.access_token}`}});if(l)throw l;return r},onSuccess:()=>{i({title:"Aggregation Complete",description:"Analytics data aggregated successfully"}),a.invalidateQueries({queryKey:["unified-analytics"]})},onError:d=>{i({title:"Aggregation Failed",description:d.message,variant:"destructive"})}})}function A(i){return re({queryKey:["unified-analytics",i],queryFn:async()=>{const{data:{user:a}}=await w.auth.getUser();if(!a)throw new Error("Not authenticated");let d=w.from("unified_search_analytics").select("*").eq("user_id",a.id).gte("date",i.startDate).lte("date",i.endDate);i.platforms&&i.platforms.length>0&&(d=d.in("source_platform",i.platforms));const{data:s,error:n}=await d.order("date",{ascending:!1});if(n)throw n;return s}})}function Se(i){const{data:a}=A(i);return a?{total_clicks:a.reduce((s,n)=>s+(n.clicks||0),0),total_impressions:a.reduce((s,n)=>s+(n.impressions||0),0),total_sessions:a.reduce((s,n)=>s+(n.sessions||0),0),total_users:a.reduce((s,n)=>s+(n.users||0),0),total_pageviews:a.reduce((s,n)=>s+(n.pageviews||0),0),average_ctr:a.length>0?a.reduce((s,n)=>s+(n.ctr||0),0)/a.length:0,average_position:a.length>0?a.reduce((s,n)=>s+(n.average_position||0),0)/a.length:0,average_bounce_rate:a.length>0?a.reduce((s,n)=>s+(n.bounce_rate||0),0)/a.length:0,clicks_change:0,impressions_change:0,sessions_change:0}:null}function Pe(i){const{data:a}=A(i);if(!a)return null;const d=a.reduce((s,n)=>{const t=n.date;return s[t]||(s[t]={date:t,clicks:0,impressions:0,sessions:0,users:0,ctr:0,position:0,count:0}),s[t].clicks+=n.clicks||0,s[t].impressions+=n.impressions||0,s[t].sessions+=n.sessions||0,s[t].users+=n.users||0,s[t].ctr+=n.ctr||0,s[t].position+=n.average_position||0,s[t].count+=1,s},{});return Object.values(d).map(s=>({date:s.date,clicks:s.clicks,impressions:s.impressions,sessions:s.sessions,users:s.users,ctr:s.count>0?s.ctr/s.count:0,position:s.count>0?s.position/s.count:0}))}function Ae(i){const{data:a}=A(i);if(!a)return null;const s=a.filter(t=>t.query).reduce((t,r)=>{const l=r.query;return t[l]||(t[l]={query:l,clicks:0,impressions:0,ctr:0,position:0,count:0,change:0}),t[l].clicks+=r.clicks||0,t[l].impressions+=r.impressions||0,t[l].ctr+=r.ctr||0,t[l].position+=r.average_position||0,t[l].count+=1,t},{});return Object.values(s).map(t=>({query:t.query,clicks:t.clicks,impressions:t.impressions,ctr:t.count>0?t.ctr/t.count:0,position:t.count>0?t.position/t.count:0,change:0})).sort((t,r)=>r.clicks-t.clicks).slice(0,i.limit||10)}function Fe(i){const{data:a}=A(i);if(!a)return null;const s=a.filter(t=>t.page_url).reduce((t,r)=>{const l=r.page_url;return t[l]||(t[l]={url:l,title:r.page_title,clicks:0,impressions:0,sessions:0,ctr:0,position:0,count:0,change:0}),t[l].clicks+=r.clicks||0,t[l].impressions+=r.impressions||0,t[l].sessions+=r.sessions||0,t[l].ctr+=r.ctr||0,t[l].position+=r.average_position||0,t[l].count+=1,t},{});return Object.values(s).map(t=>({url:t.url,title:t.title,clicks:t.clicks,impressions:t.impressions,sessions:t.sessions,ctr:t.count>0?t.ctr/t.count:0,position:t.count>0?t.position/t.count:0,change:0})).sort((t,r)=>r.clicks-t.clicks).slice(0,i.limit||10)}const $e={google_search_console:{name:"Google Search Console",description:"Search performance and indexing data",icon:"ðŸ”"},google_analytics:{name:"Google Analytics 4",description:"Website traffic and user behavior",icon:"ðŸ“Š"},bing_webmaster:{name:"Bing Webmaster Tools",description:"Bing search performance data",icon:"ðŸ…±ï¸"},yandex_webmaster:{name:"Yandex Webmaster",description:"Yandex search performance data",icon:"ðŸ‡·ðŸ‡º"}};function Le(){const{data:i,isLoading:a}=_e(),d=Ce(),s=De(),n=r=>{d.mutate(r)},t=r=>{s.mutate({platform:r})};return a?e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Platform Connections"}),e.jsx(f,{children:"Loading connection status..."})]}),e.jsx(j,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Platform Connections"}),e.jsx(f,{children:"Connect and manage your analytics platforms"})]}),e.jsx(j,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:i?.map(r=>{const l=$e[r.platform],c=r.is_connected,o=r.credential_status==="active",h=r.credential_status==="expired";return e.jsxs(m,{className:"relative",children:[e.jsxs(g,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("div",{children:e.jsx(p,{className:"text-sm",children:l.name})})]}),o&&e.jsxs(k,{variant:"default",className:"text-xs",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Connected"]}),h&&e.jsxs(k,{variant:"destructive",className:"text-xs",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),"Expired"]}),!c&&e.jsxs(k,{variant:"secondary",className:"text-xs",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Not Connected"]})]}),e.jsx(f,{className:"text-xs mt-1",children:l.description})]}),e.jsxs(j,{className:"pt-0",children:[r.last_sync&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Last sync: ",new Date(r.last_sync).toLocaleDateString()]}),e.jsx("div",{className:"flex flex-col gap-2",children:!c||h?e.jsxs(b,{size:"sm",onClick:()=>n(r.platform),disabled:d.isPending,className:"w-full",children:[e.jsx(ie,{className:"h-3 w-3 mr-2"}),h?"Reconnect":"Connect"]}):e.jsx(b,{size:"sm",variant:"outline",onClick:()=>t(r.platform),disabled:s.isPending,className:"w-full",children:"Sync Data"})})]})]},r.platform)})})})]})}function Re({startDate:i,endDate:a,platforms:d}){const s=Se({startDate:i,endDate:a,platforms:d});if(!s)return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(c=>e.jsxs(m,{children:[e.jsx(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:"Loading..."})}),e.jsx(j,{children:e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded"})})]},c))});const n=c=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(c),t=c=>`${(c*100).toFixed(2)}%`,r=c=>{if(c===0)return{icon:M,color:"text-muted-foreground",text:"0%"};const o=c>0;return{icon:o?Q:S,color:o?"text-green-600":"text-red-600",text:`${o?"+":""}${t(c/100)}`}},l=[{title:"Total Clicks",value:s.total_clicks,change:s.clicks_change,icon:ge,description:"Users who clicked through"},{title:"Total Impressions",value:s.total_impressions,change:s.impressions_change,icon:pe,description:"Times your site appeared"},{title:"Avg. CTR",value:s.average_ctr,change:0,icon:je,description:"Click-through rate",isPercentage:!0},{title:"Avg. Position",value:s.average_position,change:0,icon:fe,description:"Average search position",decimals:1},{title:"Total Sessions",value:s.total_sessions,change:s.sessions_change,icon:K,description:"Website sessions"},{title:"Total Users",value:s.total_users,change:0,icon:K,description:"Unique visitors"},{title:"Total Pageviews",value:s.total_pageviews,change:0,icon:U,description:"Pages viewed"},{title:"Bounce Rate",value:s.average_bounce_rate,change:0,icon:S,description:"Visitors who left quickly",isPercentage:!0}];return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:l.map(c=>{const o=r(c.change),h=c.icon,N=o.icon;return e.jsxs(m,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:c.title}),e.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.isPercentage?t(c.value):c.decimals?c.value.toFixed(c.decimals):n(c.value)}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(N,{className:`h-3 w-3 ${o.color}`}),e.jsx("span",{className:o.color,children:o.text}),e.jsx("span",{children:"vs. previous period"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.description})]})]},c.title)})})}function Ie({startDate:i,endDate:a,platforms:d}){const s=Pe({startDate:i,endDate:a,platforms:d});return!s||s.length===0?e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Performance Trends"}),e.jsx(f,{children:"No data available for the selected period"})]}),e.jsx(j,{children:e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:e.jsx("p",{children:"Connect your platforms and sync data to see performance trends"})})})]}):e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Performance Trends"}),e.jsx(f,{children:"Track your search and traffic metrics over time"})]}),e.jsx(j,{children:e.jsxs(H,{defaultValue:"traffic",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(y,{value:"traffic",children:"Traffic"}),e.jsx(y,{value:"search",children:"Search Performance"}),e.jsx(y,{value:"engagement",children:"Engagement"})]}),e.jsx(v,{value:"traffic",className:"space-y-4",children:e.jsx(F,{width:"100%",height:350,children:e.jsxs(ke,{data:s,children:[e.jsx($,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(C,{}),e.jsx(R,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:n=>[new Intl.NumberFormat().format(n),""]}),e.jsx(I,{}),e.jsx(q,{type:"monotone",dataKey:"sessions",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Sessions"}),e.jsx(q,{type:"monotone",dataKey:"users",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",name:"Users"}),e.jsx(q,{type:"monotone",dataKey:"pageviews",stackId:"3",stroke:"#ffc658",fill:"#ffc658",name:"Pageviews"})]})})}),e.jsx(v,{value:"search",className:"space-y-4",children:e.jsx(F,{width:"100%",height:350,children:e.jsxs(z,{data:s,children:[e.jsx($,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(C,{yAxisId:"left"}),e.jsx(C,{yAxisId:"right",orientation:"right"}),e.jsx(R,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:(n,t)=>t==="CTR"?[`${(n*100).toFixed(2)}%`,t]:t==="Avg Position"?[n.toFixed(1),t]:[new Intl.NumberFormat().format(n),t]}),e.jsx(I,{}),e.jsx(D,{yAxisId:"left",type:"monotone",dataKey:"clicks",stroke:"#8884d8",name:"Clicks",strokeWidth:2}),e.jsx(D,{yAxisId:"left",type:"monotone",dataKey:"impressions",stroke:"#82ca9d",name:"Impressions",strokeWidth:2}),e.jsx(D,{yAxisId:"right",type:"monotone",dataKey:"ctr",stroke:"#ffc658",name:"CTR",strokeWidth:2})]})})}),e.jsxs(v,{value:"engagement",className:"space-y-4",children:[e.jsx(F,{width:"100%",height:350,children:e.jsxs(z,{data:s,children:[e.jsx($,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(C,{}),e.jsx(R,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:(n,t)=>t==="Avg Position"?[n.toFixed(1),t]:[new Intl.NumberFormat().format(n),t]}),e.jsx(I,{}),e.jsx(D,{type:"monotone",dataKey:"position",stroke:"#8884d8",name:"Avg Position",strokeWidth:2})]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Lower position values are better (position 1 is the top result)"})]})]})})]})}function G({startDate:i,endDate:a,platforms:d,limit:s=10}){const n=Ae({startDate:i,endDate:a,platforms:d,limit:s});if(!n||n.length===0)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No query data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top queries"})]});const t=c=>new Intl.NumberFormat("en-US").format(c),r=c=>`${(c*100).toFixed(2)}%`,l=c=>c>0?e.jsx(Q,{className:"h-3 w-3 text-green-600"}):c<0?e.jsx(S,{className:"h-3 w-3 text-red-600"}):e.jsx(M,{className:"h-3 w-3 text-muted-foreground"});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(T,{children:[e.jsx(u,{className:"w-[40%]",children:"Query"}),e.jsx(u,{className:"text-right",children:"Clicks"}),e.jsx(u,{className:"text-right",children:"Impressions"}),e.jsx(u,{className:"text-right",children:"CTR"}),e.jsx(u,{className:"text-right",children:"Position"}),e.jsx(u,{className:"text-right",children:"Trend"})]})}),e.jsx(ee,{children:n.map((c,o)=>e.jsxs(T,{children:[e.jsx(x,{className:"font-medium max-w-xs truncate",children:c.query}),e.jsx(x,{className:"text-right",children:t(c.clicks)}),e.jsx(x,{className:"text-right",children:t(c.impressions)}),e.jsx(x,{className:"text-right",children:e.jsx(k,{variant:"outline",children:r(c.ctr)})}),e.jsx(x,{className:"text-right",children:e.jsx(k,{variant:"secondary",children:c.position.toFixed(1)})}),e.jsx(x,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:l(c.change)})})]},`${c.query}-${o}`))})]})})}function V({startDate:i,endDate:a,platforms:d,limit:s=10}){const n=Fe({startDate:i,endDate:a,platforms:d,limit:s});if(!n||n.length===0)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No page data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top pages"})]});const t=o=>new Intl.NumberFormat("en-US").format(o),r=o=>`${(o*100).toFixed(2)}%`,l=o=>o>0?e.jsx(Q,{className:"h-3 w-3 text-green-600"}):o<0?e.jsx(S,{className:"h-3 w-3 text-red-600"}):e.jsx(M,{className:"h-3 w-3 text-muted-foreground"}),c=(o,h=50)=>o.length<=h?o:o.substring(0,h)+"...";return e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(T,{children:[e.jsx(u,{className:"w-[35%]",children:"Page"}),e.jsx(u,{className:"text-right",children:"Clicks"}),e.jsx(u,{className:"text-right",children:"Sessions"}),e.jsx(u,{className:"text-right",children:"Impressions"}),e.jsx(u,{className:"text-right",children:"CTR"}),e.jsx(u,{className:"text-right",children:"Position"}),e.jsx(u,{className:"text-right",children:"Trend"}),e.jsx(u,{className:"w-[50px]"})]})}),e.jsx(ee,{children:n.map((o,h)=>e.jsxs(T,{children:[e.jsx(x,{className:"max-w-xs",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm truncate",title:o.url,children:c(o.url)}),o.title&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",title:o.title,children:o.title})]})}),e.jsx(x,{className:"text-right",children:t(o.clicks)}),e.jsx(x,{className:"text-right",children:t(o.sessions)}),e.jsx(x,{className:"text-right",children:t(o.impressions)}),e.jsx(x,{className:"text-right",children:e.jsx(k,{variant:"outline",children:r(o.ctr)})}),e.jsx(x,{className:"text-right",children:e.jsx(k,{variant:"secondary",children:o.position.toFixed(1)})}),e.jsx(x,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:l(o.change)})}),e.jsx(x,{children:e.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80",children:e.jsx(ie,{className:"h-4 w-4"})})})]},`${o.url}-${h}`))})]})})}function qe({startDate:i,endDate:a,onChange:d}){const[s,n]=E.useState(!1),t=l=>{const c=new Date,o=new Date;o.setDate(o.getDate()-l),d(o.toISOString().split("T")[0],c.toISOString().split("T")[0]),n(!1)},r=[{label:"Last 7 days",days:7},{label:"Last 30 days",days:30},{label:"Last 90 days",days:90},{label:"Last 6 months",days:180},{label:"Last year",days:365}];return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(se,{open:s,onOpenChange:n,children:[e.jsx(te,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),W(new Date(i),"MMM dd, yyyy")," - ",W(new Date(a),"MMM dd, yyyy")]})}),e.jsx(ae,{className:"w-auto p-4",align:"start",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Quick Select"}),e.jsx("div",{className:"grid gap-2",children:r.map(l=>e.jsx(b,{variant:"ghost",className:"justify-start",onClick:()=>t(l.days),children:l.label},l.label))})]})})})]})})}const Ee=[{value:"google_search_console",label:"Google Search Console"},{value:"google_analytics",label:"Google Analytics"},{value:"bing_webmaster",label:"Bing Webmaster"},{value:"yandex_webmaster",label:"Yandex Webmaster"}];function Ue({selectedPlatforms:i,onChange:a}){const d=s=>{i.includes(s)?a(i.filter(n=>n!==s)):a([...i,s])};return e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Platforms (",i.length,")"]})}),e.jsx(ae,{className:"w-64",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Filter by Platform"}),e.jsx("div",{className:"space-y-3",children:Ee.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{id:s.value,checked:i.includes(s.value),onCheckedChange:()=>d(s.value)}),e.jsx(ce,{htmlFor:s.value,className:"text-sm font-normal cursor-pointer",children:s.label})]},s.value))})]})})]})}function Oe(i){const{headers:a,rows:d,title:s}=i;let n="";s&&(n+=`${s}

`),n+=a.join(",")+`
`,d.forEach(o=>{const h=o.map(N=>{const _=String(N);return _.includes(",")||_.includes('"')||_.includes(`
`)?`"${_.replace(/"/g,'""')}"`:_});n+=h.join(",")+`
`});const t=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),l=URL.createObjectURL(t),c=`${s?.replace(/\s+/g,"_")||"export"}_${new Date().toISOString().split("T")[0]}.csv`;r.setAttribute("href",l),r.setAttribute("download",c),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)}function Me(i){const{headers:a,rows:d,title:s,dateRange:n}=i;let t=`
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8">
            <title>${s||"Analytics Report"}</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 40px;
                    color: #333;
                }
                h1 {
                    color: #2563eb;
                    margin-bottom: 10px;
                }
                .date-range {
                    color: #666;
                    font-size: 14px;
                    margin-bottom: 30px;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 20px;
                }
                th {
                    background-color: #2563eb;
                    color: white;
                    padding: 12px;
                    text-align: left;
                    font-weight: 600;
                }
                td {
                    padding: 10px 12px;
                    border-bottom: 1px solid #e5e7eb;
                }
                tr:nth-child(even) {
                    background-color: #f9fafb;
                }
                .footer {
                    margin-top: 40px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    color: #666;
                    font-size: 12px;
                    text-align: center;
                }
            </style>
        </head>
        <body>
            <h1>${s||"Analytics Report"}</h1>
            ${n?`<div class="date-range">${n}</div>`:""}
            <table>
                <thead>
                    <tr>
                        ${a.map(l=>`<th>${l}</th>`).join("")}
                    </tr>
                </thead>
                <tbody>
                    ${d.map(l=>`<tr>${l.map(c=>`<td>${c}</td>`).join("")}</tr>`).join("")}
                </tbody>
            </table>
            <div class="footer">
                Generated on ${new Date().toLocaleString()} | AgentBio.net Analytics
            </div>
        </body>
        </html>
    `;const r=window.open("","","height=600,width=800");r&&(r.document.write(t),r.document.close(),r.onload=()=>{r.print(),setTimeout(()=>{r.close()},100)})}function Y(i,a="Search Analytics Report",d){return{title:a,dateRange:d,headers:["Query","Clicks","Impressions","CTR","Avg. Position"],rows:i.map(s=>[s.query,s.clicks,s.impressions,`${(s.ctr*100).toFixed(2)}%`,s.position.toFixed(1)])}}function He(){const{toast:i}=P(),[a,d]=E.useState({start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[s,n]=E.useState(["google_search_console","google_analytics"]),t=Te(),r=async()=>{try{await t.mutateAsync({start_date:a.start,end_date:a.end,force_refresh:!0})}catch(o){console.error("Failed to refresh data:",o)}},l=()=>{const o=[{query:"luxury homes Los Angeles",clicks:245,impressions:1230,ctr:.199,position:3.2},{query:"real estate agent near me",clicks:189,impressions:2100,ctr:.09,position:5.8},{query:"homes for sale Beverly Hills",clicks:167,impressions:890,ctr:.188,position:2.1},{query:"best realtor LA",clicks:134,impressions:1500,ctr:.089,position:7.3},{query:"property listings California",clicks:98,impressions:670,ctr:.146,position:4.5}],h=`${a.start} to ${a.end}`,N=Y(o,"Search Analytics Report",h);Oe(N),i({title:"Exported to CSV",description:"Your analytics data has been downloaded."})},c=()=>{const o=[{query:"luxury homes Los Angeles",clicks:245,impressions:1230,ctr:.199,position:3.2},{query:"real estate agent near me",clicks:189,impressions:2100,ctr:.09,position:5.8},{query:"homes for sale Beverly Hills",clicks:167,impressions:890,ctr:.188,position:2.1},{query:"best realtor LA",clicks:134,impressions:1500,ctr:.089,position:7.3},{query:"property listings California",clicks:98,impressions:670,ctr:.146,position:4.5}],h=`${a.start} to ${a.end}`,N=Y(o,"Search Analytics Report",h);Me(N),i({title:"Opening PDF",description:"Your analytics report is being prepared for printing."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 flex-wrap",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:r,disabled:t.isPending,children:[e.jsx(be,{className:`h-4 w-4 mr-2 ${t.isPending?"animate-spin":""}`}),"Refresh Data"]}),e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(b,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(he,{align:"end",children:[e.jsxs(B,{onClick:l,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Export to CSV"]}),e.jsxs(B,{onClick:c,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Export to PDF"]})]})]}),e.jsxs(b,{variant:"outline",size:"sm",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(Le,{}),e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Filters"}),e.jsx(f,{children:"Customize your analytics view"})]}),e.jsxs(j,{className:"flex flex-wrap gap-4",children:[e.jsx(qe,{startDate:a.start,endDate:a.end,onChange:(o,h)=>d({start:o,end:h})}),e.jsx(Ue,{selectedPlatforms:s,onChange:n})]})]}),e.jsxs(H,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(y,{value:"overview",children:"Overview"}),e.jsx(y,{value:"queries",children:"Top Queries"}),e.jsx(y,{value:"pages",children:"Top Pages"}),e.jsx(y,{value:"devices",children:"Devices"}),e.jsx(y,{value:"countries",children:"Countries"})]}),e.jsxs(v,{value:"overview",className:"space-y-4",children:[e.jsx(Re,{startDate:a.start,endDate:a.end,platforms:s}),e.jsx(Ie,{startDate:a.start,endDate:a.end,platforms:s}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Top 10 Queries"}),e.jsx(f,{children:"Highest performing search queries"})]}),e.jsx(j,{children:e.jsx(G,{startDate:a.start,endDate:a.end,platforms:s,limit:10})})]}),e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Top 10 Pages"}),e.jsx(f,{children:"Highest performing pages"})]}),e.jsx(j,{children:e.jsx(V,{startDate:a.start,endDate:a.end,platforms:s,limit:10})})]})]})]}),e.jsx(v,{value:"queries",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"All Search Queries"}),e.jsx(f,{children:"Complete list of search queries with performance metrics"})]}),e.jsx(j,{children:e.jsx(G,{startDate:a.start,endDate:a.end,platforms:s,limit:100})})]})}),e.jsx(v,{value:"pages",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"All Pages"}),e.jsx(f,{children:"Complete list of pages with traffic metrics"})]}),e.jsx(j,{children:e.jsx(V,{startDate:a.start,endDate:a.end,platforms:s,limit:100})})]})}),e.jsx(v,{value:"devices",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Device Breakdown"}),e.jsx(f,{children:"Performance metrics by device type"})]}),e.jsx(j,{children:e.jsx("p",{className:"text-muted-foreground",children:"Device analytics coming soon..."})})]})}),e.jsx(v,{value:"countries",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Geographic Distribution"}),e.jsx(f,{children:"Performance metrics by country"})]}),e.jsx(j,{children:e.jsx("p",{className:"text-muted-foreground",children:"Geographic analytics coming soon..."})})]})})]})]})}export{He as S};
