import{r as e,j as t}from"./react-vendor-CGQ4_CNL.js";import{D as s,l as i,m as r,n as a,G as n,L as l,I as o,T as d,O as c,j as m}from"./ui-components-CDAR_vWs.js";import{i as x,a6 as u,X as h,b as p,ae as j,u as g,h as v,M as f,q as b,aw as y,Q as w,ay as N,az as C}from"./icons-BX9Iz4zT.js";import{u as k}from"./index-suCs1Jad.js";import{u as T}from"./useTestimonials-CwcC7fvt.js";import{s as S}from"./supabase--amO4t6_.js";import{u as _,U as F}from"./UpgradeModal-Cj_-7mAO.js";import{L as R}from"./LimitBanner-Do4ba85r.js";import{u as O}from"./useProfile-Drk9CK-v.js";import"./charts-D_q0pR-d.js";import"./utils-wmY8hpgz.js";import"./data-B0hfA2BH.js";import"./three-addons-DQ5hBofG.js";import"./three-BxgHQpUo.js";import"./forms-BzNDvv3d.js";function q({open:p,onOpenChange:j,onSave:g}){const[v,f]=e.useState({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),[b,y]=e.useState(null),w=e=>{const{name:t,value:s}=e.target;f(e=>({...e,[t]:s}))};return t.jsx(s,{open:p,onOpenChange:j,children:t.jsxs(i,{className:"max-w-2xl",children:[t.jsxs(r,{children:[t.jsx(a,{children:"Add Client Testimonial"}),t.jsx(n,{children:"Share feedback from satisfied clients to build credibility"})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),g?.(v),j(!1),f({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),y(null)},className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(l,{htmlFor:"clientName",children:"Client Name *"}),t.jsx(o,{id:"clientName",name:"clientName",value:v.clientName,onChange:w,placeholder:"John Smith",required:!0}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'You can use initials for privacy (e.g., "John S.")'})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"propertyType",children:"Property Type *"}),t.jsx(o,{id:"propertyType",name:"propertyType",value:v.propertyType,onChange:w,placeholder:"Single Family Home, Condo, etc.",required:!0})]})]}),t.jsxs("div",{children:[t.jsx(l,{children:"Rating *"}),t.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(e=>t.jsx("button",{type:"button",onClick:()=>f(t=>({...t,rating:e})),className:"focus:outline-none",children:t.jsx(x,{className:"h-8 w-8 transition-colors "+(e<=v.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")})},e))})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"review",children:"Testimonial Text *"}),t.jsx(d,{id:"review",name:"review",value:v.review,onChange:w,rows:6,maxLength:500,placeholder:"Share what the client said about working with you...",required:!0}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.review.length,"/500 characters"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(l,{children:"Client Photo (Optional)"}),b?t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:b,alt:"Client preview",className:"w-24 h-24 rounded-full object-cover"}),t.jsx("button",{type:"button",onClick:()=>{f(e=>({...e,clientPhoto:void 0})),y(null)},className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full",children:t.jsx(h,{className:"h-3 w-3"})})]}):t.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){f(e=>({...e,clientPhoto:t}));const e=new FileReader;e.onloadend=()=>{y(e.result)},e.readAsDataURL(t)}},className:"hidden",id:"photo-upload"}),t.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[t.jsx(u,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload client photo"}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 2MB"})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"featured",checked:v.featured,onChange:e=>f(t=>({...t,featured:e.target.checked})),className:"rounded border-border"}),t.jsx(l,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this testimonial on my profile"})]}),t.jsxs(c,{children:[t.jsx(m,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),t.jsx(m,{type:"submit",children:"Add Testimonial"})]})]})]})})}function P({isOpen:s,onClose:i,onSubmit:r,initialData:a}){const[n,c]=e.useState(a);if(e.useEffect(()=>{c(a)},[a]),!s)return null;return t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Edit Testimonial"}),t.jsx("button",{onClick:i,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:t.jsx(h,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),r(n)},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx(l,{htmlFor:"client_name",children:"Client Name *"}),t.jsx(o,{id:"client_name",value:n.client_name,onChange:e=>c({...n,client_name:e.target.value}),required:!0})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"client_title",children:"Client Title"}),t.jsx(o,{id:"client_title",value:n.client_title||"",onChange:e=>c({...n,client_title:e.target.value}),placeholder:"e.g., First-Time Homebuyer"})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"rating",children:"Rating *"}),t.jsx(o,{id:"rating",type:"number",min:"1",max:"5",value:n.rating,onChange:e=>c({...n,rating:parseInt(e.target.value)}),required:!0})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"review",children:"Review *"}),t.jsx(d,{id:"review",value:n.review,onChange:e=>c({...n,review:e.target.value}),rows:6,required:!0})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"property_type",children:"Property Type"}),t.jsx(o,{id:"property_type",value:n.property_type||"",onChange:e=>c({...n,property_type:e.target.value}),placeholder:"e.g., Single Family Home"})]}),t.jsxs("div",{children:[t.jsx(l,{htmlFor:"transaction_type",children:"Transaction Type"}),t.jsxs("select",{id:"transaction_type",value:n.transaction_type||"",onChange:e=>c({...n,transaction_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[t.jsx("option",{value:"",children:"Select type"}),t.jsx("option",{value:"buyer",children:"Buyer"}),t.jsx("option",{value:"seller",children:"Seller"})]})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(m,{type:"button",variant:"outline",onClick:i,className:"flex-1",children:"Cancel"}),t.jsx(m,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function A({open:c,onOpenChange:x,username:u,agentName:h}){const[y,w]=e.useState(!1),[N,C]=e.useState(!1),{toast:T}=k(),S=`${window.location.origin}/${u}/review`,_=`Hi there!\n\nI hope you've been enjoying your new home! I wanted to reach out and ask if you'd be willing to share a brief review of your experience working with me.\n\nYour feedback helps me improve my services and helps other clients find the right agent for their needs.\n\nYou can leave a review here:\n${S}\n\nIt only takes a couple of minutes, and I really appreciate your time!\n\nBest regards,\n${h}`,F=`Hi! Would you mind leaving a quick review of your experience? It helps me serve clients better: ${S} Thanks! - ${h}`,R=async(e,t="url")=>{try{await navigator.clipboard.writeText(e),"url"===t?(w(!0),setTimeout(()=>w(!1),2e3)):(C(!0),setTimeout(()=>C(!1),2e3)),T({title:"Copied!",description:("url"===t?"Review link":"Email template")+" copied to clipboard"})}catch(s){T({title:"Failed to copy",description:"Please copy manually",variant:"destructive"})}};return t.jsx(s,{open:c,onOpenChange:x,children:t.jsxs(i,{className:"sm:max-w-2xl",children:[t.jsxs(r,{children:[t.jsx(a,{className:"text-2xl",children:"Request Client Testimonial"}),t.jsx(n,{children:"Share this link with clients to collect reviews and testimonials"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx(l,{className:"text-base font-semibold",children:"Your Review Link"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Send this link to clients so they can leave a review"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(o,{value:S,readOnly:!0,className:"font-mono text-sm"}),t.jsx(m,{onClick:()=>R(S),variant:"outline",size:"icon",children:y?t.jsx(p,{className:"h-4 w-4 text-green-600"}):t.jsx(j,{className:"h-4 w-4"})}),t.jsx(m,{onClick:async()=>{if(navigator.share)try{await navigator.share({title:"Leave a Review",text:"I'd appreciate if you could leave a review of your experience!",url:S})}catch(e){}else R(S)},variant:"outline",size:"icon",title:"Share via...",children:t.jsx(g,{className:"h-4 w-4"})}),t.jsx(m,{asChild:!0,variant:"outline",size:"icon",title:"Preview review page",children:t.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",children:t.jsx(v,{className:"h-4 w-4"})})})]})]}),t.jsxs("div",{children:[t.jsx(l,{className:"text-base font-semibold mb-3 block",children:"Quick Send Options"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(m,{onClick:()=>{const e=encodeURIComponent(`Request for Testimonial - ${h}`),t=encodeURIComponent(_);window.open(`mailto:?subject=${e}&body=${t}`)},variant:"outline",className:"justify-start",children:[t.jsx(f,{className:"h-4 w-4 mr-2"}),"Send via Email"]}),t.jsxs(m,{onClick:()=>{const e=encodeURIComponent(F);window.open(`sms:?&body=${e}`)},variant:"outline",className:"justify-start",children:[t.jsx(b,{className:"h-4 w-4 mr-2"}),"Send via SMS"]})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx(l,{className:"text-base font-semibold",children:"Email Template"}),t.jsx(m,{onClick:()=>R(_,"email"),variant:"ghost",size:"sm",children:N?t.jsxs(t.Fragment,{children:[t.jsx(p,{className:"h-4 w-4 mr-2 text-green-600"}),"Copied"]}):t.jsxs(t.Fragment,{children:[t.jsx(j,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),t.jsx(d,{value:_,readOnly:!0,rows:12,className:"font-mono text-sm resize-none"}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ’¡ Tip: Customize this template to match your personal style"})]}),t.jsxs("div",{children:[t.jsx(l,{className:"text-base font-semibold mb-2 block",children:"SMS Template"}),t.jsx(d,{value:F,readOnly:!0,rows:3,className:"font-mono text-sm resize-none"})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-900",children:"ðŸ“‹ Best Practices for Requesting Reviews"}),t.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[t.jsx("li",{children:"â€¢ Wait 1-2 weeks after closing for best results"}),t.jsx("li",{children:"â€¢ Send a personalized message, not just the link"}),t.jsx("li",{children:"â€¢ Follow up once if no response after 1 week"}),t.jsx("li",{children:"â€¢ Thank clients regardless of whether they leave a review"}),t.jsx("li",{children:"â€¢ Make it easy - include the direct link"})]})]})]})]})})}function I(){const[s,i]=e.useState(!1),[r,a]=e.useState(null),[n,l]=e.useState(!1),[o,d]=e.useState(!1),{toast:c}=k(),{testimonials:m,addTestimonial:u,deleteTestimonial:h}=T(),{subscription:p,canAdd:j,getLimit:v,getUsage:f}=_(),{profile:b}=O(),I=m.length>0?(m.reduce((e,t)=>e+t.rating,0)/m.length).toFixed(1):"0.0",z=e=>t.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((s,i)=>t.jsx(x,{className:"h-4 w-4 "+(i<e?"fill-yellow-400 text-yellow-400":"text-gray-300")},i))});return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Testimonials"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Showcase client reviews and success stories"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors font-medium border border-border",children:[t.jsx(g,{className:"h-4 w-4"}),"Request Testimonial"]}),t.jsxs("button",{onClick:()=>{j("testimonials")?i(!0):l(!0)},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[t.jsx(y,{className:"h-4 w-4"}),"Add Testimonial"]})]})]}),p&&v("testimonials")!==1/0&&t.jsx(R,{feature:"testimonials",current:f("testimonials"),limit:v("testimonials")}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-foreground",children:m.length}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]}),t.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"text-2xl font-bold text-foreground",children:I}),t.jsx("div",{className:"flex",children:z(Math.round(parseFloat(I)))})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Rating"})]}),t.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-primary",children:m.length}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:m.map(e=>t.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-shadow relative",children:[t.jsx("div",{className:"mb-4",children:t.jsx(w,{className:"h-8 w-8 text-primary opacity-20"})}),t.jsxs("p",{className:"text-foreground mb-6 leading-relaxed",children:['"',e.review,'"']}),t.jsx("div",{className:"mb-4",children:z(e.rating)}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold",children:e.client_name.split(" ").map(e=>e[0]).join("")}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-foreground",children:e.client_name}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.property_type||"Client"})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>a(e),className:"p-2 hover:bg-accent rounded-lg transition-colors",children:t.jsx(N,{className:"h-4 w-4 text-muted-foreground"})}),t.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this testimonial?"))try{await h.mutateAsync(e),c({title:"Testimonial deleted",description:"Client review has been removed."})}catch(t){c({title:"Error",description:"Failed to delete testimonial.",variant:"destructive"})}})(e.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",children:t.jsx(C,{className:"h-4 w-4 text-red-500"})})]})]})]},e.id))}),0===m.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-accent rounded-full mb-4",children:t.jsx(x,{className:"h-8 w-8 text-muted-foreground"})}),t.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No testimonials yet"}),t.jsx("p",{className:"text-muted-foreground mb-6",children:"Start building social proof by adding client reviews"}),t.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[t.jsx(y,{className:"h-5 w-5"}),"Add Your First Testimonial"]})]}),t.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-4",children:t.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Featured testimonials will be prominently displayed on your public profile. Ask satisfied clients for reviews after successful transactions!"]})}),t.jsx(q,{open:s,onOpenChange:i,onSave:async e=>{try{await u.mutateAsync(e),c({title:"Testimonial added!",description:"Client review has been added successfully."}),i(!1)}catch(t){c({title:"Error",description:"Failed to add testimonial. Please try again.",variant:"destructive"})}}}),r&&t.jsx(P,{isOpen:!!r,onClose:()=>a(null),onSubmit:async e=>{if(r)try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:s}=await S.from("testimonials").update({client_name:e.client_name,client_title:e.client_title,rating:e.rating,review:e.review,property_type:e.property_type,transaction_type:e.transaction_type,updated_at:(new Date).toISOString()}).eq("id",r.id).eq("user_id",t.id);if(s)throw s;c({title:"Testimonial updated!",description:"Client review has been updated successfully."}),a(null),window.location.reload()}catch(t){c({title:"Error",description:"Failed to update testimonial. Please try again.",variant:"destructive"})}},initialData:{client_name:r.client_name,review:r.review,rating:r.rating,client_title:r.client_title,property_type:r.property_type,transaction_type:r.transaction_type}}),t.jsx(F,{open:n,onOpenChange:l,feature:"testimonials",currentPlan:p?.plan_name||"Free",requiredPlan:"Starter"}),b&&t.jsx(A,{open:o,onOpenChange:d,username:b.username||"",agentName:b.full_name||""})]})}export{I as default};
