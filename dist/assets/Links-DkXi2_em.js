import{r as o,ab as J,j as e,af as K,ag as X,ar as Z,ah as ee,ai as te,L as k,I as L,F as se,G as ae,J as ne,a3 as A,ak as F,al as P,aJ as E,aK as $,H as U,a5 as q,Q as _,br as Q,M as z,a6 as O,bs as R,K as re,N as le,a_ as ie,B as S,a$ as oe,b0 as ce,bt as de,b2 as T,a0 as ue,b as Y,as as me}from"./index-CIfNOF3i.js";import{F as V}from"./file-text-DQ9v_9F9.js";import{L as M}from"./link-_lEtg27e.js";import{u as xe}from"./useLinks-D8Z8ZpOY.js";import{u as he,U as pe}from"./UpgradeModal-DII7eA9e.js";import{L as be}from"./LimitBanner-BVipUC_G.js";import{P as ge}from"./plus-BBQjrNBP.js";import{G as fe}from"./grip-vertical-B92fc9TV.js";import{S as je}from"./square-pen-DwrQu7OJ.js";import{T as ve}from"./trash-2-C6tp_CcE.js";import"./useMutation-4dcsRmpl.js";import"./alert-CG_gOHyl.js";import"./progress-Cjre3bhi.js";import"./triangle-alert-Lz-W7BNH.js";const ke=ce({title:T().min(1,"Title is required").max(100,"Title must be less than 100 characters"),url:T().url("Please enter a valid URL"),icon:T(),active:de()}),I=[{value:"instagram",label:"Instagram",icon:A},{value:"facebook",label:"Facebook",icon:F},{value:"linkedin",label:"LinkedIn",icon:P},{value:"tiktok",label:"TikTok",icon:E},{value:"youtube",label:"YouTube",icon:$},{value:"zillow",label:"Zillow",icon:U},{value:"realtor",label:"Realtor.com",icon:q},{value:"calendar",label:"Calendar",icon:_},{value:"website",label:"Website",icon:Q},{value:"email",label:"Email",icon:z},{value:"phone",label:"Phone",icon:O},{value:"whatsapp",label:"WhatsApp",icon:R},{value:"document",label:"Document",icon:V},{value:"link",label:"Link",icon:M}];function Ne({open:h,onOpenChange:c,onSave:x}){const[u,a]=o.useState(null),{register:r,handleSubmit:p,formState:{errors:n},reset:i,setValue:f,watch:j}=J({resolver:oe(ke),defaultValues:{title:"",url:"",icon:"link",active:!0}}),N=j("icon"),w=j("active"),C=async l=>{try{a(null),await x?.(l),c(!1),i()}catch(t){console.error("Failed to add link:",t),a("Failed to add link. Please try again.")}};return e.jsx(K,{open:h,onOpenChange:c,children:e.jsxs(X,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Add Custom Link"}),e.jsx(te,{children:"Add a social media profile or custom link to your bio"})]}),e.jsxs("form",{onSubmit:p(C),className:"space-y-4",children:[u&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm",children:u}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"title",children:"Link Title *"}),e.jsx(L,{id:"title",...r("title"),placeholder:"Schedule a Consultation"}),n.title&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.title.message})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"url",children:"URL *"}),e.jsx(L,{id:"url",...r("url"),placeholder:"https://example.com"}),n.url&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.url.message})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"icon",children:"Icon"}),e.jsxs(se,{value:N,onValueChange:l=>f("icon",l),children:[e.jsx(ae,{children:e.jsx(ne,{children:(()=>{const l=I.find(m=>m.value===N),t=l?.icon||M;return e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsx("span",{children:l?.label||"Custom"})]})})()})}),e.jsx(re,{children:I.map(l=>{const t=l.icon;return e.jsx(le,{value:l.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsx("span",{children:l.label})]})},l.value)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"active",checked:w,onChange:l=>f("active",l.target.checked),className:"rounded border-border"}),e.jsx(k,{htmlFor:"active",className:"cursor-pointer",children:"Active (visible on profile)"})]}),e.jsxs(ie,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(S,{type:"submit",children:"Add Link"})]})]})]})})}function ye({isOpen:h,onClose:c,onSubmit:x,initialData:u}){const[a,r]=o.useState(u);if(o.useEffect(()=>{r(u)},[u]),!h)return null;const p=n=>{n.preventDefault(),x(a)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Link"}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"title",children:"Link Title *"}),e.jsx(L,{id:"title",value:a.title,onChange:n=>r({...a,title:n.target.value}),placeholder:"e.g., My Website",required:!0})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"url",children:"URL *"}),e.jsx(L,{id:"url",type:"url",value:a.url,onChange:n=>r({...a,url:n.target.value}),placeholder:"https://example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"icon",children:"Icon (optional)"}),e.jsx(L,{id:"icon",value:a.icon||"",onChange:n=>r({...a,icon:n.target.value}),placeholder:"e.g., link, globe, home"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Icon name from Lucide icons"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:c,className:"flex-1",children:"Cancel"}),e.jsx(S,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function we(h){const{onDelete:c,deleteDelay:x=1e4,undoMessage:u,resourceName:a}=h,{toast:r}=Y(),[p,n]=o.useState(new Map),i=o.useRef(p);i.current=p;const f=o.useCallback(async t=>{if(i.current.has(t.id))return;const m=setTimeout(async()=>{try{await c(t.id),n(v=>{const d=new Map(v);return d.delete(t.id),d}),r({title:`${a} deleted`,description:`Your ${a} has been permanently removed.`})}catch{r({title:"Deletion failed",description:`Failed to delete ${a}. Please try again.`,variant:"destructive"}),n(d=>{const D=new Map(d);return D.delete(t.id),D})}},x),g={id:t.id,data:t,timeoutId:m,timestamp:Date.now()};n(v=>{const d=new Map(v);return d.set(t.id,g),d});const{dismiss:b}=r({title:`${a} deleted`,description:u?.(t)||`Deleting ${a} in ${x/1e3} seconds...`,action:{label:"Undo",onClick:()=>{j(t.id),b()}},duration:x})},[c,x,u,a,r]),j=o.useCallback(t=>{const m=i.current.get(t);m&&(clearTimeout(m.timeoutId),n(g=>{const b=new Map(g);return b.delete(t),b}),r({title:"Deletion cancelled",description:`Your ${a} has been restored.`}))},[a,r]),N=o.useCallback(t=>i.current.has(t),[]),w=o.useCallback(()=>Array.from(i.current.values()).map(t=>t.data),[]),C=o.useCallback(()=>{i.current.forEach(t=>{clearTimeout(t.timeoutId)}),n(new Map),i.current.size>0&&r({title:"All deletions cancelled",description:`${i.current.size} ${a}${i.current.size>1?"s":""} restored.`})},[a,r]),l=o.useCallback(async t=>{const m=i.current.get(t);if(m){clearTimeout(m.timeoutId),n(g=>{const b=new Map(g);return b.delete(t),b});try{await c(t),r({title:`${a} deleted`,description:`Your ${a} has been permanently removed.`})}catch{r({title:"Deletion failed",description:`Failed to delete ${a}. Please try again.`,variant:"destructive"})}}},[c,a,r]);return{softDelete:f,undoDelete:j,isPendingDeletion:N,getPendingDeletions:w,cancelAllDeletions:C,forceDelete:l,pendingCount:p.size}}const Ce=h=>({calendar:_,instagram:A,facebook:F,zillow:U,link:M,linkedin:P,tiktok:E,youtube:$,realtor:q,website:Q,email:z,phone:O,whatsapp:R,document:V})[h]||M;function ze(){const[h,c]=o.useState(!1),[x,u]=o.useState(!1),[a,r]=o.useState(null),[p,n]=o.useState(!1),{toast:i}=Y(),{links:f,isLoading:j,addLink:N,updateLink:w,deleteLink:C}=xe(),{subscription:l,canAdd:t,getLimit:m,getUsage:g}=he(),{softDelete:b,isPendingDeletion:v}=we({onDelete:async s=>{await C.mutateAsync(s)},deleteDelay:1e4,resourceName:"link",undoMessage:s=>`"${s.title}" will be deleted in 10 seconds. Click Undo to cancel.`}),d=o.useMemo(()=>f.filter(s=>!v(s.id)),[f,v]),D=()=>{if(!t("links")){n(!0);return}c(!0)},G=async s=>{try{await N.mutateAsync(s),i({title:"Link added!",description:"Your custom link has been created successfully."})}catch{i({title:"Error",description:"Failed to add link. Please try again.",variant:"destructive"})}},B=s=>{r(s),u(!0)},H=async(s,y)=>{try{await w.mutateAsync({id:s,...y}),i({title:"Link updated!",description:"Your link has been updated successfully."})}catch{i({title:"Error",description:"Failed to update link. Please try again.",variant:"destructive"})}},W=s=>{b(s)};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Custom Links"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Manage your social and custom links"})]}),e.jsxs("button",{onClick:D,className:"inline-flex items-center gap-2 px-4 py-2.5 sm:py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 active:scale-95 transition-all font-medium min-h-[44px] w-full sm:w-auto justify-center shadow-sm",children:[e.jsx(ge,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Add Link"})]})]}),l&&m("links")!==1/0&&e.jsx(be,{feature:"links",current:g("links"),limit:m("links")}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:d.length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Total"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:d.filter(s=>s.is_active).length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Active"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:d.reduce((s,y)=>s+y.click_count,0)}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Clicks"})]})]}),e.jsx("div",{className:"bg-card border border-border rounded-lg divide-y divide-border",children:j?e.jsx("div",{className:"p-6 sm:p-8 text-center text-muted-foreground text-sm sm:text-base",children:"Loading links..."}):d.length===0?e.jsx("div",{className:"p-6 sm:p-8 text-center text-muted-foreground text-sm sm:text-base",children:'No links yet. Click "Add Link" to create your first link.'}):d.map(s=>e.jsxs("div",{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-4 hover:bg-accent/50 active:bg-accent/70 transition-colors",children:[e.jsx("button",{className:"cursor-grab active:cursor-grabbing p-1.5 hover:bg-accent rounded hidden sm:block min-h-[44px]","aria-label":"Drag to reorder",children:e.jsx(fe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center bg-accent rounded-lg flex-shrink-0",children:(()=>{const y=Ce(s.icon);return e.jsx(y,{className:"h-5 w-5 sm:h-6 sm:w-6 text-foreground"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-0.5 sm:mb-1 flex-wrap",children:[e.jsx("h3",{className:"font-medium text-sm sm:text-base text-foreground truncate",children:s.title}),s.is_active?e.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full font-medium flex-shrink-0",children:"Active"}):e.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 bg-gray-100 text-gray-700 text-xs rounded-full font-medium flex-shrink-0",children:"Inactive"})]}),e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs sm:text-sm text-muted-foreground hover:text-primary active:text-primary flex items-center gap-1 truncate",children:[e.jsx("span",{className:"truncate",children:s.url}),e.jsx(me,{className:"h-3 w-3 flex-shrink-0"})]}),e.jsxs("div",{className:"sm:hidden mt-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold text-foreground",children:s.click_count})," clicks"]})]}),e.jsxs("div",{className:"text-right hidden sm:block flex-shrink-0",children:[e.jsx("div",{className:"text-lg font-semibold text-foreground",children:s.click_count}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"clicks"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>B(s),className:"p-2 sm:p-2.5 hover:bg-accent active:bg-accent/80 rounded-lg transition-all min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"Edit link",children:e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("button",{onClick:()=>W(s),className:"p-2 sm:p-2.5 hover:bg-red-50 active:bg-red-100 rounded-lg transition-all min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"Delete link",children:e.jsx(ve,{className:"h-4 w-4 text-red-500"})})]})]},s.id))}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-3 sm:p-4",children:e.jsxs("p",{className:"text-xs sm:text-sm text-blue-800 dark:text-blue-200 leading-relaxed",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Drag and drop links to reorder them."}),e.jsx("span",{className:"sm:hidden",children:"Use the edit option to change link details."})," The order here will reflect on your public profile page."]})}),e.jsx(Ne,{open:h,onOpenChange:c,onSave:G}),e.jsx(ye,{open:x,onOpenChange:u,link:a,onSave:H}),e.jsx(pe,{open:p,onOpenChange:n,feature:"links",currentPlan:l?.plan_name||"Free",requiredPlan:"Starter"})]})}export{ze as default};
