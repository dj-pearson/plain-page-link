import{b as i,u as e,d as s}from"./data-O5cD9hjv.js";import{s as t}from"./supabase-BYwji6mk.js";import{u as r}from"./stores-Bwj68t5x.js";function n(){const{user:n}=r(),a=i(),{data:o=[],isLoading:d}=e({queryKey:["listings",n?.id],queryFn:async()=>{if(!n?.id)return[];const{data:i,error:e}=await t.from("listings").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(e)throw e;return i},enabled:!!n?.id});return{listings:o,isLoading:d,addListing:s({mutationFn:async i=>{if(!n?.id)throw new Error("User not authenticated");const{data:e,error:s}=await t.from("listings").insert({user_id:n.id,...i}).select().single();if(s)throw s;return e},onSuccess:()=>{a.invalidateQueries({queryKey:["listings",n?.id]})}}),updateListing:s({mutationFn:async({id:i,...e})=>{const{data:s,error:r}=await t.from("listings").update(e).eq("id",i).select().single();if(r)throw r;return s},onSuccess:()=>{a.invalidateQueries({queryKey:["listings",n?.id]})}}),deleteListing:s({mutationFn:async i=>{const{error:e}=await t.from("listings").delete().eq("id",i);if(e)throw e},onSuccess:()=>{a.invalidateQueries({queryKey:["listings",n?.id]})}})}}export{n as u};
