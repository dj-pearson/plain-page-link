import{r as e,j as s}from"./react-vendor-CGQ4_CNL.js";import{D as t,l as a,m as n,n as l,G as i,L as r,I as c,S as o,a as d,b as m,d as u,e as x,O as h,j as p}from"./ui-components-BBur-bM0.js";import{I as b,F as g,f as j,r as f,Y as v,H as k,p as N,e as y,G as w,M as C,P as D,N as L,aj as S,a7 as A,X as F,aw as M,aJ as $,h as I,ay as T,az as P}from"./icons-BX9Iz4zT.js";import{u as z}from"./index-DU1AD4H-.js";import{u as U}from"./useLinks-DjkZiMjf.js";import{u as E,U as O}from"./UpgradeModal-CZHI1I0b.js";import{L as Y}from"./LimitBanner-DOdqlemJ.js";import"./charts-D_q0pR-d.js";import"./utils-wmY8hpgz.js";import"./supabase-C4LM9fgr.js";import"./data-O5cD9hjv.js";import"./three-addons-DQ5hBofG.js";import"./three-BxgHQpUo.js";import"./forms-BzNDvv3d.js";const _=[{value:"instagram",label:"Instagram",icon:b},{value:"facebook",label:"Facebook",icon:g},{value:"linkedin",label:"LinkedIn",icon:j},{value:"tiktok",label:"TikTok",icon:f},{value:"youtube",label:"YouTube",icon:v},{value:"zillow",label:"Zillow",icon:k},{value:"realtor",label:"Realtor.com",icon:N},{value:"calendar",label:"Calendar",icon:y},{value:"website",label:"Website",icon:w},{value:"email",label:"Email",icon:C},{value:"phone",label:"Phone",icon:D},{value:"whatsapp",label:"WhatsApp",icon:L},{value:"document",label:"Document",icon:S},{value:"link",label:"Link",icon:A}];function q({open:b,onOpenChange:g,onSave:j}){const[f,v]=e.useState({title:"",url:"",icon:"link",active:!0}),k=e=>{const{name:s,value:t}=e.target;v(e=>({...e,[s]:t}))};return s.jsx(t,{open:b,onOpenChange:g,children:s.jsxs(a,{className:"max-w-md",children:[s.jsxs(n,{children:[s.jsx(l,{children:"Add Custom Link"}),s.jsx(i,{children:"Add a social media profile or custom link to your bio"})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),j?.(f),g(!1),v({title:"",url:"",icon:"link",active:!0})},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(r,{htmlFor:"title",children:"Link Title *"}),s.jsx(c,{id:"title",name:"title",value:f.title,onChange:k,placeholder:"Schedule a Consultation",required:!0})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"url",children:"URL *"}),s.jsx(c,{id:"url",name:"url",type:"url",value:f.url,onChange:k,placeholder:"https://example.com",required:!0})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"icon",children:"Icon"}),s.jsxs(o,{value:f.icon,onValueChange:e=>v(s=>({...s,icon:e})),children:[s.jsx(d,{children:s.jsx(m,{children:(()=>{const e=_.find(e=>e.value===f.icon),t=e?.icon||A;return s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx("span",{children:e?.label||"Custom"})]})})()})}),s.jsx(u,{children:_.map(e=>{const t=e.icon;return s.jsx(x,{value:e.value,children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx("span",{children:e.label})]})},e.value)})})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"active",checked:f.active,onChange:e=>v(s=>({...s,active:e.target.checked})),className:"rounded border-border"}),s.jsx(r,{htmlFor:"active",className:"cursor-pointer",children:"Active (visible on profile)"})]}),s.jsxs(h,{children:[s.jsx(p,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancel"}),s.jsx(p,{type:"submit",children:"Add Link"})]})]})]})})}function R({isOpen:t,onClose:a,onSubmit:n,initialData:l}){const[i,o]=e.useState(l);if(e.useEffect(()=>{o(l)},[l]),!t)return null;return s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-md",children:[s.jsxs("div",{className:"border-b border-border p-4 flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Edit Link"}),s.jsx("button",{onClick:a,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:s.jsx(F,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),n(i)},className:"p-6 space-y-4",children:[s.jsxs("div",{children:[s.jsx(r,{htmlFor:"title",children:"Link Title *"}),s.jsx(c,{id:"title",value:i.title,onChange:e=>o({...i,title:e.target.value}),placeholder:"e.g., My Website",required:!0})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"url",children:"URL *"}),s.jsx(c,{id:"url",type:"url",value:i.url,onChange:e=>o({...i,url:e.target.value}),placeholder:"https://example.com",required:!0})]}),s.jsxs("div",{children:[s.jsx(r,{htmlFor:"icon",children:"Icon (optional)"}),s.jsx(c,{id:"icon",value:i.icon||"",onChange:e=>o({...i,icon:e.target.value}),placeholder:"e.g., link, globe, home"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Icon name from Lucide icons"})]}),s.jsxs("div",{className:"flex gap-3 pt-4",children:[s.jsx(p,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancel"}),s.jsx(p,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function W(){const[t,a]=e.useState(!1),[n,l]=e.useState(!1),[i,r]=e.useState(null),[c,o]=e.useState(!1),{toast:d}=z(),{links:m,isLoading:u,addLink:x,updateLink:h,deleteLink:p}=U(),{subscription:F,canAdd:_,getLimit:W,getUsage:G}=E(),{softDelete:B,isPendingDeletion:H}=function(s){const{onDelete:t,deleteDelay:a=1e4,undoMessage:n,resourceName:l}=s,{toast:i}=z(),[r,c]=e.useState(new Map),o=e.useRef(r);o.current=r;const d=e.useCallback(async e=>{if(o.current.has(e.id))return;const s=setTimeout(async()=>{try{await t(e.id),c(s=>{const t=new Map(s);return t.delete(e.id),t}),i({title:`${l} deleted`,description:`Your ${l} has been permanently removed.`})}catch(s){i({title:"Deletion failed",description:`Failed to delete ${l}. Please try again.`,variant:"destructive"}),c(s=>{const t=new Map(s);return t.delete(e.id),t})}},a),r={id:e.id,data:e,timeoutId:s,timestamp:Date.now()};c(s=>{const t=new Map(s);return t.set(e.id,r),t});const{dismiss:d}=i({title:`${l} deleted`,description:n?.(e)||`Deleting ${l} in ${a/1e3} seconds...`,action:{label:"Undo",onClick:()=>{m(e.id),d()}},duration:a})},[t,a,n,l,i]),m=e.useCallback(e=>{const s=o.current.get(e);s&&(clearTimeout(s.timeoutId),c(s=>{const t=new Map(s);return t.delete(e),t}),i({title:"Deletion cancelled",description:`Your ${l} has been restored.`}))},[l,i]),u=e.useCallback(e=>o.current.has(e),[]),x=e.useCallback(()=>Array.from(o.current.values()).map(e=>e.data),[]),h=e.useCallback(()=>{o.current.forEach(e=>{clearTimeout(e.timeoutId)}),c(new Map),o.current.size>0&&i({title:"All deletions cancelled",description:`${o.current.size} ${l}${o.current.size>1?"s":""} restored.`})},[l,i]),p=e.useCallback(async e=>{const s=o.current.get(e);if(s){clearTimeout(s.timeoutId),c(s=>{const t=new Map(s);return t.delete(e),t});try{await t(e),i({title:`${l} deleted`,description:`Your ${l} has been permanently removed.`})}catch(a){i({title:"Deletion failed",description:`Failed to delete ${l}. Please try again.`,variant:"destructive"})}}},[t,l,i]);return{softDelete:d,undoDelete:m,isPendingDeletion:u,getPendingDeletions:x,cancelAllDeletions:h,forceDelete:p,pendingCount:r.size}}({onDelete:async e=>{await p.mutateAsync(e)},deleteDelay:1e4,resourceName:"link",undoMessage:e=>`"${e.title}" will be deleted in 10 seconds. Click Undo to cancel.`}),J=e.useMemo(()=>m.filter(e=>!H(e.id)),[m,H]);return s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Custom Links"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Manage your social and custom links"})]}),s.jsxs("button",{onClick:()=>{_("links")?a(!0):o(!0)},className:"inline-flex items-center gap-2 px-4 py-2.5 sm:py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 active:scale-95 transition-all font-medium min-h-[44px] w-full sm:w-auto justify-center shadow-sm",children:[s.jsx(M,{className:"h-4 w-4 sm:h-5 sm:w-5"}),s.jsx("span",{className:"text-sm sm:text-base",children:"Add Link"})]})]}),F&&W("links")!==1/0&&s.jsx(Y,{feature:"links",current:G("links"),limit:W("links")}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[s.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:J.length}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Total"})]}),s.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:J.filter(e=>e.is_active).length}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Active"})]}),s.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:J.reduce((e,s)=>e+s.click_count,0)}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Clicks"})]})]}),s.jsx("div",{className:"bg-card border border-border rounded-lg divide-y divide-border",children:u?s.jsx("div",{className:"p-6 sm:p-8 text-center text-muted-foreground text-sm sm:text-base",children:"Loading links..."}):0===J.length?s.jsx("div",{className:"p-6 sm:p-8 text-center text-muted-foreground text-sm sm:text-base",children:'No links yet. Click "Add Link" to create your first link.'}):J.map(e=>s.jsxs("div",{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-4 hover:bg-accent/50 active:bg-accent/70 transition-colors",children:[s.jsx("button",{className:"cursor-grab active:cursor-grabbing p-1.5 hover:bg-accent rounded hidden sm:block min-h-[44px]","aria-label":"Drag to reorder",children:s.jsx($,{className:"h-5 w-5 text-muted-foreground"})}),s.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center bg-accent rounded-lg flex-shrink-0",children:(()=>{const t=(a=e.icon,{calendar:y,instagram:b,facebook:g,zillow:k,link:A,linkedin:j,tiktok:f,youtube:v,realtor:N,website:w,email:C,phone:D,whatsapp:L,document:S}[a]||A);var a;return s.jsx(t,{className:"h-5 w-5 sm:h-6 sm:w-6 text-foreground"})})()}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-0.5 sm:mb-1 flex-wrap",children:[s.jsx("h3",{className:"font-medium text-sm sm:text-base text-foreground truncate",children:e.title}),e.is_active?s.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full font-medium flex-shrink-0",children:"Active"}):s.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 bg-gray-100 text-gray-700 text-xs rounded-full font-medium flex-shrink-0",children:"Inactive"})]}),s.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs sm:text-sm text-muted-foreground hover:text-primary active:text-primary flex items-center gap-1 truncate",children:[s.jsx("span",{className:"truncate",children:e.url}),s.jsx(I,{className:"h-3 w-3 flex-shrink-0"})]}),s.jsxs("div",{className:"sm:hidden mt-1.5 text-xs text-muted-foreground",children:[s.jsx("span",{className:"font-semibold text-foreground",children:e.click_count})," clicks"]})]}),s.jsxs("div",{className:"text-right hidden sm:block flex-shrink-0",children:[s.jsx("div",{className:"text-lg font-semibold text-foreground",children:e.click_count}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"clicks"})]}),s.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 flex-shrink-0",children:[s.jsx("button",{onClick:()=>(e=>{r(e),l(!0)})(e),className:"p-2 sm:p-2.5 hover:bg-accent active:bg-accent/80 rounded-lg transition-all min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"Edit link",children:s.jsx(T,{className:"h-4 w-4 text-muted-foreground"})}),s.jsx("button",{onClick:()=>(e=>{B(e)})(e),className:"p-2 sm:p-2.5 hover:bg-red-50 active:bg-red-100 rounded-lg transition-all min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"Delete link",children:s.jsx(P,{className:"h-4 w-4 text-red-500"})})]})]},e.id))}),s.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-3 sm:p-4",children:s.jsxs("p",{className:"text-xs sm:text-sm text-blue-800 dark:text-blue-200 leading-relaxed",children:["ðŸ’¡ ",s.jsx("strong",{children:"Tip:"})," ",s.jsx("span",{className:"hidden sm:inline",children:"Drag and drop links to reorder them."}),s.jsx("span",{className:"sm:hidden",children:"Use the edit option to change link details."})," The order here will reflect on your public profile page."]})}),s.jsx(q,{open:t,onOpenChange:a,onSave:async e=>{try{await x.mutateAsync(e),d({title:"Link added!",description:"Your custom link has been created successfully."})}catch(s){d({title:"Error",description:"Failed to add link. Please try again.",variant:"destructive"})}}}),s.jsx(R,{open:n,onOpenChange:l,link:i,onSave:async(e,s)=>{try{await h.mutateAsync({id:e,...s}),d({title:"Link updated!",description:"Your link has been updated successfully."})}catch(t){d({title:"Error",description:"Failed to update link. Please try again.",variant:"destructive"})}}}),s.jsx(O,{open:c,onOpenChange:o,feature:"links",currentPlan:F?.plan_name||"Free",requiredPlan:"Starter"})]})}export{W as default};
