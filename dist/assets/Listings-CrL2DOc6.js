import{r as b,af as ce,j as e,aj as X,ak as W,aw as Z,al as ee,am as se,h as d,I as g,aD as V,K as I,N as D,O as q,Q as E,R as p,T as R,a3 as O,aE as me,B as L,aF as ue,aG as he,aH as pe,aI as F,aJ as H,aK as xe,q as ge,b as $,s as U,ar as J,ao as je,ap as be,k as fe,a6 as ye,l as ve,g as Ne,a as we,J as Se,C as Ce,f as Fe,ag as Le}from"./index-BIuWzZUg.js";import{A as Pe,a as ke,b as Ae,c as Te,d as Ie,e as De,f as qe,g as Ee}from"./alert-dialog-C15ZMZM1.js";import{U as _e}from"./upload-DUKO6pC2.js";import{u as Ue}from"./useListings-DMIpmcH0.js";import{u as $e,U as Me}from"./UpgradeModal-CnPAovB8.js";import{L as ze}from"./LimitBanner-BNaHBXOg.js";import{T as Be}from"./twitter-0AMGkiQ2.js";import{C as Re}from"./copy-Cqh4YpG8.js";import{u as Oe}from"./useProfile-BFbRjsFU.js";import{K as Ge}from"./KeyboardShortcutsHelper-Dqv-8SHY.js";import{P as z}from"./plus-DSt1oDvE.js";import{F as Ye}from"./filter-CTGDcsZi.js";import{R as Ve}from"./refresh-cw-CDjEx_Wp.js";import{S as He}from"./square-pen-BBY8BxTO.js";import{T as Je}from"./trash-2-C7cGlXmF.js";import{T as Ke}from"./triangle-alert-B0U6cOSd.js";import"./useMutation-lbCNn57J.js";import"./alert-4m3QkTx3.js";import"./progress-D-TyEw37.js";const Qe=he({address:F().min(1,"Street address is required"),city:F().min(1,"City is required"),state:F().length(2,"State must be 2 characters (e.g., CA)"),zipCode:F().regex(/^\d{5}(-\d{4})?$/,"Invalid zip code format"),price:F().min(1,"Price is required"),beds:H().min(0,"Bedrooms must be at least 0"),baths:H().min(0,"Bathrooms must be at least 0"),sqft:F().min(1,"Square footage is required"),lotSize:F().optional(),propertyType:F(),status:F(),description:F(),mlsNumber:F().optional(),yearBuilt:F().optional(),images:pe(xe(File)).max(25,"Maximum 25 images allowed")});function Xe({open:N,onOpenChange:m,onSave:o}){const[j,t]=b.useState(null),[n,v]=b.useState([]),{register:r,handleSubmit:y,formState:{errors:a},reset:f,setValue:u,watch:c,control:l}=ce({resolver:ue(Qe),defaultValues:{address:"",city:"",state:"",zipCode:"",price:"",beds:3,baths:2,sqft:"",lotSize:"",propertyType:"single-family",status:"active",description:"",mlsNumber:"",yearBuilt:"",images:[]}}),x=c("images"),w=h=>{const C=Array.from(h.target.files||[]);u("images",[...x||[],...C]),C.forEach(T=>{const A=new FileReader;A.onloadend=()=>{v(_=>[..._,A.result])},A.readAsDataURL(T)})},i=h=>{u("images",(x||[]).filter((k,T)=>T!==h)),v(k=>k.filter((T,A)=>A!==h))},S=async h=>{try{t(null),await o?.(h),m(!1),f(),v([])}catch(C){console.error("Failed to add listing:",C),t("Failed to add listing. Please try again.")}};return e.jsx(X,{open:N,onOpenChange:m,children:e.jsxs(W,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Add New Property Listing"}),e.jsx(se,{children:"Fill in the details for your property listing"})]}),e.jsxs("form",{onSubmit:y(S),className:"space-y-6",children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm",children:j}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Property Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{htmlFor:"address",children:"Street Address *"}),e.jsx(g,{id:"address",...r("address"),placeholder:"123 Main Street"}),a.address&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.address.message})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"city",children:"City *"}),e.jsx(g,{id:"city",...r("city")}),a.city&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.city.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"state",children:"State *"}),e.jsx(g,{id:"state",...r("state"),maxLength:2,placeholder:"CA"}),a.state&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.state.message})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"zipCode",children:"Zip *"}),e.jsx(g,{id:"zipCode",...r("zipCode"),placeholder:"94102"}),a.zipCode&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.zipCode.message})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Property Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"price",children:"Price *"}),e.jsx(g,{id:"price",...r("price"),placeholder:"1,250,000"}),a.price&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.price.message})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"propertyType",children:"Property Type *"}),e.jsx(V,{name:"propertyType",control:l,render:({field:h})=>e.jsxs(I,{value:h.value,onValueChange:h.onChange,children:[e.jsx(D,{children:e.jsx(q,{})}),e.jsxs(E,{children:[e.jsx(p,{value:"single-family",children:"Single Family"}),e.jsx(p,{value:"condo",children:"Condo"}),e.jsx(p,{value:"townhouse",children:"Townhouse"}),e.jsx(p,{value:"multi-family",children:"Multi-Family"}),e.jsx(p,{value:"land",children:"Land"}),e.jsx(p,{value:"commercial",children:"Commercial"})]})]})})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"beds",children:"Bedrooms *"}),e.jsx(g,{id:"beds",type:"number",...r("beds",{valueAsNumber:!0}),min:0}),a.beds&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.beds.message})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"baths",children:"Bathrooms *"}),e.jsx(g,{id:"baths",type:"number",...r("baths",{valueAsNumber:!0}),min:0,step:.5}),a.baths&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.baths.message})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"sqft",children:"Square Feet *"}),e.jsx(g,{id:"sqft",...r("sqft"),placeholder:"2,400"}),a.sqft&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.sqft.message})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"lotSize",children:"Lot Size"}),e.jsx(g,{id:"lotSize",...r("lotSize"),placeholder:"0.25 acres"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",children:"Status *"}),e.jsx(V,{name:"status",control:l,render:({field:h})=>e.jsxs(I,{value:h.value,onValueChange:h.onChange,children:[e.jsx(D,{children:e.jsx(q,{})}),e.jsxs(E,{children:[e.jsx(p,{value:"active",children:"Active"}),e.jsx(p,{value:"pending",children:"Pending"}),e.jsx(p,{value:"sold",children:"Sold"}),e.jsx(p,{value:"off-market",children:"Off Market"})]})]})})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"yearBuilt",children:"Year Built"}),e.jsx(g,{id:"yearBuilt",...r("yearBuilt"),placeholder:"2015"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(R,{id:"description",...r("description"),rows:4,placeholder:"Beautiful property with stunning views..."})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mlsNumber",children:"MLS Number"}),e.jsx(g,{id:"mlsNumber",...r("mlsNumber"),placeholder:"ML81234567"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{children:"Property Photos"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:w,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(_e,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 5MB (max 25 images)"})]})]}),n.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-3",children:n.map((h,C)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:h,alt:`Preview ${C+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>i(C),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(O,{className:"h-3 w-3"})})]},C))}),a.images&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.images.message})]}),e.jsxs(me,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(L,{type:"submit",children:"Add Listing"})]})]})]})})}function We({isOpen:N,onClose:m,onSubmit:o,initialData:j}){const[t,n]=b.useState(j);if(b.useEffect(()=>{n(j)},[j]),!N)return null;const v=r=>{r.preventDefault(),o(t)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Property Listing"}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{htmlFor:"address",children:"Street Address *"}),e.jsx(g,{id:"address",value:t.address,onChange:r=>n({...t,address:r.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"city",children:"City *"}),e.jsx(g,{id:"city",value:t.city,onChange:r=>n({...t,city:r.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"price",children:"Price *"}),e.jsx(g,{id:"price",value:t.price,onChange:r=>n({...t,price:r.target.value}),placeholder:"$450,000",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"beds",children:"Bedrooms *"}),e.jsx(g,{id:"beds",type:"number",value:t.beds,onChange:r=>n({...t,beds:parseInt(r.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"baths",children:"Bathrooms *"}),e.jsx(g,{id:"baths",type:"number",value:t.baths,onChange:r=>n({...t,baths:parseInt(r.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"sqft",children:"Square Feet"}),e.jsx(g,{id:"sqft",type:"number",value:t.sqft||"",onChange:r=>n({...t,sqft:parseInt(r.target.value)||void 0})})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",children:"Status *"}),e.jsxs(I,{value:t.status,onValueChange:r=>n({...t,status:r}),children:[e.jsx(D,{children:e.jsx(q,{})}),e.jsxs(E,{children:[e.jsx(p,{value:"active",children:"Active"}),e.jsx(p,{value:"pending",children:"Pending"}),e.jsx(p,{value:"under_contract",children:"Under Contract"}),e.jsx(p,{value:"sold",children:"Sold"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"property_type",children:"Property Type"}),e.jsxs(I,{value:t.property_type||"",onValueChange:r=>n({...t,property_type:r}),children:[e.jsx(D,{children:e.jsx(q,{placeholder:"Select type"})}),e.jsxs(E,{children:[e.jsx(p,{value:"single_family",children:"Single Family"}),e.jsx(p,{value:"condo",children:"Condo"}),e.jsx(p,{value:"townhouse",children:"Townhouse"}),e.jsx(p,{value:"multi_family",children:"Multi-Family"}),e.jsx(p,{value:"land",children:"Land"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"mls_number",children:"MLS Number"}),e.jsx(g,{id:"mls_number",value:t.mls_number||"",onChange:r=>n({...t,mls_number:r.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(R,{id:"description",value:t.description||"",onChange:r=>n({...t,description:r.target.value}),rows:4,placeholder:"Describe the property features..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{htmlFor:"image",children:"Image URL"}),e.jsx(g,{id:"image",type:"url",value:t.image||"",onChange:r=>n({...t,image:r.target.value}),placeholder:"https://example.com/image.jpg"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(L,{type:"button",variant:"outline",onClick:m,className:"flex-1",children:"Cancel"}),e.jsx(L,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}const K=5*1024*1024,B=25,Q=["image/jpeg","image/jpg","image/png","image/webp"];function Ze(){const{user:N}=ge(),{toast:m}=$(),[o,j]=b.useState(!1),[t,n]=b.useState({current:0,total:0,percentage:0}),v=a=>Q.includes(a.type)?a.size>K?`File too large: ${a.name}. Maximum size is 5MB`:null:`Invalid file type: ${a.name}. Please upload JPG, PNG, or WEBP images`,r=async(a,f)=>{if(!N?.id)return m({title:"Error",description:"You must be logged in to upload images",variant:"destructive"}),[];if(a.length===0)return[];if(a.length>B)return m({title:"Too many images",description:`You can upload a maximum of ${B} images per listing`,variant:"destructive"}),[];for(const c of a){const l=v(c);if(l)return m({title:"Invalid file",description:l,variant:"destructive"}),[]}j(!0),n({current:0,total:a.length,percentage:0});const u=[];try{for(let c=0;c<a.length;c++){const l=a[c],x=l.name.split(".").pop(),w=Date.now(),i=Math.random().toString(36).substring(7),S=`${N.id}/${f||w}/${i}.${x}`,{error:h}=await U.storage.from("listings").upload(S,l,{cacheControl:"3600",upsert:!1});if(h)throw console.error("Upload error:",h),new Error(`Failed to upload ${l.name}: ${h.message}`);const{data:{publicUrl:C}}=U.storage.from("listings").getPublicUrl(S);u.push(C);const k={current:c+1,total:a.length,percentage:Math.round((c+1)/a.length*100)};n(k)}return u.length>0&&m({title:"Success",description:`Successfully uploaded ${u.length} image${u.length>1?"s":""}`}),u}catch(c){return console.error("Error uploading listing images:",c),m({title:"Upload failed",description:c instanceof Error?c.message:"Failed to upload images. Please try again.",variant:"destructive"}),u.length>0&&await y(u),[]}finally{j(!1),n({current:0,total:0,percentage:0})}},y=async a=>{if(!N?.id||a.length===0)return!1;try{const f=a.map(c=>{const l=c.match(/listings\/(.+)$/);return l?l[1]:null}).filter(Boolean);if(f.length===0)return!1;const{error:u}=await U.storage.from("listings").remove(f);if(u)throw u;return!0}catch(f){return console.error("Error deleting listing images:",f),!1}};return{uploadListingImages:r,deleteListingImages:y,uploading:o,progress:t,acceptedTypes:Q.join(", "),maxSize:K,maxImages:B}}function es({open:N,onOpenChange:m,listing:o,agentName:j="Your Real Estate Agent"}){const{toast:t}=$(),[n,v]=b.useState(!1),r=()=>{const i=[];if(i.push("ðŸ¡ NEW LISTING ALERT! ðŸ¡"),i.push(""),i.push(`ðŸ“ ${o.address}, ${o.city}`),i.push(`ðŸ’° ${f(o.price)}`),o.beds||o.baths){const S=[];o.beds&&S.push(`${o.beds} beds`),o.baths&&S.push(`${o.baths} baths`),i.push(`ðŸ›ï¸ ${S.join(" | ")}`)}return o.sqft&&i.push(`ðŸ“ ${o.sqft.toLocaleString()} sq ft`),i.push(""),i.push(`Don't miss out on this ${o.property_type||"amazing property"}!`),i.push(""),i.push("ðŸ“ž Contact me for details or to schedule a showing!"),i.push(""),i.push("#RealEstate #NewListing #HomesForSale #DreamHome #Property"),o.city&&i.push(`#${o.city.replace(/\s+/g,"")}RealEstate`),i.join(`
`)},[y,a]=b.useState(r()),f=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(i),u=async()=>{try{await navigator.clipboard.writeText(y),v(!0),t({title:"Copied!",description:"Post text copied to clipboard"}),setTimeout(()=>v(!1),2e3)}catch{t({title:"Failed to copy",description:"Please copy manually",variant:"destructive"})}},c=()=>{const i=encodeURIComponent(window.location.origin),S=encodeURIComponent(y);window.open(`https://www.facebook.com/sharer/sharer.php?u=${i}&quote=${S}`,"_blank")},l=()=>{const i=encodeURIComponent(y.substring(0,280));window.open(`https://twitter.com/intent/tweet?text=${i}`,"_blank")},x=()=>{const i=encodeURIComponent(window.location.origin);window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${i}`,"_blank")},w=async()=>{if(navigator.share)try{await navigator.share({title:`New Listing: ${o.address}`,text:y})}catch{console.log("Share cancelled")}else u()};return e.jsx(X,{open:N,onOpenChange:m,children:e.jsxs(W,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsxs(ee,{className:"text-2xl flex items-center gap-2",children:[e.jsx(J,{className:"h-6 w-6 text-blue-600"}),"Share Your New Listing"]}),e.jsx(se,{children:"Post automatically generated - customize and share on social media"})]}),e.jsxs("div",{className:"space-y-6",children:[o.image&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-border",children:[e.jsx("img",{src:o.image,alt:o.address,className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:"NEW"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Post Caption"}),e.jsx(R,{value:y,onChange:i=>a(i.target.value),rows:12,className:"font-sans text-sm resize-none",placeholder:"Customize your post..."}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"ðŸ’¡ Tip: Add your phone number or website for easy contact"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[y.length," characters"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(L,{onClick:c,variant:"outline",className:"justify-start",children:[e.jsx(je,{className:"h-4 w-4 mr-2 text-blue-600"}),"Facebook"]}),e.jsxs(L,{onClick:l,variant:"outline",className:"justify-start",children:[e.jsx(Be,{className:"h-4 w-4 mr-2 text-sky-500"}),"Twitter/X"]}),e.jsxs(L,{onClick:x,variant:"outline",className:"justify-start",children:[e.jsx(be,{className:"h-4 w-4 mr-2 text-blue-700"}),"LinkedIn"]}),e.jsxs(L,{onClick:w,variant:"outline",className:"justify-start",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"More..."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{onClick:u,variant:"secondary",className:"flex-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4 mr-2 text-green-600"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Copy Text"]})}),e.jsxs(L,{onClick:()=>m(!1),variant:"outline",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Close"]})]})]}),e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-purple-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-purple-900 mb-1",children:"For Instagram:"}),e.jsx("p",{className:"text-purple-800",children:"Copy the text above and paste it when creating your Instagram post. Don't forget to upload your listing photo!"})]})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-900",children:"ðŸ“± Social Media Best Practices"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Post during peak hours (7-9 AM or 5-7 PM)"}),e.jsx("li",{children:"â€¢ Use high-quality photos (first photo is most important)"}),e.jsx("li",{children:"â€¢ Include local hashtags for better reach"}),e.jsx("li",{children:"â€¢ Respond quickly to comments and DMs"}),e.jsx("li",{children:"â€¢ Share to Instagram Stories for 24-hour visibility"})]})]})]})]})})}function ss({listingId:N,currentStatus:m,onStatusChange:o}){const[j,t]=b.useState(m),[n,v]=b.useState(!1),[r,y]=b.useState(!1),{toast:a}=$(),f=[{value:"active",label:"Active",color:"text-green-600"},{value:"pending",label:"Pending",color:"text-yellow-600"},{value:"sold",label:"Sold",color:"text-blue-600"},{value:"under_contract",label:"Under Contract",color:"text-purple-600"},{value:"off_market",label:"Off Market",color:"text-gray-600"}],u=async l=>{v(!0),t(l);try{const{error:x}=await U.from("listings").update({status:l}).eq("id",N);if(x)throw x;y(!0),setTimeout(()=>y(!1),2e3);const w=f.find(i=>i.value===l)?.label||l;a({title:"Status Updated",description:`Listing marked as ${w}`}),o?.(l)}catch(x){console.error("Failed to update status:",x),t(m),a({title:"Update Failed",description:"Failed to update listing status. Please try again.",variant:"destructive"})}finally{v(!1)}},c=f.find(l=>l.value===j);return e.jsx("div",{className:"relative inline-block",children:e.jsxs(I,{value:j,onValueChange:u,disabled:n,children:[e.jsx(D,{className:`w-[140px] h-8 text-xs ${c?.color||""} ${n?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsx(ve,{className:"h-3 w-3 animate-spin"}),r&&!n&&e.jsx(Ne,{className:"h-3 w-3 text-green-600"}),e.jsx(q,{})]})}),e.jsx(E,{children:f.map(l=>e.jsx(p,{value:l.value,className:l.color,children:l.label},l.value))})]})})}function vs(){const[N,m]=b.useState(""),[o,j]=b.useState(!1),[t,n]=b.useState(null),[v,r]=b.useState(!1),[y,a]=b.useState(!1),[f,u]=b.useState(null),[c,l]=b.useState(null),{toast:x}=$(),{listings:w,isError:i,error:S,refetch:h,addListing:C,updateListing:k,deleteListing:T}=Ue(),{uploadListingImages:A}=Ze(),{subscription:_,canAdd:te,getLimit:G,getUsage:re}=$e(),{profile:ae}=Oe(),M=we(),ie=[{key:"n",description:"Add new listing",action:()=>Y(),category:"Actions"},{key:"d",description:"Go to Dashboard",action:()=>M("/dashboard"),category:"Navigation"},{key:"l",description:"Go to Leads",action:()=>M("/dashboard/leads"),category:"Navigation"},{key:"a",description:"Go to Analytics",action:()=>M("/dashboard/analytics"),category:"Navigation"}],Y=()=>{if(!te("listings")){r(!0),x({title:"Upgrade required",description:"Your plan limit has been reached for listings."});return}j(!0)},le=async s=>{try{let P=[];if(s.images&&s.images.length>0&&(P=await A(s.images),P.length===0))return;const de={address:s.address,city:s.city,price:s.price,beds:s.beds,baths:s.baths,sqft:parseInt(s.sqft)||null,status:s.status,image:P[0]||null,photos:P.length>0?P:null,description:s.description||null,mls_number:s.mlsNumber||null,property_type:s.propertyType||null};await C.mutateAsync(de),u({address:s.address,city:s.city,price:s.price,beds:s.beds,baths:s.baths,sqft:parseInt(s.sqft)||void 0,property_type:s.propertyType,image:P[0]||void 0}),x({title:"Listing added!",description:"Your property listing has been created successfully."}),j(!1),a(!0)}catch{x({title:"Error",description:"Failed to add listing. Please try again.",variant:"destructive"})}},ne=async()=>{if(c)try{await T.mutateAsync(c.id),x({title:"Listing deleted",description:"Property listing has been removed."})}catch{x({title:"Error",description:"Failed to delete listing.",variant:"destructive"})}finally{l(null)}},oe=async s=>{if(t)try{await k.mutateAsync({id:t.id,address:s.address,city:s.city,price:s.price,beds:s.beds,baths:s.baths,sqft:s.sqft,status:s.status,image:s.image,description:s.description,mls_number:s.mls_number,property_type:s.property_type,updated_at:new Date().toISOString()}),x({title:"Listing updated!",description:"Your property listing has been updated successfully."}),n(null)}catch{x({title:"Error",description:"Failed to update listing. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Property Listings"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Manage your active and sold properties"})]}),e.jsxs("button",{id:"add-property-button",onClick:s=>{s.preventDefault(),s.stopPropagation(),Y()},className:"inline-flex items-center gap-2 px-4 py-2.5 sm:py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 active:scale-95 transition-all font-medium min-h-[44px] w-full sm:w-auto justify-center shadow-sm",style:{position:"relative",zIndex:10},children:[e.jsx(z,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Add Property"})]})]}),_&&G("listings")!==1/0&&e.jsx(ze,{feature:"listings",current:re("listings"),limit:G("listings")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search properties...",value:N,onChange:s=>m(s.target.value),className:"w-full pl-10 pr-4 py-2.5 sm:py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm sm:text-base min-h-[44px]"})]}),e.jsxs("button",{className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 sm:py-2 bg-background border border-border rounded-lg hover:bg-accent active:scale-95 transition-all min-h-[44px] w-full sm:w-auto",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Filters"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:w.length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Total"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:w.filter(s=>s.status==="active").length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Active"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600",children:w.filter(s=>s.status==="pending").length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Pending"})]})]}),i&&e.jsx(Ce,{children:e.jsxs(Fe,{className:"p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-red-100 rounded-full mb-3 sm:mb-4",children:e.jsx(Le,{className:"h-7 w-7 sm:h-8 sm:w-8 text-red-600"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 sm:mb-2",children:"Failed to load listings"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4 max-w-sm mx-auto",children:S instanceof Error?S.message:"An unexpected error occurred. Please try again."}),e.jsxs(L,{onClick:()=>h(),variant:"outline",className:"gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Try Again"]})]})}),!i&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:w.map(s=>e.jsxs("div",{className:"bg-card border border-border rounded-lg overflow-hidden hover:shadow-lg active:shadow-xl transition-all group",children:[e.jsxs("div",{className:"relative h-44 sm:h-48 overflow-hidden",children:[e.jsx("img",{src:s.image,alt:s.address,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}),e.jsx("div",{className:"absolute top-2 sm:top-3 left-2 sm:left-3",children:e.jsx(ss,{listingId:s.id,currentStatus:s.status,onStatusChange:P=>{s.status=P}})}),e.jsxs("div",{className:"absolute top-2 sm:top-3 right-2 sm:right-3 flex gap-1.5 sm:gap-2",children:[e.jsx("button",{onClick:()=>n(s),className:"p-2 sm:p-2.5 bg-white/90 backdrop-blur-sm rounded-full hover:bg-white active:scale-90 transition-all shadow-md min-w-[44px] min-h-[44px] flex items-center justify-center",title:"Edit listing","aria-label":"Edit listing",children:e.jsx(He,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>l({id:s.id,address:s.address}),className:"p-2 sm:p-2.5 bg-white/90 backdrop-blur-sm rounded-full hover:bg-white active:scale-90 transition-all text-red-600 shadow-md min-w-[44px] min-h-[44px] flex items-center justify-center",title:"Delete listing","aria-label":"Delete listing",children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"mb-2 sm:mb-3",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary mb-1",children:s.price}),e.jsx("div",{className:"font-medium text-sm sm:text-base text-foreground",children:s.address}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:s.city})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-muted-foreground mb-3 sm:mb-4 flex-wrap",children:[e.jsxs("span",{children:[s.beds," beds"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[s.baths," baths"]}),s.sqft&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"whitespace-nowrap",children:[s.sqft.toLocaleString()," sqft"]})]})]}),e.jsx("div",{className:"flex items-center justify-between pt-2 sm:pt-3 border-t border-border",children:e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:["Listed ",new Date(s.created_at).toLocaleDateString()]})})]})]},s.id))}),!i&&w.length===0&&e.jsxs("div",{className:"text-center py-8 sm:py-12 px-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-accent rounded-full mb-3 sm:mb-4",children:e.jsx(z,{className:"h-7 w-7 sm:h-8 sm:w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 sm:mb-2",children:"No properties yet"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4 sm:mb-6 max-w-sm mx-auto",children:"Start by adding your first property listing"}),e.jsxs("button",{onClick:()=>j(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 active:scale-95 transition-all font-medium min-h-[44px] shadow-md",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Add Your First Property"})]})]}),e.jsx(Xe,{open:o,onOpenChange:j,onSave:le}),t&&e.jsx(We,{isOpen:!!t,onClose:()=>n(null),onSubmit:oe,initialData:{address:t.address,city:t.city,price:t.price,beds:t.beds,baths:t.baths,sqft:t.sqft,status:t.status,image:t.image,description:t.description,mls_number:t.mls_number,property_type:t.property_type}}),e.jsx(Me,{open:v,onOpenChange:r,feature:"listings",currentPlan:_?.plan_name||"Free",requiredPlan:"Starter"}),f&&e.jsx(es,{open:y,onOpenChange:a,listing:f,agentName:ae?.full_name}),e.jsx(Pe,{open:!!c,onOpenChange:s=>!s&&l(null),children:e.jsxs(ke,{children:[e.jsxs(Ae,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-red-600"}),"Delete Listing"]}),e.jsxs(Ie,{children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold text-foreground",children:c?.address}),"? This action cannot be undone."]})]}),e.jsxs(De,{children:[e.jsx(qe,{children:"Cancel"}),e.jsx(Ee,{onClick:ne,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:"Delete Listing"})]})]})}),e.jsx(Ge,{shortcuts:ie})]})}export{vs as default};
