import{K as y,a8 as f,u as m,s}from"./index-CH8a_jH7.js";import{u as r}from"./useMutation-DQof0gk2.js";function h(){const{user:i}=y(),a=f(),{data:d=[],isLoading:c}=m({queryKey:["listings",i==null?void 0:i.id],queryFn:async()=>{if(!(i!=null&&i.id))return[];const{data:e,error:t}=await s.from("listings").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});if(t)throw t;return e},enabled:!!(i!=null&&i.id)}),u=r({mutationFn:async e=>{if(!(i!=null&&i.id))throw new Error("User not authenticated");const{data:t,error:n}=await s.from("listings").insert({user_id:i.id,...e}).select().single();if(n)throw n;return t},onSuccess:()=>{a.invalidateQueries({queryKey:["listings",i==null?void 0:i.id]})}}),l=r({mutationFn:async({id:e,...t})=>{const{data:n,error:o}=await s.from("listings").update(t).eq("id",e).select().single();if(o)throw o;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["listings",i==null?void 0:i.id]})}}),g=r({mutationFn:async e=>{const{error:t}=await s.from("listings").delete().eq("id",e);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["listings",i==null?void 0:i.id]})}});return{listings:d,isLoading:c,addListing:u,updateListing:l,deleteListing:g}}export{h as u};
