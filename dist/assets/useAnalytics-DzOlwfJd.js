import{u as e}from"./data-Hz84gFTE.js";import{u as i,s as t}from"./index-q1Xv5wHf.js";function a(){const{user:a}=i(),{data:s=[],isLoading:n}=e({queryKey:["analytics-views",null==a?void 0:a.id],queryFn:async()=>{if(!(null==a?void 0:a.id))return[];const{data:e,error:i}=await t.from("analytics_views").select("*").eq("user_id",a.id).order("viewed_at",{ascending:!1});if(i)throw i;return e},enabled:!!(null==a?void 0:a.id)}),{data:r=[],isLoading:d}=e({queryKey:["analytics-leads",null==a?void 0:a.id],queryFn:async()=>{if(!(null==a?void 0:a.id))return[];const{data:e,error:i}=await t.from("leads").select("*").eq("user_id",a.id);if(i)throw i;return e},enabled:!!(null==a?void 0:a.id)}),o={totalViews:s.length,uniqueVisitors:new Set(s.map(e=>e.visitor_id)).size,totalLeads:r.length,conversionRate:s.length>0?(r.length/s.length*100).toFixed(2):"0.00"},l=s.reduce((e,i)=>{const t=new Date(i.viewed_at).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e[t]||(e[t]={name:t,views:0,visitors:new Set}),e[t].views++,i.visitor_id&&e[t].visitors.add(i.visitor_id),e},{}),u=Object.values(l).map(e=>({name:e.name,views:e.views,visitors:e.visitors.size})),c=r.reduce((e,i)=>{const t=i.lead_type||"contact";return e[t]=(e[t]||0)+1,e},{});return{stats:o,viewsData:u,leadsData:Object.entries(c).map(([e,i])=>({name:e.charAt(0).toUpperCase()+e.slice(1),value:i})),recentLeads:r.slice(0,10),isLoading:n||d}}export{a as u};
