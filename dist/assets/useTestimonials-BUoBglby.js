import{K as y,a8 as f,u as w,s as n}from"./index-CH8a_jH7.js";import{u as o}from"./useMutation-DQof0gk2.js";function p(){const{user:t}=y(),s=f(),{data:d=[],isLoading:l}=w({queryKey:["testimonials",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];const{data:i,error:e}=await n.from("testimonials").select("*").eq("user_id",t.id).order("date",{ascending:!1});if(e)throw e;return i},enabled:!!(t!=null&&t.id)}),c=o({mutationFn:async i=>{if(!(t!=null&&t.id))throw new Error("User not authenticated");const{data:e,error:a}=await n.from("testimonials").insert({user_id:t.id,...i}).select().single();if(a)throw a;return e},onSuccess:()=>{s.invalidateQueries({queryKey:["testimonials",t==null?void 0:t.id]})}}),u=o({mutationFn:async({id:i,...e})=>{const{data:a,error:r}=await n.from("testimonials").update(e).eq("id",i).select().single();if(r)throw r;return a},onSuccess:()=>{s.invalidateQueries({queryKey:["testimonials",t==null?void 0:t.id]})}}),m=o({mutationFn:async i=>{const{error:e}=await n.from("testimonials").delete().eq("id",i);if(e)throw e},onSuccess:()=>{s.invalidateQueries({queryKey:["testimonials",t==null?void 0:t.id]})}});return{testimonials:d,isLoading:l,addTestimonial:c,updateTestimonial:u,deleteTestimonial:m}}export{p as u};
