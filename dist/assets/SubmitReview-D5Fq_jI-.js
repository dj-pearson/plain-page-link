import{f as e,g as t,r as s,j as r}from"./react-vendor-CGQ4_CNL.js";import{s as i}from"./supabase-BYwji6mk.js";import{u as a}from"./index-BVsPZqG5.js";import{u as l,C as n,f as o,g as c,h as m,o as d,j as u,L as x,I as h,T as p}from"./ui-components-aacikMi6.js";import{H as j,J as f,i as y,a5 as g}from"./icons-BX9Iz4zT.js";import"./charts-D_q0pR-d.js";import"./utils-wmY8hpgz.js";import"./data-O5cD9hjv.js";import"./three-addons-DQ5hBofG.js";import"./three-BxgHQpUo.js";import"./stores-DrVlQDHa.js";import"./forms-BzNDvv3d.js";function v(){const{username:v}=e(),b=t(),{toast:w}=a(),[_,N]=s.useState(null),[S,F]=s.useState(!0),[C,T]=s.useState(!1),[k,Y]=s.useState(!1),[E,P]=s.useState(0),[q,H]=s.useState(0),[R,z]=s.useState({client_name:"",client_email:"",client_title:"",review:"",property_type:"",transaction_type:"buyer"});s.useEffect(()=>{v&&(async()=>{try{const{data:e,error:t}=await i.from("profiles").select("id, full_name, avatar_url, bio").eq("username",v).single();if(t)throw t;N(e)}catch(e){w({title:"Agent not found",description:"The agent profile could not be found.",variant:"destructive"})}finally{F(!1)}})()},[v,w]);return S?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center",children:r.jsx(l,{size:"lg"})}):_?k?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:r.jsxs(n,{className:"w-full max-w-md",children:[r.jsxs(o,{className:"text-center",children:[r.jsx("div",{className:"flex justify-center mb-4",children:r.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:r.jsx(f,{className:"w-10 h-10 text-green-600"})})}),r.jsx(c,{className:"text-2xl",children:"Thank You!"}),r.jsxs(m,{className:"text-base mt-2",children:["Your review has been submitted successfully. ",_.full_name," will be notified and may feature your testimonial on their profile."]})]}),r.jsx(d,{children:r.jsxs(u,{onClick:()=>b(`/${v}`),className:"w-full",variant:"outline",children:["View ",_.full_name,"'s Profile"]})})]})}):r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-12 px-4",children:r.jsx("div",{className:"max-w-2xl mx-auto",children:r.jsxs(n,{children:[r.jsxs(o,{children:[r.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[_.avatar_url&&r.jsx("img",{src:_.avatar_url,alt:_.full_name,className:"w-16 h-16 rounded-full object-cover"}),r.jsxs("div",{children:[r.jsx(c,{className:"text-2xl",children:"Share Your Experience"}),r.jsxs(m,{className:"text-base",children:["Leave a review for ",_.full_name]})]})]}),_.bio&&r.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',_.bio,'"']})]}),r.jsx(d,{children:r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),0!==E){T(!0);try{const{error:e}=await i.from("testimonials").insert({user_id:_.id,client_name:R.client_name,client_title:R.client_title||"",rating:E,review:R.review,property_type:R.property_type||"",transaction_type:R.transaction_type,date:(new Date).toISOString()});if(e)throw e;Y(!0),w({title:"Review submitted!",description:`Thank you for sharing your experience with ${_.full_name}!`})}catch(t){w({title:"Submission failed",description:"There was an error submitting your review. Please try again.",variant:"destructive"})}finally{T(!1)}}else w({title:"Rating required",description:"Please select a star rating.",variant:"destructive"})},className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx(x,{className:"text-base font-semibold mb-3 block",children:"How would you rate your experience? *"}),r.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(e=>r.jsx("button",{type:"button",onClick:()=>P(e),onMouseEnter:()=>H(e),onMouseLeave:()=>H(0),className:"transition-transform hover:scale-110",children:r.jsx(y,{className:"w-10 h-10 "+(e<=(q||E)?"fill-yellow-400 text-yellow-400":"text-gray-300")})},e))}),r.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:E>0&&r.jsx("span",{className:"text-blue-600 font-medium",children:5===E?"Excellent!":4===E?"Great!":3===E?"Good":2===E?"Fair":"Poor"})})]}),r.jsxs("div",{children:[r.jsx(x,{htmlFor:"client_name",children:"Your Name *"}),r.jsx(h,{id:"client_name",value:R.client_name,onChange:e=>z({...R,client_name:e.target.value}),placeholder:"John Doe",required:!0})]}),r.jsxs("div",{children:[r.jsx(x,{htmlFor:"client_email",children:"Your Email *"}),r.jsx(h,{id:"client_email",type:"email",value:R.client_email,onChange:e=>z({...R,client_email:e.target.value}),placeholder:"john@example.com",required:!0}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Your email won't be published, it's for verification only."})]}),r.jsxs("div",{children:[r.jsx(x,{htmlFor:"client_title",children:"Title/Occupation (Optional)"}),r.jsx(h,{id:"client_title",value:R.client_title,onChange:e=>z({...R,client_title:e.target.value}),placeholder:"e.g., First-time Homebuyer, Real Estate Investor"})]}),r.jsxs("div",{children:[r.jsx(x,{htmlFor:"transaction_type",children:"Transaction Type"}),r.jsxs("select",{id:"transaction_type",value:R.transaction_type,onChange:e=>z({...R,transaction_type:e.target.value}),className:"w-full px-3 py-2 border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[r.jsx("option",{value:"buyer",children:"Buyer"}),r.jsx("option",{value:"seller",children:"Seller"}),r.jsx("option",{value:"both",children:"Both (Buyer & Seller)"})]})]}),r.jsxs("div",{children:[r.jsx(x,{htmlFor:"property_type",children:"Property Type (Optional)"}),r.jsx(h,{id:"property_type",value:R.property_type,onChange:e=>z({...R,property_type:e.target.value}),placeholder:"e.g., Single Family Home, Condo, Townhouse"})]}),r.jsxs("div",{children:[r.jsx(x,{htmlFor:"review",children:"Your Review *"}),r.jsx(p,{id:"review",value:R.review,onChange:e=>z({...R,review:e.target.value}),placeholder:"Share your experience working with this agent...",rows:6,required:!0,className:"resize-none"}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please be specific about what made your experience positive."})]}),r.jsx(u,{type:"submit",disabled:C||0===E,className:"w-full",size:"lg",children:C?r.jsxs(r.Fragment,{children:[r.jsx(l,{size:"sm",className:"mr-2"}),"Submitting..."]}):r.jsxs(r.Fragment,{children:[r.jsx(g,{className:"mr-2 h-4 w-4"}),"Submit Review"]})}),r.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["By submitting this review, you agree that it may be displayed publicly on ",_.full_name,"'s profile page."]})]})})]})})}):r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:r.jsxs(n,{className:"w-full max-w-md",children:[r.jsxs(o,{className:"text-center",children:[r.jsx(c,{className:"text-2xl",children:"Agent Not Found"}),r.jsx(m,{children:"The agent profile you're looking for doesn't exist."})]}),r.jsx(d,{children:r.jsxs(u,{onClick:()=>b("/"),className:"w-full",children:[r.jsx(j,{className:"mr-2 h-4 w-4"}),"Go to Homepage"]})})]})})}export{v as default};
