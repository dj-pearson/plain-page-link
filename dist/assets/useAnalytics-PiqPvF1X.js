import{K as g,u as o,s as r}from"./index-CH8a_jH7.js";function f(){const{user:t}=g(),{data:a=[],isLoading:d}=o({queryKey:["analytics-views",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];const{data:e,error:i}=await r.from("analytics_views").select("*").eq("user_id",t.id).order("viewed_at",{ascending:!1});if(i)throw i;return e},enabled:!!(t!=null&&t.id)}),{data:n=[],isLoading:l}=o({queryKey:["analytics-leads",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];const{data:e,error:i}=await r.from("leads").select("*").eq("user_id",t.id);if(i)throw i;return e},enabled:!!(t!=null&&t.id)}),c={totalViews:a.length,uniqueVisitors:new Set(a.map(e=>e.visitor_id)).size,totalLeads:n.length,conversionRate:a.length>0?(n.length/a.length*100).toFixed(2):"0.00"},v=a.reduce((e,i)=>{const s=new Date(i.viewed_at).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e[s]||(e[s]={name:s,views:0,visitors:new Set}),e[s].views++,i.visitor_id&&e[s].visitors.add(i.visitor_id),e},{}),w=Object.values(v).map(e=>({name:e.name,views:e.views,visitors:e.visitors.size})),u=n.reduce((e,i)=>{const s=i.lead_type||"contact";return e[s]=(e[s]||0)+1,e},{}),y=Object.entries(u).map(([e,i])=>({name:e.charAt(0).toUpperCase()+e.slice(1),value:i}));return{stats:c,viewsData:w,leadsData:y,recentLeads:n.slice(0,10),isLoading:d||l}}export{f as u};
