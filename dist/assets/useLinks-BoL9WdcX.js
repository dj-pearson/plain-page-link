import{b as e,u as i,d as r}from"./data-O5cD9hjv.js";import{s as t}from"./supabase-BYwji6mk.js";import{u as s}from"./stores-Bwj68t5x.js";import{u as n}from"./index-ChdTqDF5.js";function o(){const{user:o}=s(),a=e(),{toast:d}=n(),{data:c=[],isLoading:u}=i({queryKey:["links",o?.id],queryFn:async()=>{if(!o?.id)return[];const{data:e,error:i}=await t.from("links").select("*").eq("user_id",o.id).order("position",{ascending:!0});if(i)throw i;return e},enabled:!!o?.id}),l=r({mutationFn:async e=>{if(!o?.id)throw new Error("User not authenticated");const i=c.length>0?Math.max(...c.map(e=>e.position)):-1,{data:r,error:s}=await t.from("links").insert({user_id:o.id,title:e.title,url:e.url,icon:e.icon,position:i+1,is_active:e.active}).select().single();if(s)throw s;return r},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]}),d({title:"Link Added",description:"Your custom link has been added successfully."})},onError:e=>{d({title:"Failed to Add Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),f=r({mutationFn:async({id:e,...i})=>{const{data:r,error:s}=await t.from("links").update(i).eq("id",e).select().single();if(s)throw s;return r},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]}),d({title:"Link Updated",description:"Your link has been updated successfully."})},onError:e=>{d({title:"Failed to Update Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),k=r({mutationFn:async e=>{const{error:i}=await t.from("links").delete().eq("id",e);if(i)throw i},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]}),d({title:"Link Deleted",description:"Your link has been deleted successfully."})},onError:e=>{d({title:"Failed to Delete Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),m=r({mutationFn:async({id:e,is_active:i})=>{const{error:r}=await t.from("links").update({is_active:i}).eq("id",e);if(r)throw r},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]})}});return{links:c,isLoading:u,addLink:l,updateLink:f,deleteLink:k,toggleActive:m}}export{o as u};
