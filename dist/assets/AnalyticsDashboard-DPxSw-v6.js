import{bU as T,bo as ae,j as e,Y as w,a5 as D,r as y,bN as ne,a4 as G,a7 as re,as as le,ag as ie,g as oe,bP as L,h as A,K as I,N as O,O as _,Q as E,R as B,V as ce,B as P,l as X,aq as de,ai as V,bV as W,q as ue,b4 as me,G as he,s as k,ae as Y}from"./index-BIuWzZUg.js";import{T as xe,a as pe,b as F,c as $}from"./tabs-DzToSYRx.js";import{M as ge}from"./minus-7iFqXvzW.js";import{T as ve}from"./trending-down-De83hRlf.js";import{L as Q}from"./lightbulb-D-xIoVHy.js";import{g as fe}from"./exportUtils-BkvQ9-oG.js";import{F as J}from"./file-text-ClpuzDjD.js";import{u as je}from"./useAnalytics-DKDZSM1S.js";import{u as K}from"./useMutation-lbCNn57J.js";import"./index-C0U7aKTc.js";function be(s,a){const t=T(s);return isNaN(a)?ae(s,NaN):(a&&t.setDate(t.getDate()+a),t)}function ye(s,a){const t=T(s.start),l=T(s.end);let r=+t>+l;const o=r?+t:+l,i=r?l:t;i.setHours(0,0,0,0);let u=1;const h=[];for(;+i<=o;)h.push(T(i)),i.setDate(i.getDate()+u),i.setHours(0,0,0,0);return r?h.reverse():h}function U(s){const a=T(s);return a.setDate(1),a.setHours(0,0,0,0),a}function S(s,a){return be(s,-a)}function Ne({metrics:s,className:a}){return e.jsx("div",{className:w("grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",a),children:s.map(t=>e.jsx(we,{metric:t},t.name))})}function we({metric:s}){const a=()=>{switch(s.trend){case"up":return e.jsx(D,{className:"w-4 h-4"});case"down":return e.jsx(ve,{className:"w-4 h-4"});case"flat":return e.jsx(ge,{className:"w-4 h-4"})}},t=()=>{switch(s.trend){case"up":return"text-green-600 bg-green-100";case"down":return"text-red-600 bg-red-100";case"flat":return"text-gray-600 bg-gray-100"}},l=()=>s.unit==="$"?`$${s.value.toLocaleString()}`:s.unit==="%"?`${s.value.toFixed(1)}%`:s.unit==="min"?`${Math.round(s.value)} min`:s.value.toLocaleString();return e.jsxs("div",{className:"bg-white p-6 rounded-lg border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:s.name}),e.jsx("div",{className:w("p-2 rounded-full",t()),children:a()})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l()})}),e.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[e.jsxs("span",{className:w("text-sm font-medium",s.trend==="up"?"text-green-600":s.trend==="down"?"text-red-600":"text-gray-600"),children:[s.change>0?"+":"",s.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"vs last period"})]}),s.benchmark&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Benchmark: ",s.unit==="$"?"$":"",s.benchmark.toLocaleString(),s.unit==="%"?"%":""]})})]})}function Re({data:s,title:a,color:t="#2563eb",height:l=300,showPredictions:r=!1,className:o}){const{actualData:i,predictedData:u,maxValue:h,minValue:d}=y.useMemo(()=>{const c=s.filter(n=>!n.label),m=s.filter(n=>n.label==="predicted"),v=s.map(n=>n.value);return{actualData:c,predictedData:m,maxValue:Math.max(...v),minValue:Math.min(...v)}},[s]),g=c=>{const v=l-40,n=h-d||1;return 20+v-(c-d)/n*v},b=(c,m)=>40+c/(m-1)*720,R=(c,m=!1)=>c.length===0?"":c.map((f,M)=>({x:b(M,c.length),y:g(f.value)})).map((f,M)=>`${M===0?"M":"L"} ${f.x} ${f.y}`).join(" "),C=c=>{if(c.length===0)return"";const m=R(c),v=b(c.length-1,c.length),n=b(0,c.length),f=l-20;return`${m} L ${v} ${f} L ${n} ${f} Z`};return e.jsxs("div",{className:o,children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:a}),e.jsxs("svg",{width:"100%",height:l,viewBox:"0 0 800 300",className:"bg-white rounded-lg border",children:[e.jsx("g",{className:"grid-lines",children:[0,25,50,75,100].map(c=>{const m=20+(l-40)*(c/100);return e.jsxs("g",{children:[e.jsx("line",{x1:40,y1:m,x2:760,y2:m,stroke:"#e5e7eb",strokeWidth:1}),e.jsx("text",{x:25,y:m+4,fontSize:10,fill:"#6b7280",textAnchor:"end",children:Math.round(h-c/100*(h-d))})]},c)})}),e.jsx("path",{d:C(i),fill:t,fillOpacity:.1}),e.jsx("path",{d:R(i),fill:"none",stroke:t,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),r&&u.length>0&&e.jsx("path",{d:R(u),fill:"none",stroke:t,strokeWidth:2,strokeDasharray:"5,5",strokeOpacity:.5,strokeLinecap:"round",strokeLinejoin:"round"}),i.map((c,m)=>e.jsx("circle",{cx:b(m,i.length),cy:g(c.value),r:4,fill:"white",stroke:t,strokeWidth:2},m)),e.jsx("g",{className:"x-axis-labels",children:i.map((c,m)=>m%Math.ceil(i.length/7)===0?e.jsx("text",{x:b(m,i.length),y:l-5,fontSize:10,fill:"#6b7280",textAnchor:"middle",children:c.date},m):null)})]}),r&&u.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:t}}),e.jsx("span",{children:"Actual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:t,opacity:.5,borderTop:`2px dashed ${t}`}}),e.jsx("span",{children:"Predicted"})]})]})]})}function Ce({stages:s,className:a}){const t=s[0]?.count||1;return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Conversion Funnel"}),e.jsx("div",{className:"space-y-2",children:s.map((l,r)=>e.jsxs("div",{children:[e.jsx(Me,{stage:l,maxCount:t,isFirst:r===0,isLast:r===s.length-1}),!isLast&&l.dropoff!==void 0&&l.dropoff>0&&e.jsx(Le,{count:l.dropoff,percentage:Se(l,s[r+1])})]},l.name))}),e.jsxs("div",{className:"mt-6 pt-6 border-t grid grid-cols-3 gap-4",children:[e.jsx(z,{label:"Overall Conversion",value:`${s[s.length-1].percentage.toFixed(1)}%`}),e.jsx(z,{label:"Total Conversions",value:s[s.length-1].count.toLocaleString()}),e.jsx(z,{label:"Total Dropoff",value:De(s).toLocaleString()})]})]})}function Me({stage:s,maxCount:a,isFirst:t,isLast:l}){const r=s.count/a*100,o=()=>s.percentage>=75?"bg-green-500":s.percentage>=50?"bg-yellow-500":s.percentage>=25?"bg-orange-500":"bg-red-500";return e.jsx("div",{className:"relative",children:e.jsx("div",{className:w("relative mx-auto rounded-lg p-4 transition-all duration-300 hover:shadow-md",o()),style:{width:`${Math.max(r,20)}%`},children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm opacity-90",children:[s.count.toLocaleString()," leads"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[s.percentage.toFixed(1),"%"]}),!t&&e.jsx("p",{className:"text-xs opacity-90",children:"of total"})]})]})})})}function Le({count:s,percentage:a}){return e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-red-600",children:s.toLocaleString()})," ","dropped off (",a.toFixed(1),"%)"]})]})})}function z({label:s,value:a}){return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s})]})}function Se(s,a){return s.count===0?0:(s.count-a.count)/s.count*100}function De(s){return s.length<2?0:s[0].count-s[s.length-1].count}function Te({sources:s,className:a}){const t=s.reduce((o,i)=>o+i.leads,0),l=s.reduce((o,i)=>o+i.revenue,0),r=[...s].sort((o,i)=>i.conversionRate-o.conversionRate);return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Lead Sources"}),e.jsxs("div",{className:"flex gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),t," leads"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),"$",l.toLocaleString()]})]})]}),e.jsx("div",{className:"space-y-4",children:r.map(o=>e.jsx(Ve,{source:o,totalLeads:t},o.source))}),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No lead source data available"})]})]})}function Ve({source:s,totalLeads:a}){const t=s.leads/a*100,l=r=>r>=20?"text-green-600":r>=10?"text-yellow-600":"text-gray-600";return e.jsxs("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 capitalize",children:s.source}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:w("text-lg font-bold",l(s.conversionRate)),children:[s.conversionRate.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"conversion"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Lead share"}),e.jsxs("span",{className:"font-medium",children:[t.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary rounded-full h-2 transition-all duration-500",style:{width:`${t}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Leads"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.leads})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conversions"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.conversions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Revenue"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["$",s.revenue.toLocaleString()]})]})]}),s.roi!==void 0&&e.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ROI"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:w("font-semibold",s.roi>0?"text-green-600":"text-red-600"),children:[s.roi>0?"+":"",s.roi.toFixed(1),"%"]})]})]})]})}function H({insights:s,className:a}){return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Key Insights"})]}),e.jsx("div",{className:"space-y-3",children:s.map((t,l)=>e.jsx(ke,{insight:t},l))}),s.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No insights available yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Check back when you have more data"})]})]})}function ke({insight:s}){const a=()=>s.includes("ðŸ“ˆ")||s.includes("ðŸš€")||s.includes("ðŸŽ¯")?e.jsx(D,{className:"w-5 h-5 text-green-600"}):s.includes("âš ï¸")||s.includes("ðŸŒ")?e.jsx(ie,{className:"w-5 h-5 text-orange-600"}):s.includes("âš¡")||s.includes("ðŸŒŸ")?e.jsx(oe,{className:"w-5 h-5 text-blue-600"}):e.jsx(Q,{className:"w-5 h-5 text-yellow-600"}),t=()=>s.includes("ðŸ“ˆ")||s.includes("ðŸš€")||s.includes("ðŸŽ¯")?"bg-green-50 border-green-200":s.includes("âš ï¸")||s.includes("ðŸŒ")?"bg-orange-50 border-orange-200":s.includes("âš¡")||s.includes("ðŸŒŸ")?"bg-blue-50 border-blue-200":"bg-yellow-50 border-yellow-200";return e.jsx("div",{className:w("p-4 rounded-lg border",t()),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a()}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:s})]})})}class j{static calculateKPIs(a,t){return[this.createMetric("Total Page Views",a.pageViews,"",t.pageViews),this.createMetric("Unique Visitors",a.uniqueVisitors,"",t.uniqueVisitors),this.createMetric("Total Leads",a.leads,"",t.leads),this.createMetric("Conversions",a.conversions,"",t.conversions),this.createMetric("Revenue",a.revenue,"$",t.revenue),this.createMetric("Avg Response Time",a.avgResponseTime,"min",t.avgResponseTime,!0),this.createMetric("Conversion Rate",this.calculateConversionRate(a.leads,a.conversions),"%",this.calculateConversionRate(t.leads,t.conversions)),this.createMetric("Lead-to-Visitor Rate",this.calculateConversionRate(a.uniqueVisitors,a.leads),"%",this.calculateConversionRate(t.uniqueVisitors,t.leads))]}static createMetric(a,t,l,r,o=!1){const i=this.calculatePercentageChange(t,r),u=this.determineTrend(i,o);return{name:a,value:t,unit:l,change:i,trend:u}}static calculatePercentageChange(a,t){return t===0?a>0?100:0:(a-t)/t*100}static determineTrend(a,t=!1){return Math.abs(a)<2?"flat":t?a<0?"up":"down":a>0?"up":"down"}static calculateConversionRate(a,t){return a===0?0:t/a*100}static generateTimeSeries(a,t,l){return ye({start:a,end:t}).map(o=>({date:L(o,"MMM d"),value:l(o)}))}static calculateFunnel(a){const{visitors:t,viewed:l,contacted:r,qualified:o,converted:i}=a;return[{name:"Visitors",count:t,percentage:100},{name:"Viewed Listing",count:l,percentage:this.calculateConversionRate(t,l),dropoff:t-l},{name:"Contacted",count:r,percentage:this.calculateConversionRate(t,r),dropoff:l-r},{name:"Qualified",count:o,percentage:this.calculateConversionRate(t,o),dropoff:r-o},{name:"Converted",count:i,percentage:this.calculateConversionRate(t,i),dropoff:o-i}]}static analyzeLeadSources(a){return a.map(t=>({source:t.source,leads:t.leads,conversions:t.conversions,conversionRate:this.calculateConversionRate(t.leads,t.conversions),revenue:t.revenue,roi:t.cost?(t.revenue-t.cost)/t.cost*100:void 0}))}static rankListings(a){return a.map(t=>({...t,conversionRate:this.calculateConversionRate(t.views,t.leads)})).sort((t,l)=>l.conversionRate-t.conversionRate)}static predictTrend(a,t=7){if(a.length<2)return[];const l=a.length,r=a.map((c,m)=>m),o=a.map(c=>c.value),i=r.reduce((c,m)=>c+m,0),u=o.reduce((c,m)=>c+m,0),h=r.reduce((c,m,v)=>c+m*o[v],0),d=r.reduce((c,m)=>c+m*m,0),g=(l*h-i*u)/(l*d-i*i),b=(u-g*i)/l,R=[],C=new Date(a[a.length-1].date);for(let c=1;c<=t;c++){const m=l+c-1,v=Math.max(0,Math.round(g*m+b)),n=new Date(C);n.setDate(n.getDate()+c),R.push({date:L(n,"MMM d"),value:v,label:"predicted"})}return R}static calculateEngagementScore(a){const{avgTimeOnPage:t,bounceRate:l,pagesPerSession:r,returnVisitorRate:o}=a,i=Math.min(t/180*25,25),u=Math.max((100-l)/4,0),h=Math.min(r/5*25,25),d=o/100*25;return Math.round(i+u+h+d)}static generateInsights(a,t,l){const r=[],o=this.calculatePercentageChange(a.leads,t.leads);o>20?r.push(`ðŸ“ˆ Lead generation is up ${Math.round(o)}% compared to last period`):o<-20&&r.push(`âš ï¸ Lead generation is down ${Math.abs(Math.round(o))}% - consider increasing marketing efforts`);const i=this.calculateConversionRate(a.leads,a.conversions),u=this.calculateConversionRate(t.leads,t.conversions);if(i>u+5&&r.push(`ðŸŽ¯ Conversion rate improved to ${i.toFixed(1)}% - keep up the good work!`),a.avgResponseTime<5?r.push("âš¡ Excellent response time! You're responding in under 5 minutes"):a.avgResponseTime>60&&r.push(`ðŸŒ Response time is high (${Math.round(a.avgResponseTime)} min) - faster responses increase conversions`),l.length>0){const d=l.reduce((g,b)=>b.conversionRate>g.conversionRate?b:g);d.conversionRate>15&&r.push(`ðŸŒŸ ${d.source} is your best performing source at ${d.conversionRate.toFixed(1)}% conversion rate`)}const h=this.calculatePercentageChange(a.uniqueVisitors,t.uniqueVisitors);return h>30&&r.push(`ðŸš€ Traffic is surging! Up ${Math.round(h)}% - great time to capture leads`),r}static exportToCSV(a,t){if(a.length===0)return;const l=Object.keys(a[0]),r=[l.join(","),...a.map(h=>l.map(d=>JSON.stringify(h[d]||"")).join(","))].join(`
`),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),u=URL.createObjectURL(o);i.setAttribute("href",u),i.setAttribute("download",`${t}_${Date.now()}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}const Fe=j.calculateKPIs.bind(j);j.generateTimeSeries.bind(j);const $e=j.calculateFunnel.bind(j),qe=j.analyzeLeadSources.bind(j);j.rankListings.bind(j);const Pe=j.predictTrend.bind(j);j.calculateEngagementScore.bind(j);const Ae=j.generateInsights.bind(j),Ie=j.exportToCSV.bind(j);function Oe({onGenerateReport:s,className:a}){const[t,l]=y.useState("leads"),[r,o]=y.useState("30d"),[i,u]=y.useState("csv"),[h,d]=y.useState(!1),g=[{value:"leads",label:"Leads Report"},{value:"listings",label:"Listings Performance"},{value:"conversions",label:"Conversion Analytics"},{value:"sources",label:"Lead Sources"},{value:"performance",label:"Overall Performance"}],b=[{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"90d",label:"Last 90 Days"},{value:"this_month",label:"This Month"},{value:"last_month",label:"Last Month"}],R=[{value:"csv",label:"CSV",disabled:!1},{value:"pdf",label:"PDF",disabled:!1},{value:"excel",label:"Excel (Coming Soon)",disabled:!0}],C=()=>{const n=new Date;switch(r){case"7d":return{start:S(n,7),end:n};case"30d":return{start:S(n,30),end:n};case"90d":return{start:S(n,90),end:n};case"this_month":return{start:U(n),end:W(n)};case"last_month":const f=S(U(n),1);return{start:U(f),end:W(f)};default:return{start:S(n,30),end:n}}},c=()=>({leads:"Leads Report",listings:"Listings Performance Report",conversions:"Conversion Analytics Report",sources:"Lead Sources Report",performance:"Overall Performance Report"})[t]||"Analytics Report",m=async()=>{d(!0);try{const{start:n,end:f}=C(),M=`${L(n,"MMM d, yyyy")} - ${L(f,"MMM d, yyyy")}`,p=await s({reportType:t,dateRange:r,metrics:[],format:i,startDate:n,endDate:f});if(i==="csv"){const N=`${t}_report_${L(n,"yyyy-MM-dd")}_to_${L(f,"yyyy-MM-dd")}`;Ie(p,N),V.success("CSV report exported successfully!")}else if(i==="pdf")if(p&&p.length>0){const N=Object.keys(p[0]),Z=p.map(se=>N.map(te=>se[te]??"")),ee=v(p,t);fe({title:c(),dateRange:M,headers:N,rows:Z,summary:ee,orientation:N.length>5?"landscape":"portrait"}),V.success("PDF report generated successfully!")}else V.error("No data available for report")}catch(n){console.error("Report generation error:",n),V.error("Failed to generate report")}finally{d(!1)}},v=(n,f)=>{switch(f){case"leads":return[{label:"Total Leads",value:n.length},{label:"New Leads",value:n.filter(x=>x.status==="new").length},{label:"Qualified",value:n.filter(x=>x.status==="qualified").length}];case"listings":return[{label:"Total Listings",value:n.length},{label:"Active",value:n.filter(x=>x.status==="active").length},{label:"Sold",value:n.filter(x=>x.status==="sold").length}];case"conversions":return[{label:"Total Conversions",value:n.reduce((x,p)=>x+(p.conversions||0),0)},{label:"Records",value:n.length}];case"sources":return[{label:"Total Sources",value:n.length},{label:"Total Leads",value:n.reduce((x,p)=>x+(p.count||0),0)}];default:return[{label:"Total Records",value:n.length}]}};return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Custom Report Builder"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Report Type"}),e.jsxs(I,{value:t,onValueChange:n=>l(n),children:[e.jsx(O,{children:e.jsx(_,{})}),e.jsx(E,{children:g.map(n=>e.jsx(B,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Date Range"]}),e.jsxs(I,{value:r,onValueChange:n=>o(n),children:[e.jsx(O,{children:e.jsx(_,{})}),e.jsx(E,{children:b.map(n=>e.jsx(B,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Export Format"}),e.jsxs(I,{value:i,onValueChange:n=>u(n),children:[e.jsx(O,{children:e.jsx(_,{})}),e.jsx(E,{children:R.map(n=>e.jsx(B,{value:n.value,disabled:n.disabled,children:n.label},n.value))})]})]}),e.jsx(P,{onClick:m,disabled:h,className:"w-full gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Generating ",i.toUpperCase(),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Generate Report"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Report Preview"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:["Type: ",e.jsx("span",{className:"font-medium",children:t})]}),e.jsxs("p",{children:["Range:"," ",e.jsxs("span",{className:"font-medium",children:[L(C().start,"MMM d, yyyy")," ","-"," ",L(C().end,"MMM d, yyyy")]})]}),e.jsxs("p",{children:["Format:"," ",e.jsx("span",{className:"font-medium uppercase",children:i})]})]})]})]})}function _e(){const{user:s}=ue(),a=me(),{data:t=[],isLoading:l}=he({queryKey:["leads",s?.id],queryFn:async()=>{if(!s?.id)return[];const{data:u,error:h}=await k.from("leads").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(h)throw h;return u},enabled:!!s?.id}),r=K({mutationFn:async u=>{const{data:h,error:d}=await k.from("leads").insert(u).select().single();if(d)throw d;return h},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",s?.id]})}}),o=K({mutationFn:async({id:u,...h})=>{if(!s?.id)throw new Error("User not authenticated");const{data:d,error:g}=await k.from("leads").update(h).eq("id",u).eq("user_id",s.id).select().single();if(g)throw g;return d},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",s?.id]})}}),i=K({mutationFn:async u=>{if(!s?.id)throw new Error("User not authenticated");const{error:h}=await k.from("leads").delete().eq("id",u).eq("user_id",s.id);if(h)throw h},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",s?.id]})}});return{leads:t,isLoading:l,addLead:r,updateLead:o,deleteLead:i}}function Xe(){const[s,a]=y.useState(!0),[t,l]=y.useState("30d"),{stats:r,viewsData:o,isLoading:i}=je(t),{leads:u}=_e(),h=new Date,d=y.useMemo(()=>({pageViews:r.totalViews,uniqueVisitors:r.uniqueVisitors,leads:r.totalLeads,conversions:u.filter(x=>x.status==="converted").length,revenue:0,avgResponseTime:0,period:t==="7d"?"week":t==="30d"?"month":"quarter",startDate:S(h,t==="7d"?7:t==="30d"?30:90),endDate:h}),[r,u,t,h]),g=y.useMemo(()=>({pageViews:Math.round(r.totalViews*.85),uniqueVisitors:Math.round(r.uniqueVisitors*.85),leads:Math.round(r.totalLeads*.85),conversions:Math.round(u.filter(x=>x.status==="converted").length*.85),revenue:0,avgResponseTime:0,period:d.period,startDate:S(d.startDate,t==="7d"?7:t==="30d"?30:90),endDate:d.startDate}),[r,u,d,t]),b=y.useMemo(()=>o.map(x=>({date:new Date(x.name),value:x.views,label:x.name})),[o]),R=y.useMemo(()=>b.length>0?Pe(b,7):[],[b]),C=[...b,...s?R:[]],c=y.useMemo(()=>Fe(d,g),[d,g]),m=y.useMemo(()=>$e({visitors:d.uniqueVisitors,viewed:Math.round(d.uniqueVisitors*.7),contacted:d.leads,qualified:u.filter(x=>x.status==="qualified"||x.status==="converted").length,converted:d.conversions}),[d,u]),v=y.useMemo(()=>{const x={};return u.forEach(p=>{const N=p.source||"website";x[N]||(x[N]={leads:0,conversions:0}),x[N].leads++,p.status==="converted"&&x[N].conversions++}),Object.entries(x).map(([p,N])=>({source:p,leads:N.leads,conversions:N.conversions,revenue:0,cost:0}))},[u]),n=y.useMemo(()=>qe(v.length>0?v:[{source:"website",leads:0,conversions:0,revenue:0,cost:0}]),[v]),f=y.useMemo(()=>Ae(d,g,n),[d,g,n]),M=async x=>{switch(x.reportType){case"leads":return u.map(p=>({id:p.id,name:p.name||"Unknown",email:p.email||"",source:p.source||"website",status:p.status||"new",score:p.score||0,created:p.created_at}));case"sources":return n.map(p=>({source:p.source,leads:p.leads,conversions:p.conversions,conversion_rate:`${p.conversionRate.toFixed(1)}%`,revenue:p.revenue,roi:p.roi?`${p.roi.toFixed(1)}%`:"N/A"}));default:return[{metric:"Page Views",current:d.pageViews,previous:g.pageViews,change:g.pageViews>0?`${((d.pageViews-g.pageViews)/g.pageViews*100).toFixed(1)}%`:"N/A"},{metric:"Leads",current:d.leads,previous:g.leads,change:g.leads>0?`${((d.leads-g.leads)/g.leads*100).toFixed(1)}%`:"N/A"},{metric:"Conversions",current:d.conversions,previous:g.conversions,change:g.conversions>0?`${((d.conversions-g.conversions)/g.conversions*100).toFixed(1)}%`:"N/A"}]}};return i?e.jsx("div",{className:"container mx-auto py-6 flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(X,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your performance and gain insights"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:t==="7d"?"default":"outline",size:"sm",onClick:()=>l("7d"),children:"7 Days"}),e.jsx(P,{variant:t==="30d"?"default":"outline",size:"sm",onClick:()=>l("30d"),children:"30 Days"}),e.jsx(P,{variant:t==="90d"?"default":"outline",size:"sm",onClick:()=>l("90d"),children:"90 Days"})]})]}),r.totalViews===0&&r.totalLeads===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"No Data Yet"}),e.jsx("p",{className:"text-blue-700",children:"Start sharing your profile to see analytics data here. Views and leads will be tracked automatically."})]}),e.jsx(Ne,{metrics:c}),e.jsxs(xe,{defaultValue:"overview",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-4 max-w-2xl",children:[e.jsxs(F,{value:"overview",className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(F,{value:"funnel",className:"gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Funnel"]}),e.jsxs(F,{value:"sources",className:"gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Sources"]}),e.jsxs(F,{value:"reports",className:"gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Reports"]})]}),e.jsx($,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Re,{data:C,title:"Lead Generation Trend",color:"#2563eb",showPredictions:s})}),e.jsx(H,{insights:f})]})}),e.jsx($,{value:"funnel",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ce,{stages:m}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{insights:f}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Optimization Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Improve Viewed â†’ Contacted rate with clearer CTAs"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Reduce dropoff with faster response times"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Qualify leads better with targeted questions"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Nurture qualified leads with follow-ups"})]})]})]})]})]})}),e.jsx($,{value:"sources",className:"mt-6",children:e.jsx(Te,{sources:n})}),e.jsx($,{value:"reports",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Available Reports"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(q,{title:"Leads Report",description:"Detailed lead data with scores and sources",icon:e.jsx(G,{className:"w-6 h-6"})}),e.jsx(q,{title:"Performance Report",description:"Overall performance metrics and trends",icon:e.jsx(D,{className:"w-6 h-6"})}),e.jsx(q,{title:"Sources Report",description:"Lead source analysis with ROI",icon:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx(q,{title:"Conversion Report",description:"Conversion funnel and rates",icon:e.jsx(D,{className:"w-6 h-6"})})]})]})}),e.jsx(Oe,{onGenerateReport:M})]})})]})]})}function q({title:s,description:a,icon:t}){return e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg text-primary",children:t}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:s}),e.jsx("p",{className:"text-sm text-gray-600",children:a})]})]})})}export{Xe as default};
