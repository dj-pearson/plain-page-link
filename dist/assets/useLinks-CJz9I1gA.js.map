{"version":3,"file":"useLinks-CJz9I1gA.js","sources":["../../src/hooks/useLinks.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuthStore } from \"@/stores/useAuthStore\";\nimport { useToast } from \"./use-toast\";\nimport type { LinkFormData } from \"@/components/modals/AddLinkModal\";\n\nexport interface Link {\n  id: string;\n  user_id: string;\n  title: string;\n  url: string;\n  icon: string;\n  position: number;\n  is_active: boolean;\n  click_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport function useLinks() {\n  const { user } = useAuthStore();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const { data: links = [], isLoading, isError, error, refetch } = useQuery({\n    queryKey: [\"links\", user?.id],\n    queryFn: async () => {\n      if (!user?.id) return [];\n\n      const { data, error } = await supabase\n        .from(\"links\")\n        .select(\"*\")\n        .eq(\"user_id\", user.id)\n        .order(\"position\", { ascending: true });\n\n      if (error) throw error;\n      return data as Link[];\n    },\n    enabled: !!user?.id,\n  });\n\n  const addLink = useMutation({\n    mutationFn: async (linkData: LinkFormData) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      const maxPosition = links.length > 0\n        ? Math.max(...links.map(l => l.position))\n        : -1;\n\n      const { data, error } = await supabase\n        .from(\"links\")\n        .insert({\n          user_id: user.id,\n          title: linkData.title,\n          url: linkData.url,\n          icon: linkData.icon,\n          position: maxPosition + 1,\n          is_active: linkData.active,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"links\", user?.id] });\n      toast({\n        title: \"Link Added\",\n        description: \"Your custom link has been added successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to Add Link\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateLink = useMutation({\n    mutationFn: async ({ id, ...updates }: Partial<Link> & { id: string }) => {\n      const { data, error } = await supabase\n        .from(\"links\")\n        .update(updates)\n        .eq(\"id\", id)\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"links\", user?.id] });\n      toast({\n        title: \"Link Updated\",\n        description: \"Your link has been updated successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to Update Link\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteLink = useMutation({\n    mutationFn: async (id: string) => {\n      const { error } = await supabase\n        .from(\"links\")\n        .delete()\n        .eq(\"id\", id);\n\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"links\", user?.id] });\n      toast({\n        title: \"Link Deleted\",\n        description: \"Your link has been deleted successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to Delete Link\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleActive = useMutation({\n    mutationFn: async ({ id, is_active }: { id: string; is_active: boolean }) => {\n      const { error } = await supabase\n        .from(\"links\")\n        .update({ is_active })\n        .eq(\"id\", id);\n\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"links\", user?.id] });\n    },\n  });\n\n  return {\n    links,\n    isLoading,\n    isError,\n    error,\n    refetch,\n    addLink,\n    updateLink,\n    deleteLink,\n    toggleActive,\n  };\n}\n"],"names":["useLinks","user","useAuthStore","queryClient","useQueryClient","toast","useToast","links","isLoading","isError","error","refetch","useQuery","data","supabase","addLink","useMutation","linkData","maxPosition","l","updateLink","id","updates","deleteLink","toggleActive","is_active"],"mappings":"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"}