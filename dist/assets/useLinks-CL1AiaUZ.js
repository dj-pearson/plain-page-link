import{b as e,u as i,d as t}from"./data-O5cD9hjv.js";import{u as r,s as n}from"./stores-CbHKfBOf.js";import{u as s}from"./index-B1bhRrK2.js";function o(){const{user:o}=r(),a=e(),{toast:d}=s(),{data:c=[],isLoading:u}=i({queryKey:["links",o?.id],queryFn:async()=>{if(!o?.id)return[];const{data:e,error:i}=await n.from("links").select("*").eq("user_id",o.id).order("position",{ascending:!0});if(i)throw i;return e},enabled:!!o?.id}),l=t({mutationFn:async e=>{if(!o?.id)throw new Error("User not authenticated");const i=c.length>0?Math.max(...c.map(e=>e.position)):-1,{data:t,error:r}=await n.from("links").insert({user_id:o.id,title:e.title,url:e.url,icon:e.icon,position:i+1,is_active:e.active}).select().single();if(r)throw r;return t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]}),d({title:"Link Added",description:"Your custom link has been added successfully."})},onError:e=>{d({title:"Failed to Add Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),k=t({mutationFn:async({id:e,...i})=>{const{data:t,error:r}=await n.from("links").update(i).eq("id",e).select().single();if(r)throw r;return t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]}),d({title:"Link Updated",description:"Your link has been updated successfully."})},onError:e=>{d({title:"Failed to Update Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),f=t({mutationFn:async e=>{const{error:i}=await n.from("links").delete().eq("id",e);if(i)throw i},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]}),d({title:"Link Deleted",description:"Your link has been deleted successfully."})},onError:e=>{d({title:"Failed to Delete Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),m=t({mutationFn:async({id:e,is_active:i})=>{const{error:t}=await n.from("links").update({is_active:i}).eq("id",e);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",o?.id]})}});return{links:c,isLoading:u,addLink:l,updateLink:k,deleteLink:f,toggleActive:m}}export{o as u};
