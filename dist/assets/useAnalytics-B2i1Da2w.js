import{u as e,a as t,s as a}from"./data-OhSCRAps.js";function i(i="30d"){const{user:s}=e(),r=(e=>{const t={"7d":7,"30d":30,"90d":90}[e],a=new Date;return a.setDate(a.getDate()-t),a.toISOString()})(i),{data:n=[],isLoading:d}=t({queryKey:["analytics-views",s?.id,i],queryFn:async()=>{if(!s?.id)return[];const{data:e,error:t}=await a.from("analytics_views").select("viewed_at, visitor_id, page_url, referrer").eq("user_id",s.id).gte("viewed_at",r).order("viewed_at",{ascending:!1}).limit(1e3);if(t)throw t;return e},enabled:!!s?.id,staleTime:3e5,gcTime:6e5}),{data:o=[],isLoading:c}=t({queryKey:["analytics-leads",s?.id,i],queryFn:async()=>{if(!s?.id)return[];const{data:e,error:t}=await a.from("leads").select("created_at, lead_type, status, email, phone").eq("user_id",s.id).gte("created_at",r).order("created_at",{ascending:!1}).limit(500);if(t)throw t;return e},enabled:!!s?.id,staleTime:3e5,gcTime:6e5}),l={totalViews:n.length,uniqueVisitors:new Set(n.map(e=>e.visitor_id)).size,totalLeads:o.length,conversionRate:n.length>0?(o.length/n.length*100).toFixed(2):"0.00"},u=n.reduce((e,t)=>{const a=new Date(t.viewed_at).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e[a]||(e[a]={name:a,views:0,visitors:new Set}),e[a].views++,t.visitor_id&&e[a].visitors.add(t.visitor_id),e},{}),v=Object.values(u).map(e=>({name:e.name,views:e.views,visitors:e.visitors.size})),m=o.reduce((e,t)=>{const a=t.lead_type||"contact";return e[a]=(e[a]||0)+1,e},{});return{stats:l,viewsData:v,leadsData:Object.entries(m).map(([e,t])=>({name:e.charAt(0).toUpperCase()+e.slice(1),value:t})),recentLeads:o.slice(0,10),isLoading:d||c,timeRange:i}}export{i as u};
