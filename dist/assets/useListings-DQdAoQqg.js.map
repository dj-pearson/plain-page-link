{"version":3,"file":"useListings-DQdAoQqg.js","sources":["../../src/hooks/useListings.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuthStore } from \"@/stores/useAuthStore\";\n\nexport interface Listing {\n  id: string;\n  user_id: string;\n  image?: string;\n  address: string;\n  city: string;\n  price: string;\n  beds: number;\n  baths: number;\n  sqft?: number;\n  status: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport function useListings() {\n  const { user } = useAuthStore();\n  const queryClient = useQueryClient();\n\n  const { data: listings = [], isLoading, isError, error, refetch } = useQuery({\n    queryKey: [\"listings\", user?.id],\n    queryFn: async () => {\n      if (!user?.id) return [];\n\n      const { data, error } = await supabase\n        .from(\"listings\")\n        .select(\"*\")\n        .eq(\"user_id\", user.id)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n      return data as Listing[];\n    },\n    enabled: !!user?.id,\n    staleTime: 5 * 60 * 1000, // 5 minutes - data considered fresh\n    gcTime: 10 * 60 * 1000, // 10 minutes - cache retention\n  });\n\n  const addListing = useMutation({\n    mutationFn: async (listingData: Omit<Listing, \"id\" | \"user_id\" | \"created_at\" | \"updated_at\">) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      const { data, error } = await supabase\n        .from(\"listings\")\n        .insert({\n          user_id: user.id,\n          ...listingData,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"listings\", user?.id] });\n    },\n  });\n\n  const updateListing = useMutation({\n    mutationFn: async ({ id, ...updates }: Partial<Listing> & { id: string }) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      // Security: Verify user owns this listing by requiring both id and user_id match\n      const { data, error } = await supabase\n        .from(\"listings\")\n        .update(updates)\n        .eq(\"id\", id)\n        .eq(\"user_id\", user.id)\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"listings\", user?.id] });\n    },\n  });\n\n  const deleteListing = useMutation({\n    mutationFn: async (id: string) => {\n      if (!user?.id) throw new Error(\"User not authenticated\");\n\n      // Security: Verify user owns this listing by requiring both id and user_id match\n      const { error } = await supabase\n        .from(\"listings\")\n        .delete()\n        .eq(\"id\", id)\n        .eq(\"user_id\", user.id);\n\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"listings\", user?.id] });\n    },\n  });\n\n  return {\n    listings,\n    isLoading,\n    isError,\n    error,\n    refetch,\n    addListing,\n    updateListing,\n    deleteListing,\n  };\n}\n"],"names":["useListings","user","useAuthStore","queryClient","useQueryClient","listings","isLoading","isError","error","refetch","useQuery","data","supabase","addListing","useMutation","listingData","updateListing","id","updates","deleteListing"],"mappings":"uGAmBO,SAASA,GAAc,CAC5B,KAAM,CAAE,KAAAC,CAAA,EAASC,EAAA,EACXC,EAAcC,EAAA,EAEd,CAAE,KAAMC,EAAW,GAAI,UAAAC,EAAW,QAAAC,EAAS,MAAAC,EAAO,QAAAC,CAAA,EAAYC,EAAS,CAC3E,SAAU,CAAC,WAAYT,GAAM,EAAE,EAC/B,QAAS,SAAY,CACnB,GAAI,CAACA,GAAM,GAAI,MAAO,CAAA,EAEtB,KAAM,CAAE,KAAAU,EAAM,MAAAH,CAAAA,EAAU,MAAMI,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,UAAWX,EAAK,EAAE,EACrB,MAAM,aAAc,CAAE,UAAW,GAAO,EAE3C,GAAIO,EAAO,MAAMA,EACjB,OAAOG,CACT,EACA,QAAS,CAAC,CAACV,GAAM,GACjB,UAAW,IAAS,IACpB,OAAQ,IAAU,GAAA,CACnB,EAEKY,EAAaC,EAAY,CAC7B,WAAY,MAAOC,GAA+E,CAChG,GAAI,CAACd,GAAM,GAAI,MAAM,IAAI,MAAM,wBAAwB,EAEvD,KAAM,CAAE,KAAAU,EAAM,MAAAH,CAAAA,EAAU,MAAMI,EAC3B,KAAK,UAAU,EACf,OAAO,CACN,QAASX,EAAK,GACd,GAAGc,CAAA,CACJ,EACA,OAAA,EACA,OAAA,EAEH,GAAIP,EAAO,MAAMA,EACjB,OAAOG,CACT,EACA,UAAW,IAAM,CACfR,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAYF,GAAM,EAAE,EAAG,CACpE,CAAA,CACD,EAEKe,EAAgBF,EAAY,CAChC,WAAY,MAAO,CAAE,GAAAG,EAAI,GAAGC,KAAiD,CAC3E,GAAI,CAACjB,GAAM,GAAI,MAAM,IAAI,MAAM,wBAAwB,EAGvD,KAAM,CAAE,KAAAU,EAAM,MAAAH,CAAAA,EAAU,MAAMI,EAC3B,KAAK,UAAU,EACf,OAAOM,CAAO,EACd,GAAG,KAAMD,CAAE,EACX,GAAG,UAAWhB,EAAK,EAAE,EACrB,OAAA,EACA,OAAA,EAEH,GAAIO,EAAO,MAAMA,EACjB,OAAOG,CACT,EACA,UAAW,IAAM,CACfR,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAYF,GAAM,EAAE,EAAG,CACpE,CAAA,CACD,EAEKkB,EAAgBL,EAAY,CAChC,WAAY,MAAOG,GAAe,CAChC,GAAI,CAAChB,GAAM,GAAI,MAAM,IAAI,MAAM,wBAAwB,EAGvD,KAAM,CAAE,MAAAO,CAAAA,EAAU,MAAMI,EACrB,KAAK,UAAU,EACf,OAAA,EACA,GAAG,KAAMK,CAAE,EACX,GAAG,UAAWhB,EAAK,EAAE,EAExB,GAAIO,EAAO,MAAMA,CACnB,EACA,UAAW,IAAM,CACfL,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAYF,GAAM,EAAE,EAAG,CACpE,CAAA,CACD,EAED,MAAO,CACL,SAAAI,EACA,UAAAC,EACA,QAAAC,EACA,MAAAC,EACA,QAAAC,EACA,WAAAI,EACA,cAAAG,EACA,cAAAG,CAAA,CAEJ"}