import{p as y,aR as p,b as T,z as h,s as a}from"./index-DPimQPXj.js";import{u as o}from"./useMutation-n5aR1Lzl.js";function v(){const{user:t}=y(),n=p(),{toast:s}=T(),{data:u=[],isLoading:l}=h({queryKey:["testimonials",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:e,error:i}=await a.from("testimonials").select("*").eq("user_id",t.id).order("date",{ascending:!1});if(i)throw i;return e},enabled:!!t?.id}),c=o({mutationFn:async e=>{if(!t?.id)throw new Error("User not authenticated");const{data:i,error:r}=await a.from("testimonials").insert({user_id:t.id,...e}).select().single();if(r)throw r;return i},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",t?.id]}),s({title:"Testimonial Added",description:"Your testimonial has been added successfully."})},onError:e=>{s({title:"Failed to Add Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),m=o({mutationFn:async({id:e,...i})=>{const{data:r,error:d}=await a.from("testimonials").update(i).eq("id",e).select().single();if(d)throw d;return r},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",t?.id]}),s({title:"Testimonial Updated",description:"Your testimonial has been updated successfully."})},onError:e=>{s({title:"Failed to Update Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),f=o({mutationFn:async e=>{const{error:i}=await a.from("testimonials").delete().eq("id",e);if(i)throw i},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",t?.id]}),s({title:"Testimonial Deleted",description:"Your testimonial has been deleted successfully."})},onError:e=>{s({title:"Failed to Delete Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}});return{testimonials:u,isLoading:l,addTestimonial:c,updateTestimonial:m,deleteTestimonial:f}}export{v as u};
