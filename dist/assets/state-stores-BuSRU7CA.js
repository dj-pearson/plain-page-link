import{s as y,a as O}from"./supabase-Ba7v9dZh.js";import{a as U,R as W}from"./react-vendor-CotwlNTQ.js";import{g as $}from"./charts-hR54p0E0.js";import{u as I}from"./utils-BpArqNZu.js";const J={},A=n=>{let i;const t=new Set,e=(m,h)=>{const g=typeof m=="function"?m(i):m;if(!Object.is(g,i)){const p=i;i=h??(typeof g!="object"||g===null)?g:Object.assign({},i,g),t.forEach(v=>v(i,p))}},o=()=>i,c={setState:e,getState:o,getInitialState:()=>d,subscribe:m=>(t.add(m),()=>t.delete(m)),destroy:()=>{(J?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},d=i=n(e,o,c);return c},Y=n=>n?A(n):A;var x={exports:{}},D={},R={exports:{}},C={};var q;function G(){if(q)return C;q=1;var n=U();function i(h,g){return h===g&&(h!==0||1/h===1/g)||h!==h&&g!==g}var t=typeof Object.is=="function"?Object.is:i,e=n.useState,o=n.useEffect,r=n.useLayoutEffect,s=n.useDebugValue;function a(h,g){var p=g(),v=e({inst:{value:p,getSnapshot:g}}),l=v[0].inst,u=v[1];return r(function(){l.value=p,l.getSnapshot=g,c(l)&&u({inst:l})},[h,p,g]),o(function(){return c(l)&&u({inst:l}),h(function(){c(l)&&u({inst:l})})},[h]),s(p),p}function c(h){var g=h.getSnapshot;h=h.value;try{var p=g();return!t(h,p)}catch{return!0}}function d(h,g){return g()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:a;return C.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:m,C}var T;function V(){return T||(T=1,R.exports=G()),R.exports}var H;function K(){if(H)return D;H=1;var n=U(),i=V();function t(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var e=typeof Object.is=="function"?Object.is:t,o=i.useSyncExternalStore,r=n.useRef,s=n.useEffect,a=n.useMemo,c=n.useDebugValue;return D.useSyncExternalStoreWithSelector=function(d,m,h,g,p){var v=r(null);if(v.current===null){var l={hasValue:!1,value:null};v.current=l}else l=v.current;v=a(function(){function w(k){if(!f){if(f=!0,S=k,k=g(k),p!==void 0&&l.hasValue){var E=l.value;if(p(E,k))return _=E}return _=k}if(E=_,e(S,k))return E;var L=g(k);return p!==void 0&&p(E,L)?(S=k,E):(S=k,_=L)}var f=!1,S,_,P=h===void 0?null:h;return[function(){return w(m())},P===null?void 0:function(){return w(P())}]},[m,h,g,p]);var u=o(d,v[0],v[1]);return s(function(){l.hasValue=!0,l.value=u},[u]),c(u),u},D}var F;function X(){return F||(F=1,x.exports=K()),x.exports}var Q=X();const Z=$(Q),N={},{useDebugValue:ee}=W,{useSyncExternalStoreWithSelector:te}=Z;let M=!1;const re=n=>n;function oe(n,i=re,t){(N?"production":void 0)!=="production"&&t&&!M&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),M=!0);const e=te(n.subscribe,n.getState,n.getServerState||n.getInitialState,i,t);return ee(e),e}const z=n=>{(N?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const i=typeof n=="function"?Y(n):n,t=(e,o)=>oe(i,e,o);return Object.assign(t,i),t},j=n=>n?z(n):z,ne={};function ie(n,i){let t;try{t=n()}catch{return}return{getItem:o=>{var r;const s=c=>c===null?null:JSON.parse(c,void 0),a=(r=t.getItem(o))!=null?r:null;return a instanceof Promise?a.then(s):s(a)},setItem:(o,r)=>t.setItem(o,JSON.stringify(r,void 0)),removeItem:o=>t.removeItem(o)}}const B=n=>i=>{try{const t=n(i);return t instanceof Promise?t:{then(e){return B(e)(t)},catch(e){return this}}}catch(t){return{then(e){return this},catch(e){return B(e)(t)}}}},se=(n,i)=>(t,e,o)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:u=>u,version:0,merge:(u,w)=>({...w,...u}),...i},s=!1;const a=new Set,c=new Set;let d;try{d=r.getStorage()}catch{}if(!d)return n((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...u)},e,o);const m=B(r.serialize),h=()=>{const u=r.partialize({...e()});let w;const f=m({state:u,version:r.version}).then(S=>d.setItem(r.name,S)).catch(S=>{w=S});if(w)throw w;return f},g=o.setState;o.setState=(u,w)=>{g(u,w),h()};const p=n((...u)=>{t(...u),h()},e,o);let v;const l=()=>{var u;if(!d)return;s=!1,a.forEach(f=>f(e()));const w=((u=r.onRehydrateStorage)==null?void 0:u.call(r,e()))||void 0;return B(d.getItem.bind(d))(r.name).then(f=>{if(f)return r.deserialize(f)}).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==r.version){if(r.migrate)return r.migrate(f.state,f.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return f.state}).then(f=>{var S;return v=r.merge(f,(S=e())!=null?S:p),t(v,!0),h()}).then(()=>{w?.(v,void 0),s=!0,c.forEach(f=>f(v))}).catch(f=>{w?.(void 0,f)})};return o.persist={setOptions:u=>{r={...r,...u},u.getStorage&&(d=u.getStorage())},clearStorage:()=>{d?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>l(),hasHydrated:()=>s,onHydrate:u=>(a.add(u),()=>{a.delete(u)}),onFinishHydration:u=>(c.add(u),()=>{c.delete(u)})},l(),v||p},ae=(n,i)=>(t,e,o)=>{let r={storage:ie(()=>localStorage),partialize:l=>l,version:0,merge:(l,u)=>({...u,...l}),...i},s=!1;const a=new Set,c=new Set;let d=r.storage;if(!d)return n((...l)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...l)},e,o);const m=()=>{const l=r.partialize({...e()});return d.setItem(r.name,{state:l,version:r.version})},h=o.setState;o.setState=(l,u)=>{h(l,u),m()};const g=n((...l)=>{t(...l),m()},e,o);o.getInitialState=()=>g;let p;const v=()=>{var l,u;if(!d)return;s=!1,a.forEach(f=>{var S;return f((S=e())!=null?S:g)});const w=((u=r.onRehydrateStorage)==null?void 0:u.call(r,(l=e())!=null?l:g))||void 0;return B(d.getItem.bind(d))(r.name).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==r.version){if(r.migrate)return[!0,r.migrate(f.state,f.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,f.state];return[!1,void 0]}).then(f=>{var S;const[_,P]=f;if(p=r.merge(P,(S=e())!=null?S:g),t(p,!0),_)return m()}).then(()=>{w?.(p,void 0),p=e(),s=!0,c.forEach(f=>f(p))}).catch(f=>{w?.(void 0,f)})};return o.persist={setOptions:l=>{r={...r,...l},l.storage&&(d=l.storage)},clearStorage:()=>{d?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>v(),hasHydrated:()=>s,onHydrate:l=>(a.add(l),()=>{a.delete(l)}),onFinishHydration:l=>(c.add(l),()=>{c.delete(l)})},r.skipHydration||v(),p||g},le=(n,i)=>"getStorage"in i||"serialize"in i||"deserialize"in i?((ne?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),se(n,i)):ae(n,i),ce=le,Se=j()(ce((n,i)=>({user:null,session:null,profile:null,role:null,isLoading:!0,error:null,initialize:async()=>{const t=await y.auth.getSession();t.data.session?n({user:t.data.session.user,session:t.data.session,isLoading:!0}):n({isLoading:!0});try{const{data:{session:e}}=await y.auth.getSession();if(e?.user){const[o,r]=await Promise.all([y.from("profiles").select("*").eq("id",e.user.id).single(),y.from("user_roles").select("role").eq("user_id",e.user.id).order("role",{ascending:!0})]),s=r.data?.find(a=>a.role==="admin")?.role||r.data?.[0]?.role||null;n({user:e.user,session:e,profile:o.data||null,role:s,isLoading:!1})}else n({user:null,session:null,profile:null,role:null,isLoading:!1})}catch(e){console.error("Auth initialization error:",e),n({user:null,session:null,profile:null,role:null,isLoading:!1,error:e.message})}y.auth.onAuthStateChange(async(e,o)=>{if(console.log("Auth state change:",e,o?.user?.id),e==="SIGNED_OUT"){n({session:null,user:null,profile:null,role:null});return}if(e==="TOKEN_REFRESHED"){n({session:o,user:o?.user??null});return}if(n({session:o,user:o?.user??null}),o?.user)try{const[r,s]=await Promise.all([y.from("profiles").select("*").eq("id",o.user.id).single(),y.from("user_roles").select("role").eq("user_id",o.user.id).order("role",{ascending:!0})]),a=s.data?.find(c=>c.role==="admin")?.role||s.data?.[0]?.role||null;n({profile:r.data||null,role:a})}catch(r){console.error("Error fetching user data in auth state listener:",r)}else n({profile:null,role:null})})},signUp:async(t,e,o,r)=>{n({isLoading:!0,error:null});try{const{data:s,error:a}=await y.auth.signUp({email:t,password:e,options:{data:{username:o,full_name:r||""},emailRedirectTo:`${window.location.origin}/`}});if(a)throw a;n({user:s.user,session:s.session,isLoading:!1})}catch(s){throw n({error:s.message,isLoading:!1}),s}},signIn:async(t,e)=>{n({isLoading:!0,error:null});try{const{data:o,error:r}=await y.auth.signInWithPassword({email:t,password:e});if(r)throw r;const{data:s}=await y.from("profiles").select("*").eq("id",o.user.id).single(),{data:a}=await y.from("user_roles").select("role").eq("user_id",o.user.id).order("role",{ascending:!0}),c=a?.find(d=>d.role==="admin")?.role||a?.[0]?.role||null;n({user:o.user,session:o.session,profile:s||null,role:c,isLoading:!1})}catch(o){throw n({error:o.message,isLoading:!1}),o}},signOut:async()=>{n({isLoading:!0});try{await y.auth.signOut(),n({user:null,session:null,profile:null,role:null,isLoading:!1,error:null})}catch(t){console.error("Sign out error:",t),n({isLoading:!1})}},updateProfile:async t=>{const{user:e}=i();if(!e)throw new Error("Not authenticated");n({isLoading:!0,error:null});try{const{data:o,error:r}=await y.from("profiles").update(t).eq("id",e.id).select().single();if(r)throw r;n({profile:o,isLoading:!1})}catch(o){throw n({error:o.message,isLoading:!1}),o}},clearError:()=>{n({error:null})}}),{name:"auth-storage",partialize:n=>({profile:n.profile,role:n.role})}));class ue{createNewPage(i,t){return{id:this.generateId(),userId:i,slug:t,title:"My Link-in-Bio Page",description:"Real Estate Professional",blocks:[],theme:this.getDefaultTheme(),seo:{title:"My Link-in-Bio Page",description:"Real Estate Professional",keywords:["real estate","agent","properties"],twitterCard:"summary_large_image"},published:!1,createdAt:new Date,updatedAt:new Date}}getDefaultTheme(){return{name:"Default",preset:"modern",colors:{primary:"#2563eb",secondary:"#10b981",background:"#ffffff",text:"#1f2937",accent:"#f59e0b"},fonts:{heading:"Inter",body:"Inter"},borderRadius:"medium",spacing:"normal"}}async addBlock(i,t,e,o){const r=this.getBlockTemplate(t);if(!r)throw new Error(`Unknown block type: ${t}`);let s=r.defaultConfig;o&&(s=await O(r.defaultConfig,o));const a={id:this.generateId(),type:t,order:e!==void 0?e:i.blocks.length,visible:!0,config:s},c=[...i.blocks];return e!==void 0?(c.splice(e,0,a),c.forEach((d,m)=>{d.order=m})):c.push(a),{...i,blocks:c,updatedAt:new Date}}removeBlock(i,t){const e=i.blocks.filter(o=>o.id!==t).map((o,r)=>({...o,order:r}));return{...i,blocks:e,updatedAt:new Date}}updateBlock(i,t,e){const o=i.blocks.map(r=>r.id===t?{...r,config:{...r.config,...e}}:r);return{...i,blocks:o,updatedAt:new Date}}reorderBlocks(i,t,e){const o=[...i.blocks],[r]=o.splice(t,1);return o.splice(e,0,r),o.forEach((s,a)=>{s.order=a}),{...i,blocks:o,updatedAt:new Date}}toggleBlockVisibility(i,t){const e=i.blocks.map(o=>o.id===t?{...o,visible:!o.visible}:o);return{...i,blocks:e,updatedAt:new Date}}duplicateBlock(i,t){const e=i.blocks.find(s=>s.id===t);if(!e)return i;const o={...e,id:this.generateId(),order:e.order+1},r=[...i.blocks];return r.splice(e.order+1,0,o),r.forEach((s,a)=>{a>e.order&&(s.order=a)}),{...i,blocks:r,updatedAt:new Date}}getBlockTemplates(){return[{type:"bio",name:"Bio Section",description:"Your profile and introduction",icon:"User",category:"content",defaultConfig:{type:"bio",title:"Your Name",subtitle:"Real Estate Professional",description:"Helping clients find their dream homes in [Your City]. Licensed agent with [X] years of experience.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",name:"Property Listings",description:"Showcase your active listings",icon:"Home",category:"content",defaultConfig:{type:"listings",title:"Featured Properties",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!0}},{type:"link",name:"Link Button",description:"Add a custom link",icon:"Link",category:"content",defaultConfig:{type:"link",title:"Click Here",url:"https://example.com",style:"button",openInNewTab:!0}},{type:"contact",name:"Contact Form",description:"Let visitors reach out",icon:"Mail",category:"engagement",defaultConfig:{type:"contact",title:"Get In Touch",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"message",type:"textarea",label:"Message",placeholder:"How can I help you?",required:!0}],submitButtonText:"Send Message",successMessage:"Thank you! I'll get back to you soon."}},{type:"social",name:"Social Links",description:"Connect on social media",icon:"Share2",category:"engagement",defaultConfig:{type:"social",title:"Follow Me",links:[],layout:"horizontal",iconSize:"medium"}},{type:"video",name:"Video",description:"Embed a video",icon:"Video",category:"media",defaultConfig:{type:"video",title:"Watch My Introduction",videoUrl:"",autoplay:!1,muted:!0}},{type:"testimonial",name:"Testimonials",description:"Client reviews",icon:"MessageSquare",category:"content",defaultConfig:{type:"testimonial",title:"What Clients Say",testimonials:[],layout:"slider"}},{type:"spacer",name:"Spacer",description:"Add vertical space",icon:"MoveVertical",category:"content",defaultConfig:{type:"spacer",height:40}},{type:"image",name:"Image",description:"Add an image",icon:"Image",category:"media",defaultConfig:{type:"image",imageUrl:"",alt:"Image",size:"medium"}},{type:"text",name:"Text Block",description:"Add custom text",icon:"Type",category:"content",defaultConfig:{type:"text",content:"Your text here...",align:"left",fontSize:"medium"}}]}getBlockTemplate(i){return this.getBlockTemplates().find(t=>t.type===i)}generateId(){return`block_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}validatePage(i){const t=[];(!i.slug||i.slug.trim()==="")&&t.push("Page slug is required"),(!i.title||i.title.trim()==="")&&t.push("Page title is required"),/^[a-z0-9-]+$/i.test(i.slug)||t.push("Page slug must contain only letters, numbers, and hyphens");const e=i.blocks.map(r=>r.id),o=new Set(e);return e.length!==o.size&&t.push("Duplicate block IDs detected"),{valid:t.length===0,errors:t}}}const b=new ue,ke=b.createNewPage.bind(b),de=b.addBlock.bind(b),fe=b.removeBlock.bind(b),ge=b.updateBlock.bind(b),he=b.reorderBlocks.bind(b),pe=b.toggleBlockVisibility.bind(b),me=b.duplicateBlock.bind(b),Ie=b.getBlockTemplates.bind(b);b.validatePage.bind(b);const _e=j((n,i)=>({page:null,selectedBlockId:null,isDragging:!1,history:[],historyIndex:-1,isPreviewMode:!1,isSaving:!1,setPage:t=>{n({page:t,history:[t],historyIndex:0,selectedBlockId:null})},loadPage:async t=>{try{const{data:e,error:o}=await y.from("custom_pages").select("*").eq("id",t).single();if(o)throw o;if(!e)throw new Error("Page not found");const r={id:e.id,userId:e.user_id,slug:e.slug,title:e.title,description:e.description||"",blocks:e.blocks,theme:e.theme,seo:e.seo,published:e.published,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)};i().setPage(r)}catch(e){throw console.error("Failed to load page:",e),I.error("Failed to load page"),e}},loadUserPages:async()=>{try{const{data:{user:t}}=await y.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:e,error:o}=await y.from("custom_pages").select("*").eq("user_id",t.id).order("updated_at",{ascending:!1});if(o)throw o;return(e||[]).map(r=>({id:r.id,userId:r.user_id,slug:r.slug,title:r.title,description:r.description||"",blocks:r.blocks,theme:r.theme,seo:r.seo,published:r.published,createdAt:new Date(r.created_at),updatedAt:new Date(r.updated_at)}))}catch(t){return console.error("Failed to load user pages:",t),[]}},selectBlock:t=>{n({selectedBlockId:t})},setIsDragging:t=>{n({isDragging:t})},addBlockToPage:async(t,e)=>{const{page:o,history:r,historyIndex:s}=i();if(o)try{const{data:{user:a}}=await y.auth.getUser(),c=await de(o,t,e,a?.id),d=r.slice(0,s+1);d.push(c),n({page:c,history:d,historyIndex:d.length-1,selectedBlockId:c.blocks[c.blocks.length-1]?.id})}catch(a){console.error("Error adding block:",a),I.error("Failed to add block")}},removeBlockFromPage:t=>{const{page:e,history:o,historyIndex:r}=i();if(!e)return;const s=fe(e,t),a=o.slice(0,r+1);a.push(s),n({page:s,history:a,historyIndex:a.length-1,selectedBlockId:null})},updateBlockConfig:(t,e)=>{const{page:o,history:r,historyIndex:s}=i();if(!o)return;const a=ge(o,t,e),c=r.slice(0,s+1);c.push(a),n({page:a,history:c,historyIndex:c.length-1})},reorderPageBlocks:(t,e)=>{const{page:o,history:r,historyIndex:s}=i();if(!o)return;const a=he(o,t,e),c=r.slice(0,s+1);c.push(a),n({page:a,history:c,historyIndex:c.length-1})},toggleBlockVisible:t=>{const{page:e,history:o,historyIndex:r}=i();if(!e)return;const s=pe(e,t),a=o.slice(0,r+1);a.push(s),n({page:s,history:a,historyIndex:a.length-1})},duplicatePageBlock:t=>{const{page:e,history:o,historyIndex:r}=i();if(!e)return;const s=me(e,t),a=o.slice(0,r+1);a.push(s),n({page:s,history:a,historyIndex:a.length-1})},updatePageMeta:t=>{const{page:e,history:o,historyIndex:r}=i();if(!e)return;const s={...e,...t,updatedAt:new Date},a=o.slice(0,r+1);a.push(s),n({page:s,history:a,historyIndex:a.length-1})},undo:()=>{const{history:t,historyIndex:e}=i();e>0&&n({page:t[e-1],historyIndex:e-1})},redo:()=>{const{history:t,historyIndex:e}=i();e<t.length-1&&n({page:t[e+1],historyIndex:e+1})},canUndo:()=>{const{historyIndex:t}=i();return t>0},canRedo:()=>{const{history:t,historyIndex:e}=i();return e<t.length-1},togglePreviewMode:()=>{n(t=>({isPreviewMode:!t.isPreviewMode,selectedBlockId:null}))},savePage:async()=>{const{page:t}=i();if(t){n({isSaving:!0});try{const{data:{user:e}}=await y.auth.getUser();if(!e)throw new Error("Not authenticated");const o={user_id:e.id,slug:t.slug,title:t.title,description:t.description,blocks:t.blocks,theme:t.theme,seo:t.seo,published:t.published},{data:r}=await y.from("custom_pages").select("id").eq("id",t.id).single();if(r){const{error:s}=await y.from("custom_pages").update(o).eq("id",t.id);if(s)throw s}else{const{error:s}=await y.from("custom_pages").insert({...o,id:t.id});if(s)throw s}I.success("Page saved successfully")}catch(e){throw console.error("Failed to save page:",e),I.error("Failed to save page"),e}finally{n({isSaving:!1})}}},publishPage:async()=>{const{page:t,updatePageMeta:e,savePage:o}=i();t&&(e({published:!0}),await o(),I.success("Page published successfully!"))},setAsActivePage:async t=>{try{const{data:{user:e}}=await y.auth.getUser();if(!e)throw new Error("Not authenticated");const{error:o}=await y.from("custom_pages").update({is_active:!0}).eq("id",t).eq("user_id",e.id);if(o)throw o;I.success("This page is now your active profile")}catch(e){throw console.error("Failed to set active page:",e),I.error("Failed to set active page"),e}},resetBuilder:()=>{n({page:null,selectedBlockId:null,isDragging:!1,history:[],historyIndex:-1,isPreviewMode:!1,isSaving:!1})}}));export{_e as a,ke as c,Ie as g,Se as u};
