import{j as e}from"./ui-components-DvFqL2_v.js";import{h as t,r as s}from"./react-vendor-CAgXa5q3.js";import{c as i}from"./data-Hz84gFTE.js";import{u as a}from"./utils-DFLHD_kh.js";import{s as l,u as r,B as o,C as n,m as c,D as d,o as u,p as m,q as p,r as h,I as g,L as y}from"./index-q1Xv5wHf.js";import{af as x,G as f,at as b,ah as v,E as w,N as k,ai as j,g as N,O as P,aJ as I,aK as S,a5 as B,an as C,ao as M,ak as D,ap as T,ab as q,_}from"./icons-DlImXNWg.js";import{p as z,g as A,B as F}from"./themeUtils-B-KDEwOX.js";import{T as E,a as L,b as U,c as Y}from"./tabs-CXyl62hg.js";import"./three-CADX-pQf.js";import"./charts-DkiT9PS6.js";import"./supabase-DAg_76Of.js";import"./forms-BPAyz8lx.js";import"./checkbox-CFAIMNYg.js";async function $(e,t){const s=await async function(e){const{data:t,error:s}=await l.from("profiles").select("*").eq("id",e).single();return s?null:t}(t);return s?{...e,title:s.full_name||s.username||e.title,subtitle:e.subtitle,description:s.bio||e.description,avatarUrl:s.avatar_url||e.avatarUrl}:e}async function R(e,t){const s=await async function(e){const{data:t,error:s}=await l.from("links").select("*").eq("user_id",e).eq("is_active",!0).order("position");return s?[]:t||[]}(t),i=function(e){return e.map(e=>{const t=function(e){const t=e.toLowerCase();return t.includes("instagram.com")?"instagram":t.includes("facebook.com")?"facebook":t.includes("twitter.com")||t.includes("x.com")?"twitter":t.includes("linkedin.com")?"linkedin":t.includes("youtube.com")?"youtube":t.includes("tiktok.com")?"tiktok":t.includes("zillow.com")?"zillow":t.includes("realtor.com")?"realtor":null}(e.url);return t?{id:e.id,platform:t,url:e.url,username:e.title}:null}).filter(e=>null!==e)}(s);return i.length>0?{...e,links:i}:e}const H=new class{createNewPage(e,t){return{id:this.generateId(),userId:e,slug:t,title:"My Link-in-Bio Page",description:"Real Estate Professional",blocks:[],theme:this.getDefaultTheme(),seo:{title:"My Link-in-Bio Page",description:"Real Estate Professional",keywords:["real estate","agent","properties"],twitterCard:"summary_large_image"},published:!1,createdAt:new Date,updatedAt:new Date}}getDefaultTheme(){return{name:"Default",preset:"modern",colors:{primary:"#2563eb",secondary:"#10b981",background:"#ffffff",text:"#1f2937",accent:"#f59e0b"},fonts:{heading:"Inter",body:"Inter"},borderRadius:"medium",spacing:"normal"}}async addBlock(e,t,s,i){const a=this.getBlockTemplate(t);if(!a)throw new Error(`Unknown block type: ${t}`);let l=a.defaultConfig;i&&(l=await async function(e,t){try{switch(e.type){case"bio":return await $(e,t);case"social":return await R(e,t);case"listings":return await async function(e){return{...e,title:"My Featured Properties",filter:"active",maxItems:6}}(e);case"contact":return await async function(e){return e}(e);default:return e}}catch(s){return e}}(a.defaultConfig,i));const r={id:this.generateId(),type:t,order:void 0!==s?s:e.blocks.length,visible:!0,config:l},o=[...e.blocks];return void 0!==s?(o.splice(s,0,r),o.forEach((e,t)=>{e.order=t})):o.push(r),{...e,blocks:o,updatedAt:new Date}}removeBlock(e,t){const s=e.blocks.filter(e=>e.id!==t).map((e,t)=>({...e,order:t}));return{...e,blocks:s,updatedAt:new Date}}updateBlock(e,t,s){const i=e.blocks.map(e=>e.id===t?{...e,config:{...e.config,...s}}:e);return{...e,blocks:i,updatedAt:new Date}}reorderBlocks(e,t,s){const i=[...e.blocks],[a]=i.splice(t,1);return i.splice(s,0,a),i.forEach((e,t)=>{e.order=t}),{...e,blocks:i,updatedAt:new Date}}toggleBlockVisibility(e,t){const s=e.blocks.map(e=>e.id===t?{...e,visible:!e.visible}:e);return{...e,blocks:s,updatedAt:new Date}}duplicateBlock(e,t){const s=e.blocks.find(e=>e.id===t);if(!s)return e;const i={...s,id:this.generateId(),order:s.order+1},a=[...e.blocks];return a.splice(s.order+1,0,i),a.forEach((e,t)=>{t>s.order&&(e.order=t)}),{...e,blocks:a,updatedAt:new Date}}getBlockTemplates(){return[{type:"bio",name:"Bio Section",description:"Your profile and introduction",icon:"User",category:"content",defaultConfig:{type:"bio",title:"Your Name",subtitle:"Real Estate Professional",description:"Helping clients find their dream homes in [Your City]. Licensed agent with [X] years of experience.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",name:"Property Listings",description:"Showcase your active listings",icon:"Home",category:"content",defaultConfig:{type:"listings",title:"Featured Properties",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!0}},{type:"link",name:"Link Button",description:"Add a custom link",icon:"Link",category:"content",defaultConfig:{type:"link",title:"Click Here",url:"https://example.com",style:"button",openInNewTab:!0}},{type:"contact",name:"Contact Form",description:"Let visitors reach out",icon:"Mail",category:"engagement",defaultConfig:{type:"contact",title:"Get In Touch",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"message",type:"textarea",label:"Message",placeholder:"How can I help you?",required:!0}],submitButtonText:"Send Message",successMessage:"Thank you! I'll get back to you soon."}},{type:"social",name:"Social Links",description:"Connect on social media",icon:"Share2",category:"engagement",defaultConfig:{type:"social",title:"Follow Me",links:[],layout:"horizontal",iconSize:"medium"}},{type:"video",name:"Video",description:"Embed a video",icon:"Video",category:"media",defaultConfig:{type:"video",title:"Watch My Introduction",videoUrl:"",autoplay:!1,muted:!0}},{type:"testimonial",name:"Testimonials",description:"Client reviews",icon:"MessageSquare",category:"content",defaultConfig:{type:"testimonial",title:"What Clients Say",testimonials:[],layout:"slider"}},{type:"spacer",name:"Spacer",description:"Add vertical space",icon:"MoveVertical",category:"content",defaultConfig:{type:"spacer",height:40}},{type:"image",name:"Image",description:"Add an image",icon:"Image",category:"media",defaultConfig:{type:"image",imageUrl:"",alt:"Image",size:"medium"}},{type:"text",name:"Text Block",description:"Add custom text",icon:"Type",category:"content",defaultConfig:{type:"text",content:"Your text here...",align:"left",fontSize:"medium"}}]}getBlockTemplate(e){return this.getBlockTemplates().find(t=>t.type===e)}generateId(){return`block_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}validatePage(e){const t=[];e.slug&&""!==e.slug.trim()||t.push("Page slug is required"),e.title&&""!==e.title.trim()||t.push("Page title is required"),/^[a-z0-9-]+$/i.test(e.slug)||t.push("Page slug must contain only letters, numbers, and hyphens");const s=e.blocks.map(e=>e.id),i=new Set(s);return s.length!==i.size&&t.push("Duplicate block IDs detected"),{valid:0===t.length,errors:t}}},V=H.createNewPage.bind(H),G=H.addBlock.bind(H),K=H.removeBlock.bind(H),W=H.updateBlock.bind(H),O=H.reorderBlocks.bind(H),J=H.toggleBlockVisibility.bind(H),X=H.duplicateBlock.bind(H),Q=H.getBlockTemplates.bind(H);H.validatePage.bind(H);const Z=i((e,t)=>({page:null,selectedBlockId:null,isDragging:!1,history:[],historyIndex:-1,isPreviewMode:!1,isSaving:!1,setPage:t=>{e({page:t,history:[t],historyIndex:0,selectedBlockId:null})},loadPage:async e=>{try{const{data:s,error:i}=await l.from("custom_pages").select("*").eq("id",e).single();if(i)throw i;if(!s)throw new Error("Page not found");const a={id:s.id,userId:s.user_id,slug:s.slug,title:s.title,description:s.description||"",blocks:s.blocks,theme:s.theme,seo:s.seo,published:s.published,createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at)};t().setPage(a)}catch(s){throw a.error("Failed to load page"),s}},loadUserPages:async()=>{try{const{data:{user:e}}=await l.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:t,error:s}=await l.from("custom_pages").select("*").eq("user_id",e.id).order("updated_at",{ascending:!1});if(s)throw s;return(t||[]).map(e=>({id:e.id,userId:e.user_id,slug:e.slug,title:e.title,description:e.description||"",blocks:e.blocks,theme:e.theme,seo:e.seo,published:e.published,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}catch(e){return[]}},selectBlock:t=>{e({selectedBlockId:t})},setIsDragging:t=>{e({isDragging:t})},addBlockToPage:async(s,i)=>{var r;const{page:o,history:n,historyIndex:c}=t();if(o)try{const{data:{user:t}}=await l.auth.getUser(),a=await G(o,s,i,null==t?void 0:t.id),d=n.slice(0,c+1);d.push(a),e({page:a,history:d,historyIndex:d.length-1,selectedBlockId:null==(r=a.blocks[a.blocks.length-1])?void 0:r.id})}catch(d){a.error("Failed to add block")}},removeBlockFromPage:s=>{const{page:i,history:a,historyIndex:l}=t();if(!i)return;const r=K(i,s),o=a.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1,selectedBlockId:null})},updateBlockConfig:(s,i)=>{const{page:a,history:l,historyIndex:r}=t();if(!a)return;const o=W(a,s,i),n=l.slice(0,r+1);n.push(o),e({page:o,history:n,historyIndex:n.length-1})},reorderPageBlocks:(s,i)=>{const{page:a,history:l,historyIndex:r}=t();if(!a)return;const o=O(a,s,i),n=l.slice(0,r+1);n.push(o),e({page:o,history:n,historyIndex:n.length-1})},toggleBlockVisible:s=>{const{page:i,history:a,historyIndex:l}=t();if(!i)return;const r=J(i,s),o=a.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1})},duplicatePageBlock:s=>{const{page:i,history:a,historyIndex:l}=t();if(!i)return;const r=X(i,s),o=a.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1})},updatePageMeta:s=>{const{page:i,history:a,historyIndex:l}=t();if(!i)return;const r={...i,...s,updatedAt:new Date},o=a.slice(0,l+1);o.push(r),e({page:r,history:o,historyIndex:o.length-1})},undo:()=>{const{history:s,historyIndex:i}=t();i>0&&e({page:s[i-1],historyIndex:i-1})},redo:()=>{const{history:s,historyIndex:i}=t();i<s.length-1&&e({page:s[i+1],historyIndex:i+1})},canUndo:()=>{const{historyIndex:e}=t();return e>0},canRedo:()=>{const{history:e,historyIndex:s}=t();return s<e.length-1},togglePreviewMode:()=>{e(e=>({isPreviewMode:!e.isPreviewMode,selectedBlockId:null}))},savePage:async()=>{const{page:s}=t();if(s){e({isSaving:!0});try{const{data:{user:e}}=await l.auth.getUser();if(!e)throw new Error("Not authenticated");const t={user_id:e.id,slug:s.slug,title:s.title,description:s.description,blocks:s.blocks,theme:s.theme,seo:s.seo,published:s.published},{data:i}=await l.from("custom_pages").select("id").eq("id",s.id).single();if(i){const{error:e}=await l.from("custom_pages").update(t).eq("id",s.id);if(e)throw e}else{const{error:e}=await l.from("custom_pages").insert({...t,id:s.id});if(e)throw e}a.success("Page saved successfully")}catch(i){throw a.error("Failed to save page"),i}finally{e({isSaving:!1})}}},publishPage:async()=>{const{page:e,updatePageMeta:s,savePage:i}=t();e&&(s({published:!0}),await i(),a.success("Page published successfully!"))},setAsActivePage:async e=>{try{const{data:{user:t}}=await l.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:s}=await l.from("custom_pages").update({is_active:!0}).eq("id",e).eq("user_id",t.id);if(s)throw s;a.success("This page is now your active profile")}catch(t){throw a.error("Failed to set active page"),t}},resetBuilder:()=>{e({page:null,selectedBlockId:null,isDragging:!1,history:[],historyIndex:-1,isPreviewMode:!1,isSaving:!1})}})),ee=[{id:"luxury-agent",name:"Luxury Agent",description:"Professional layout for luxury real estate specialists",category:"real-estate",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"Luxury Real Estate Specialist",description:"Specializing in high-end properties and exclusive listings. Let me help you find your dream home in the most prestigious neighborhoods.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",visible:!0,config:{type:"listings",title:"Featured Luxury Properties",layout:"grid",filter:"featured",maxItems:6,showPrices:!0,showStatus:!0}},{type:"social",visible:!0,config:{type:"social",title:"Connect With Me",links:[],layout:"horizontal",iconSize:"medium"}},{type:"contact",visible:!0,config:{type:"contact",title:"Schedule a Consultation",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"phone",type:"phone",label:"Phone",placeholder:"(555) 555-5555",required:!1},{id:"interest",type:"select",label:"I'm interested in",placeholder:"Select one",required:!0,options:["Buying","Selling","Both"]},{id:"message",type:"textarea",label:"Tell me about your goals",placeholder:"What can I help you with?",required:!0}],submitButtonText:"Request Consultation",successMessage:"Thank you! I'll be in touch within 24 hours."}}]},{id:"first-time-buyer",name:"First-Time Buyer Specialist",description:"Friendly layout for agents helping first-time buyers",category:"real-estate",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"First-Time Homebuyer Specialist",description:"Making your first home purchase stress-free! I guide first-time buyers through every step of the process with patience and expertise.",showSocialLinks:!0,showContactButton:!0}},{type:"text",visible:!0,config:{type:"text",content:"ðŸ  New to homebuying? You're in the right place! I'll walk you through every step, from getting pre-approved to closing day.",align:"center",fontSize:"medium"}},{type:"listings",visible:!0,config:{type:"listings",title:"Starter Homes & Condos",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!0}},{type:"link",visible:!0,config:{type:"link",title:"ðŸ“š First-Time Buyer Guide (Free Download)",url:"#",style:"button",openInNewTab:!1}},{type:"contact",visible:!0,config:{type:"contact",title:"Let's Get Started!",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"phone",type:"phone",label:"Phone",placeholder:"(555) 555-5555",required:!1},{id:"timeline",type:"select",label:"When are you looking to buy?",placeholder:"Select timeframe",required:!0,options:["1-3 months","3-6 months","6-12 months","Just exploring"]}],submitButtonText:"Start My Journey",successMessage:"Exciting! I'll reach out soon to help you find your first home."}},{type:"social",visible:!0,config:{type:"social",title:"Follow for Home Buying Tips",links:[],layout:"horizontal",iconSize:"large"}}]},{id:"investor-focused",name:"Investment Property Specialist",description:"Perfect for agents working with real estate investors",category:"real-estate",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"Investment Property Specialist",description:"Helping investors build wealth through strategic real estate acquisitions. Data-driven analysis and proven ROI.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",visible:!0,config:{type:"listings",title:"Investment Opportunities",layout:"list",filter:"active",maxItems:8,showPrices:!0,showStatus:!0}},{type:"text",visible:!0,config:{type:"text",content:"ðŸ’° All properties analyzed for cap rate, cash-on-cash return, and appreciation potential.",align:"center",fontSize:"medium"}},{type:"link",visible:!0,config:{type:"link",title:"ðŸ“Š Market Analysis Report",url:"#",style:"button",openInNewTab:!1}},{type:"contact",visible:!0,config:{type:"contact",title:"Discuss Investment Strategy",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"investment_type",type:"select",label:"Investment Type",placeholder:"Select type",required:!0,options:["Single Family Rental","Multi-Family","Commercial","Fix & Flip","Mixed Use"]},{id:"budget",type:"select",label:"Investment Budget",placeholder:"Select range",required:!1,options:["Under $250K","$250K - $500K","$500K - $1M","Over $1M"]}],submitButtonText:"Get Investment Analysis",successMessage:"I'll prepare a custom market analysis for you."}},{type:"social",visible:!0,config:{type:"social",title:"Connect for Market Insights",links:[],layout:"horizontal",iconSize:"medium"}}]},{id:"simple-clean",name:"Simple & Clean",description:"Minimalist layout that works for any real estate professional",category:"general",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"Real Estate Professional",description:"Helping clients buy and sell properties with expertise and dedication.",showSocialLinks:!1,showContactButton:!0}},{type:"listings",visible:!0,config:{type:"listings",title:"Current Listings",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!1}},{type:"contact",visible:!0,config:{type:"contact",title:"Get in Touch",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"message",type:"textarea",label:"Message",placeholder:"How can I help?",required:!0}],submitButtonText:"Send Message",successMessage:"Thanks! I'll get back to you soon."}}]}];function te(){const i=t(),{user:g,profile:y}=r(),{setPage:P,loadUserPages:I,setAsActivePage:S}=Z(),[B,C]=s.useState([]),[M,D]=s.useState(!0),[T,q]=s.useState(null),[_,z]=s.useState(!1);s.useEffect(()=>{A()},[]);const A=async()=>{try{const e=await I();C(e)}catch(e){a.error("Failed to load pages")}finally{D(!1)}},F=()=>{g&&y?z(!0):a.error("Please log in to create a page")},E=e=>{if(!g||!y)return void a.error("Please log in to create a page");const t=V(g.id,y.username||"my-page");if(e){const s=ee.find(t=>t.id===e);s&&(t.blocks=function(e){return e.blocks.map((e,t)=>({...e,id:`block_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,order:t}))}(s,g.id,t.slug),a.success(`Created page from "${s.name}" template!`))}P(t),z(!1),i("/dashboard/page-builder")};return M?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading pages..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Your Pages"}),e.jsx("p",{className:"text-muted-foreground",children:"Create custom link-in-bio pages"})]}),e.jsxs(o,{onClick:F,className:"gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"Create New Page"]})]}),0===B.length?e.jsx(n,{className:"p-12 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(f,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No pages yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Create your first custom page to get started"}),e.jsxs(o,{onClick:F,className:"gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"Create Your First Page"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(t=>{const s=t.is_active||!1;return e.jsxs(n,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["/",t.slug]})]}),s&&e.jsxs(c,{variant:"default",className:"gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),"Active"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:t.published?"default":"secondary",children:t.published?"Published":"Draft"}),e.jsxs(c,{variant:"outline",children:[t.blocks.length," blocks"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>(e=>{P(e),i("/dashboard/page-builder")})(t),className:"gap-2 w-full",children:[e.jsx(v,{className:"h-4 w-4"}),"Edit"]}),t.published&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",asChild:!0,className:"gap-2 w-full",children:e.jsxs("a",{href:`/p/${t.slug}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(w,{className:"h-4 w-4"}),"Preview",e.jsx(k,{className:"h-3 w-3 ml-auto"})]})}),!s&&e.jsxs(o,{variant:"default",size:"sm",onClick:()=>(async e=>{q(e);try{await S(e),await A()}catch(t){}finally{q(null)}})(t.id),disabled:T===t.id,className:"gap-2 w-full",children:[e.jsx(b,{className:"h-4 w-4"}),T===t.id?"Setting...":"Set as Active"]})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this page?"))try{const{error:t}=await l.from("custom_pages").delete().eq("id",e);if(t)throw t;a.success("Page deleted successfully"),await A()}catch(t){a.error("Failed to delete page")}})(t.id),className:"gap-2 w-full text-destructive hover:text-destructive",children:[e.jsx(j,{className:"h-4 w-4"}),"Delete"]})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.description})]},t.id)})}),e.jsx(d,{open:_,onOpenChange:z,children:e.jsxs(u,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(m,{children:[e.jsx(p,{children:"Choose a Template"}),e.jsx(h,{children:"Start with a pre-built template or create a blank page"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4",children:[e.jsx(n,{className:"p-6 cursor-pointer hover:border-primary transition-colors",onClick:()=>E(null),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded",children:e.jsx(x,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Blank Page"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start from scratch"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground flex-1",children:"Create a completely custom page by adding blocks one at a time."})]})}),ee.map(t=>e.jsx(n,{className:"p-6 cursor-pointer hover:border-primary transition-colors",onClick:()=>E(t.id),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded",children:e.jsx(N,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsxs(c,{variant:"outline",className:"mt-1",children:[t.blocks.length," blocks"]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground flex-1",children:t.description})]})},t.id))]})]})})]})}function se(){const{user:t,profile:i}=r(),[l,n]=s.useState(!0),[d,u]=s.useState(null),[m,p]=s.useState(!1),{page:h,selectedBlockId:b,isPreviewMode:v,isSaving:k,canUndo:N,canRedo:$,setPage:R,selectBlock:H,addBlockToPage:V,removeBlockFromPage:G,duplicatePageBlock:K,toggleBlockVisible:W,undo:O,redo:J,togglePreviewMode:X,savePage:ee,publishPage:se,updatePageMeta:ie}=Z();s.useEffect(()=>{n(!h)},[h]),s.useEffect(()=>{(null==h?void 0:h.theme)&&z(h.theme)},[null==h?void 0:h.theme]),s.useEffect(()=>{if(!h||k)return;const e=setTimeout(async()=>{try{await ee();u(new Date)}catch(e){a.error("Auto-save failed - please save manually")}},3e3);return()=>clearTimeout(e)},[h,k,ee]);const ae=null==h?void 0:h.blocks.find(e=>e.id===b),le=Q();return l||!h?e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(te,{})}):e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[!v&&e.jsxs("div",{className:"w-64 bg-white border-r flex flex-col",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"font-semibold text-lg",children:"Add Blocks"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:le.map(t=>e.jsx("button",{onClick:()=>V(t.type),className:"w-full p-3 text-left rounded-lg border hover:border-primary hover:bg-primary/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-5 h-5 text-gray-400 group-hover:text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.description})]})]})},t.type))})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{R(null),n(!0)},children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Back to Pages"]}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),e.jsx(o,{variant:"outline",size:"sm",onClick:O,disabled:!N(),children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:J,disabled:!$(),children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),e.jsx(g,{type:"text",value:h.title,onChange:e=>ie({title:e.target.value}),className:"w-64",placeholder:"Page Title"}),e.jsx(c,{variant:h.published?"default":"secondary",children:h.published?"Published":"Draft"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:X,children:v?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Edit"]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Preview"]})}),e.jsxs("div",{className:"flex border rounded-md",children:[e.jsx(o,{variant:m?"ghost":"default",size:"sm",onClick:()=>p(!1),className:"rounded-r-none",title:"Desktop Preview",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx(o,{variant:m?"default":"ghost",size:"sm",onClick:()=>p(!0),className:"rounded-l-none",title:"Mobile Preview",children:e.jsx(M,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:async()=>{try{await ee(),u(new Date),a.success("Page saved successfully!")}catch(e){a.error("Failed to save page")}},disabled:k,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),k?"Saving...":"Save"]}),d&&!k&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Saved ",d.toLocaleTimeString()]})]}),e.jsxs(o,{size:"sm",onClick:async()=>{try{await se(),a.success("Page published successfully!")}catch(e){a.error("Failed to publish page")}},disabled:k,children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Publish"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:e.jsx("div",{className:"mx-auto rounded-lg shadow-lg min-h-full transition-all duration-300",style:{...A(h.theme),backgroundColor:h.theme.colors.background,color:h.theme.colors.text,fontFamily:`'${h.theme.fonts.body}', sans-serif`,maxWidth:m?"375px":"672px"},children:e.jsx("div",{className:"p-8",style:{display:"flex",flexDirection:"column",gap:"compact"===h.theme.spacing?"1rem":"spacious"===h.theme.spacing?"3rem":"2rem"},children:0===h.blocks.length?e.jsxs("div",{className:"text-center py-20 text-gray-500",children:[e.jsx(x,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"Your page is empty"}),e.jsx("p",{className:"text-sm mt-1",children:"Add blocks from the left sidebar to get started"})]}):h.blocks.map(t=>e.jsxs("div",{className:"relative group",children:[!v&&e.jsxs("div",{className:"absolute -left-12 top-0 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[e.jsx("button",{className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Drag to reorder",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(t.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Duplicate",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>W(t.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:t.visible?"Hide":"Show",children:t.visible?e.jsx(w,{className:"w-4 h-4"}):e.jsx(_,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(t.id),className:"p-1 bg-white border rounded hover:bg-red-50 text-red-600",title:"Delete",children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsx(F,{block:t,isEditing:!v,isSelected:b===t.id,onSelect:()=>H(t.id),userId:h.userId})]},t.id))})})})]}),!v&&ae&&e.jsxs("div",{className:"w-80 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Block Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:ae.type})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs(E,{defaultValue:"content",className:"w-full",children:[e.jsxs(L,{className:"grid w-full grid-cols-2",children:[e.jsx(U,{value:"content",children:"Content"}),e.jsx(U,{value:"style",children:"Style"})]}),e.jsxs(Y,{value:"content",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Block Type"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:ae.type})]}),e.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Block-specific settings will appear here"})]}),e.jsx(Y,{value:"style",className:"space-y-4 mt-4",children:e.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Style settings coming soon"})})]})}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs(o,{variant:"outline",className:"w-full",onClick:()=>G(ae.id),children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Delete Block"]})})]})]})}export{se as default};
