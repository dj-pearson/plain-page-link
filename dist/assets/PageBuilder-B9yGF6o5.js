import{g as e,r as s,j as t}from"./react-vendor-CGQ4_CNL.js";import{u as a,e as i,s as l,f as r,g as o}from"./data-OhSCRAps.js";import{j as n,C as c,B as d,D as m,l as u,m as h,n as p,G as x,I as g,J as y,K as f,M as b,N as j,L as v}from"./ui-components-BeQXH7on.js";import{u as N}from"./utils-wmY8hpgz.js";import{aw as w,G as k,n as S,ay as C,E as P,h as B,az as I,g as z,a2 as M,aV as T,aW as F,an as q,aH as D,aI as E,aE as L,aJ as A,ae as Y,a4 as $}from"./icons-BX9Iz4zT.js";import{p as H,g as R,B as G}from"./themeUtils-CoWq0tHJ.js";import"./charts-D_q0pR-d.js";import"./supabase-D5NmozDF.js";const _=[{id:"luxury-agent",name:"Luxury Agent",description:"Professional layout for luxury real estate specialists",category:"real-estate",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"Luxury Real Estate Specialist",description:"Specializing in high-end properties and exclusive listings. Let me help you find your dream home in the most prestigious neighborhoods.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",visible:!0,config:{type:"listings",title:"Featured Luxury Properties",layout:"grid",filter:"featured",maxItems:6,showPrices:!0,showStatus:!0}},{type:"social",visible:!0,config:{type:"social",title:"Connect With Me",links:[],layout:"horizontal",iconSize:"medium"}},{type:"contact",visible:!0,config:{type:"contact",title:"Schedule a Consultation",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"phone",type:"phone",label:"Phone",placeholder:"(555) 555-5555",required:!1},{id:"interest",type:"select",label:"I'm interested in",placeholder:"Select one",required:!0,options:["Buying","Selling","Both"]},{id:"message",type:"textarea",label:"Tell me about your goals",placeholder:"What can I help you with?",required:!0}],submitButtonText:"Request Consultation",successMessage:"Thank you! I'll be in touch within 24 hours."}}]},{id:"first-time-buyer",name:"First-Time Buyer Specialist",description:"Friendly layout for agents helping first-time buyers",category:"real-estate",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"First-Time Homebuyer Specialist",description:"Making your first home purchase stress-free! I guide first-time buyers through every step of the process with patience and expertise.",showSocialLinks:!0,showContactButton:!0}},{type:"text",visible:!0,config:{type:"text",content:"ðŸ  New to homebuying? You're in the right place! I'll walk you through every step, from getting pre-approved to closing day.",align:"center",fontSize:"medium"}},{type:"listings",visible:!0,config:{type:"listings",title:"Starter Homes & Condos",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!0}},{type:"link",visible:!0,config:{type:"link",title:"ðŸ“š First-Time Buyer Guide (Free Download)",url:"#",style:"button",openInNewTab:!1}},{type:"contact",visible:!0,config:{type:"contact",title:"Let's Get Started!",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"phone",type:"phone",label:"Phone",placeholder:"(555) 555-5555",required:!1},{id:"timeline",type:"select",label:"When are you looking to buy?",placeholder:"Select timeframe",required:!0,options:["1-3 months","3-6 months","6-12 months","Just exploring"]}],submitButtonText:"Start My Journey",successMessage:"Exciting! I'll reach out soon to help you find your first home."}},{type:"social",visible:!0,config:{type:"social",title:"Follow for Home Buying Tips",links:[],layout:"horizontal",iconSize:"large"}}]},{id:"investor-focused",name:"Investment Property Specialist",description:"Perfect for agents working with real estate investors",category:"real-estate",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"Investment Property Specialist",description:"Helping investors build wealth through strategic real estate acquisitions. Data-driven analysis and proven ROI.",showSocialLinks:!0,showContactButton:!0}},{type:"listings",visible:!0,config:{type:"listings",title:"Investment Opportunities",layout:"list",filter:"active",maxItems:8,showPrices:!0,showStatus:!0}},{type:"text",visible:!0,config:{type:"text",content:"ðŸ’° All properties analyzed for cap rate, cash-on-cash return, and appreciation potential.",align:"center",fontSize:"medium"}},{type:"link",visible:!0,config:{type:"link",title:"ðŸ“Š Market Analysis Report",url:"#",style:"button",openInNewTab:!1}},{type:"contact",visible:!0,config:{type:"contact",title:"Discuss Investment Strategy",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"investment_type",type:"select",label:"Investment Type",placeholder:"Select type",required:!0,options:["Single Family Rental","Multi-Family","Commercial","Fix & Flip","Mixed Use"]},{id:"budget",type:"select",label:"Investment Budget",placeholder:"Select range",required:!1,options:["Under $250K","$250K - $500K","$500K - $1M","Over $1M"]}],submitButtonText:"Get Investment Analysis",successMessage:"I'll prepare a custom market analysis for you."}},{type:"social",visible:!0,config:{type:"social",title:"Connect for Market Insights",links:[],layout:"horizontal",iconSize:"medium"}}]},{id:"simple-clean",name:"Simple & Clean",description:"Minimalist layout that works for any real estate professional",category:"general",blocks:[{type:"bio",visible:!0,config:{type:"bio",title:"Your Name",subtitle:"Real Estate Professional",description:"Helping clients buy and sell properties with expertise and dedication.",showSocialLinks:!1,showContactButton:!0}},{type:"listings",visible:!0,config:{type:"listings",title:"Current Listings",layout:"grid",filter:"active",maxItems:6,showPrices:!0,showStatus:!1}},{type:"contact",visible:!0,config:{type:"contact",title:"Get in Touch",fields:[{id:"name",type:"text",label:"Name",placeholder:"Your name",required:!0},{id:"email",type:"email",label:"Email",placeholder:"your@email.com",required:!0},{id:"message",type:"textarea",label:"Message",placeholder:"How can I help?",required:!0}],submitButtonText:"Send Message",successMessage:"Thanks! I'll get back to you soon."}}]}];function K(){const o=e(),{user:g,profile:y}=a(),{setPage:f,loadUserPages:b,setAsActivePage:j}=i(),[v,M]=s.useState([]),[T,F]=s.useState(!0),[q,D]=s.useState(null),[E,L]=s.useState(!1);s.useEffect(()=>{A()},[]);const A=async()=>{try{const e=await b();M(e)}catch(e){N.error("Failed to load pages")}finally{F(!1)}},Y=()=>{g&&y?L(!0):N.error("Please log in to create a page")},$=e=>{if(!g||!y)return void N.error("Please log in to create a page");const s=r(g.id,y.username||"my-page");if(e){const t=_.find(s=>s.id===e);t&&(s.blocks=function(e){return e.blocks.map((e,s)=>({...e,id:`block_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,order:s}))}(t,g.id,s.slug),N.success(`Created page from "${t.name}" template!`))}f(s),L(!1),o("/dashboard/page-builder")};return T?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("p",{className:"text-muted-foreground",children:"Loading pages..."})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Your Pages"}),t.jsx("p",{className:"text-muted-foreground",children:"Create custom link-in-bio pages"})]}),t.jsxs(n,{onClick:Y,className:"gap-2",children:[t.jsx(w,{className:"h-4 w-4"}),"Create New Page"]})]}),0===v.length?t.jsx(c,{className:"p-12 text-center",children:t.jsxs("div",{className:"max-w-md mx-auto",children:[t.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No pages yet"}),t.jsx("p",{className:"text-muted-foreground mb-6",children:"Create your first custom page to get started"}),t.jsxs(n,{onClick:Y,className:"gap-2",children:[t.jsx(w,{className:"h-4 w-4"}),"Create Your First Page"]})]})}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(e=>{const s=e.is_active||!1;return t.jsxs(c,{className:"p-6 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-lg truncate",children:e.title}),t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["/",e.slug]})]}),s&&t.jsxs(d,{variant:"default",className:"gap-1",children:[t.jsx(S,{className:"h-3 w-3"}),"Active"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(d,{variant:e.published?"default":"secondary",children:e.published?"Published":"Draft"}),t.jsxs(d,{variant:"outline",children:[e.blocks.length," blocks"]})]})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs(n,{variant:"outline",size:"sm",onClick:()=>(e=>{f(e),o("/dashboard/page-builder")})(e),className:"gap-2 w-full",children:[t.jsx(C,{className:"h-4 w-4"}),"Edit"]}),e.published&&t.jsxs(t.Fragment,{children:[t.jsx(n,{variant:"outline",size:"sm",asChild:!0,className:"gap-2 w-full",children:t.jsxs("a",{href:`/p/${e.slug}`,target:"_blank",rel:"noopener noreferrer",children:[t.jsx(P,{className:"h-4 w-4"}),"Preview",t.jsx(B,{className:"h-3 w-3 ml-auto"})]})}),!s&&t.jsxs(n,{variant:"default",size:"sm",onClick:()=>(async e=>{D(e);try{await j(e),await A()}catch(s){}finally{D(null)}})(e.id),disabled:q===e.id,className:"gap-2 w-full",children:[t.jsx(S,{className:"h-4 w-4"}),q===e.id?"Setting...":"Set as Active"]})]}),t.jsxs(n,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this page?"))try{const{error:s}=await l.from("custom_pages").delete().eq("id",e);if(s)throw s;N.success("Page deleted successfully"),await A()}catch(s){N.error("Failed to delete page")}})(e.id),className:"gap-2 w-full text-destructive hover:text-destructive",children:[t.jsx(I,{className:"h-4 w-4"}),"Delete"]})]}),e.description&&t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description})]},e.id)})}),t.jsx(m,{open:E,onOpenChange:L,children:t.jsxs(u,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(h,{children:[t.jsx(p,{children:"Choose a Template"}),t.jsx(x,{children:"Start with a pre-built template or create a blank page"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4",children:[t.jsx(c,{className:"p-6 cursor-pointer hover:border-primary transition-colors",onClick:()=>$(null),children:t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"p-2 bg-gray-100 rounded",children:t.jsx(w,{className:"h-6 w-6"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Blank Page"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Start from scratch"})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground flex-1",children:"Create a completely custom page by adding blocks one at a time."})]})}),_.map(e=>t.jsx(c,{className:"p-6 cursor-pointer hover:border-primary transition-colors",onClick:()=>$(e.id),children:t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"p-2 bg-primary/10 rounded",children:t.jsx(z,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:e.name}),t.jsxs(d,{variant:"outline",className:"mt-1",children:[e.blocks.length," blocks"]})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground flex-1",children:e.description})]})},e.id))]})]})})]})}function U(){const{user:e,profile:l}=a(),[r,c]=s.useState(!0),[m,u]=s.useState(null),[h,p]=s.useState(!1),{page:x,selectedBlockId:S,isPreviewMode:C,isSaving:B,canUndo:z,canRedo:_,setPage:U,selectBlock:W,addBlockToPage:J,removeBlockFromPage:O,duplicatePageBlock:V,toggleBlockVisible:Q,undo:X,redo:Z,togglePreviewMode:ee,savePage:se,publishPage:te,updatePageMeta:ae}=i();s.useEffect(()=>{c(!x)},[x]),s.useEffect(()=>{x?.theme&&H(x.theme)},[x?.theme]),s.useEffect(()=>{if(!x||B)return;const e=setTimeout(async()=>{try{await se();u(new Date)}catch(e){N.error("Auto-save failed - please save manually")}},3e3);return()=>clearTimeout(e)},[x,B,se]);const ie=x?.blocks.find(e=>e.id===S),le=o();return r||!x?t.jsx("div",{className:"container mx-auto py-8",children:t.jsx(K,{})}):t.jsxs("div",{className:"flex h-screen bg-gray-50",children:[!C&&t.jsxs("div",{className:"w-64 bg-white border-r flex flex-col",children:[t.jsx("div",{className:"p-4 border-b",children:t.jsx("h2",{className:"font-semibold text-lg",children:"Add Blocks"})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:le.map(e=>t.jsx("button",{onClick:()=>J(e.type),className:"w-full p-3 text-left rounded-lg border hover:border-primary hover:bg-primary/5 transition-colors group",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(w,{className:"w-5 h-5 text-gray-400 group-hover:text-primary"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.name}),t.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]})},e.type))})]}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsxs("div",{className:"bg-white border-b p-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{U(null),c(!0)},children:[t.jsx(M,{className:"w-4 h-4 mr-2"}),"Back to Pages"]}),t.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),t.jsx(n,{variant:"outline",size:"sm",onClick:X,disabled:!z(),children:t.jsx(T,{className:"w-4 h-4"})}),t.jsx(n,{variant:"outline",size:"sm",onClick:Z,disabled:!_(),children:t.jsx(F,{className:"w-4 h-4"})}),t.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),t.jsx(g,{type:"text",value:x.title,onChange:e=>ae({title:e.target.value}),className:"w-64",placeholder:"Page Title"}),t.jsx(d,{variant:x.published?"default":"secondary",children:x.published?"Published":"Draft"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(n,{variant:"outline",size:"sm",onClick:ee,children:C?t.jsxs(t.Fragment,{children:[t.jsx(q,{className:"w-4 h-4 mr-2"}),"Edit"]}):t.jsxs(t.Fragment,{children:[t.jsx(P,{className:"w-4 h-4 mr-2"}),"Preview"]})}),t.jsxs("div",{className:"flex border rounded-md",children:[t.jsx(n,{variant:h?"ghost":"default",size:"sm",onClick:()=>p(!1),className:"rounded-r-none",title:"Desktop Preview",children:t.jsx(D,{className:"w-4 h-4"})}),t.jsx(n,{variant:h?"default":"ghost",size:"sm",onClick:()=>p(!0),className:"rounded-l-none",title:"Mobile Preview",children:t.jsx(E,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(n,{variant:"outline",size:"sm",onClick:async()=>{try{await se(),u(new Date),N.success("Page saved successfully!")}catch(e){N.error("Failed to save page")}},disabled:B,children:[t.jsx(L,{className:"w-4 h-4 mr-2"}),B?"Saving...":"Save"]}),m&&!B&&t.jsxs("span",{className:"text-xs text-gray-500",children:["Saved ",m.toLocaleTimeString()]})]}),t.jsxs(n,{size:"sm",onClick:async()=>{try{await te(),N.success("Page published successfully!")}catch(e){N.error("Failed to publish page")}},disabled:B,children:[t.jsx(k,{className:"w-4 h-4 mr-2"}),"Publish"]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:t.jsx("div",{className:"mx-auto rounded-lg shadow-lg min-h-full transition-all duration-300",style:{...R(x.theme),backgroundColor:x.theme.colors.background,color:x.theme.colors.text,fontFamily:`'${x.theme.fonts.body}', sans-serif`,maxWidth:h?"375px":"672px"},children:t.jsx("div",{className:"p-8",style:{display:"flex",flexDirection:"column",gap:"compact"===x.theme.spacing?"1rem":"spacious"===x.theme.spacing?"3rem":"2rem"},children:0===x.blocks.length?t.jsxs("div",{className:"text-center py-20 text-gray-500",children:[t.jsx(w,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),t.jsx("p",{className:"font-medium",children:"Your page is empty"}),t.jsx("p",{className:"text-sm mt-1",children:"Add blocks from the left sidebar to get started"})]}):x.blocks.map(e=>t.jsxs("div",{className:"relative group",children:[!C&&t.jsxs("div",{className:"absolute -left-12 top-0 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[t.jsx("button",{className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Drag to reorder",children:t.jsx(A,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>V(e.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:"Duplicate",children:t.jsx(Y,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>Q(e.id),className:"p-1 bg-white border rounded hover:bg-gray-50",title:e.visible?"Hide":"Show",children:e.visible?t.jsx(P,{className:"w-4 h-4"}):t.jsx($,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>O(e.id),className:"p-1 bg-white border rounded hover:bg-red-50 text-red-600",title:"Delete",children:t.jsx(I,{className:"w-4 h-4"})})]}),t.jsx(G,{block:e,isEditing:!C,isSelected:S===e.id,onSelect:()=>W(e.id),userId:x.userId})]},e.id))})})})]}),!C&&ie&&t.jsxs("div",{className:"w-80 bg-white border-l flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsx("h2",{className:"font-semibold text-lg",children:"Block Settings"}),t.jsx("p",{className:"text-sm text-gray-600",children:ie.type})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:t.jsxs(y,{defaultValue:"content",className:"w-full",children:[t.jsxs(f,{className:"grid w-full grid-cols-2",children:[t.jsx(b,{value:"content",children:"Content"}),t.jsx(b,{value:"style",children:"Style"})]}),t.jsxs(j,{value:"content",className:"space-y-4 mt-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(v,{children:"Block Type"}),t.jsx("p",{className:"text-sm text-gray-600 capitalize",children:ie.type})]}),t.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Block-specific settings will appear here"})]}),t.jsx(j,{value:"style",className:"space-y-4 mt-4",children:t.jsx("div",{className:"p-4 bg-gray-50 rounded text-sm text-gray-600",children:"Style settings coming soon"})})]})}),t.jsx("div",{className:"p-4 border-t",children:t.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>O(ie.id),children:[t.jsx(I,{className:"w-4 h-4 mr-2"}),"Delete Block"]})})]})]})}export{U as default};
