{"version":3,"file":"SSOCallback-CUqX2Bho.js","sources":["../../node_modules/lucide-react/dist/esm/icons/shield-alert.js","../../src/hooks/useSSO.ts","../../src/lib/url-validation.ts","../../src/components/auth/sso/SSOCallback.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.354.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ShieldAlert = createLucideIcon(\"ShieldAlert\", [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ],\n  [\"path\", { d: \"M12 8v4\", key: \"1got3b\" }],\n  [\"path\", { d: \"M12 16h.01\", key: \"1drbdi\" }]\n]);\n\nexport { ShieldAlert as default };\n//# sourceMappingURL=shield-alert.js.map\n","import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { edgeFunctions } from \"@/lib/edgeFunctions\";\nimport { useAuthStore } from \"@/stores/useAuthStore\";\n\nexport interface SSOConfig {\n  id: string;\n  organization_name: string;\n  organization_domain: string;\n  sso_provider: 'saml' | 'oidc' | 'azure_ad' | 'okta' | 'google_workspace';\n  saml_entity_id?: string;\n  saml_sso_url?: string;\n  saml_slo_url?: string;\n  saml_certificate?: string;\n  saml_metadata_url?: string;\n  oidc_client_id?: string;\n  oidc_issuer?: string;\n  oidc_authorization_endpoint?: string;\n  oidc_token_endpoint?: string;\n  oidc_userinfo_endpoint?: string;\n  oidc_jwks_uri?: string;\n  oidc_scopes?: string[];\n  attribute_mappings?: Record<string, string>;\n  allowed_groups?: string[];\n  default_role: 'user' | 'admin';\n  auto_provision_users: boolean;\n  active: boolean;\n  verified_at?: string;\n  last_used_at?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface SSOAuditLog {\n  id: string;\n  config_id: string;\n  user_id?: string;\n  event_type: string;\n  event_details: Record<string, unknown>;\n  ip_address?: string;\n  user_agent?: string;\n  created_at: string;\n}\n\nexport interface SSOInitiateResponse {\n  ssoAvailable: boolean;\n  provider?: string;\n  organizationName?: string;\n  authUrl?: string;\n  requestId?: string;\n  message?: string;\n}\n\nexport interface SSOCallbackResponse {\n  success: boolean;\n  userId?: string;\n  email?: string;\n  redirectUrl?: string;\n  error?: string;\n}\n\nexport function useSSO() {\n  const { user, session, role } = useAuthStore();\n  const queryClient = useQueryClient();\n  const isAdmin = role === 'admin';\n\n  // Fetch all SSO configs (admin only)\n  const {\n    data: ssoConfigs,\n    isLoading: isLoadingConfigs,\n    error: configsError,\n    refetch: refetchConfigs,\n  } = useQuery({\n    queryKey: [\"sso-configs\"],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\"enterprise_sso_config\")\n        .select(\"*\")\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n      return data as SSOConfig[];\n    },\n    enabled: isAdmin,\n  });\n\n  // Fetch SSO audit logs (admin only)\n  const {\n    data: auditLogs,\n    isLoading: isLoadingLogs,\n    refetch: refetchLogs,\n  } = useQuery({\n    queryKey: [\"sso-audit-logs\"],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\"sso_audit_logs\")\n        .select(\"*\")\n        .order(\"created_at\", { ascending: false })\n        .limit(100);\n\n      if (error) throw error;\n      return data as SSOAuditLog[];\n    },\n    enabled: isAdmin,\n  });\n\n  // Check if SSO is available for an email domain\n  const checkSSOAvailability = useMutation({\n    mutationFn: async (email: string): Promise<SSOInitiateResponse> => {\n      const response = await edgeFunctions.invoke(\"sso-initiate\", {\n        body: { email },\n      });\n\n      if (response.error) throw new Error(response.error.message);\n      return response.data as SSOInitiateResponse;\n    },\n  });\n\n  // Initiate SSO login\n  const initiateSSOLogin = useMutation({\n    mutationFn: async ({\n      email,\n      redirectUri,\n    }: {\n      email: string;\n      redirectUri?: string;\n    }): Promise<SSOInitiateResponse> => {\n      const response = await edgeFunctions.invoke(\"sso-initiate\", {\n        body: { email, redirectUri },\n      });\n\n      if (response.error) throw new Error(response.error.message);\n\n      const data = response.data as SSOInitiateResponse;\n\n      // Store the state/requestId in sessionStorage for CSRF validation\n      // This will be verified when the callback is received\n      if (data.requestId) {\n        sessionStorage.setItem('sso_oauth_state', data.requestId);\n        sessionStorage.setItem('sso_oauth_timestamp', Date.now().toString());\n      }\n\n      return data;\n    },\n  });\n\n  // Handle SSO callback\n  const handleSSOCallback = useMutation({\n    mutationFn: async (params: {\n      SAMLResponse?: string;\n      RelayState?: string;\n      code?: string;\n      state?: string;\n      error?: string;\n      error_description?: string;\n    }): Promise<SSOCallbackResponse> => {\n      const response = await edgeFunctions.invoke(\"sso-callback\", {\n        body: params,\n      });\n\n      if (response.error) throw new Error(response.error.message);\n      return response.data as SSOCallbackResponse;\n    },\n  });\n\n  // Create SSO config (admin only)\n  const createSSOConfig = useMutation({\n    mutationFn: async (config: Partial<SSOConfig>) => {\n      if (!user?.id) throw new Error(\"Not authenticated\");\n\n      const { data, error } = await supabase\n        .from(\"enterprise_sso_config\")\n        .insert({\n          ...config,\n          created_by: user.id,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data as SSOConfig;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"sso-configs\"] });\n    },\n  });\n\n  // Update SSO config (admin only)\n  const updateSSOConfig = useMutation({\n    mutationFn: async ({\n      id,\n      updates,\n    }: {\n      id: string;\n      updates: Partial<SSOConfig>;\n    }) => {\n      const { data, error } = await supabase\n        .from(\"enterprise_sso_config\")\n        .update(updates)\n        .eq(\"id\", id)\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data as SSOConfig;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"sso-configs\"] });\n    },\n  });\n\n  // Delete SSO config (admin only)\n  const deleteSSOConfig = useMutation({\n    mutationFn: async (id: string) => {\n      const { error } = await supabase\n        .from(\"enterprise_sso_config\")\n        .delete()\n        .eq(\"id\", id);\n\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"sso-configs\"] });\n    },\n  });\n\n  // Toggle SSO config active status\n  const toggleSSOConfig = useMutation({\n    mutationFn: async ({ id, active }: { id: string; active: boolean }) => {\n      const { data, error } = await supabase\n        .from(\"enterprise_sso_config\")\n        .update({ active })\n        .eq(\"id\", id)\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data as SSOConfig;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"sso-configs\"] });\n    },\n  });\n\n  // Get SSO config by domain\n  const getSSOConfigByDomain = async (\n    domain: string\n  ): Promise<SSOConfig | null> => {\n    const { data, error } = await supabase\n      .from(\"enterprise_sso_config\")\n      .select(\"*\")\n      .eq(\"organization_domain\", domain)\n      .eq(\"active\", true)\n      .single();\n\n    if (error) return null;\n    return data as SSOConfig;\n  };\n\n  /**\n   * Validate the OAuth state parameter to prevent CSRF attacks\n   * @param state - The state parameter received from the IdP callback\n   * @returns true if valid, throws error if invalid\n   */\n  const validateSSOState = (state: string | null): boolean => {\n    const storedState = sessionStorage.getItem('sso_oauth_state');\n    const storedTimestamp = sessionStorage.getItem('sso_oauth_timestamp');\n\n    // Clear stored state after validation attempt (one-time use)\n    sessionStorage.removeItem('sso_oauth_state');\n    sessionStorage.removeItem('sso_oauth_timestamp');\n\n    // State must match\n    if (!state || !storedState || state !== storedState) {\n      throw new Error('Invalid SSO state - possible CSRF attack detected');\n    }\n\n    // State must not be expired (15 minute timeout)\n    if (storedTimestamp) {\n      const elapsed = Date.now() - parseInt(storedTimestamp, 10);\n      const maxAge = 15 * 60 * 1000; // 15 minutes\n      if (elapsed > maxAge) {\n        throw new Error('SSO request expired - please try again');\n      }\n    }\n\n    return true;\n  };\n\n  /**\n   * Clear any stored SSO state (e.g., on logout or error)\n   */\n  const clearSSOState = () => {\n    sessionStorage.removeItem('sso_oauth_state');\n    sessionStorage.removeItem('sso_oauth_timestamp');\n  };\n\n  return {\n    // State\n    ssoConfigs,\n    auditLogs,\n    isLoading: isLoadingConfigs || isLoadingLogs,\n    error: configsError,\n    isAdmin,\n\n    // Auth Actions\n    checkSSOAvailability,\n    initiateSSOLogin,\n    handleSSOCallback,\n\n    // Admin Actions\n    createSSOConfig,\n    updateSSOConfig,\n    deleteSSOConfig,\n    toggleSSOConfig,\n    refetchConfigs,\n    refetchLogs,\n\n    // Utilities\n    getSSOConfigByDomain,\n    validateSSOState,\n    clearSSOState,\n  };\n}\n","/**\n * URL Validation Utilities - Frontend\n * Prevents open redirect vulnerabilities by validating redirect URLs\n */\n\n/**\n * Validate that a redirect URL is safe (same origin or whitelisted)\n * @param redirectUrl - The URL to validate\n * @param allowedDomains - Additional allowed domains (optional)\n * @returns boolean - true if URL is safe, false otherwise\n */\nexport function isValidRedirectUrl(\n  redirectUrl: string,\n  allowedDomains: string[] = []\n): boolean {\n  try {\n    const appUrl = import.meta.env.VITE_APP_URL || window.location.origin;\n\n    // Parse both URLs\n    const redirect = new URL(redirectUrl, window.location.origin);\n    const app = new URL(appUrl);\n\n    // Allow relative URLs (they start with /)\n    if (redirectUrl.startsWith('/') && !redirectUrl.startsWith('//')) {\n      return true;\n    }\n\n    // Check if same origin (protocol + hostname + port)\n    if (redirect.origin === app.origin || redirect.origin === window.location.origin) {\n      return true;\n    }\n\n    // Check against whitelist\n    const redirectHost = redirect.hostname.toLowerCase();\n    const allowedHosts = [\n      app.hostname.toLowerCase(),\n      window.location.hostname.toLowerCase(),\n      ...allowedDomains.map(d => d.toLowerCase()),\n    ];\n\n    return allowedHosts.some(allowed => {\n      // Exact match\n      if (redirectHost === allowed) return true;\n\n      // Subdomain match (e.g., allow \"*.agentbio.net\")\n      if (allowed.startsWith('*.')) {\n        const baseDomain = allowed.substring(2);\n        return redirectHost.endsWith('.' + baseDomain) || redirectHost === baseDomain;\n      }\n\n      return false;\n    });\n  } catch (error) {\n    // Invalid URL format\n    console.error('Invalid redirect URL format:', error);\n    return false;\n  }\n}\n\n/**\n * Sanitize a redirect URL, returning a safe default if invalid\n * @param redirectUrl - The URL to sanitize\n * @param defaultPath - Default path to use if URL is invalid\n * @param allowedDomains - Additional allowed domains (optional)\n * @returns string - Safe redirect URL\n */\nexport function sanitizeRedirectUrl(\n  redirectUrl: string | null | undefined,\n  defaultPath: string = '/dashboard',\n  allowedDomains: string[] = []\n): string {\n  // If no URL provided, use default\n  if (!redirectUrl) {\n    return defaultPath;\n  }\n\n  // Validate the URL\n  if (isValidRedirectUrl(redirectUrl, allowedDomains)) {\n    return redirectUrl;\n  }\n\n  // Invalid URL, return default\n  console.warn(`[Security] Invalid redirect URL blocked: ${redirectUrl}`);\n  return defaultPath;\n}\n","import { useEffect, useState } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { useSSO } from \"@/hooks/useSSO\";\nimport { useAuthStore } from \"@/stores/useAuthStore\";\nimport { sanitizeRedirectUrl } from \"@/lib/url-validation\";\nimport { Loader2, AlertCircle, CheckCircle, ShieldAlert } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport const SSOCallback = () => {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const { handleSSOCallback, validateSSOState, clearSSOState } = useSSO();\n  const { initialize } = useAuthStore();\n  const [status, setStatus] = useState<\"processing\" | \"success\" | \"error\" | \"csrf_error\">(\n    \"processing\"\n  );\n  const [error, setError] = useState(\"\");\n\n  useEffect(() => {\n    const processCallback = async () => {\n      try {\n        // Get parameters from URL\n        const SAMLResponse = searchParams.get(\"SAMLResponse\");\n        const RelayState = searchParams.get(\"RelayState\");\n        const code = searchParams.get(\"code\");\n        const state = searchParams.get(\"state\");\n        const errorParam = searchParams.get(\"error\");\n        const errorDescription = searchParams.get(\"error_description\");\n\n        // Handle OAuth errors\n        if (errorParam) {\n          clearSSOState();\n          throw new Error(errorDescription || errorParam);\n        }\n\n        if (!SAMLResponse && !code) {\n          clearSSOState();\n          throw new Error(\"Invalid SSO callback - missing required parameters\");\n        }\n\n        // CSRF Protection: Validate state parameter for OIDC flows\n        // Note: SAML flows use RelayState which is validated differently\n        if (code && state) {\n          try {\n            validateSSOState(state);\n          } catch (csrfError) {\n            setStatus(\"csrf_error\");\n            setError(csrfError instanceof Error ? csrfError.message : \"Security validation failed\");\n            return;\n          }\n        }\n\n        // Process callback\n        const result = await handleSSOCallback.mutateAsync({\n          SAMLResponse: SAMLResponse || undefined,\n          RelayState: RelayState || undefined,\n          code: code || undefined,\n          state: state || undefined,\n        });\n\n        if (result.success) {\n          setStatus(\"success\");\n\n          // If we have a redirect URL with magic link, navigate there\n          if (result.redirectUrl) {\n            // Validate redirect URL to prevent open redirect attacks (defense in depth)\n            const safeRedirectUrl = sanitizeRedirectUrl(\n              result.redirectUrl,\n              '/dashboard',\n              ['*.agentbio.net', 'localhost:8080', '127.0.0.1:8080']\n            );\n\n            // The redirect URL might be a magic link - let Supabase handle it\n            window.location.href = safeRedirectUrl;\n          } else {\n            // Re-initialize auth state and redirect to dashboard\n            await initialize();\n            setTimeout(() => {\n              navigate(\"/dashboard\", { replace: true });\n            }, 1500);\n          }\n        } else {\n          throw new Error(result.error || \"SSO authentication failed\");\n        }\n      } catch (err) {\n        console.error(\"SSO Callback Error:\", err);\n        setStatus(\"error\");\n        setError(\n          err instanceof Error ? err.message : \"An unexpected error occurred\"\n        );\n      }\n    };\n\n    processCallback();\n  }, [searchParams]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\n      <div className=\"w-full max-w-md text-center\">\n        {status === \"processing\" && (\n          <div className=\"space-y-4\">\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\n              <Loader2 className=\"w-8 h-8 text-blue-600 animate-spin\" />\n            </div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              Completing Sign In\n            </h2>\n            <p className=\"text-gray-600\">\n              Please wait while we verify your identity...\n            </p>\n          </div>\n        )}\n\n        {status === \"success\" && (\n          <div className=\"space-y-4\">\n            <div className=\"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n            </div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              Sign In Successful\n            </h2>\n            <p className=\"text-gray-600\">\n              Redirecting you to the dashboard...\n            </p>\n          </div>\n        )}\n\n        {status === \"csrf_error\" && (\n          <div className=\"space-y-4\">\n            <div className=\"mx-auto w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center\">\n              <ShieldAlert className=\"w-8 h-8 text-amber-600\" />\n            </div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              Security Check Failed\n            </h2>\n            <p className=\"text-amber-600\">{error}</p>\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 mt-4 text-left\">\n              <p className=\"text-sm text-amber-800\">\n                <strong>What happened?</strong>\n              </p>\n              <p className=\"text-sm text-amber-700 mt-1\">\n                This security check protects against cross-site request forgery attacks.\n                This can happen if:\n              </p>\n              <ul className=\"text-sm text-amber-700 mt-2 list-disc list-inside space-y-1\">\n                <li>The SSO request took too long (over 15 minutes)</li>\n                <li>You opened the login link in a different browser/tab</li>\n                <li>Your browser cleared session data</li>\n              </ul>\n            </div>\n            <div className=\"flex flex-col gap-2 pt-4\">\n              <Button onClick={() => navigate(\"/auth/login\")}>\n                Try Again\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {status === \"error\" && (\n          <div className=\"space-y-4\">\n            <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center\">\n              <AlertCircle className=\"w-8 h-8 text-red-600\" />\n            </div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              Sign In Failed\n            </h2>\n            <p className=\"text-red-600\">{error}</p>\n            <div className=\"flex flex-col gap-2 pt-4\">\n              <Button onClick={() => navigate(\"/auth/login\")}>\n                Try Again\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => navigate(\"/auth/login\")}\n              >\n                Back to Login\n              </Button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SSOCallback;\n"],"names":["ShieldAlert","createLucideIcon","useSSO","user","session","role","useAuthStore","queryClient","useQueryClient","isAdmin","ssoConfigs","isLoadingConfigs","configsError","refetchConfigs","useQuery","data","error","supabase","auditLogs","isLoadingLogs","refetchLogs","checkSSOAvailability","useMutation","email","response","edgeFunctions","initiateSSOLogin","redirectUri","handleSSOCallback","params","createSSOConfig","config","updateSSOConfig","id","updates","deleteSSOConfig","toggleSSOConfig","active","domain","state","storedState","storedTimestamp","elapsed","maxAge","isValidRedirectUrl","redirectUrl","allowedDomains","appUrl","redirect","app","redirectHost","d","allowed","baseDomain","sanitizeRedirectUrl","defaultPath","SSOCallback","navigate","useNavigate","searchParams","useSearchParams","validateSSOState","clearSSOState","initialize","status","setStatus","useState","setError","useEffect","SAMLResponse","RelayState","code","errorParam","errorDescription","csrfError","result","safeRedirectUrl","err","jsxs","jsx","Loader2","CheckCircle","Button","AlertCircle"],"mappings":"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","x_google_ignoreList":[0]}