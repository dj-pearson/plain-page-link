import{j as e}from"./ui-components-ClhKjEhW.js";import{i as t,j as s,a as r}from"./react-vendor-CmKLYqnR.js";import{u as i,C as a,a as l,b as n,c as o,d as c,B as m,L as d,I as u,T as x,s as h}from"./index-DbJL4fXl.js";import{L as p}from"./LoadingSpinner-Df_-rbx5.js";import{H as j,u as f,i as y,a0 as g}from"./icons--vfrx8Ku.js";import"./three-DMNeqvYw.js";import"./charts-D6IDAGAX.js";import"./utils-CwVVV8W2.js";import"./data-DkeJbMsV.js";import"./supabase-Bu2D04vJ.js";import"./forms-BQFHsYzL.js";function v(){const{username:v}=t(),b=s(),{toast:w}=i(),[_,N]=r.useState(null),[S,F]=r.useState(!0),[C,T]=r.useState(!1),[k,Y]=r.useState(!1),[E,L]=r.useState(0),[P,q]=r.useState(0),[B,H]=r.useState({client_name:"",client_email:"",client_title:"",review:"",property_type:"",transaction_type:"buyer"});r.useEffect(()=>{v&&(async()=>{try{const{data:e,error:t}=await h.from("profiles").select("id, full_name, avatar_url, bio").eq("username",v).single();if(t)throw t;N(e)}catch(e){w({title:"Agent not found",description:"The agent profile could not be found.",variant:"destructive"})}finally{F(!1)}})()},[v,w]);return S?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center",children:e.jsx(p,{size:"lg"})}):_?k?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(a,{className:"w-full max-w-md",children:[e.jsxs(l,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"w-10 h-10 text-green-600"})})}),e.jsx(n,{className:"text-2xl",children:"Thank You!"}),e.jsxs(o,{className:"text-base mt-2",children:["Your review has been submitted successfully. ",_.full_name," will be notified and may feature your testimonial on their profile."]})]}),e.jsx(c,{children:e.jsxs(m,{onClick:()=>b(`/${v}`),className:"w-full",variant:"outline",children:["View ",_.full_name,"'s Profile"]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-12 px-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(a,{children:[e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[_.avatar_url&&e.jsx("img",{src:_.avatar_url,alt:_.full_name,className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx(n,{className:"text-2xl",children:"Share Your Experience"}),e.jsxs(o,{className:"text-base",children:["Leave a review for ",_.full_name]})]})]}),_.bio&&e.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',_.bio,'"']})]}),e.jsx(c,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),0!==E){T(!0);try{const{error:e}=await h.from("testimonials").insert({user_id:_.id,client_name:B.client_name,client_title:B.client_title||"",rating:E,review:B.review,property_type:B.property_type||"",transaction_type:B.transaction_type,date:(new Date).toISOString()});if(e)throw e;Y(!0),w({title:"Review submitted!",description:`Thank you for sharing your experience with ${_.full_name}!`})}catch(t){w({title:"Submission failed",description:"There was an error submitting your review. Please try again.",variant:"destructive"})}finally{T(!1)}}else w({title:"Rating required",description:"Please select a star rating.",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-base font-semibold mb-3 block",children:"How would you rate your experience? *"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>L(t),onMouseEnter:()=>q(t),onMouseLeave:()=>q(0),className:"transition-transform hover:scale-110",children:e.jsx(y,{className:"w-10 h-10 "+(t<=(P||E)?"fill-yellow-400 text-yellow-400":"text-gray-300")})},t))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:E>0&&e.jsx("span",{className:"text-blue-600 font-medium",children:5===E?"Excellent!":4===E?"Great!":3===E?"Good":2===E?"Fair":"Poor"})})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"client_name",children:"Your Name *"}),e.jsx(u,{id:"client_name",value:B.client_name,onChange:e=>H({...B,client_name:e.target.value}),placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"client_email",children:"Your Email *"}),e.jsx(u,{id:"client_email",type:"email",value:B.client_email,onChange:e=>H({...B,client_email:e.target.value}),placeholder:"john@example.com",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Your email won't be published, it's for verification only."})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"client_title",children:"Title/Occupation (Optional)"}),e.jsx(u,{id:"client_title",value:B.client_title,onChange:e=>H({...B,client_title:e.target.value}),placeholder:"e.g., First-time Homebuyer, Real Estate Investor"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:B.transaction_type,onChange:e=>H({...B,transaction_type:e.target.value}),className:"w-full px-3 py-2 border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"both",children:"Both (Buyer & Seller)"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"property_type",children:"Property Type (Optional)"}),e.jsx(u,{id:"property_type",value:B.property_type,onChange:e=>H({...B,property_type:e.target.value}),placeholder:"e.g., Single Family Home, Condo, Townhouse"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"review",children:"Your Review *"}),e.jsx(x,{id:"review",value:B.review,onChange:e=>H({...B,review:e.target.value}),placeholder:"Share your experience working with this agent...",rows:6,required:!0,className:"resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please be specific about what made your experience positive."})]}),e.jsx(m,{type:"submit",disabled:C||0===E,className:"w-full",size:"lg",children:C?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",className:"mr-2"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Submit Review"]})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["By submitting this review, you agree that it may be displayed publicly on ",_.full_name,"'s profile page."]})]})})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(a,{className:"w-full max-w-md",children:[e.jsxs(l,{className:"text-center",children:[e.jsx(n,{className:"text-2xl",children:"Agent Not Found"}),e.jsx(o,{children:"The agent profile you're looking for doesn't exist."})]}),e.jsx(c,{children:e.jsxs(m,{onClick:()=>b("/"),className:"w-full",children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Go to Homepage"]})})]})})}export{v as default};
