import{j as e}from"./ui-vendor-DfpuNOa7.js";import{b as V,L as K}from"./react-vendor-ctj0ExSI.js";import{a0 as U,C as f,a as b,b as v,N as L,d as w,c as k,B as j,U as P,M as _,$ as M,G as S,aI as E,aJ as F,aK as q,a4 as I,e as z,u as O,J as Y,ad as G,a3 as H,w as W,j as J,R as X,V as Q}from"./index-ChZTfseL.js";import{R as Z,L as ee,a as se,B as te,b as ae,A as ie,d as re,C as ne,X as le,Y as oe,T as ce,e as de}from"./charts-vendor-DGVahL1I.js";import{T as me,a as xe,b as T,c as y,d as he,e as g}from"./table-BGgRRZHp.js";import{S as pe}from"./SearchAnalyticsDashboard-D-2TW0wW.js";import{L as R}from"./lightbulb-gL2xIXVE.js";import{A as ue}from"./arrow-right-wWOLRogr.js";import{T as ge,a as je,b as $,c as D}from"./tabs-C7rAKPjQ.js";import{a as ye}from"./skeleton-DzXVHwz8.js";import{D as fe,a as be,b as ve,c as A}from"./dropdown-menu-BzmyVmpD.js";import{u as we}from"./useAnalytics-BRoF8NCy.js";import"./supabase-GsKtvycU.js";import"./three-vendor-BsISVfAm.js";import"./state-vendor-BElgh7Si.js";import"./date-vendor-Xm6TBh54.js";import"./form-vendor-Ce9oe0_k.js";import"./animation-vendor-OAo91Cux.js";import"./circle-x-D4H2Ku3s.js";import"./mouse-pointer-xOdcwssI.js";import"./file-text-Bppdu57h.js";import"./trending-down-DXVBOGjg.js";import"./minus-Clae-M4V.js";import"./popover-CyTqRhtO.js";import"./checkbox-er1Ftalr.js";import"./filter-C2J43EtA.js";import"./exportUtils-dP2nAW1h.js";import"./export-vendor-BbAValdh.js";import"./refresh-cw-C0A3Mddp.js";import"./settings-B133Eh4J.js";const Ne=U("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function C({title:n,value:l,change:t,changeLabel:c="vs last period",icon:i,iconColor:d="text-blue-600",iconBgColor:m="bg-blue-100",trend:o="neutral"}){const x=o==="up"?"text-green-600":o==="down"?"text-red-600":"text-gray-600",a=o==="up"?"↑":o==="down"?"↓":"•";return e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:n}),e.jsx("div",{className:L("rounded-full p-2",m),children:e.jsx(i,{className:L("h-4 w-4",d)})})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l}),t!==void 0&&e.jsxs("p",{className:L("text-xs font-medium mt-1",x),children:[a," ",Math.abs(t),"% ",c]})]})]})}function Ce({title:n,description:l,data:t,series:c,type:i="line",height:d=300,showLegend:m=!0,yAxisLabel:o}){const x=()=>{const a={data:t,margin:{top:5,right:20,left:0,bottom:5}},r=e.jsxs(e.Fragment,{children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(le,{dataKey:"name",tick:{fontSize:12},tickLine:!1,axisLine:!1}),e.jsx(oe,{tick:{fontSize:12},tickLine:!1,axisLine:!1,label:o?{value:o,angle:-90,position:"insideLeft"}:void 0}),e.jsx(ce,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px"}}),m&&e.jsx(de,{})]});switch(i){case"area":return e.jsxs(ie,{...a,children:[r,c.map(s=>e.jsx(re,{type:"monotone",dataKey:s.dataKey,name:s.name,stroke:s.color,fill:s.color,fillOpacity:.2,strokeWidth:2},s.dataKey))]});case"bar":return e.jsxs(te,{...a,children:[r,c.map(s=>e.jsx(ae,{dataKey:s.dataKey,name:s.name,fill:s.color,radius:[4,4,0,0]},s.dataKey))]});case"line":default:return e.jsxs(ee,{...a,children:[r,c.map(s=>e.jsx(se,{type:"monotone",dataKey:s.dataKey,name:s.name,stroke:s.color,strokeWidth:2,dot:{r:4},activeDot:{r:6}},s.dataKey))]})}};return e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(v,{children:n}),l&&e.jsx(k,{children:l})]}),e.jsx(w,{children:e.jsx(Z,{width:"100%",height:d,children:x()})})]})}function ke({leads:n,onLeadClick:l}){const[t,c]=V.useState("created_at"),[i,d]=V.useState("desc"),m=s=>{t===s?d(i==="asc"?"desc":"asc"):(c(s),d("desc"))},o=[...n].sort((s,h)=>{let p=0;switch(t){case"created_at":p=new Date(s.created_at).getTime()-new Date(h.created_at).getTime();break;case"name":p=s.name.localeCompare(h.name);break;case"lead_type":p=s.lead_type.localeCompare(h.lead_type);break;case"status":p=s.status.localeCompare(h.status);break}return i==="asc"?p:-p}),x=({field:s})=>t!==s?null:i==="asc"?e.jsx(F,{className:"inline w-4 h-4 ml-1"}):e.jsx(q,{className:"inline w-4 h-4 ml-1"}),a=s=>{switch(s){case"new":return"bg-blue-100 text-blue-800";case"contacted":return"bg-yellow-100 text-yellow-800";case"qualified":return"bg-green-100 text-green-800";case"converted":return"bg-purple-100 text-purple-800";case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},r=s=>{switch(s){case"buyer":return"Buyer";case"seller":return"Seller";case"valuation":return"Valuation";case"contact":return"Contact";default:return s}};return e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(v,{children:"Recent Leads"}),e.jsxs(k,{children:["Your latest lead submissions (",n.length," total)"]})]}),e.jsx(w,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(me,{children:[e.jsx(xe,{children:e.jsxs(T,{children:[e.jsx(y,{children:e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>m("name"),className:"hover:bg-transparent",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Name",e.jsx(x,{field:"name"})]})}),e.jsx(y,{children:"Contact"}),e.jsx(y,{children:e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>m("lead_type"),className:"hover:bg-transparent",children:["Type",e.jsx(x,{field:"lead_type"})]})}),e.jsx(y,{children:e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>m("status"),className:"hover:bg-transparent",children:["Status",e.jsx(x,{field:"status"})]})}),e.jsx(y,{children:e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>m("created_at"),className:"hover:bg-transparent",children:["Date",e.jsx(x,{field:"created_at"})]})}),e.jsx(y,{className:"text-right",children:"Actions"})]})}),e.jsx(he,{children:o.length===0?e.jsx(T,{children:e.jsx(g,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No leads yet. They'll appear here when visitors submit forms."})}):o.map(s=>e.jsxs(T,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>l?.(s),children:[e.jsx(g,{className:"font-medium",children:s.name}),e.jsx(g,{children:e.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[e.jsxs("a",{href:`mailto:${s.email}`,className:"flex items-center text-blue-600 hover:underline",onClick:h=>h.stopPropagation(),children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),s.email]}),s.phone&&e.jsxs("a",{href:`tel:${s.phone}`,className:"flex items-center text-blue-600 hover:underline",onClick:h=>h.stopPropagation(),children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),s.phone]})]})}),e.jsx(g,{children:e.jsx(S,{variant:"outline",children:r(s.lead_type)})}),e.jsx(g,{children:e.jsx(S,{className:a(s.status),children:s.status})}),e.jsx(g,{className:"text-sm text-muted-foreground",children:E(s.created_at)}),e.jsx(g,{className:"text-right",children:e.jsx(j,{variant:"ghost",size:"sm",onClick:h=>{h.stopPropagation(),l?.(s)},children:"View"})})]},s.id))})]})})})]})}function Le({stats:n,previousStats:l,listingsCount:t=0,linksCount:c=0}){const i=[],d=l?(n.totalViews-l.totalViews)/(l.totalViews||1)*100:0,m=l?(n.totalLeads-l.totalLeads)/(l.totalLeads||1)*100:0;d>20&&i.push({id:"views-growth",type:"positive",title:`Profile views up ${d.toFixed(0)}%`,description:"Your profile is getting great visibility! Keep sharing your link on social media."}),m>15&&i.push({id:"leads-growth",type:"positive",title:`Leads increased ${m.toFixed(0)}%`,description:"Your lead generation is accelerating. Make sure to respond quickly to maintain momentum.",action:{label:"Check leads",href:"/dashboard/leads"}}),n.conversionRate>5&&i.push({id:"high-conversion",type:"positive",title:`Strong ${n.conversionRate}% conversion rate`,description:"You're converting visitors to leads at an excellent rate!"}),n.totalViews>100&&n.conversionRate<2&&i.push({id:"low-conversion",type:"warning",title:"Conversion rate could be higher",description:"You're getting views but not many leads. Try adding clear call-to-action buttons.",action:{label:"Add CTAs",href:"/dashboard/links"}}),n.totalViews<50&&t>0&&i.push({id:"low-traffic",type:"warning",title:"Profile needs more visibility",description:"Share your profile link on Instagram, Facebook, and email signatures to increase traffic."}),t===0?i.push({id:"no-listings",type:"warning",title:"Add your first listing",description:"Profiles with property listings get 3x more leads. Showcase what you're selling!",action:{label:"Add listing",href:"/dashboard/listings"}}):t<3&&i.push({id:"few-listings",type:"tip",title:"Add more listings",description:"Agents with 5+ listings convert 40% better. Add more properties to build credibility.",action:{label:"Add listings",href:"/dashboard/listings"}}),c===0&&i.push({id:"no-links",type:"tip",title:"Add custom links",description:"Link to your website, calendar, and social media to give visitors more ways to connect.",action:{label:"Add links",href:"/dashboard/links"}}),n.totalViews>0&&n.totalLeads===0&&i.push({id:"no-leads-yet",type:"tip",title:"First lead tips",description:"Add contact forms, showcase testimonials, and ensure your phone/email are visible.",action:{label:"Edit profile",href:"/dashboard/profile"}}),d<-20&&i.push({id:"views-declining",type:"warning",title:`Views down ${Math.abs(d).toFixed(0)}%`,description:"Increase your social media activity and consider updating your listings to boost visibility."}),i.length===0&&i.push({id:"keep-going",type:"positive",title:"You're doing great!",description:"Keep your profile updated with fresh listings and share it regularly to maintain growth."});const o=a=>{switch(a){case"positive":return e.jsx(z,{className:"w-5 h-5 text-green-600"});case"warning":return e.jsx(I,{className:"w-5 h-5 text-orange-600"});case"tip":return e.jsx(R,{className:"w-5 h-5 text-blue-600"})}},x=a=>{switch(a){case"positive":return"bg-green-50 border-green-200";case"warning":return"bg-orange-50 border-orange-200";case"tip":return"bg-blue-50 border-blue-200"}};return e.jsxs(f,{children:[e.jsx(b,{className:"pb-3",children:e.jsxs(v,{className:"text-lg flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-primary"}),"Insights & Recommendations"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:i.slice(0,5).map(a=>e.jsx("div",{className:`p-4 rounded-lg border ${x(a.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:o(a.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm mb-1",children:a.title}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:a.description}),a.action&&e.jsxs(K,{to:a.action.href,className:"inline-flex items-center gap-1 text-sm font-medium text-blue-600 hover:text-blue-700",children:[a.action.label,e.jsx(ue,{className:"w-4 h-4"})]})]})]})},a.id))})})]})}function as(){const[n,l]=V.useState("30d"),{stats:t,viewsData:c,leadsData:i,recentLeads:d,isLoading:m}=we(n),{toast:o}=O(),x=()=>{if(t.totalViews===0&&t.totalLeads===0){o({title:"No data to export",description:"There's no analytics data for the selected time period.",variant:"destructive"});return}const a=n==="7d"?"7 days":n==="30d"?"30 days":"90 days",r=[];r.push("Analytics Summary"),r.push(`Date Range,Last ${a}`),r.push(`Export Date,${new Date().toLocaleDateString()}`),r.push(""),r.push("Key Metrics"),r.push("Metric,Value"),r.push(`Total Views,${t.totalViews}`),r.push(`Unique Visitors,${t.uniqueVisitors}`),r.push(`Total Leads,${t.totalLeads}`),r.push(`Conversion Rate,${t.conversionRate}%`),r.push(""),c.length>0&&(r.push("Views Over Time"),r.push("Date,Views,Visitors"),c.forEach(u=>{r.push(`${u.name},${u.views},${u.visitors}`)}),r.push("")),i.length>0&&(r.push("Leads by Type"),r.push("Type,Count,Percentage"),i.forEach(u=>{const B=t.totalLeads>0?(u.value/t.totalLeads*100).toFixed(1):"0";r.push(`${u.name},${u.value},${B}%`)}));const s=r.join(`
`),h=new Blob([s],{type:"text/csv"}),p=URL.createObjectURL(h),N=document.createElement("a");N.href=p,N.download=`analytics-${n}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(p),o({title:"Analytics exported",description:`Successfully exported analytics data for the last ${a}`})};return m?e.jsx(ye,{}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Analytics"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Track your profile performance, lead generation, and search visibility"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(fe,{children:[e.jsx(be,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",className:"flex-1 sm:flex-none",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs sm:text-sm",children:n==="7d"?"Last 7 days":n==="30d"?"Last 30 days":"Last 90 days"})]})}),e.jsxs(ve,{align:"end",children:[e.jsx(A,{onClick:()=>l("7d"),children:"Last 7 days"}),e.jsx(A,{onClick:()=>l("30d"),children:"Last 30 days"}),e.jsx(A,{onClick:()=>l("90d"),children:"Last 90 days"})]})]}),e.jsxs(j,{variant:"outline",size:"sm",className:"flex-1 sm:flex-none",onClick:x,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Export"})]})]})]}),e.jsxs(ge,{defaultValue:"overview",className:"space-y-4 sm:space-y-6",children:[e.jsxs(je,{className:"grid w-full grid-cols-2 sm:w-auto",children:[e.jsxs($,{value:"overview",className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Profile Analytics"}),e.jsx("span",{className:"sm:hidden",children:"Overview"})]}),e.jsxs($,{value:"search",className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Search Analytics"}),e.jsx("span",{className:"sm:hidden",children:"Search"})]})]}),e.jsxs(D,{value:"overview",className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx(C,{title:"Total Views",value:t.totalViews.toLocaleString(),icon:J,iconColor:"text-blue-600",iconBgColor:"bg-blue-100"}),e.jsx(C,{title:"Unique Visitors",value:t.uniqueVisitors.toLocaleString(),icon:X,iconColor:"text-green-600",iconBgColor:"bg-green-100"}),e.jsx(C,{title:"Total Leads",value:t.totalLeads,icon:Ne,iconColor:"text-purple-600",iconBgColor:"bg-purple-100"}),e.jsx(C,{title:"Conversion Rate",value:`${t.conversionRate}%`,icon:Q,iconColor:"text-orange-600",iconBgColor:"bg-orange-100"})]}),e.jsx(Le,{stats:t,listingsCount:0,linksCount:0}),e.jsx(Ce,{title:"Profile Views",description:"Views and unique visitors over time",data:c.length>0?c:[{name:"No data",views:0,visitors:0}],series:[{dataKey:"views",name:"Total Views",color:"#3B82F6"},{dataKey:"visitors",name:"Unique Visitors",color:"#10B981"}],type:"area",height:window.innerWidth<640?200:300}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs(f,{children:[e.jsxs(b,{className:"pb-3 sm:pb-4",children:[e.jsx(v,{className:"text-base sm:text-lg",children:"Leads by Type"}),e.jsx(k,{className:"text-xs sm:text-sm",children:"Distribution of lead inquiries"})]}),e.jsx(w,{children:i.length>0?e.jsx("div",{className:"space-y-2 sm:space-y-3",children:i.map(a=>e.jsxs("div",{className:"flex items-center justify-between py-2 min-h-[44px]",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap",children:[a.value," leads"]}),e.jsxs("span",{className:"text-xs sm:text-sm font-semibold min-w-[35px] text-right",children:[t.totalLeads>0?(a.value/t.totalLeads*100).toFixed(0):0,"%"]})]})]},a.name))}):e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center py-6 sm:py-8",children:"No leads yet"})})]}),e.jsxs(f,{children:[e.jsxs(b,{className:"pb-3 sm:pb-4",children:[e.jsx(v,{className:"text-base sm:text-lg",children:"Recent Activity"}),e.jsx(k,{className:"text-xs sm:text-sm",children:"Latest profile interactions"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground text-center py-6 sm:py-8",children:t.totalViews>0?`${t.totalViews} profile views`:"No activity yet"})})]})]}),e.jsx(ke,{leads:d,onLeadClick:a=>console.log("Lead clicked:",a)})]}),e.jsx(D,{value:"search",className:"space-y-4 sm:space-y-6",children:e.jsx(pe,{})})]})]})}export{as as default};
