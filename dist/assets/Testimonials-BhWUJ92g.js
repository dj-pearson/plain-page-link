import{r as h,j as e,Q as E,R,T as U,V as q,a3 as M,a4 as c,I as j,W as T,a5 as k,a6 as P,a7 as L,B as b,aT as I,s as S}from"./index-CH8a_jH7.js";import{U as B}from"./upload-BKMneLgQ.js";import{u as O}from"./use-toast-DTZfmZso.js";import{u as H}from"./useTestimonials-BUoBglby.js";import{u as J,U as G}from"./UpgradeModal-BhpG-LVi.js";import{L as Q}from"./LimitBanner-CSFLGViX.js";import{P as F}from"./plus-mX94DPLf.js";import{S as Y}from"./square-pen-WI1F4rAb.js";import{T as $}from"./trash-2-D7F6DUix.js";import"./useMutation-DQof0gk2.js";import"./alert-CfHcFOLv.js";import"./progress-DgRiG04T.js";import"./triangle-alert-BMXRUX3N.js";function z({open:f,onOpenChange:m,onSave:i}){const[a,s]=h.useState({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),[n,o]=h.useState(null),t=l=>{const{name:d,value:g}=l.target;s(x=>({...x,[d]:g}))},y=l=>{var g;const d=(g=l.target.files)==null?void 0:g[0];if(d){s(w=>({...w,clientPhoto:d}));const x=new FileReader;x.onloadend=()=>{o(x.result)},x.readAsDataURL(d)}},N=()=>{s(l=>({...l,clientPhoto:void 0})),o(null)},p=l=>{l.preventDefault(),i==null||i(a),m(!1),s({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),o(null)};return e.jsx(E,{open:f,onOpenChange:m,children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsx(q,{children:"Add Client Testimonial"}),e.jsx(M,{children:"Share feedback from satisfied clients to build credibility"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(j,{id:"clientName",name:"clientName",value:a.clientName,onChange:t,placeholder:"John Smith",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'You can use initials for privacy (e.g., "John S.")'})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"propertyType",children:"Property Type *"}),e.jsx(j,{id:"propertyType",name:"propertyType",value:a.propertyType,onChange:t,placeholder:"Single Family Home, Condo, etc.",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",onClick:()=>s(d=>({...d,rating:l})),className:"focus:outline-none",children:e.jsx(T,{className:`h-8 w-8 transition-colors ${l<=a.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},l))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"review",children:"Testimonial Text *"}),e.jsx(k,{id:"review",name:"review",value:a.review,onChange:t,rows:6,maxLength:500,placeholder:"Share what the client said about working with you...",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[a.review.length,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Client Photo (Optional)"}),n?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:n,alt:"Client preview",className:"w-24 h-24 rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:N,className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full",children:e.jsx(P,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:y,className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx(B,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload client photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 2MB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"featured",checked:a.featured,onChange:l=>s(d=>({...d,featured:l.target.checked})),className:"rounded border-border"}),e.jsx(c,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this testimonial on my profile"})]}),e.jsxs(L,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(b,{type:"submit",children:"Add Testimonial"})]})]})]})})}function V({isOpen:f,onClose:m,onSubmit:i,initialData:a}){const[s,n]=h.useState(a);if(h.useEffect(()=>{n(a)},[a]),!f)return null;const o=t=>{t.preventDefault(),i(s)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Testimonial"}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"client_name",children:"Client Name *"}),e.jsx(j,{id:"client_name",value:s.client_name,onChange:t=>n({...s,client_name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"client_title",children:"Client Title"}),e.jsx(j,{id:"client_title",value:s.client_title||"",onChange:t=>n({...s,client_title:t.target.value}),placeholder:"e.g., First-Time Homebuyer"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"rating",children:"Rating *"}),e.jsx(j,{id:"rating",type:"number",min:"1",max:"5",value:s.rating,onChange:t=>n({...s,rating:parseInt(t.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"review",children:"Review *"}),e.jsx(k,{id:"review",value:s.review,onChange:t=>n({...s,review:t.target.value}),rows:6,required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"property_type",children:"Property Type"}),e.jsx(j,{id:"property_type",value:s.property_type||"",onChange:t=>n({...s,property_type:t.target.value}),placeholder:"e.g., Single Family Home"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:s.transaction_type||"",onChange:t=>n({...s,transaction_type:t.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:m,className:"flex-1",children:"Cancel"}),e.jsx(b,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function de(){const[f,m]=h.useState(!1),[i,a]=h.useState(null),[s,n]=h.useState(!1),{toast:o}=O(),{testimonials:t,addTestimonial:y,deleteTestimonial:N}=H(),{subscription:p,canAdd:l,getLimit:d,getUsage:g}=J(),x=()=>{if(!l("testimonials")){n(!0);return}m(!0)},w=async r=>{try{await y.mutateAsync(r),o({title:"Testimonial added!",description:"Client review has been added successfully."}),m(!1)}catch{o({title:"Error",description:"Failed to add testimonial. Please try again.",variant:"destructive"})}},A=async r=>{if(confirm("Are you sure you want to delete this testimonial?"))try{await N.mutateAsync(r),o({title:"Testimonial deleted",description:"Client review has been removed."})}catch{o({title:"Error",description:"Failed to delete testimonial.",variant:"destructive"})}},D=async r=>{if(i)try{const{data:{user:u}}=await S.auth.getUser();if(!u)throw new Error("Not authenticated");const{error:v}=await S.from("testimonials").update({client_name:r.client_name,client_title:r.client_title,rating:r.rating,review:r.review,property_type:r.property_type,transaction_type:r.transaction_type,updated_at:new Date().toISOString()}).eq("id",i.id).eq("user_id",u.id);if(v)throw v;o({title:"Testimonial updated!",description:"Client review has been updated successfully."}),a(null),window.location.reload()}catch{o({title:"Error",description:"Failed to update testimonial. Please try again.",variant:"destructive"})}},_=t.length>0?(t.reduce((r,u)=>r+u.rating,0)/t.length).toFixed(1):"0.0",C=r=>e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((u,v)=>e.jsx(T,{className:`h-4 w-4 ${v<r?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},v))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Testimonials"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Showcase client reviews and success stories"})]}),e.jsxs("button",{onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(F,{className:"h-4 w-4"}),"Add Testimonial"]})]}),p&&d("testimonials")!==1/0&&e.jsx(Q,{feature:"testimonials",current:g("testimonials"),limit:d("testimonials")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:_}),e.jsx("div",{className:"flex",children:C(Math.round(parseFloat(_)))})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Rating"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.map(r=>e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-shadow relative",children:[e.jsx("div",{className:"mb-4",children:e.jsx(I,{className:"h-8 w-8 text-primary opacity-20"})}),e.jsxs("p",{className:"text-foreground mb-6 leading-relaxed",children:['"',r.review,'"']}),e.jsx("div",{className:"mb-4",children:C(r.rating)}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold",children:r.client_name.split(" ").map(u=>u[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:r.client_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.property_type||"Client"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>a(r),className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("button",{onClick:()=>A(r.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx($,{className:"h-4 w-4 text-red-500"})})]})]})]},r.id))}),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-accent rounded-full mb-4",children:e.jsx(T,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No testimonials yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Start building social proof by adding client reviews"}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(F,{className:"h-5 w-5"}),"Add Your First Testimonial"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Featured testimonials will be prominently displayed on your public profile. Ask satisfied clients for reviews after successful transactions!"]})}),e.jsx(z,{open:f,onOpenChange:m,onSave:w}),i&&e.jsx(V,{isOpen:!!i,onClose:()=>a(null),onSubmit:D,initialData:{client_name:i.client_name,review:i.review,rating:i.rating,client_title:i.client_title,property_type:i.property_type,transaction_type:i.transaction_type}}),e.jsx(G,{open:s,onOpenChange:n,feature:"testimonials",currentPlan:(p==null?void 0:p.plan_name)||"Free",requiredPlan:"Starter"})]})}export{de as default};
