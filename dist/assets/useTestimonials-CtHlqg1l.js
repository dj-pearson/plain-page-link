import{b as y,u as p,c as n}from"./data-15YcDnrk.js";import{s as o}from"./supabase-Ba7v9dZh.js";import{u as T}from"./state-stores-BuSRU7CA.js";import{u as h}from"./index-sCAK2lXW.js";function E(){const{user:t}=T(),a=y(),{toast:s}=h(),{data:u=[],isLoading:l}=p({queryKey:["testimonials",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:e,error:i}=await o.from("testimonials").select("*").eq("user_id",t.id).order("date",{ascending:!1});if(i)throw i;return e},enabled:!!t?.id}),c=n({mutationFn:async e=>{if(!t?.id)throw new Error("User not authenticated");const{data:i,error:r}=await o.from("testimonials").insert({user_id:t.id,...e}).select().single();if(r)throw r;return i},onSuccess:()=>{a.invalidateQueries({queryKey:["testimonials",t?.id]}),s({title:"Testimonial Added",description:"Your testimonial has been added successfully."})},onError:e=>{s({title:"Failed to Add Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),m=n({mutationFn:async({id:e,...i})=>{const{data:r,error:d}=await o.from("testimonials").update(i).eq("id",e).select().single();if(d)throw d;return r},onSuccess:()=>{a.invalidateQueries({queryKey:["testimonials",t?.id]}),s({title:"Testimonial Updated",description:"Your testimonial has been updated successfully."})},onError:e=>{s({title:"Failed to Update Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),f=n({mutationFn:async e=>{const{error:i}=await o.from("testimonials").delete().eq("id",e);if(i)throw i},onSuccess:()=>{a.invalidateQueries({queryKey:["testimonials",t?.id]}),s({title:"Testimonial Deleted",description:"Your testimonial has been deleted successfully."})},onError:e=>{s({title:"Failed to Delete Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}});return{testimonials:u,isLoading:l,addTestimonial:c,updateTestimonial:m,deleteTestimonial:f}}export{E as u};
