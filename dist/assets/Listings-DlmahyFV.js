import{F as z,r as p,j as e,Q as I,R as E,T as U,V,a3 as O,a4 as a,I as o,i as y,k as N,l as w,m as C,n as c,a5 as A,a6 as k,a7 as R,B as S,h as Y,s as D}from"./index-CH8a_jH7.js";import{U as Q}from"./upload-BKMneLgQ.js";import{u as $}from"./use-toast-DTZfmZso.js";import{u as G}from"./useListings-C4-OD926.js";import{u as H,U as J}from"./UpgradeModal-BhpG-LVi.js";import{L as X}from"./LimitBanner-CSFLGViX.js";import{P}from"./plus-mX94DPLf.js";import{S as Z}from"./square-pen-WI1F4rAb.js";import{T as K}from"./trash-2-D7F6DUix.js";import"./useMutation-DQof0gk2.js";import"./alert-CfHcFOLv.js";import"./progress-DgRiG04T.js";import"./triangle-alert-BMXRUX3N.js";/**
 * @license lucide-react v0.354.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=z("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function ee({open:v,onOpenChange:x,onSave:g}){const[l,s]=p.useState({address:"",city:"",state:"",zipCode:"",price:"",beds:3,baths:2,sqft:"",lotSize:"",propertyType:"single-family",status:"active",description:"",mlsNumber:"",yearBuilt:"",images:[]}),[n,j]=p.useState([]),t=i=>{const{name:d,value:m}=i.target;s(h=>({...h,[d]:m}))},u=(i,d)=>{const m=parseInt(d)||0;s(h=>({...h,[i]:m}))},b=i=>{const d=Array.from(i.target.files||[]);s(m=>({...m,images:[...m.images,...d]})),d.forEach(m=>{const h=new FileReader;h.onloadend=()=>{j(L=>[...L,h.result])},h.readAsDataURL(m)})},F=i=>{s(d=>({...d,images:d.images.filter((m,h)=>h!==i)})),j(d=>d.filter((m,h)=>h!==i))},q=i=>{i.preventDefault(),g==null||g(l),x(!1),s({address:"",city:"",state:"",zipCode:"",price:"",beds:3,baths:2,sqft:"",lotSize:"",propertyType:"single-family",status:"active",description:"",mlsNumber:"",yearBuilt:"",images:[]}),j([])};return e.jsx(I,{open:v,onOpenChange:x,children:e.jsxs(E,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(U,{children:[e.jsx(V,{children:"Add New Property Listing"}),e.jsx(O,{children:"Fill in the details for your property listing"})]}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Property Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{htmlFor:"address",children:"Street Address *"}),e.jsx(o,{id:"address",name:"address",value:l.address,onChange:t,placeholder:"123 Main Street",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"city",children:"City *"}),e.jsx(o,{id:"city",name:"city",value:l.city,onChange:t,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"state",children:"State *"}),e.jsx(o,{id:"state",name:"state",value:l.state,onChange:t,maxLength:2,placeholder:"CA",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"zipCode",children:"Zip *"}),e.jsx(o,{id:"zipCode",name:"zipCode",value:l.zipCode,onChange:t,placeholder:"94102",required:!0})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Property Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"price",children:"Price *"}),e.jsx(o,{id:"price",name:"price",value:l.price,onChange:t,placeholder:"1,250,000",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"propertyType",children:"Property Type *"}),e.jsxs(y,{value:l.propertyType,onValueChange:i=>s(d=>({...d,propertyType:i})),children:[e.jsx(N,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"single-family",children:"Single Family"}),e.jsx(c,{value:"condo",children:"Condo"}),e.jsx(c,{value:"townhouse",children:"Townhouse"}),e.jsx(c,{value:"multi-family",children:"Multi-Family"}),e.jsx(c,{value:"land",children:"Land"}),e.jsx(c,{value:"commercial",children:"Commercial"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"beds",children:"Bedrooms *"}),e.jsx(o,{id:"beds",type:"number",value:l.beds,onChange:i=>u("beds",i.target.value),min:0,required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"baths",children:"Bathrooms *"}),e.jsx(o,{id:"baths",type:"number",value:l.baths,onChange:i=>u("baths",i.target.value),min:0,step:.5,required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"sqft",children:"Square Feet *"}),e.jsx(o,{id:"sqft",name:"sqft",value:l.sqft,onChange:t,placeholder:"2,400",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"lotSize",children:"Lot Size"}),e.jsx(o,{id:"lotSize",name:"lotSize",value:l.lotSize,onChange:t,placeholder:"0.25 acres"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"status",children:"Status *"}),e.jsxs(y,{value:l.status,onValueChange:i=>s(d=>({...d,status:i})),children:[e.jsx(N,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"sold",children:"Sold"}),e.jsx(c,{value:"off-market",children:"Off Market"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"yearBuilt",children:"Year Built"}),e.jsx(o,{id:"yearBuilt",name:"yearBuilt",value:l.yearBuilt,onChange:t,placeholder:"2015"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"description",children:"Description"}),e.jsx(A,{id:"description",name:"description",value:l.description,onChange:t,rows:4,placeholder:"Beautiful property with stunning views..."})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"mlsNumber",children:"MLS Number"}),e.jsx(o,{id:"mlsNumber",name:"mlsNumber",value:l.mlsNumber,onChange:t,placeholder:"ML81234567"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(a,{children:"Property Photos"}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:b,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(Q,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 5MB (max 25 images)"})]})]}),n.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-3",children:n.map((i,d)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:i,alt:`Preview ${d+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>F(d),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{className:"h-3 w-3"})})]},d))})]}),e.jsxs(R,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(S,{type:"submit",children:"Add Listing"})]})]})]})})}function se({isOpen:v,onClose:x,onSubmit:g,initialData:l}){const[s,n]=p.useState(l);if(p.useEffect(()=>{n(l)},[l]),!v)return null;const j=t=>{t.preventDefault(),g(s)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Property Listing"}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(k,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{htmlFor:"address",children:"Street Address *"}),e.jsx(o,{id:"address",value:s.address,onChange:t=>n({...s,address:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"city",children:"City *"}),e.jsx(o,{id:"city",value:s.city,onChange:t=>n({...s,city:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"price",children:"Price *"}),e.jsx(o,{id:"price",value:s.price,onChange:t=>n({...s,price:t.target.value}),placeholder:"$450,000",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"beds",children:"Bedrooms *"}),e.jsx(o,{id:"beds",type:"number",value:s.beds,onChange:t=>n({...s,beds:parseInt(t.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"baths",children:"Bathrooms *"}),e.jsx(o,{id:"baths",type:"number",value:s.baths,onChange:t=>n({...s,baths:parseInt(t.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"sqft",children:"Square Feet"}),e.jsx(o,{id:"sqft",type:"number",value:s.sqft||"",onChange:t=>n({...s,sqft:parseInt(t.target.value)||void 0})})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"status",children:"Status *"}),e.jsxs(y,{value:s.status,onValueChange:t=>n({...s,status:t}),children:[e.jsx(N,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"under_contract",children:"Under Contract"}),e.jsx(c,{value:"sold",children:"Sold"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"property_type",children:"Property Type"}),e.jsxs(y,{value:s.property_type||"",onValueChange:t=>n({...s,property_type:t}),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Select type"})}),e.jsxs(C,{children:[e.jsx(c,{value:"single_family",children:"Single Family"}),e.jsx(c,{value:"condo",children:"Condo"}),e.jsx(c,{value:"townhouse",children:"Townhouse"}),e.jsx(c,{value:"multi_family",children:"Multi-Family"}),e.jsx(c,{value:"land",children:"Land"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"mls_number",children:"MLS Number"}),e.jsx(o,{id:"mls_number",value:s.mls_number||"",onChange:t=>n({...s,mls_number:t.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{htmlFor:"description",children:"Description"}),e.jsx(A,{id:"description",value:s.description||"",onChange:t=>n({...s,description:t.target.value}),rows:4,placeholder:"Describe the property features..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{htmlFor:"image",children:"Image URL"}),e.jsx(o,{id:"image",type:"url",value:s.image||"",onChange:t=>n({...s,image:t.target.value}),placeholder:"https://example.com/image.jpg"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:x,className:"flex-1",children:"Cancel"}),e.jsx(S,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function pe(){const[v,x]=p.useState(""),[g,l]=p.useState(!1),[s,n]=p.useState(null),[j,t]=p.useState(!1),{toast:u}=$(),{listings:b,addListing:F,deleteListing:q}=G(),{subscription:i,canAdd:d,getLimit:m,getUsage:h}=H(),L=()=>{if(!d("listings")){t(!0);return}l(!0)},T=async r=>{try{await F.mutateAsync(r),u({title:"Listing added!",description:"Your property listing has been created successfully."}),l(!1)}catch{u({title:"Error",description:"Failed to add listing. Please try again.",variant:"destructive"})}},B=async r=>{if(confirm("Are you sure you want to delete this listing?"))try{await q.mutateAsync(r),u({title:"Listing deleted",description:"Property listing has been removed."})}catch{u({title:"Error",description:"Failed to delete listing.",variant:"destructive"})}},M=async r=>{if(s)try{const{data:{user:f}}=await D.auth.getUser();if(!f)throw new Error("Not authenticated");const{error:_}=await D.from("listings").update({address:r.address,city:r.city,price:r.price,beds:r.beds,baths:r.baths,sqft:r.sqft,status:r.status,image:r.image,description:r.description,mls_number:r.mls_number,property_type:r.property_type,updated_at:new Date().toISOString()}).eq("id",s.id).eq("user_id",f.id);if(_)throw _;u({title:"Listing updated!",description:"Your property listing has been updated successfully."}),n(null),window.location.reload()}catch{u({title:"Error",description:"Failed to update listing. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Property Listings"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Manage your active and sold properties"})]}),e.jsxs("button",{onClick:L,className:"inline-flex items-center gap-2 px-4 py-2.5 sm:py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 active:scale-95 transition-all font-medium min-h-[44px] w-full sm:w-auto justify-center shadow-sm",children:[e.jsx(P,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Add Property"})]})]}),i&&m("listings")!==1/0&&e.jsx(X,{feature:"listings",current:h("listings"),limit:m("listings")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search properties...",value:v,onChange:r=>x(r.target.value),className:"w-full pl-10 pr-4 py-2.5 sm:py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm sm:text-base min-h-[44px]"})]}),e.jsxs("button",{className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 sm:py-2 bg-background border border-border rounded-lg hover:bg-accent active:scale-95 transition-all min-h-[44px] w-full sm:w-auto",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Filters"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:b.length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Total"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:b.filter(r=>r.status==="active").length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Active"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600",children:b.filter(r=>r.status==="pending").length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Pending"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:b.map(r=>e.jsxs("div",{className:"bg-card border border-border rounded-lg overflow-hidden hover:shadow-lg active:shadow-xl transition-all group",children:[e.jsxs("div",{className:"relative h-44 sm:h-48 overflow-hidden",children:[e.jsx("img",{src:r.image,alt:r.address,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}),e.jsx("div",{className:"absolute top-2 sm:top-3 left-2 sm:left-3",children:e.jsx("span",{className:`px-2 sm:px-3 py-1 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-500 text-white shadow-md":"bg-yellow-500 text-white shadow-md"}`,children:r.status})}),e.jsxs("div",{className:"absolute top-2 sm:top-3 right-2 sm:right-3 flex gap-1.5 sm:gap-2",children:[e.jsx("button",{onClick:()=>n(r),className:"p-2 sm:p-2.5 bg-white/90 backdrop-blur-sm rounded-full hover:bg-white active:scale-90 transition-all shadow-md min-w-[44px] min-h-[44px] flex items-center justify-center",title:"Edit listing","aria-label":"Edit listing",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>B(r.id),className:"p-2 sm:p-2.5 bg-white/90 backdrop-blur-sm rounded-full hover:bg-white active:scale-90 transition-all text-red-600 shadow-md min-w-[44px] min-h-[44px] flex items-center justify-center",title:"Delete listing","aria-label":"Delete listing",children:e.jsx(K,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"mb-2 sm:mb-3",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary mb-1",children:r.price}),e.jsx("div",{className:"font-medium text-sm sm:text-base text-foreground",children:r.address}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:r.city})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-muted-foreground mb-3 sm:mb-4 flex-wrap",children:[e.jsxs("span",{children:[r.beds," beds"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[r.baths," baths"]}),r.sqft&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"whitespace-nowrap",children:[r.sqft.toLocaleString()," sqft"]})]})]}),e.jsx("div",{className:"flex items-center justify-between pt-2 sm:pt-3 border-t border-border",children:e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:["Listed ",new Date(r.created_at).toLocaleDateString()]})})]})]},r.id))}),b.length===0&&e.jsxs("div",{className:"text-center py-8 sm:py-12 px-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-accent rounded-full mb-3 sm:mb-4",children:e.jsx(P,{className:"h-7 w-7 sm:h-8 sm:w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 sm:mb-2",children:"No properties yet"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4 sm:mb-6 max-w-sm mx-auto",children:"Start by adding your first property listing"}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 active:scale-95 transition-all font-medium min-h-[44px] shadow-md",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Add Your First Property"})]})]}),e.jsx(ee,{isOpen:g,onClose:()=>l(!1),onSubmit:T}),s&&e.jsx(se,{isOpen:!!s,onClose:()=>n(null),onSubmit:M,initialData:{address:s.address,city:s.city,price:s.price,beds:s.beds,baths:s.baths,sqft:s.sqft,status:s.status,image:s.image,description:s.description,mls_number:s.mls_number,property_type:s.property_type}}),e.jsx(J,{open:j,onOpenChange:t,feature:"listings",currentPlan:(i==null?void 0:i.plan_name)||"Free",requiredPlan:"Starter"})]})}export{pe as default};
