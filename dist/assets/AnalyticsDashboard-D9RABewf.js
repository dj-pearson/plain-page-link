import{bS as T,bl as ae,j as e,W as w,a3 as D,r as y,bL as ne,a2 as Q,a5 as re,aq as le,ae as ie,g as ce,bN as M,L as A,G as I,J as O,K as _,N as B,O as E,R as oe,B as P,k as X,ao as de,ag as V,bT as W,p as ue,b1 as me,D as he,s as k,ac as Y}from"./index-Dqp2k1py.js";import{T as xe,a as pe,b as F,c as $}from"./tabs-54ZmhUku.js";import{M as ge}from"./minus-B6VoiwoP.js";import{T as ve}from"./trending-down-Dod1spdn.js";import{L as U}from"./lightbulb-B7FXKsqC.js";import{g as fe}from"./exportUtils-ONScMiwb.js";import{F as J}from"./file-text-BQVFFYgF.js";import{u as je}from"./useAnalytics-Dof2-WTt.js";import{u as K}from"./useMutation-Cc-9CBVE.js";import"./index-BpCpig5b.js";function be(t,a){const s=T(t);return isNaN(a)?ae(t,NaN):(a&&s.setDate(s.getDate()+a),s)}function ye(t,a){const s=T(t.start),l=T(t.end);let r=+s>+l;const c=r?+s:+l,i=r?l:s;i.setHours(0,0,0,0);let u=1;const h=[];for(;+i<=c;)h.push(T(i)),i.setDate(i.getDate()+u),i.setHours(0,0,0,0);return r?h.reverse():h}function z(t){const a=T(t);return a.setDate(1),a.setHours(0,0,0,0),a}function S(t,a){return be(t,-a)}function Ne({metrics:t,className:a}){return e.jsx("div",{className:w("grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",a),children:t.map(s=>e.jsx(we,{metric:s},s.name))})}function we({metric:t}){const a=()=>{switch(t.trend){case"up":return e.jsx(D,{className:"w-4 h-4"});case"down":return e.jsx(ve,{className:"w-4 h-4"});case"flat":return e.jsx(ge,{className:"w-4 h-4"})}},s=()=>{switch(t.trend){case"up":return"text-green-600 bg-green-100";case"down":return"text-red-600 bg-red-100";case"flat":return"text-gray-600 bg-gray-100"}},l=()=>t.unit==="$"?`$${t.value.toLocaleString()}`:t.unit==="%"?`${t.value.toFixed(1)}%`:t.unit==="min"?`${Math.round(t.value)} min`:t.value.toLocaleString();return e.jsxs("div",{className:"bg-white p-6 rounded-lg border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:t.name}),e.jsx("div",{className:w("p-2 rounded-full",s()),children:a()})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l()})}),e.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[e.jsxs("span",{className:w("text-sm font-medium",t.trend==="up"?"text-green-600":t.trend==="down"?"text-red-600":"text-gray-600"),children:[t.change>0?"+":"",t.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"vs last period"})]}),t.benchmark&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Benchmark: ",t.unit==="$"?"$":"",t.benchmark.toLocaleString(),t.unit==="%"?"%":""]})})]})}function Re({data:t,title:a,color:s="#2563eb",height:l=300,showPredictions:r=!1,className:c}){const{actualData:i,predictedData:u,maxValue:h,minValue:d}=y.useMemo(()=>{const o=t.filter(n=>!n.label),m=t.filter(n=>n.label==="predicted"),v=t.map(n=>n.value);return{actualData:o,predictedData:m,maxValue:Math.max(...v),minValue:Math.min(...v)}},[t]),g=o=>{const v=l-40,n=h-d||1;return 20+v-(o-d)/n*v},b=(o,m)=>40+o/(m-1)*720,R=(o,m=!1)=>o.length===0?"":o.map((f,L)=>({x:b(L,o.length),y:g(f.value)})).map((f,L)=>`${L===0?"M":"L"} ${f.x} ${f.y}`).join(" "),C=o=>{if(o.length===0)return"";const m=R(o),v=b(o.length-1,o.length),n=b(0,o.length),f=l-20;return`${m} L ${v} ${f} L ${n} ${f} Z`};return e.jsxs("div",{className:c,children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:a}),e.jsxs("svg",{width:"100%",height:l,viewBox:"0 0 800 300",className:"bg-white rounded-lg border",children:[e.jsx("g",{className:"grid-lines",children:[0,25,50,75,100].map(o=>{const m=20+(l-40)*(o/100);return e.jsxs("g",{children:[e.jsx("line",{x1:40,y1:m,x2:760,y2:m,stroke:"#e5e7eb",strokeWidth:1}),e.jsx("text",{x:25,y:m+4,fontSize:10,fill:"#6b7280",textAnchor:"end",children:Math.round(h-o/100*(h-d))})]},o)})}),e.jsx("path",{d:C(i),fill:s,fillOpacity:.1}),e.jsx("path",{d:R(i),fill:"none",stroke:s,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),r&&u.length>0&&e.jsx("path",{d:R(u),fill:"none",stroke:s,strokeWidth:2,strokeDasharray:"5,5",strokeOpacity:.5,strokeLinecap:"round",strokeLinejoin:"round"}),i.map((o,m)=>e.jsx("circle",{cx:b(m,i.length),cy:g(o.value),r:4,fill:"white",stroke:s,strokeWidth:2},m)),e.jsx("g",{className:"x-axis-labels",children:i.map((o,m)=>m%Math.ceil(i.length/7)===0?e.jsx("text",{x:b(m,i.length),y:l-5,fontSize:10,fill:"#6b7280",textAnchor:"middle",children:o.date},m):null)})]}),r&&u.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:s}}),e.jsx("span",{children:"Actual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:s,opacity:.5,borderTop:`2px dashed ${s}`}}),e.jsx("span",{children:"Predicted"})]})]})]})}function Ce({stages:t,className:a}){const s=t[0]?.count||1;return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Conversion Funnel"}),e.jsx("div",{className:"space-y-2",children:t.map((l,r)=>e.jsxs("div",{children:[e.jsx(Le,{stage:l,maxCount:s,isFirst:r===0,isLast:r===t.length-1}),!isLast&&l.dropoff!==void 0&&l.dropoff>0&&e.jsx(Me,{count:l.dropoff,percentage:Se(l,t[r+1])})]},l.name))}),e.jsxs("div",{className:"mt-6 pt-6 border-t grid grid-cols-3 gap-4",children:[e.jsx(G,{label:"Overall Conversion",value:`${t[t.length-1].percentage.toFixed(1)}%`}),e.jsx(G,{label:"Total Conversions",value:t[t.length-1].count.toLocaleString()}),e.jsx(G,{label:"Total Dropoff",value:De(t).toLocaleString()})]})]})}function Le({stage:t,maxCount:a,isFirst:s,isLast:l}){const r=t.count/a*100,c=()=>t.percentage>=75?"bg-green-500":t.percentage>=50?"bg-yellow-500":t.percentage>=25?"bg-orange-500":"bg-red-500";return e.jsx("div",{className:"relative",children:e.jsx("div",{className:w("relative mx-auto rounded-lg p-4 transition-all duration-300 hover:shadow-md",c()),style:{width:`${Math.max(r,20)}%`},children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.name}),e.jsxs("p",{className:"text-sm opacity-90",children:[t.count.toLocaleString()," leads"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[t.percentage.toFixed(1),"%"]}),!s&&e.jsx("p",{className:"text-xs opacity-90",children:"of total"})]})]})})})}function Me({count:t,percentage:a}){return e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-red-600",children:t.toLocaleString()})," ","dropped off (",a.toFixed(1),"%)"]})]})})}function G({label:t,value:a}){return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t})]})}function Se(t,a){return t.count===0?0:(t.count-a.count)/t.count*100}function De(t){return t.length<2?0:t[0].count-t[t.length-1].count}function Te({sources:t,className:a}){const s=t.reduce((c,i)=>c+i.leads,0),l=t.reduce((c,i)=>c+i.revenue,0),r=[...t].sort((c,i)=>i.conversionRate-c.conversionRate);return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Lead Sources"}),e.jsxs("div",{className:"flex gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-4 h-4"}),s," leads"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),"$",l.toLocaleString()]})]})]}),e.jsx("div",{className:"space-y-4",children:r.map(c=>e.jsx(Ve,{source:c,totalLeads:s},c.source))}),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No lead source data available"})]})]})}function Ve({source:t,totalLeads:a}){const s=t.leads/a*100,l=r=>r>=20?"text-green-600":r>=10?"text-yellow-600":"text-gray-600";return e.jsxs("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 capitalize",children:t.source}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:w("text-lg font-bold",l(t.conversionRate)),children:[t.conversionRate.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"conversion"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Lead share"}),e.jsxs("span",{className:"font-medium",children:[s.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary rounded-full h-2 transition-all duration-500",style:{width:`${s}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Leads"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.leads})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conversions"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.conversions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Revenue"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["$",t.revenue.toLocaleString()]})]})]}),t.roi!==void 0&&e.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ROI"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:w("font-semibold",t.roi>0?"text-green-600":"text-red-600"),children:[t.roi>0?"+":"",t.roi.toFixed(1),"%"]})]})]})]})}function H({insights:t,className:a}){return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Key Insights"})]}),e.jsx("div",{className:"space-y-3",children:t.map((s,l)=>e.jsx(ke,{insight:s},l))}),t.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No insights available yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Check back when you have more data"})]})]})}function ke({insight:t}){const a=()=>t.includes("ðŸ“ˆ")||t.includes("ðŸš€")||t.includes("ðŸŽ¯")?e.jsx(D,{className:"w-5 h-5 text-green-600"}):t.includes("âš ï¸")||t.includes("ðŸŒ")?e.jsx(ie,{className:"w-5 h-5 text-orange-600"}):t.includes("âš¡")||t.includes("ðŸŒŸ")?e.jsx(ce,{className:"w-5 h-5 text-blue-600"}):e.jsx(U,{className:"w-5 h-5 text-yellow-600"}),s=()=>t.includes("ðŸ“ˆ")||t.includes("ðŸš€")||t.includes("ðŸŽ¯")?"bg-green-50 border-green-200":t.includes("âš ï¸")||t.includes("ðŸŒ")?"bg-orange-50 border-orange-200":t.includes("âš¡")||t.includes("ðŸŒŸ")?"bg-blue-50 border-blue-200":"bg-yellow-50 border-yellow-200";return e.jsx("div",{className:w("p-4 rounded-lg border",s()),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a()}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t})]})})}class j{static calculateKPIs(a,s){return[this.createMetric("Total Page Views",a.pageViews,"",s.pageViews),this.createMetric("Unique Visitors",a.uniqueVisitors,"",s.uniqueVisitors),this.createMetric("Total Leads",a.leads,"",s.leads),this.createMetric("Conversions",a.conversions,"",s.conversions),this.createMetric("Revenue",a.revenue,"$",s.revenue),this.createMetric("Avg Response Time",a.avgResponseTime,"min",s.avgResponseTime,!0),this.createMetric("Conversion Rate",this.calculateConversionRate(a.leads,a.conversions),"%",this.calculateConversionRate(s.leads,s.conversions)),this.createMetric("Lead-to-Visitor Rate",this.calculateConversionRate(a.uniqueVisitors,a.leads),"%",this.calculateConversionRate(s.uniqueVisitors,s.leads))]}static createMetric(a,s,l,r,c=!1){const i=this.calculatePercentageChange(s,r),u=this.determineTrend(i,c);return{name:a,value:s,unit:l,change:i,trend:u}}static calculatePercentageChange(a,s){return s===0?a>0?100:0:(a-s)/s*100}static determineTrend(a,s=!1){return Math.abs(a)<2?"flat":s?a<0?"up":"down":a>0?"up":"down"}static calculateConversionRate(a,s){return a===0?0:s/a*100}static generateTimeSeries(a,s,l){return ye({start:a,end:s}).map(c=>({date:M(c,"MMM d"),value:l(c)}))}static calculateFunnel(a){const{visitors:s,viewed:l,contacted:r,qualified:c,converted:i}=a;return[{name:"Visitors",count:s,percentage:100},{name:"Viewed Listing",count:l,percentage:this.calculateConversionRate(s,l),dropoff:s-l},{name:"Contacted",count:r,percentage:this.calculateConversionRate(s,r),dropoff:l-r},{name:"Qualified",count:c,percentage:this.calculateConversionRate(s,c),dropoff:r-c},{name:"Converted",count:i,percentage:this.calculateConversionRate(s,i),dropoff:c-i}]}static analyzeLeadSources(a){return a.map(s=>({source:s.source,leads:s.leads,conversions:s.conversions,conversionRate:this.calculateConversionRate(s.leads,s.conversions),revenue:s.revenue,roi:s.cost?(s.revenue-s.cost)/s.cost*100:void 0}))}static rankListings(a){return a.map(s=>({...s,conversionRate:this.calculateConversionRate(s.views,s.leads)})).sort((s,l)=>l.conversionRate-s.conversionRate)}static predictTrend(a,s=7){if(a.length<2)return[];const l=a.length,r=a.map((o,m)=>m),c=a.map(o=>o.value),i=r.reduce((o,m)=>o+m,0),u=c.reduce((o,m)=>o+m,0),h=r.reduce((o,m,v)=>o+m*c[v],0),d=r.reduce((o,m)=>o+m*m,0),g=(l*h-i*u)/(l*d-i*i),b=(u-g*i)/l,R=[],C=new Date(a[a.length-1].date);for(let o=1;o<=s;o++){const m=l+o-1,v=Math.max(0,Math.round(g*m+b)),n=new Date(C);n.setDate(n.getDate()+o),R.push({date:M(n,"MMM d"),value:v,label:"predicted"})}return R}static calculateEngagementScore(a){const{avgTimeOnPage:s,bounceRate:l,pagesPerSession:r,returnVisitorRate:c}=a,i=Math.min(s/180*25,25),u=Math.max((100-l)/4,0),h=Math.min(r/5*25,25),d=c/100*25;return Math.round(i+u+h+d)}static generateInsights(a,s,l){const r=[],c=this.calculatePercentageChange(a.leads,s.leads);c>20?r.push(`ðŸ“ˆ Lead generation is up ${Math.round(c)}% compared to last period`):c<-20&&r.push(`âš ï¸ Lead generation is down ${Math.abs(Math.round(c))}% - consider increasing marketing efforts`);const i=this.calculateConversionRate(a.leads,a.conversions),u=this.calculateConversionRate(s.leads,s.conversions);if(i>u+5&&r.push(`ðŸŽ¯ Conversion rate improved to ${i.toFixed(1)}% - keep up the good work!`),a.avgResponseTime<5?r.push("âš¡ Excellent response time! You're responding in under 5 minutes"):a.avgResponseTime>60&&r.push(`ðŸŒ Response time is high (${Math.round(a.avgResponseTime)} min) - faster responses increase conversions`),l.length>0){const d=l.reduce((g,b)=>b.conversionRate>g.conversionRate?b:g);d.conversionRate>15&&r.push(`ðŸŒŸ ${d.source} is your best performing source at ${d.conversionRate.toFixed(1)}% conversion rate`)}const h=this.calculatePercentageChange(a.uniqueVisitors,s.uniqueVisitors);return h>30&&r.push(`ðŸš€ Traffic is surging! Up ${Math.round(h)}% - great time to capture leads`),r}static exportToCSV(a,s){if(a.length===0)return;const l=Object.keys(a[0]),r=[l.join(","),...a.map(h=>l.map(d=>JSON.stringify(h[d]||"")).join(","))].join(`
`),c=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),u=URL.createObjectURL(c);i.setAttribute("href",u),i.setAttribute("download",`${s}_${Date.now()}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}const Fe=j.calculateKPIs.bind(j);j.generateTimeSeries.bind(j);const $e=j.calculateFunnel.bind(j),qe=j.analyzeLeadSources.bind(j);j.rankListings.bind(j);const Pe=j.predictTrend.bind(j);j.calculateEngagementScore.bind(j);const Ae=j.generateInsights.bind(j),Ie=j.exportToCSV.bind(j);function Oe({onGenerateReport:t,className:a}){const[s,l]=y.useState("leads"),[r,c]=y.useState("30d"),[i,u]=y.useState("csv"),[h,d]=y.useState(!1),g=[{value:"leads",label:"Leads Report"},{value:"listings",label:"Listings Performance"},{value:"conversions",label:"Conversion Analytics"},{value:"sources",label:"Lead Sources"},{value:"performance",label:"Overall Performance"}],b=[{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"90d",label:"Last 90 Days"},{value:"this_month",label:"This Month"},{value:"last_month",label:"Last Month"}],R=[{value:"csv",label:"CSV",disabled:!1},{value:"pdf",label:"PDF",disabled:!1},{value:"excel",label:"Excel (Coming Soon)",disabled:!0}],C=()=>{const n=new Date;switch(r){case"7d":return{start:S(n,7),end:n};case"30d":return{start:S(n,30),end:n};case"90d":return{start:S(n,90),end:n};case"this_month":return{start:z(n),end:W(n)};case"last_month":const f=S(z(n),1);return{start:z(f),end:W(f)};default:return{start:S(n,30),end:n}}},o=()=>({leads:"Leads Report",listings:"Listings Performance Report",conversions:"Conversion Analytics Report",sources:"Lead Sources Report",performance:"Overall Performance Report"})[s]||"Analytics Report",m=async()=>{d(!0);try{const{start:n,end:f}=C(),L=`${M(n,"MMM d, yyyy")} - ${M(f,"MMM d, yyyy")}`,p=await t({reportType:s,dateRange:r,metrics:[],format:i,startDate:n,endDate:f});if(i==="csv"){const N=`${s}_report_${M(n,"yyyy-MM-dd")}_to_${M(f,"yyyy-MM-dd")}`;Ie(p,N),V.success("CSV report exported successfully!")}else if(i==="pdf")if(p&&p.length>0){const N=Object.keys(p[0]),Z=p.map(se=>N.map(te=>se[te]??"")),ee=v(p,s);fe({title:o(),dateRange:L,headers:N,rows:Z,summary:ee,orientation:N.length>5?"landscape":"portrait"}),V.success("PDF report generated successfully!")}else V.error("No data available for report")}catch(n){console.error("Report generation error:",n),V.error("Failed to generate report")}finally{d(!1)}},v=(n,f)=>{switch(f){case"leads":return[{label:"Total Leads",value:n.length},{label:"New Leads",value:n.filter(x=>x.status==="new").length},{label:"Qualified",value:n.filter(x=>x.status==="qualified").length}];case"listings":return[{label:"Total Listings",value:n.length},{label:"Active",value:n.filter(x=>x.status==="active").length},{label:"Sold",value:n.filter(x=>x.status==="sold").length}];case"conversions":return[{label:"Total Conversions",value:n.reduce((x,p)=>x+(p.conversions||0),0)},{label:"Records",value:n.length}];case"sources":return[{label:"Total Sources",value:n.length},{label:"Total Leads",value:n.reduce((x,p)=>x+(p.count||0),0)}];default:return[{label:"Total Records",value:n.length}]}};return e.jsxs("div",{className:w("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Custom Report Builder"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Report Type"}),e.jsxs(I,{value:s,onValueChange:n=>l(n),children:[e.jsx(O,{children:e.jsx(_,{})}),e.jsx(B,{children:g.map(n=>e.jsx(E,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Date Range"]}),e.jsxs(I,{value:r,onValueChange:n=>c(n),children:[e.jsx(O,{children:e.jsx(_,{})}),e.jsx(B,{children:b.map(n=>e.jsx(E,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Export Format"}),e.jsxs(I,{value:i,onValueChange:n=>u(n),children:[e.jsx(O,{children:e.jsx(_,{})}),e.jsx(B,{children:R.map(n=>e.jsx(E,{value:n.value,disabled:n.disabled,children:n.label},n.value))})]})]}),e.jsx(P,{onClick:m,disabled:h,className:"w-full gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Generating ",i.toUpperCase(),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Generate Report"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Report Preview"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:["Type: ",e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("p",{children:["Range:"," ",e.jsxs("span",{className:"font-medium",children:[M(C().start,"MMM d, yyyy")," ","-"," ",M(C().end,"MMM d, yyyy")]})]}),e.jsxs("p",{children:["Format:"," ",e.jsx("span",{className:"font-medium uppercase",children:i})]})]})]})]})}function _e(){const{user:t}=ue(),a=me(),{data:s=[],isLoading:l}=he({queryKey:["leads",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:u,error:h}=await k.from("leads").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(h)throw h;return u},enabled:!!t?.id}),r=K({mutationFn:async u=>{const{data:h,error:d}=await k.from("leads").insert(u).select().single();if(d)throw d;return h},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",t?.id]})}}),c=K({mutationFn:async({id:u,...h})=>{const{data:d,error:g}=await k.from("leads").update(h).eq("id",u).select().single();if(g)throw g;return d},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",t?.id]})}}),i=K({mutationFn:async u=>{const{error:h}=await k.from("leads").delete().eq("id",u);if(h)throw h},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",t?.id]})}});return{leads:s,isLoading:l,addLead:r,updateLead:c,deleteLead:i}}function Xe(){const[t,a]=y.useState(!0),[s,l]=y.useState("30d"),{stats:r,viewsData:c,isLoading:i}=je(s),{leads:u}=_e(),h=new Date,d=y.useMemo(()=>({pageViews:r.totalViews,uniqueVisitors:r.uniqueVisitors,leads:r.totalLeads,conversions:u.filter(x=>x.status==="converted").length,revenue:0,avgResponseTime:0,period:s==="7d"?"week":s==="30d"?"month":"quarter",startDate:S(h,s==="7d"?7:s==="30d"?30:90),endDate:h}),[r,u,s,h]),g=y.useMemo(()=>({pageViews:Math.round(r.totalViews*.85),uniqueVisitors:Math.round(r.uniqueVisitors*.85),leads:Math.round(r.totalLeads*.85),conversions:Math.round(u.filter(x=>x.status==="converted").length*.85),revenue:0,avgResponseTime:0,period:d.period,startDate:S(d.startDate,s==="7d"?7:s==="30d"?30:90),endDate:d.startDate}),[r,u,d,s]),b=y.useMemo(()=>c.map(x=>({date:new Date(x.name),value:x.views,label:x.name})),[c]),R=y.useMemo(()=>b.length>0?Pe(b,7):[],[b]),C=[...b,...t?R:[]],o=y.useMemo(()=>Fe(d,g),[d,g]),m=y.useMemo(()=>$e({visitors:d.uniqueVisitors,viewed:Math.round(d.uniqueVisitors*.7),contacted:d.leads,qualified:u.filter(x=>x.status==="qualified"||x.status==="converted").length,converted:d.conversions}),[d,u]),v=y.useMemo(()=>{const x={};return u.forEach(p=>{const N=p.source||"website";x[N]||(x[N]={leads:0,conversions:0}),x[N].leads++,p.status==="converted"&&x[N].conversions++}),Object.entries(x).map(([p,N])=>({source:p,leads:N.leads,conversions:N.conversions,revenue:0,cost:0}))},[u]),n=y.useMemo(()=>qe(v.length>0?v:[{source:"website",leads:0,conversions:0,revenue:0,cost:0}]),[v]),f=y.useMemo(()=>Ae(d,g,n),[d,g,n]),L=async x=>{switch(x.reportType){case"leads":return u.map(p=>({id:p.id,name:p.name||"Unknown",email:p.email||"",source:p.source||"website",status:p.status||"new",score:p.score||0,created:p.created_at}));case"sources":return n.map(p=>({source:p.source,leads:p.leads,conversions:p.conversions,conversion_rate:`${p.conversionRate.toFixed(1)}%`,revenue:p.revenue,roi:p.roi?`${p.roi.toFixed(1)}%`:"N/A"}));default:return[{metric:"Page Views",current:d.pageViews,previous:g.pageViews,change:g.pageViews>0?`${((d.pageViews-g.pageViews)/g.pageViews*100).toFixed(1)}%`:"N/A"},{metric:"Leads",current:d.leads,previous:g.leads,change:g.leads>0?`${((d.leads-g.leads)/g.leads*100).toFixed(1)}%`:"N/A"},{metric:"Conversions",current:d.conversions,previous:g.conversions,change:g.conversions>0?`${((d.conversions-g.conversions)/g.conversions*100).toFixed(1)}%`:"N/A"}]}};return i?e.jsx("div",{className:"container mx-auto py-6 flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(X,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your performance and gain insights"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:s==="7d"?"default":"outline",size:"sm",onClick:()=>l("7d"),children:"7 Days"}),e.jsx(P,{variant:s==="30d"?"default":"outline",size:"sm",onClick:()=>l("30d"),children:"30 Days"}),e.jsx(P,{variant:s==="90d"?"default":"outline",size:"sm",onClick:()=>l("90d"),children:"90 Days"})]})]}),r.totalViews===0&&r.totalLeads===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"No Data Yet"}),e.jsx("p",{className:"text-blue-700",children:"Start sharing your profile to see analytics data here. Views and leads will be tracked automatically."})]}),e.jsx(Ne,{metrics:o}),e.jsxs(xe,{defaultValue:"overview",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-4 max-w-2xl",children:[e.jsxs(F,{value:"overview",className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(F,{value:"funnel",className:"gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Funnel"]}),e.jsxs(F,{value:"sources",className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Sources"]}),e.jsxs(F,{value:"reports",className:"gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Reports"]})]}),e.jsx($,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Re,{data:C,title:"Lead Generation Trend",color:"#2563eb",showPredictions:t})}),e.jsx(H,{insights:f})]})}),e.jsx($,{value:"funnel",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ce,{stages:m}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{insights:f}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Optimization Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Improve Viewed â†’ Contacted rate with clearer CTAs"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Reduce dropoff with faster response times"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Qualify leads better with targeted questions"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Nurture qualified leads with follow-ups"})]})]})]})]})]})}),e.jsx($,{value:"sources",className:"mt-6",children:e.jsx(Te,{sources:n})}),e.jsx($,{value:"reports",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Available Reports"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(q,{title:"Leads Report",description:"Detailed lead data with scores and sources",icon:e.jsx(Q,{className:"w-6 h-6"})}),e.jsx(q,{title:"Performance Report",description:"Overall performance metrics and trends",icon:e.jsx(D,{className:"w-6 h-6"})}),e.jsx(q,{title:"Sources Report",description:"Lead source analysis with ROI",icon:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx(q,{title:"Conversion Report",description:"Conversion funnel and rates",icon:e.jsx(D,{className:"w-6 h-6"})})]})]})}),e.jsx(Oe,{onGenerateReport:L})]})})]})]})}function q({title:t,description:a,icon:s}){return e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg text-primary",children:s}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:t}),e.jsx("p",{className:"text-sm text-gray-600",children:a})]})]})})}export{Xe as default};
