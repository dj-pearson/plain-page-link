import{q as _,G as d,s as c}from"./index-CCgIDu48.js";function h(r="30d"){const{user:i}=_(),o=(e=>{const t={"7d":7,"30d":30,"90d":90}[e],s=new Date;return s.setDate(s.getDate()-t),s.toISOString()})(r),{data:a=[],isLoading:l}=d({queryKey:["analytics-views",i?.id,r],queryFn:async()=>{if(!i?.id)return[];const{data:e,error:t}=await c.from("analytics_views").select("viewed_at, visitor_id, page_url, referrer").eq("user_id",i.id).gte("viewed_at",o).order("viewed_at",{ascending:!1}).limit(1e3);if(t)throw t;return e},enabled:!!i?.id,staleTime:300*1e3,gcTime:600*1e3}),{data:n=[],isLoading:u}=d({queryKey:["analytics-leads",i?.id,r],queryFn:async()=>{if(!i?.id)return[];const{data:e,error:t}=await c.from("leads").select("created_at, lead_type, status, email, phone").eq("user_id",i.id).gte("created_at",o).order("created_at",{ascending:!1}).limit(500);if(t)throw t;return e},enabled:!!i?.id,staleTime:300*1e3,gcTime:600*1e3}),v={totalViews:a.length,uniqueVisitors:new Set(a.map(e=>e.visitor_id)).size,totalLeads:n.length,conversionRate:a.length>0?(n.length/a.length*100).toFixed(2):"0.00"},f=a.reduce((e,t)=>{const s=new Date(t.viewed_at).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e[s]||(e[s]={name:s,views:0,visitors:new Set}),e[s].views++,t.visitor_id&&e[s].visitors.add(t.visitor_id),e},{}),w=Object.values(f).map(e=>({name:e.name,views:e.views,visitors:e.visitors.size})),g=n.reduce((e,t)=>{const s=t.lead_type||"contact";return e[s]=(e[s]||0)+1,e},{}),y=Object.entries(g).map(([e,t])=>({name:e.charAt(0).toUpperCase()+e.slice(1),value:t}));return{stats:v,viewsData:w,leadsData:y,recentLeads:n.slice(0,10),isLoading:l||u,timeRange:r}}export{h as u};
