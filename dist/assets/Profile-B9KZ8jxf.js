import{j as e}from"./ui-components-DtyTDbSg.js";import{r}from"./react-vendor-B_Chv4nK.js";import{u as a}from"./useProfile-5nBKmHQN.js";import{u as t,s}from"./index-DxTo7WPx.js";import{u as o}from"./use-toast-BIxl6y56.js";import{ae as i,af as l}from"./icons-K_BhWJ_Z.js";import"./data-ChU7VID-.js";import"./three-t2PEh41g.js";import"./charts-CeHnXkIf.js";import"./utils-D6PrBqaA.js";import"./supabase-D4JaKbf_.js";import"./forms-yc2f2ZZT.js";const n=5242880,d=["image/jpeg","image/jpg","image/png","image/webp"];function u(){const{user:e}=t(),{toast:a}=o(),[i,l]=r.useState(!1);return{uploadAvatar:async r=>{if(!(null==e?void 0:e.id))return a({title:"Error",description:"You must be logged in to upload an avatar",variant:"destructive"}),null;const t=(e=>d.includes(e.type)?e.size>n?"File size must be less than 5MB":null:"Please upload a JPG, PNG, or WEBP image")(r);if(t)return a({title:"Invalid file",description:t,variant:"destructive"}),null;l(!0);try{const t=r.name.split(".").pop(),o=`${e.id}/avatar.${t}`,{data:i}=await s.storage.from("avatars").list(e.id);i&&i.length>0&&await s.storage.from("avatars").remove(i.map(r=>`${e.id}/${r.name}`));const{error:l}=await s.storage.from("avatars").upload(o,r,{cacheControl:"3600",upsert:!0});if(l)throw l;const{data:{publicUrl:n}}=s.storage.from("avatars").getPublicUrl(o),{error:d}=await s.from("profiles").update({avatar_url:n}).eq("id",e.id);if(d)throw d;return a({title:"Success",description:"Profile picture updated successfully"}),n}catch(o){return a({title:"Error",description:"Failed to upload profile picture. Please try again.",variant:"destructive"}),null}finally{l(!1)}},uploading:i,acceptedTypes:d.join(", "),maxSize:n}}function c(){var t,s,n;const{profile:d,isLoading:c,updateProfile:m}=a(),{uploadAvatar:p,uploading:f}=u(),{toast:g}=o(),b=r.useRef(null),[x,h]=r.useState({full_name:"",username:"",bio:"",avatar_url:""});r.useEffect(()=>{d&&h({full_name:d.full_name||"",username:d.username||"",bio:d.bio||"",avatar_url:d.avatar_url||""})},[d]);const v=e=>{h({...x,[e.target.name]:e.target.value})};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:"Loading..."}):e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{await m.mutateAsync(x),g({title:"Profile updated!",description:"Your profile has been saved successfully."})}catch(r){g({title:"Error",description:"Failed to update profile. Please try again.",variant:"destructive"})}},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Edit Profile"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Update your agent information and contact details"})]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(i,{className:"h-4 w-4"}),"Save Changes"]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[x.avatar_url?e.jsx("img",{src:x.avatar_url,alt:"Profile",className:"w-24 h-24 rounded-full object-cover"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary/10 flex items-center justify-center text-3xl font-bold text-primary",children:(null==(t=x.full_name)?void 0:t.split(" ").map(e=>e[0]).join(""))||(null==(n=null==(s=x.username)?void 0:s[0])?void 0:n.toUpperCase())||"?"}),e.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=b.current)?void 0:e.click()},disabled:f,className:"absolute bottom-0 right-0 p-2 bg-primary text-primary-foreground rounded-full hover:bg-primary/90 transition-colors disabled:opacity-50",children:e.jsx(l,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground mb-1",children:"Upload Photo"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"JPG, PNG or WEBP. Max size 5MB."}),e.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=b.current)?void 0:e.click()},disabled:f,className:"px-4 py-2 bg-background border border-border rounded-lg hover:bg-accent transition-colors text-sm font-medium disabled:opacity-50",children:f?"Uploading...":"Choose File"}),e.jsx("input",{ref:b,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:async e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];if(!a)return;const t=await p(a);t&&h({...x,avatar_url:t})},className:"hidden"})]})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Full Name"}),e.jsx("input",{type:"text",name:"full_name",value:x.full_name,onChange:v,className:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Username *"}),e.jsx("input",{type:"text",name:"username",value:x.username,onChange:v,required:!0,className:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"})]})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Professional Bio"}),e.jsx("textarea",{name:"bio",value:x.bio,onChange:v,rows:6,maxLength:500,placeholder:"Tell potential clients about your experience, specialties, and what makes you unique...",className:"w-full px-4 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary resize-none"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[x.bio.length,"/500 characters"]})]})]})}export{c as default};
