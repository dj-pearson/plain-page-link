import{j as e,r as y}from"./vendor-react-Vgz0BWSF.js";import{u as F,s as N,C as x,a as p,b as g,c as j,d as f,z as _,ar as je,B as v,af as X,i as ye,ac as be,$ as we,K,N as z,aF as W,D as ve,L as Ne,G as k,aa as ke}from"./index-CEZzrIvr.js";import{T as J,a as Z,b,c as w}from"./tabs-fjmUo2oa.js";import{f as ee,g as Q,u as se}from"./vendor-data-D8Q-8Ib3.js";import{C as Ce}from"./clock-amzXWUj6.js";import{C as _e}from"./circle-x-IKboHOgA.js";import{M as De}from"./mouse-pointer-DsHkgmYN.js";import{F as U}from"./file-text-oC-QR1q2.js";import{T as P}from"./trending-down-H7Y0XP5S.js";import{M as B}from"./minus-FqIgeKtl.js";import{R as I,A as Te,C as L,X as $,Y as T,T as M,h as q,f as E,L as G,d as S}from"./vendor-charts-DwHIVLWv.js";import{T as te,a as ae,b as A,c as h,d as ne,e as u}from"./table-Kp0XPu3N.js";import{P as re,a as ie,b as oe}from"./popover-DxUgTru7.js";import{C as Se}from"./checkbox-9Jy94Iko.js";import{F as Pe}from"./filter-uSX7YMFK.js";import{F as Ae,G as Fe,H as Re,J as ce,K as le,M as de,N as me,Q as he,U as ue,W as xe,X as pe,Y as ge}from"./vendor-ui-B_M8o0qd.js";import{R as Ie}from"./refresh-cw-CYWpEObx.js";import{S as Le}from"./settings-DYF8sxll.js";function $e(){return se({queryKey:["connected-platforms"],queryFn:async()=>{const{data:{user:r}}=await N.auth.getUser();if(!r)throw new Error("Not authenticated");const{data:t,error:i}=await N.rpc("get_connected_search_platforms",{p_user_id:r.id});if(i)throw i;return t}})}function Me(){const{toast:r}=F();return Q({mutationFn:async t=>{const i={google_analytics:`${window.location.origin}/admin/search-analytics/oauth/callback/google-analytics`,google_search_console:`${window.location.origin}/admin/search-analytics/oauth/callback/google-search-console`,bing_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/bing-webmaster`,yandex_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/yandex-webmaster`},s={google_analytics:"https://accounts.google.com/o/oauth2/v2/auth",google_search_console:"https://accounts.google.com/o/oauth2/v2/auth",bing_webmaster:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",yandex_webmaster:"https://oauth.yandex.ru/authorize"},n=new URLSearchParams({client_id:(t.includes("google"),""),redirect_uri:i[t],response_type:"code",scope:t==="google_analytics"?"https://www.googleapis.com/auth/analytics.readonly":t==="google_search_console"?"https://www.googleapis.com/auth/webmasters.readonly":t==="bing_webmaster"?"https://api.bing.microsoft.com/webmaster.read offline_access":"webmaster:read",access_type:"offline",prompt:"consent"}),a=`${s[t]}?${n.toString()}`;window.location.href=a},onError:t=>{r({title:"OAuth Error",description:t.message,variant:"destructive"})}})}function qe(){const{toast:r}=F(),t=ee();return Q({mutationFn:async({platform:i,property_id:s,site_id:n,start_date:a,end_date:o})=>{const{data:{session:d}}=await N.auth.getSession();if(!d)throw new Error("Not authenticated");const l=i==="google_analytics"?"google-analytics-sync":i==="google_search_console"?"google-search-console-sync":i==="bing_webmaster"?"bing-webmaster-sync":"yandex-webmaster-sync",{data:c,error:m}=await N.functions.invoke(l,{body:{property_id:s,site_id:n,start_date:a,end_date:o},headers:{Authorization:`Bearer ${d.access_token}`}});if(m)throw m;return c},onSuccess:()=>{r({title:"Sync Started",description:"Data synchronization started successfully"}),t.invalidateQueries({queryKey:["search-analytics"]})},onError:i=>{r({title:"Sync Failed",description:i.message,variant:"destructive"})}})}function Ee(){const{toast:r}=F(),t=ee();return Q({mutationFn:async({start_date:i,end_date:s,force_refresh:n})=>{const{data:{session:a}}=await N.auth.getSession();if(!a)throw new Error("Not authenticated");const{data:o,error:d}=await N.functions.invoke("aggregate-search-analytics",{body:{start_date:i,end_date:s,force_refresh:n},headers:{Authorization:`Bearer ${a.access_token}`}});if(d)throw d;return o},onSuccess:()=>{r({title:"Aggregation Complete",description:"Analytics data aggregated successfully"}),t.invalidateQueries({queryKey:["unified-analytics"]})},onError:i=>{r({title:"Aggregation Failed",description:i.message,variant:"destructive"})}})}function R(r){return se({queryKey:["unified-analytics",r],queryFn:async()=>{const{data:{user:t}}=await N.auth.getUser();if(!t)throw new Error("Not authenticated");let i=N.from("unified_search_analytics").select("*").eq("user_id",t.id).gte("date",r.startDate).lte("date",r.endDate);r.platforms&&r.platforms.length>0&&(i=i.in("source_platform",r.platforms));const{data:s,error:n}=await i.order("date",{ascending:!1});if(n)throw n;return s}})}function Ue(r){const{data:t}=R(r);return t?{total_clicks:t.reduce((s,n)=>s+(n.clicks||0),0),total_impressions:t.reduce((s,n)=>s+(n.impressions||0),0),total_sessions:t.reduce((s,n)=>s+(n.sessions||0),0),total_users:t.reduce((s,n)=>s+(n.users||0),0),total_pageviews:t.reduce((s,n)=>s+(n.pageviews||0),0),average_ctr:t.length>0?t.reduce((s,n)=>s+(n.ctr||0),0)/t.length:0,average_position:t.length>0?t.reduce((s,n)=>s+(n.average_position||0),0)/t.length:0,average_bounce_rate:t.length>0?t.reduce((s,n)=>s+(n.bounce_rate||0),0)/t.length:0,clicks_change:0,impressions_change:0,sessions_change:0}:null}function Oe(r){const{data:t}=R(r);if(!t)return null;const i=t.reduce((s,n)=>{const a=n.date;return s[a]||(s[a]={date:a,clicks:0,impressions:0,sessions:0,users:0,ctr:0,position:0,count:0}),s[a].clicks+=n.clicks||0,s[a].impressions+=n.impressions||0,s[a].sessions+=n.sessions||0,s[a].users+=n.users||0,s[a].ctr+=n.ctr||0,s[a].position+=n.average_position||0,s[a].count+=1,s},{});return Object.values(i).map(s=>({date:s.date,clicks:s.clicks,impressions:s.impressions,sessions:s.sessions,users:s.users,ctr:s.count>0?s.ctr/s.count:0,position:s.count>0?s.position/s.count:0}))}function ze(r){const{data:t}=R(r);if(!t)return null;const s=t.filter(a=>a.query).reduce((a,o)=>{const d=o.query;return a[d]||(a[d]={query:d,clicks:0,impressions:0,ctr:0,position:0,count:0,change:0}),a[d].clicks+=o.clicks||0,a[d].impressions+=o.impressions||0,a[d].ctr+=o.ctr||0,a[d].position+=o.average_position||0,a[d].count+=1,a},{});return Object.values(s).map(a=>({query:a.query,clicks:a.clicks,impressions:a.impressions,ctr:a.count>0?a.ctr/a.count:0,position:a.count>0?a.position/a.count:0,change:0})).sort((a,o)=>o.clicks-a.clicks).slice(0,r.limit||10)}function Qe(r){const{data:t}=R(r);if(!t)return null;const s=t.filter(a=>a.page_url).reduce((a,o)=>{const d=o.page_url;return a[d]||(a[d]={url:d,title:o.page_title,clicks:0,impressions:0,sessions:0,ctr:0,position:0,count:0,change:0}),a[d].clicks+=o.clicks||0,a[d].impressions+=o.impressions||0,a[d].sessions+=o.sessions||0,a[d].ctr+=o.ctr||0,a[d].position+=o.average_position||0,a[d].count+=1,a},{});return Object.values(s).map(a=>({url:a.url,title:a.title,clicks:a.clicks,impressions:a.impressions,sessions:a.sessions,ctr:a.count>0?a.ctr/a.count:0,position:a.count>0?a.position/a.count:0,change:0})).sort((a,o)=>o.clicks-a.clicks).slice(0,r.limit||10)}const Be={google_search_console:{name:"Google Search Console",description:"Search performance and indexing data",icon:"ðŸ”"},google_analytics:{name:"Google Analytics 4",description:"Website traffic and user behavior",icon:"ðŸ“Š"},bing_webmaster:{name:"Bing Webmaster Tools",description:"Bing search performance data",icon:"ðŸ…±ï¸"},yandex_webmaster:{name:"Yandex Webmaster",description:"Yandex search performance data",icon:"ðŸ‡·ðŸ‡º"}};function Ke(){const{data:r,isLoading:t}=$e(),i=Me(),s=qe(),n=o=>{i.mutate(o)},a=o=>{s.mutate({platform:o})};return t?e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Platform Connections"}),e.jsx(j,{children:"Loading connection status..."})]}),e.jsx(f,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Platform Connections"}),e.jsx(j,{children:"Connect and manage your analytics platforms"})]}),e.jsx(f,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:r?.map(o=>{const d=Be[o.platform],l=o.is_connected,c=o.credential_status==="active",m=o.credential_status==="expired";return e.jsxs(x,{className:"relative",children:[e.jsxs(p,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:d.icon}),e.jsx("div",{children:e.jsx(g,{className:"text-sm",children:d.name})})]}),c&&e.jsxs(_,{variant:"default",className:"text-xs",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"Connected"]}),m&&e.jsxs(_,{variant:"destructive",className:"text-xs",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Expired"]}),!l&&e.jsxs(_,{variant:"secondary",className:"text-xs",children:[e.jsx(_e,{className:"h-3 w-3 mr-1"}),"Not Connected"]})]}),e.jsx(j,{className:"text-xs mt-1",children:d.description})]}),e.jsxs(f,{className:"pt-0",children:[o.last_sync&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Last sync: ",new Date(o.last_sync).toLocaleDateString()]}),e.jsx("div",{className:"flex flex-col gap-2",children:!l||m?e.jsxs(v,{size:"sm",onClick:()=>n(o.platform),disabled:i.isPending,className:"w-full",children:[e.jsx(X,{className:"h-3 w-3 mr-2"}),m?"Reconnect":"Connect"]}):e.jsx(v,{size:"sm",variant:"outline",onClick:()=>a(o.platform),disabled:s.isPending,className:"w-full",children:"Sync Data"})})]})]},o.platform)})})})]})}function We({startDate:r,endDate:t,platforms:i}){const s=Ue({startDate:r,endDate:t,platforms:i});if(!s)return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(l=>e.jsxs(x,{children:[e.jsx(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Loading..."})}),e.jsx(f,{children:e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded"})})]},l))});const n=l=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(l),a=l=>`${(l*100).toFixed(2)}%`,o=l=>{if(l===0)return{icon:B,color:"text-muted-foreground",text:"0%"};const c=l>0;return{icon:c?z:P,color:c?"text-green-600":"text-red-600",text:`${c?"+":""}${a(l/100)}`}},d=[{title:"Total Clicks",value:s.total_clicks,change:s.clicks_change,icon:De,description:"Users who clicked through"},{title:"Total Impressions",value:s.total_impressions,change:s.impressions_change,icon:ye,description:"Times your site appeared"},{title:"Avg. CTR",value:s.average_ctr,change:0,icon:be,description:"Click-through rate",isPercentage:!0},{title:"Avg. Position",value:s.average_position,change:0,icon:we,description:"Average search position",decimals:1},{title:"Total Sessions",value:s.total_sessions,change:s.sessions_change,icon:K,description:"Website sessions"},{title:"Total Users",value:s.total_users,change:0,icon:K,description:"Unique visitors"},{title:"Total Pageviews",value:s.total_pageviews,change:0,icon:U,description:"Pages viewed"},{title:"Bounce Rate",value:s.average_bounce_rate,change:0,icon:P,description:"Visitors who left quickly",isPercentage:!0}];return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:d.map(l=>{const c=o(l.change),m=l.icon,C=c.icon;return e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:l.title}),e.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.isPercentage?a(l.value):l.decimals?l.value.toFixed(l.decimals):n(l.value)}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(C,{className:`h-3 w-3 ${c.color}`}),e.jsx("span",{className:c.color,children:c.text}),e.jsx("span",{children:"vs. previous period"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l.description})]})]},l.title)})})}function Ge({startDate:r,endDate:t,platforms:i}){const s=Oe({startDate:r,endDate:t,platforms:i});return!s||s.length===0?e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Performance Trends"}),e.jsx(j,{children:"No data available for the selected period"})]}),e.jsx(f,{children:e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:e.jsx("p",{children:"Connect your platforms and sync data to see performance trends"})})})]}):e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Performance Trends"}),e.jsx(j,{children:"Track your search and traffic metrics over time"})]}),e.jsx(f,{children:e.jsxs(J,{defaultValue:"traffic",className:"space-y-4",children:[e.jsxs(Z,{children:[e.jsx(b,{value:"traffic",children:"Traffic"}),e.jsx(b,{value:"search",children:"Search Performance"}),e.jsx(b,{value:"engagement",children:"Engagement"})]}),e.jsx(w,{value:"traffic",className:"space-y-4",children:e.jsx(I,{width:"100%",height:350,children:e.jsxs(Te,{data:s,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(T,{}),e.jsx(M,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:n=>[new Intl.NumberFormat().format(n),""]}),e.jsx(q,{}),e.jsx(E,{type:"monotone",dataKey:"sessions",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Sessions"}),e.jsx(E,{type:"monotone",dataKey:"users",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",name:"Users"}),e.jsx(E,{type:"monotone",dataKey:"pageviews",stackId:"3",stroke:"#ffc658",fill:"#ffc658",name:"Pageviews"})]})})}),e.jsx(w,{value:"search",className:"space-y-4",children:e.jsx(I,{width:"100%",height:350,children:e.jsxs(G,{data:s,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(T,{yAxisId:"left"}),e.jsx(T,{yAxisId:"right",orientation:"right"}),e.jsx(M,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:(n,a)=>a==="CTR"?[`${(n*100).toFixed(2)}%`,a]:a==="Avg Position"?[n.toFixed(1),a]:[new Intl.NumberFormat().format(n),a]}),e.jsx(q,{}),e.jsx(S,{yAxisId:"left",type:"monotone",dataKey:"clicks",stroke:"#8884d8",name:"Clicks",strokeWidth:2}),e.jsx(S,{yAxisId:"left",type:"monotone",dataKey:"impressions",stroke:"#82ca9d",name:"Impressions",strokeWidth:2}),e.jsx(S,{yAxisId:"right",type:"monotone",dataKey:"ctr",stroke:"#ffc658",name:"CTR",strokeWidth:2})]})})}),e.jsxs(w,{value:"engagement",className:"space-y-4",children:[e.jsx(I,{width:"100%",height:350,children:e.jsxs(G,{data:s,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(T,{}),e.jsx(M,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:(n,a)=>a==="Avg Position"?[n.toFixed(1),a]:[new Intl.NumberFormat().format(n),a]}),e.jsx(q,{}),e.jsx(S,{type:"monotone",dataKey:"position",stroke:"#8884d8",name:"Avg Position",strokeWidth:2})]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Lower position values are better (position 1 is the top result)"})]})]})})]})}function Y({startDate:r,endDate:t,platforms:i,limit:s=10}){const n=ze({startDate:r,endDate:t,platforms:i,limit:s});if(!n||n.length===0)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No query data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top queries"})]});const a=l=>new Intl.NumberFormat("en-US").format(l),o=l=>`${(l*100).toFixed(2)}%`,d=l=>l>0?e.jsx(z,{className:"h-3 w-3 text-green-600"}):l<0?e.jsx(P,{className:"h-3 w-3 text-red-600"}):e.jsx(B,{className:"h-3 w-3 text-muted-foreground"});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(A,{children:[e.jsx(h,{className:"w-[40%]",children:"Query"}),e.jsx(h,{className:"text-right",children:"Clicks"}),e.jsx(h,{className:"text-right",children:"Impressions"}),e.jsx(h,{className:"text-right",children:"CTR"}),e.jsx(h,{className:"text-right",children:"Position"}),e.jsx(h,{className:"text-right",children:"Trend"})]})}),e.jsx(ne,{children:n.map((l,c)=>e.jsxs(A,{children:[e.jsx(u,{className:"font-medium max-w-xs truncate",children:l.query}),e.jsx(u,{className:"text-right",children:a(l.clicks)}),e.jsx(u,{className:"text-right",children:a(l.impressions)}),e.jsx(u,{className:"text-right",children:e.jsx(_,{variant:"outline",children:o(l.ctr)})}),e.jsx(u,{className:"text-right",children:e.jsx(_,{variant:"secondary",children:l.position.toFixed(1)})}),e.jsx(u,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:d(l.change)})})]},`${l.query}-${c}`))})]})})}function H({startDate:r,endDate:t,platforms:i,limit:s=10}){const n=Qe({startDate:r,endDate:t,platforms:i,limit:s});if(!n||n.length===0)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No page data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top pages"})]});const a=c=>new Intl.NumberFormat("en-US").format(c),o=c=>`${(c*100).toFixed(2)}%`,d=c=>c>0?e.jsx(z,{className:"h-3 w-3 text-green-600"}):c<0?e.jsx(P,{className:"h-3 w-3 text-red-600"}):e.jsx(B,{className:"h-3 w-3 text-muted-foreground"}),l=(c,m=50)=>c.length<=m?c:c.substring(0,m)+"...";return e.jsx("div",{className:"rounded-md border",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(A,{children:[e.jsx(h,{className:"w-[35%]",children:"Page"}),e.jsx(h,{className:"text-right",children:"Clicks"}),e.jsx(h,{className:"text-right",children:"Sessions"}),e.jsx(h,{className:"text-right",children:"Impressions"}),e.jsx(h,{className:"text-right",children:"CTR"}),e.jsx(h,{className:"text-right",children:"Position"}),e.jsx(h,{className:"text-right",children:"Trend"}),e.jsx(h,{className:"w-[50px]"})]})}),e.jsx(ne,{children:n.map((c,m)=>e.jsxs(A,{children:[e.jsx(u,{className:"max-w-xs",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm truncate",title:c.url,children:l(c.url)}),c.title&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",title:c.title,children:c.title})]})}),e.jsx(u,{className:"text-right",children:a(c.clicks)}),e.jsx(u,{className:"text-right",children:a(c.sessions)}),e.jsx(u,{className:"text-right",children:a(c.impressions)}),e.jsx(u,{className:"text-right",children:e.jsx(_,{variant:"outline",children:o(c.ctr)})}),e.jsx(u,{className:"text-right",children:e.jsx(_,{variant:"secondary",children:c.position.toFixed(1)})}),e.jsx(u,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:d(c.change)})}),e.jsx(u,{children:e.jsx("a",{href:c.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80",children:e.jsx(X,{className:"h-4 w-4"})})})]},`${c.url}-${m}`))})]})})}function Ye({startDate:r,endDate:t,onChange:i}){const[s,n]=y.useState(!1),a=d=>{const l=new Date,c=new Date;c.setDate(c.getDate()-d),i(c.toISOString().split("T")[0],l.toISOString().split("T")[0]),n(!1)},o=[{label:"Last 7 days",days:7},{label:"Last 30 days",days:30},{label:"Last 90 days",days:90},{label:"Last 6 months",days:180},{label:"Last year",days:365}];return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(re,{open:s,onOpenChange:n,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),W(new Date(r),"MMM dd, yyyy")," - ",W(new Date(t),"MMM dd, yyyy")]})}),e.jsx(oe,{className:"w-auto p-4",align:"start",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Quick Select"}),e.jsx("div",{className:"grid gap-2",children:o.map(d=>e.jsx(v,{variant:"ghost",className:"justify-start",onClick:()=>a(d.days),children:d.label},d.label))})]})})})]})})}const He=[{value:"google_search_console",label:"Google Search Console"},{value:"google_analytics",label:"Google Analytics"},{value:"bing_webmaster",label:"Bing Webmaster"},{value:"yandex_webmaster",label:"Yandex Webmaster"}];function Ve({selectedPlatforms:r,onChange:t}){const i=s=>{r.includes(s)?t(r.filter(n=>n!==s)):t([...r,s])};return e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Platforms (",r.length,")"]})}),e.jsx(oe,{className:"w-64",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Filter by Platform"}),e.jsx("div",{className:"space-y-3",children:He.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{id:s.value,checked:r.includes(s.value),onCheckedChange:()=>i(s.value)}),e.jsx(Ne,{htmlFor:s.value,className:"text-sm font-normal cursor-pointer",children:s.label})]},s.value))})]})})]})}function Xe(r){const{headers:t,rows:i,title:s}=r;let n="";s&&(n+=`${s}

`),n+=t.join(",")+`
`,i.forEach(c=>{const m=c.map(C=>{const D=String(C);return D.includes(",")||D.includes('"')||D.includes(`
`)?`"${D.replace(/"/g,'""')}"`:D});n+=m.join(",")+`
`});const a=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(a),l=`${s?.replace(/\s+/g,"_")||"export"}_${new Date().toISOString().split("T")[0]}.csv`;o.setAttribute("href",d),o.setAttribute("download",l),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)}function Je(r){const{headers:t,rows:i,title:s,dateRange:n}=r;let a=`
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8">
            <title>${s||"Analytics Report"}</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 40px;
                    color: #333;
                }
                h1 {
                    color: #2563eb;
                    margin-bottom: 10px;
                }
                .date-range {
                    color: #666;
                    font-size: 14px;
                    margin-bottom: 30px;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 20px;
                }
                th {
                    background-color: #2563eb;
                    color: white;
                    padding: 12px;
                    text-align: left;
                    font-weight: 600;
                }
                td {
                    padding: 10px 12px;
                    border-bottom: 1px solid #e5e7eb;
                }
                tr:nth-child(even) {
                    background-color: #f9fafb;
                }
                .footer {
                    margin-top: 40px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    color: #666;
                    font-size: 12px;
                    text-align: center;
                }
            </style>
        </head>
        <body>
            <h1>${s||"Analytics Report"}</h1>
            ${n?`<div class="date-range">${n}</div>`:""}
            <table>
                <thead>
                    <tr>
                        ${t.map(d=>`<th>${d}</th>`).join("")}
                    </tr>
                </thead>
                <tbody>
                    ${i.map(d=>`<tr>${d.map(l=>`<td>${l}</td>`).join("")}</tr>`).join("")}
                </tbody>
            </table>
            <div class="footer">
                Generated on ${new Date().toLocaleString()} | AgentBio.net Analytics
            </div>
        </body>
        </html>
    `;const o=window.open("","","height=600,width=800");o&&(o.document.write(a),o.document.close(),o.onload=()=>{o.print(),setTimeout(()=>{o.close()},100)})}function V(r,t="Search Analytics Report",i){return{title:t,dateRange:i,headers:["Query","Clicks","Impressions","CTR","Avg. Position"],rows:r.map(s=>[s.query,s.clicks,s.impressions,`${(s.ctr*100).toFixed(2)}%`,s.position.toFixed(1)])}}const Ze=Ae,es=Fe,ss=y.forwardRef(({className:r,inset:t,children:i,...s},n)=>e.jsx(de,{ref:n,className:k("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100",t&&"pl-8",r),...s,children:i}));ss.displayName=de.displayName;const ts=y.forwardRef(({className:r,...t},i)=>e.jsx(me,{ref:i,className:k("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-gray-900 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));ts.displayName=me.displayName;const fe=y.forwardRef(({className:r,sideOffset:t=4,...i},s)=>e.jsx(Re,{children:e.jsx(ce,{ref:s,sideOffset:t,className:k("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-gray-900 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...i})}));fe.displayName=ce.displayName;const O=y.forwardRef(({className:r,inset:t,...i},s)=>e.jsx(le,{ref:s,className:k("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",r),...i}));O.displayName=le.displayName;const as=y.forwardRef(({className:r,children:t,checked:i,...s},n)=>e.jsxs(he,{ref:n,className:k("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:i,...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ue,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})})}),t]}));as.displayName=he.displayName;const ns=y.forwardRef(({className:r,children:t,...i},s)=>e.jsxs(xe,{ref:s,className:k("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ue,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-2 w-2",children:e.jsx("circle",{cx:"12",cy:"12",r:"12"})})})}),t]}));ns.displayName=xe.displayName;const rs=y.forwardRef(({className:r,inset:t,...i},s)=>e.jsx(pe,{ref:s,className:k("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",r),...i}));rs.displayName=pe.displayName;const is=y.forwardRef(({className:r,...t},i)=>e.jsx(ge,{ref:i,className:k("-mx-1 my-1 h-px bg-gray-200",r),...t}));is.displayName=ge.displayName;function Cs(){const{toast:r}=F(),[t,i]=y.useState({start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[s,n]=y.useState(["google_search_console","google_analytics"]),a=Ee(),o=async()=>{try{await a.mutateAsync({start_date:t.start,end_date:t.end,force_refresh:!0})}catch(c){console.error("Failed to refresh data:",c)}},d=()=>{const c=[{query:"luxury homes Los Angeles",clicks:245,impressions:1230,ctr:.199,position:3.2},{query:"real estate agent near me",clicks:189,impressions:2100,ctr:.09,position:5.8},{query:"homes for sale Beverly Hills",clicks:167,impressions:890,ctr:.188,position:2.1},{query:"best realtor LA",clicks:134,impressions:1500,ctr:.089,position:7.3},{query:"property listings California",clicks:98,impressions:670,ctr:.146,position:4.5}],m=`${t.start} to ${t.end}`,C=V(c,"Search Analytics Report",m);Xe(C),r({title:"Exported to CSV",description:"Your analytics data has been downloaded."})},l=()=>{const c=[{query:"luxury homes Los Angeles",clicks:245,impressions:1230,ctr:.199,position:3.2},{query:"real estate agent near me",clicks:189,impressions:2100,ctr:.09,position:5.8},{query:"homes for sale Beverly Hills",clicks:167,impressions:890,ctr:.188,position:2.1},{query:"best realtor LA",clicks:134,impressions:1500,ctr:.089,position:7.3},{query:"property listings California",clicks:98,impressions:670,ctr:.146,position:4.5}],m=`${t.start} to ${t.end}`,C=V(c,"Search Analytics Report",m);Je(C),r({title:"Opening PDF",description:"Your analytics report is being prepared for printing."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 flex-wrap",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:o,disabled:a.isPending,children:[e.jsx(Ie,{className:`h-4 w-4 mr-2 ${a.isPending?"animate-spin":""}`}),"Refresh Data"]}),e.jsxs(Ze,{children:[e.jsx(es,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(fe,{align:"end",children:[e.jsxs(O,{onClick:d,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Export to CSV"]}),e.jsxs(O,{onClick:l,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Export to PDF"]})]})]}),e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(Ke,{}),e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Filters"}),e.jsx(j,{children:"Customize your analytics view"})]}),e.jsxs(f,{className:"flex flex-wrap gap-4",children:[e.jsx(Ye,{startDate:t.start,endDate:t.end,onChange:(c,m)=>i({start:c,end:m})}),e.jsx(Ve,{selectedPlatforms:s,onChange:n})]})]}),e.jsxs(J,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(Z,{children:[e.jsx(b,{value:"overview",children:"Overview"}),e.jsx(b,{value:"queries",children:"Top Queries"}),e.jsx(b,{value:"pages",children:"Top Pages"}),e.jsx(b,{value:"devices",children:"Devices"}),e.jsx(b,{value:"countries",children:"Countries"})]}),e.jsxs(w,{value:"overview",className:"space-y-4",children:[e.jsx(We,{startDate:t.start,endDate:t.end,platforms:s}),e.jsx(Ge,{startDate:t.start,endDate:t.end,platforms:s}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Top 10 Queries"}),e.jsx(j,{children:"Highest performing search queries"})]}),e.jsx(f,{children:e.jsx(Y,{startDate:t.start,endDate:t.end,platforms:s,limit:10})})]}),e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Top 10 Pages"}),e.jsx(j,{children:"Highest performing pages"})]}),e.jsx(f,{children:e.jsx(H,{startDate:t.start,endDate:t.end,platforms:s,limit:10})})]})]})]}),e.jsx(w,{value:"queries",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"All Search Queries"}),e.jsx(j,{children:"Complete list of search queries with performance metrics"})]}),e.jsx(f,{children:e.jsx(Y,{startDate:t.start,endDate:t.end,platforms:s,limit:100})})]})}),e.jsx(w,{value:"pages",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"All Pages"}),e.jsx(j,{children:"Complete list of pages with traffic metrics"})]}),e.jsx(f,{children:e.jsx(H,{startDate:t.start,endDate:t.end,platforms:s,limit:100})})]})}),e.jsx(w,{value:"devices",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Device Breakdown"}),e.jsx(j,{children:"Performance metrics by device type"})]}),e.jsx(f,{children:e.jsx("p",{className:"text-muted-foreground",children:"Device analytics coming soon..."})})]})}),e.jsx(w,{value:"countries",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Geographic Distribution"}),e.jsx(j,{children:"Performance metrics by country"})]}),e.jsx(f,{children:e.jsx("p",{className:"text-muted-foreground",children:"Geographic analytics coming soon..."})})]})})]})]})}export{Ze as D,Cs as S,es as a,fe as b,O as c};
