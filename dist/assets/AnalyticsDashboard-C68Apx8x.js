import{j as e}from"./ui-vendor-CfJXqRNY.js";import{b as y}from"./react-vendor-J1CWpfuS.js";import{T as te,a as ae,b as D,c as V}from"./tabs-CoCrxbc5.js";import{N as C,V as T,aK as ne,R as U,Y as re,af as le,a4 as ie,e as oe,f as P,x as A,y as I,z as O,D as _,F as E,J as ce,B as q,h as X,ad as de,a6 as k,l as ue,s as F,a3 as Q}from"./index-B2XyC1QB.js";import{M as me}from"./minus-C-peTPZU.js";import{T as he}from"./trending-down-5LhoXedZ.js";import{L as G}from"./lightbulb-Bj2t3wl1.js";import{e as xe,a as L,s as S,c as z,d as W}from"./date-vendor-Xm6TBh54.js";import{g as pe}from"./exportUtils-x9xyIWKb.js";import{F as J}from"./file-text-DvkEQcYI.js";import{u as ge}from"./useAnalytics-BzRP5yza.js";import{b as ve,u as fe,d as B}from"./state-vendor-CLv4ylJ5.js";import"./supabase-Cz6j5Lvp.js";import"./three-vendor-D7cCqkiR.js";import"./charts-vendor-CEquIWeD.js";import"./form-vendor-DMOe4tsc.js";import"./animation-vendor-BZ61rGB5.js";import"./export-vendor-krJeBhBJ.js";function je({metrics:s,className:a}){return e.jsx("div",{className:C("grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",a),children:s.map(t=>e.jsx(be,{metric:t},t.name))})}function be({metric:s}){const a=()=>{switch(s.trend){case"up":return e.jsx(T,{className:"w-4 h-4"});case"down":return e.jsx(he,{className:"w-4 h-4"});case"flat":return e.jsx(me,{className:"w-4 h-4"})}},t=()=>{switch(s.trend){case"up":return"text-green-600 bg-green-100";case"down":return"text-red-600 bg-red-100";case"flat":return"text-gray-600 bg-gray-100"}},l=()=>s.unit==="$"?`$${s.value.toLocaleString()}`:s.unit==="%"?`${s.value.toFixed(1)}%`:s.unit==="min"?`${Math.round(s.value)} min`:s.value.toLocaleString();return e.jsxs("div",{className:"bg-white p-6 rounded-lg border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:s.name}),e.jsx("div",{className:C("p-2 rounded-full",t()),children:a()})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l()})}),e.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[e.jsxs("span",{className:C("text-sm font-medium",s.trend==="up"?"text-green-600":s.trend==="down"?"text-red-600":"text-gray-600"),children:[s.change>0?"+":"",s.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"vs last period"})]}),s.benchmark&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Benchmark: ",s.unit==="$"?"$":"",s.benchmark.toLocaleString(),s.unit==="%"?"%":""]})})]})}function ye({data:s,title:a,color:t="#2563eb",height:l=300,showPredictions:r=!1,className:c}){const{actualData:i,predictedData:p,maxValue:v,minValue:d}=y.useMemo(()=>{const o=s.filter(n=>!n.label),m=s.filter(n=>n.label==="predicted"),f=s.map(n=>n.value);return{actualData:o,predictedData:m,maxValue:Math.max(...f),minValue:Math.min(...f)}},[s]),u=o=>{const f=l-40,n=v-d||1;return 20+f-(o-d)/n*f},g=(o,m)=>40+o/(m-1)*720,N=(o,m=!1)=>o.length===0?"":o.map((j,M)=>({x:g(M,o.length),y:u(j.value)})).map((j,M)=>`${M===0?"M":"L"} ${j.x} ${j.y}`).join(" "),R=o=>{if(o.length===0)return"";const m=N(o),f=g(o.length-1,o.length),n=g(0,o.length),j=l-20;return`${m} L ${f} ${j} L ${n} ${j} Z`};return e.jsxs("div",{className:c,children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:a}),e.jsxs("svg",{width:"100%",height:l,viewBox:"0 0 800 300",className:"bg-white rounded-lg border",children:[e.jsx("g",{className:"grid-lines",children:[0,25,50,75,100].map(o=>{const m=20+(l-40)*(o/100);return e.jsxs("g",{children:[e.jsx("line",{x1:40,y1:m,x2:760,y2:m,stroke:"#e5e7eb",strokeWidth:1}),e.jsx("text",{x:25,y:m+4,fontSize:10,fill:"#6b7280",textAnchor:"end",children:Math.round(v-o/100*(v-d))})]},o)})}),e.jsx("path",{d:R(i),fill:t,fillOpacity:.1}),e.jsx("path",{d:N(i),fill:"none",stroke:t,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),r&&p.length>0&&e.jsx("path",{d:N(p),fill:"none",stroke:t,strokeWidth:2,strokeDasharray:"5,5",strokeOpacity:.5,strokeLinecap:"round",strokeLinejoin:"round"}),i.map((o,m)=>e.jsx("circle",{cx:g(m,i.length),cy:u(o.value),r:4,fill:"white",stroke:t,strokeWidth:2},m)),e.jsx("g",{className:"x-axis-labels",children:i.map((o,m)=>m%Math.ceil(i.length/7)===0?e.jsx("text",{x:g(m,i.length),y:l-5,fontSize:10,fill:"#6b7280",textAnchor:"middle",children:o.date},m):null)})]}),r&&p.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:t}}),e.jsx("span",{children:"Actual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:t,opacity:.5,borderTop:`2px dashed ${t}`}}),e.jsx("span",{children:"Predicted"})]})]})]})}function Ne({stages:s,className:a}){const t=s[0]?.count||1;return e.jsxs("div",{className:C("bg-white p-6 rounded-lg border",a),children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Conversion Funnel"}),e.jsx("div",{className:"space-y-2",children:s.map((l,r)=>e.jsxs("div",{children:[e.jsx(we,{stage:l,maxCount:t,isFirst:r===0,isLast:r===s.length-1}),!isLast&&l.dropoff!==void 0&&l.dropoff>0&&e.jsx(Re,{count:l.dropoff,percentage:Ce(l,s[r+1])})]},l.name))}),e.jsxs("div",{className:"mt-6 pt-6 border-t grid grid-cols-3 gap-4",children:[e.jsx(K,{label:"Overall Conversion",value:`${s[s.length-1].percentage.toFixed(1)}%`}),e.jsx(K,{label:"Total Conversions",value:s[s.length-1].count.toLocaleString()}),e.jsx(K,{label:"Total Dropoff",value:Me(s).toLocaleString()})]})]})}function we({stage:s,maxCount:a,isFirst:t,isLast:l}){const r=s.count/a*100,c=()=>s.percentage>=75?"bg-green-500":s.percentage>=50?"bg-yellow-500":s.percentage>=25?"bg-orange-500":"bg-red-500";return e.jsx("div",{className:"relative",children:e.jsx("div",{className:C("relative mx-auto rounded-lg p-4 transition-all duration-300 hover:shadow-md",c()),style:{width:`${Math.max(r,20)}%`},children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm opacity-90",children:[s.count.toLocaleString()," leads"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[s.percentage.toFixed(1),"%"]}),!t&&e.jsx("p",{className:"text-xs opacity-90",children:"of total"})]})]})})})}function Re({count:s,percentage:a}){return e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-red-600",children:s.toLocaleString()})," ","dropped off (",a.toFixed(1),"%)"]})]})})}function K({label:s,value:a}){return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s})]})}function Ce(s,a){return s.count===0?0:(s.count-a.count)/s.count*100}function Me(s){return s.length<2?0:s[0].count-s[s.length-1].count}function Le({sources:s,className:a}){const t=s.reduce((c,i)=>c+i.leads,0),l=s.reduce((c,i)=>c+i.revenue,0),r=[...s].sort((c,i)=>i.conversionRate-c.conversionRate);return e.jsxs("div",{className:C("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Lead Sources"}),e.jsxs("div",{className:"flex gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),t," leads"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),"$",l.toLocaleString()]})]})]}),e.jsx("div",{className:"space-y-4",children:r.map(c=>e.jsx(Se,{source:c,totalLeads:t},c.source))}),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No lead source data available"})]})]})}function Se({source:s,totalLeads:a}){const t=s.leads/a*100,l=r=>r>=20?"text-green-600":r>=10?"text-yellow-600":"text-gray-600";return e.jsxs("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 capitalize",children:s.source}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:C("text-lg font-bold",l(s.conversionRate)),children:[s.conversionRate.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"conversion"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Lead share"}),e.jsxs("span",{className:"font-medium",children:[t.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary rounded-full h-2 transition-all duration-500",style:{width:`${t}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Leads"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.leads})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conversions"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.conversions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Revenue"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["$",s.revenue.toLocaleString()]})]})]}),s.roi!==void 0&&e.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ROI"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:C("font-semibold",s.roi>0?"text-green-600":"text-red-600"),children:[s.roi>0?"+":"",s.roi.toFixed(1),"%"]})]})]})]})}function Y({insights:s,className:a}){return e.jsxs("div",{className:C("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Key Insights"})]}),e.jsx("div",{className:"space-y-3",children:s.map((t,l)=>e.jsx(Te,{insight:t},l))}),s.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No insights available yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Check back when you have more data"})]})]})}function Te({insight:s}){const a=()=>s.includes("ðŸ“ˆ")||s.includes("ðŸš€")||s.includes("ðŸŽ¯")?e.jsx(T,{className:"w-5 h-5 text-green-600"}):s.includes("âš ï¸")||s.includes("ðŸŒ")?e.jsx(ie,{className:"w-5 h-5 text-orange-600"}):s.includes("âš¡")||s.includes("ðŸŒŸ")?e.jsx(oe,{className:"w-5 h-5 text-blue-600"}):e.jsx(G,{className:"w-5 h-5 text-yellow-600"}),t=()=>s.includes("ðŸ“ˆ")||s.includes("ðŸš€")||s.includes("ðŸŽ¯")?"bg-green-50 border-green-200":s.includes("âš ï¸")||s.includes("ðŸŒ")?"bg-orange-50 border-orange-200":s.includes("âš¡")||s.includes("ðŸŒŸ")?"bg-blue-50 border-blue-200":"bg-yellow-50 border-yellow-200";return e.jsx("div",{className:C("p-4 rounded-lg border",t()),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a()}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:s})]})})}class b{static calculateKPIs(a,t){return[this.createMetric("Total Page Views",a.pageViews,"",t.pageViews),this.createMetric("Unique Visitors",a.uniqueVisitors,"",t.uniqueVisitors),this.createMetric("Total Leads",a.leads,"",t.leads),this.createMetric("Conversions",a.conversions,"",t.conversions),this.createMetric("Revenue",a.revenue,"$",t.revenue),this.createMetric("Avg Response Time",a.avgResponseTime,"min",t.avgResponseTime,!0),this.createMetric("Conversion Rate",this.calculateConversionRate(a.leads,a.conversions),"%",this.calculateConversionRate(t.leads,t.conversions)),this.createMetric("Lead-to-Visitor Rate",this.calculateConversionRate(a.uniqueVisitors,a.leads),"%",this.calculateConversionRate(t.uniqueVisitors,t.leads))]}static createMetric(a,t,l,r,c=!1){const i=this.calculatePercentageChange(t,r),p=this.determineTrend(i,c);return{name:a,value:t,unit:l,change:i,trend:p}}static calculatePercentageChange(a,t){return t===0?a>0?100:0:(a-t)/t*100}static determineTrend(a,t=!1){return Math.abs(a)<2?"flat":t?a<0?"up":"down":a>0?"up":"down"}static calculateConversionRate(a,t){return a===0?0:t/a*100}static generateTimeSeries(a,t,l){return xe({start:a,end:t}).map(c=>({date:L(c,"MMM d"),value:l(c)}))}static calculateFunnel(a){const{visitors:t,viewed:l,contacted:r,qualified:c,converted:i}=a;return[{name:"Visitors",count:t,percentage:100},{name:"Viewed Listing",count:l,percentage:this.calculateConversionRate(t,l),dropoff:t-l},{name:"Contacted",count:r,percentage:this.calculateConversionRate(t,r),dropoff:l-r},{name:"Qualified",count:c,percentage:this.calculateConversionRate(t,c),dropoff:r-c},{name:"Converted",count:i,percentage:this.calculateConversionRate(t,i),dropoff:c-i}]}static analyzeLeadSources(a){return a.map(t=>({source:t.source,leads:t.leads,conversions:t.conversions,conversionRate:this.calculateConversionRate(t.leads,t.conversions),revenue:t.revenue,roi:t.cost?(t.revenue-t.cost)/t.cost*100:void 0}))}static rankListings(a){return a.map(t=>({...t,conversionRate:this.calculateConversionRate(t.views,t.leads)})).sort((t,l)=>l.conversionRate-t.conversionRate)}static predictTrend(a,t=7){if(a.length<2)return[];const l=a.length,r=a.map((o,m)=>m),c=a.map(o=>o.value),i=r.reduce((o,m)=>o+m,0),p=c.reduce((o,m)=>o+m,0),v=r.reduce((o,m,f)=>o+m*c[f],0),d=r.reduce((o,m)=>o+m*m,0),u=(l*v-i*p)/(l*d-i*i),g=(p-u*i)/l,N=[],R=new Date(a[a.length-1].date);for(let o=1;o<=t;o++){const m=l+o-1,f=Math.max(0,Math.round(u*m+g)),n=new Date(R);n.setDate(n.getDate()+o),N.push({date:L(n,"MMM d"),value:f,label:"predicted"})}return N}static calculateEngagementScore(a){const{avgTimeOnPage:t,bounceRate:l,pagesPerSession:r,returnVisitorRate:c}=a,i=Math.min(t/180*25,25),p=Math.max((100-l)/4,0),v=Math.min(r/5*25,25),d=c/100*25;return Math.round(i+p+v+d)}static generateInsights(a,t,l){const r=[],c=this.calculatePercentageChange(a.leads,t.leads);c>20?r.push(`ðŸ“ˆ Lead generation is up ${Math.round(c)}% compared to last period`):c<-20&&r.push(`âš ï¸ Lead generation is down ${Math.abs(Math.round(c))}% - consider increasing marketing efforts`);const i=this.calculateConversionRate(a.leads,a.conversions),p=this.calculateConversionRate(t.leads,t.conversions);if(i>p+5&&r.push(`ðŸŽ¯ Conversion rate improved to ${i.toFixed(1)}% - keep up the good work!`),a.avgResponseTime<5?r.push("âš¡ Excellent response time! You're responding in under 5 minutes"):a.avgResponseTime>60&&r.push(`ðŸŒ Response time is high (${Math.round(a.avgResponseTime)} min) - faster responses increase conversions`),l.length>0){const d=l.reduce((u,g)=>g.conversionRate>u.conversionRate?g:u);d.conversionRate>15&&r.push(`ðŸŒŸ ${d.source} is your best performing source at ${d.conversionRate.toFixed(1)}% conversion rate`)}const v=this.calculatePercentageChange(a.uniqueVisitors,t.uniqueVisitors);return v>30&&r.push(`ðŸš€ Traffic is surging! Up ${Math.round(v)}% - great time to capture leads`),r}static exportToCSV(a,t){if(a.length===0)return;const l=Object.keys(a[0]),r=[l.join(","),...a.map(v=>l.map(d=>JSON.stringify(v[d]||"")).join(","))].join(`
`),c=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),p=URL.createObjectURL(c);i.setAttribute("href",p),i.setAttribute("download",`${t}_${Date.now()}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}const De=b.calculateKPIs.bind(b);b.generateTimeSeries.bind(b);const Ve=b.calculateFunnel.bind(b),ke=b.analyzeLeadSources.bind(b);b.rankListings.bind(b);const Fe=b.predictTrend.bind(b);b.calculateEngagementScore.bind(b);const $e=b.generateInsights.bind(b),qe=b.exportToCSV.bind(b);function Pe({onGenerateReport:s,className:a}){const[t,l]=y.useState("leads"),[r,c]=y.useState("30d"),[i,p]=y.useState("csv"),[v,d]=y.useState(!1),u=[{value:"leads",label:"Leads Report"},{value:"listings",label:"Listings Performance"},{value:"conversions",label:"Conversion Analytics"},{value:"sources",label:"Lead Sources"},{value:"performance",label:"Overall Performance"}],g=[{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"90d",label:"Last 90 Days"},{value:"this_month",label:"This Month"},{value:"last_month",label:"Last Month"}],N=[{value:"csv",label:"CSV",disabled:!1},{value:"pdf",label:"PDF",disabled:!1},{value:"excel",label:"Excel (Coming Soon)",disabled:!0}],R=()=>{const n=new Date;switch(r){case"7d":return{start:S(n,7),end:n};case"30d":return{start:S(n,30),end:n};case"90d":return{start:S(n,90),end:n};case"this_month":return{start:z(n),end:W(n)};case"last_month":const j=S(z(n),1);return{start:z(j),end:W(j)};default:return{start:S(n,30),end:n}}},o=()=>({leads:"Leads Report",listings:"Listings Performance Report",conversions:"Conversion Analytics Report",sources:"Lead Sources Report",performance:"Overall Performance Report"})[t]||"Analytics Report",m=async()=>{d(!0);try{const{start:n,end:j}=R(),M=`${L(n,"MMM d, yyyy")} - ${L(j,"MMM d, yyyy")}`,x=await s({reportType:t,dateRange:r,metrics:[],format:i,startDate:n,endDate:j});if(i==="csv"){const w=`${t}_report_${L(n,"yyyy-MM-dd")}_to_${L(j,"yyyy-MM-dd")}`;qe(x,w),k.success("CSV report exported successfully!")}else if(i==="pdf")if(x&&x.length>0){const w=Object.keys(x[0]),H=x.map(ee=>w.map(se=>ee[se]??"")),Z=f(x,t);pe({title:o(),dateRange:M,headers:w,rows:H,summary:Z,orientation:w.length>5?"landscape":"portrait"}),k.success("PDF report generated successfully!")}else k.error("No data available for report")}catch(n){console.error("Report generation error:",n),k.error("Failed to generate report")}finally{d(!1)}},f=(n,j)=>{switch(j){case"leads":return[{label:"Total Leads",value:n.length},{label:"New Leads",value:n.filter(h=>h.status==="new").length},{label:"Qualified",value:n.filter(h=>h.status==="qualified").length}];case"listings":return[{label:"Total Listings",value:n.length},{label:"Active",value:n.filter(h=>h.status==="active").length},{label:"Sold",value:n.filter(h=>h.status==="sold").length}];case"conversions":return[{label:"Total Conversions",value:n.reduce((h,x)=>h+(x.conversions||0),0)},{label:"Records",value:n.length}];case"sources":return[{label:"Total Sources",value:n.length},{label:"Total Leads",value:n.reduce((h,x)=>h+(x.count||0),0)}];default:return[{label:"Total Records",value:n.length}]}};return e.jsxs("div",{className:C("bg-white p-6 rounded-lg border",a),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Custom Report Builder"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Report Type"}),e.jsxs(A,{value:t,onValueChange:n=>l(n),children:[e.jsx(I,{children:e.jsx(O,{})}),e.jsx(_,{children:u.map(n=>e.jsx(E,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Date Range"]}),e.jsxs(A,{value:r,onValueChange:n=>c(n),children:[e.jsx(I,{children:e.jsx(O,{})}),e.jsx(_,{children:g.map(n=>e.jsx(E,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Export Format"}),e.jsxs(A,{value:i,onValueChange:n=>p(n),children:[e.jsx(I,{children:e.jsx(O,{})}),e.jsx(_,{children:N.map(n=>e.jsx(E,{value:n.value,disabled:n.disabled,children:n.label},n.value))})]})]}),e.jsx(q,{onClick:m,disabled:v,className:"w-full gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Generating ",i.toUpperCase(),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Generate Report"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Report Preview"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:["Type: ",e.jsx("span",{className:"font-medium",children:t})]}),e.jsxs("p",{children:["Range:"," ",e.jsxs("span",{className:"font-medium",children:[L(R().start,"MMM d, yyyy")," ","-"," ",L(R().end,"MMM d, yyyy")]})]}),e.jsxs("p",{children:["Format:"," ",e.jsx("span",{className:"font-medium uppercase",children:i})]})]})]})]})}function Ae(){const{user:s}=ue(),a=ve(),{data:t=[],isLoading:l,isError:r,error:c,refetch:i}=fe({queryKey:["leads",s?.id],queryFn:async()=>{if(!s?.id)return[];const{data:u,error:g}=await F.from("leads").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(g)throw g;return u},enabled:!!s?.id,staleTime:300*1e3,gcTime:600*1e3}),p=B({mutationFn:async u=>{const{data:g,error:N}=await F.from("leads").insert(u).select().single();if(N)throw N;return g},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",s?.id]})}}),v=B({mutationFn:async({id:u,...g})=>{if(!s?.id)throw new Error("User not authenticated");const{data:N,error:R}=await F.from("leads").update(g).eq("id",u).eq("user_id",s.id).select().single();if(R)throw R;return N},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",s?.id]})}}),d=B({mutationFn:async u=>{if(!s?.id)throw new Error("User not authenticated");const{error:g}=await F.from("leads").delete().eq("id",u).eq("user_id",s.id);if(g)throw g},onSuccess:()=>{a.invalidateQueries({queryKey:["leads",s?.id]})}});return{leads:t,isLoading:l,isError:r,error:c,refetch:i,addLead:p,updateLead:v,deleteLead:d}}function ts(){const[s,a]=y.useState(!0),[t,l]=y.useState("30d"),{stats:r,viewsData:c,isLoading:i}=ge(t),{leads:p}=Ae(),v=new Date,d=y.useMemo(()=>({pageViews:r.totalViews,uniqueVisitors:r.uniqueVisitors,leads:r.totalLeads,conversions:p.filter(h=>h.status==="converted").length,revenue:0,avgResponseTime:0,period:t==="7d"?"week":t==="30d"?"month":"quarter",startDate:S(v,t==="7d"?7:t==="30d"?30:90),endDate:v}),[r,p,t,v]),u=y.useMemo(()=>({pageViews:Math.round(r.totalViews*.85),uniqueVisitors:Math.round(r.uniqueVisitors*.85),leads:Math.round(r.totalLeads*.85),conversions:Math.round(p.filter(h=>h.status==="converted").length*.85),revenue:0,avgResponseTime:0,period:d.period,startDate:S(d.startDate,t==="7d"?7:t==="30d"?30:90),endDate:d.startDate}),[r,p,d,t]),g=y.useMemo(()=>c.map(h=>({date:new Date(h.name),value:h.views,label:h.name})),[c]),N=y.useMemo(()=>g.length>0?Fe(g,7):[],[g]),R=[...g,...s?N:[]],o=y.useMemo(()=>De(d,u),[d,u]),m=y.useMemo(()=>Ve({visitors:d.uniqueVisitors,viewed:Math.round(d.uniqueVisitors*.7),contacted:d.leads,qualified:p.filter(h=>h.status==="qualified"||h.status==="converted").length,converted:d.conversions}),[d,p]),f=y.useMemo(()=>{const h={};return p.forEach(x=>{const w=x.source||"website";h[w]||(h[w]={leads:0,conversions:0}),h[w].leads++,x.status==="converted"&&h[w].conversions++}),Object.entries(h).map(([x,w])=>({source:x,leads:w.leads,conversions:w.conversions,revenue:0,cost:0}))},[p]),n=y.useMemo(()=>ke(f.length>0?f:[{source:"website",leads:0,conversions:0,revenue:0,cost:0}]),[f]),j=y.useMemo(()=>$e(d,u,n),[d,u,n]),M=async h=>{switch(h.reportType){case"leads":return p.map(x=>({id:x.id,name:x.name||"Unknown",email:x.email||"",source:x.source||"website",status:x.status||"new",score:x.score||0,created:x.created_at}));case"sources":return n.map(x=>({source:x.source,leads:x.leads,conversions:x.conversions,conversion_rate:`${x.conversionRate.toFixed(1)}%`,revenue:x.revenue,roi:x.roi?`${x.roi.toFixed(1)}%`:"N/A"}));default:return[{metric:"Page Views",current:d.pageViews,previous:u.pageViews,change:u.pageViews>0?`${((d.pageViews-u.pageViews)/u.pageViews*100).toFixed(1)}%`:"N/A"},{metric:"Leads",current:d.leads,previous:u.leads,change:u.leads>0?`${((d.leads-u.leads)/u.leads*100).toFixed(1)}%`:"N/A"},{metric:"Conversions",current:d.conversions,previous:u.conversions,change:u.conversions>0?`${((d.conversions-u.conversions)/u.conversions*100).toFixed(1)}%`:"N/A"}]}};return i?e.jsx("div",{className:"container mx-auto py-6 flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(X,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your performance and gain insights"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{variant:t==="7d"?"default":"outline",size:"sm",onClick:()=>l("7d"),children:"7 Days"}),e.jsx(q,{variant:t==="30d"?"default":"outline",size:"sm",onClick:()=>l("30d"),children:"30 Days"}),e.jsx(q,{variant:t==="90d"?"default":"outline",size:"sm",onClick:()=>l("90d"),children:"90 Days"})]})]}),r.totalViews===0&&r.totalLeads===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"No Data Yet"}),e.jsx("p",{className:"text-blue-700",children:"Start sharing your profile to see analytics data here. Views and leads will be tracked automatically."})]}),e.jsx(je,{metrics:o}),e.jsxs(te,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ae,{className:"grid w-full grid-cols-4 max-w-2xl",children:[e.jsxs(D,{value:"overview",className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(D,{value:"funnel",className:"gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Funnel"]}),e.jsxs(D,{value:"sources",className:"gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Sources"]}),e.jsxs(D,{value:"reports",className:"gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Reports"]})]}),e.jsx(V,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ye,{data:R,title:"Lead Generation Trend",color:"#2563eb",showPredictions:s})}),e.jsx(Y,{insights:j})]})}),e.jsx(V,{value:"funnel",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ne,{stages:m}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{insights:j}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Optimization Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Improve Viewed â†’ Contacted rate with clearer CTAs"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Reduce dropoff with faster response times"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Qualify leads better with targeted questions"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary",children:"â€¢"}),e.jsx("span",{children:"Nurture qualified leads with follow-ups"})]})]})]})]})]})}),e.jsx(V,{value:"sources",className:"mt-6",children:e.jsx(Le,{sources:n})}),e.jsx(V,{value:"reports",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Available Reports"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx($,{title:"Leads Report",description:"Detailed lead data with scores and sources",icon:e.jsx(U,{className:"w-6 h-6"})}),e.jsx($,{title:"Performance Report",description:"Overall performance metrics and trends",icon:e.jsx(T,{className:"w-6 h-6"})}),e.jsx($,{title:"Sources Report",description:"Lead source analysis with ROI",icon:e.jsx(Q,{className:"w-6 h-6"})}),e.jsx($,{title:"Conversion Report",description:"Conversion funnel and rates",icon:e.jsx(T,{className:"w-6 h-6"})})]})]})}),e.jsx(Pe,{onGenerateReport:M})]})})]})]})}function $({title:s,description:a,icon:t}){return e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg text-primary",children:t}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:s}),e.jsx("p",{className:"text-sm text-gray-600",children:a})]})]})})}export{ts as default};
