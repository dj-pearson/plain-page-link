import{b as w,u as q,d as a}from"./state-vendor-BElgh7Si.js";import{l as T,u as E,s as o}from"./index-DMBvLcus.js";function F(){const{user:t}=T(),n=w(),{toast:r}=E(),{data:u=[],isLoading:l,isError:c,error:m,refetch:f}=q({queryKey:["testimonials",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:e,error:i}=await o.from("testimonials").select("*").eq("user_id",t.id).order("date",{ascending:!1});if(i)throw i;return e},enabled:!!t?.id}),y=a({mutationFn:async e=>{if(!t?.id)throw new Error("User not authenticated");const{data:i,error:s}=await o.from("testimonials").insert({user_id:t.id,...e}).select().single();if(s)throw s;return i},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",t?.id]}),r({title:"Testimonial Added",description:"Your testimonial has been added successfully."})},onError:e=>{r({title:"Failed to Add Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),h=a({mutationFn:async({id:e,...i})=>{if(!t?.id)throw new Error("User not authenticated");const{data:s,error:d}=await o.from("testimonials").update(i).eq("id",e).eq("user_id",t.id).select().single();if(d)throw d;return s},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",t?.id]}),r({title:"Testimonial Updated",description:"Your testimonial has been updated successfully."})},onError:e=>{r({title:"Failed to Update Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),p=a({mutationFn:async e=>{if(!t?.id)throw new Error("User not authenticated");const{error:i}=await o.from("testimonials").delete().eq("id",e).eq("user_id",t.id);if(i)throw i},onSuccess:()=>{n.invalidateQueries({queryKey:["testimonials",t?.id]}),r({title:"Testimonial Deleted",description:"Your testimonial has been deleted successfully."})},onError:e=>{r({title:"Failed to Delete Testimonial",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}});return{testimonials:u,isLoading:l,isError:c,error:m,refetch:f,addTestimonial:y,updateTestimonial:h,deleteTestimonial:p}}export{F as u};
