import{r as c,j as e}from"./react-vendor-CotwlNTQ.js";import{u as R}from"./index-sCAK2lXW.js";import{u as D}from"./data-15YcDnrk.js";import{s as S}from"./supabase-Ba7v9dZh.js";import{u as P}from"./state-stores-BuSRU7CA.js";import{u as E,U as I}from"./UpgradeModal-D_pdeQ4u.js";import{D as q,l as B,m as O,n as A,G as F,I as W,j as N,B as C,C as n,o}from"./ui-components-XxFWEsul.js";import{u as $}from"./useProfile-CBbwI6SV.js";import{Z as L,J as H,aD as z,L as T,c as G,h as Q,a1 as J,S as V,M as Z,P as U,e as Y,q as M,a0 as K}from"./icons-CcUX9GkC.js";import"./charts-hR54p0E0.js";import"./utils-BpArqNZu.js";import"./three-addons-CjyX6BZ_.js";import"./three-D6omocmH.js";import"./forms-Dr9C5XML.js";function X({open:d,onOpenChange:y}){const{toast:l}=R(),{profile:j,refetch:w}=$(),[r,m]=c.useState(j?.zapier_webhook_url||""),[p,x]=c.useState(!1),[t,v]=c.useState(!1),[h,u]=c.useState(null),k=async()=>{x(!0);try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:a}=await S.from("profiles").update({zapier_webhook_url:r||null}).eq("id",s.id);if(a)throw a;await w(),l({title:"Saved!",description:r?"Zapier webhook configured successfully":"Zapier webhook removed"})}catch{l({title:"Error",description:"Failed to save webhook URL",variant:"destructive"})}finally{x(!1)}},f=async()=>{if(!r){l({title:"Error",description:"Please enter a webhook URL first",variant:"destructive"});return}v(!0),u(null);try{const s={test:!0,lead_id:"test-lead-id",name:"Test Lead",email:"test@example.com",phone:"+1 555-123-4567",message:"This is a test lead from AgentBio.net",lead_type:"contact",created_at:new Date().toISOString()},a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok)u("success"),l({title:"Test successful!",description:"Your Zapier webhook is working correctly"});else throw new Error(`HTTP ${a.status}`)}catch{u("error"),l({title:"Test failed",description:"Could not reach your webhook. Check the URL and try again.",variant:"destructive"})}finally{v(!1)}};return e.jsx(q,{open:d,onOpenChange:y,children:e.jsxs(B,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(O,{children:[e.jsxs(A,{className:"text-2xl flex items-center gap-2",children:[e.jsx(L,{className:"h-6 w-6 text-orange-500"}),"Zapier Integration"]}),e.jsx(F,{children:"Automatically send new leads to your CRM via Zapier"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Zapier Webhook URL"}),e.jsx(W,{type:"url",placeholder:"https://hooks.zapier.com/hooks/catch/...",value:r,onChange:s=>m(s.target.value),className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Paste your Zapier webhook URL here"})]}),h&&e.jsxs("div",{className:`p-3 rounded-lg flex items-center gap-2 ${h==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[h==="success"?e.jsx(H,{className:"h-5 w-5"}):e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:h==="success"?"Webhook test successful!":"Webhook test failed. Check your URL."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{onClick:f,variant:"outline",disabled:t||!r,className:"flex-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Test Webhook"]})}),e.jsx(N,{onClick:k,disabled:p,className:"flex-1",children:p?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Configuration"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-blue-900 mb-2",children:"How to set up Zapier integration:"}),e.jsxs("ol",{className:"text-blue-800 space-y-2 list-decimal list-inside",children:[e.jsxs("li",{children:["Go to"," ",e.jsxs("a",{href:"https://zapier.com",target:"_blank",rel:"noopener noreferrer",className:"underline inline-flex items-center gap-1",children:["Zapier.com",e.jsx(Q,{className:"h-3 w-3"})]})," ","and create a new Zap"]}),e.jsx("li",{children:'Choose "Webhooks by Zapier" as the trigger'}),e.jsx("li",{children:'Select "Catch Hook" as the event'}),e.jsx("li",{children:"Copy the webhook URL Zapier provides"}),e.jsx("li",{children:"Paste it in the field above and save"}),e.jsx("li",{children:"Connect your CRM (Salesforce, HubSpot, etc.) as the action"}),e.jsx("li",{children:"Map the lead fields to your CRM fields"}),e.jsx("li",{children:"Turn on your Zap!"})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Available Fields in Webhook Payload:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs font-mono",children:[e.jsx("div",{className:"text-gray-600",children:"lead_id"}),e.jsx("div",{className:"text-gray-600",children:"name"}),e.jsx("div",{className:"text-gray-600",children:"email"}),e.jsx("div",{className:"text-gray-600",children:"phone"}),e.jsx("div",{className:"text-gray-600",children:"message"}),e.jsx("div",{className:"text-gray-600",children:"lead_type"}),e.jsx("div",{className:"text-gray-600",children:"price_range"}),e.jsx("div",{className:"text-gray-600",children:"timeline"}),e.jsx("div",{className:"text-gray-600",children:"property_address"}),e.jsx("div",{className:"text-gray-600",children:"preapproved"}),e.jsx("div",{className:"text-gray-600",children:"referrer_url"}),e.jsx("div",{className:"text-gray-600",children:"utm_source"}),e.jsx("div",{className:"text-gray-600",children:"utm_medium"}),e.jsx("div",{className:"text-gray-600",children:"utm_campaign"}),e.jsx("div",{className:"text-gray-600",children:"device"}),e.jsx("div",{className:"text-gray-600",children:"created_at"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-purple-900",children:"⚡ Benefits of Zapier Integration:"}),e.jsxs("ul",{className:"text-sm text-purple-800 space-y-1",children:[e.jsx("li",{children:"• Automatically sync leads to 5,000+ apps"}),e.jsx("li",{children:"• Connect to popular CRMs (Salesforce, HubSpot, Zoho)"}),e.jsx("li",{children:"• Send leads to Google Sheets for easy tracking"}),e.jsx("li",{children:"• Get instant Slack/Teams notifications for new leads"}),e.jsx("li",{children:"• Create tasks in your project management tools"})]})]})]})]})})}function pe(){const[d,y]=c.useState(""),[l,j]=c.useState(!1),[w,r]=c.useState(!1),{user:m}=P(),{toast:p}=R(),{subscription:x}=E(),{data:t,isLoading:v}=D({queryKey:["leads",m?.id],queryFn:async()=>{if(!m?.id)return[];const{data:s,error:a}=await S.from("leads").select("*").eq("user_id",m.id).order("created_at",{ascending:!1});if(a)throw a;return s},enabled:!!m?.id}),h=()=>{if(x?.plan_name==="free"){j(!0);return}if(!t||t.length===0){p({title:"No leads to export",description:"You don't have any leads yet.",variant:"destructive"});return}const a=[["Name","Email","Phone","Type","Message","Status","Created At"].join(","),...t.map(i=>[i.name,i.email,i.phone||"",i.lead_type,`"${(i.message||"").replace(/"/g,'""')}"`,i.status,new Date(i.created_at).toLocaleDateString()].join(","))].join(`
`),b=new Blob([a],{type:"text/csv"}),_=URL.createObjectURL(b),g=document.createElement("a");g.href=_,g.download=`leads-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(_),p({title:"Leads exported",description:`Successfully exported ${t.length} leads to CSV`})},u=s=>{const b={new:{variant:"default",label:"New"},contacted:{variant:"secondary",label:"Contacted"},qualified:{variant:"outline",label:"Qualified"},converted:{variant:"default",label:"Converted"}}[s]||{variant:"outline",label:s};return e.jsx(C,{variant:b.variant,children:b.label})},k=s=>{switch(s){case"buyer":return e.jsx(K,{className:"h-4 w-4"});case"seller":return e.jsx(U,{className:"h-4 w-4"});case"valuation":return e.jsx(Z,{className:"h-4 w-4"});default:return e.jsx(M,{className:"h-4 w-4"})}},f=t?.filter(s=>d?s.name.toLowerCase().includes(d.toLowerCase())||s.email.toLowerCase().includes(d.toLowerCase()):!0);return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Lead Management"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Track and follow up with your inquiries"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(N,{onClick:()=>r(!0),variant:"outline",className:"flex-1 sm:flex-none min-h-[44px] active:scale-95 transition-all",children:[e.jsx(L,{className:"h-4 w-4 mr-2 text-orange-500"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Zapier"})]}),e.jsxs(N,{onClick:h,variant:"outline",disabled:!t||t.length===0,className:"flex-1 sm:flex-none min-h-[44px] active:scale-95 transition-all",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Export CSV"}),x?.plan_name==="free"&&e.jsx(C,{variant:"secondary",className:"ml-2",children:"Pro"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsxs(o,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:t?.length||0}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Total Leads"})]})}),e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsxs(o,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:t?.filter(s=>s.status==="new").length||0}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"New"})]})}),e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsxs(o,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:t?.filter(s=>s.status==="contacted").length||0}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Contacted"})]})}),e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsxs(o,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:t?.filter(s=>s.status==="converted").length||0}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Converted"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search leads by name or email...",value:d,onChange:s=>y(s.target.value),className:"w-full pl-10 pr-4 py-2.5 sm:py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm sm:text-base min-h-[44px]"})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:v?e.jsx(n,{children:e.jsx(o,{className:"p-6 sm:p-8 text-center text-muted-foreground text-sm sm:text-base",children:"Loading leads..."})}):f&&f.length>0?f.map(s=>e.jsx(n,{className:"hover:shadow-md active:shadow-lg transition-all",children:e.jsx(o,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:k(s.lead_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground truncate",children:s.name}),u(s.status),e.jsx(C,{variant:"outline",className:"capitalize text-xs",children:s.lead_type})]}),e.jsxs("div",{className:"space-y-1.5 text-xs sm:text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 min-h-[32px]",children:[e.jsx(Z,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:text-primary active:text-primary-dark break-all",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 min-h-[32px]",children:[e.jsx(U,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-primary active:text-primary-dark",children:s.phone})]}),s.message&&e.jsx("p",{className:"mt-2 text-foreground line-clamp-2 text-xs sm:text-sm leading-relaxed",children:s.message})]})]})]}),e.jsx("div",{className:"text-left sm:text-right flex-shrink-0 pl-12 sm:pl-0",children:e.jsxs("div",{className:"flex sm:justify-end items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})]})})]})})},s.id)):e.jsx(n,{children:e.jsxs(o,{className:"p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-accent rounded-full mb-3 sm:mb-4",children:e.jsx(M,{className:"h-7 w-7 sm:h-8 sm:w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 sm:mb-2",children:"No leads yet"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto",children:"Leads will appear here when visitors contact you through your profile"})]})})}),e.jsx(I,{open:l,onOpenChange:j,feature:"lead_export",currentPlan:x?.plan_name||"Free",requiredPlan:"Starter"}),e.jsx(X,{open:w,onOpenChange:r})]})}export{pe as default};
