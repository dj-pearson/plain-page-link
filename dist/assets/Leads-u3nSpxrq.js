import{r as e,j as s}from"./react-vendor-CGQ4_CNL.js";import{u as a}from"./index-DU1AD4H-.js";import{u as t}from"./data-O5cD9hjv.js";import{s as r,u as l}from"./supabase-C4LM9fgr.js";import{u as i,U as n}from"./UpgradeModal-CZHI1I0b.js";import{D as o,l as d,m as c,n as m,G as x,I as h,j as p,B as u,C as j,o as f}from"./ui-components-BBur-bM0.js";import{u as g}from"./useProfile-DOatPw8C.js";import{Z as v,J as N,aD as b,L as y,c as w,h as k,a1 as C,S,M as _,P as L,e as Z,q as T,a0 as R}from"./icons-BX9Iz4zT.js";import"./charts-D_q0pR-d.js";import"./utils-wmY8hpgz.js";import"./three-addons-DQ5hBofG.js";import"./three-BxgHQpUo.js";import"./forms-BzNDvv3d.js";function U({open:t,onOpenChange:l}){const{toast:i}=a(),{profile:n,refetch:u}=g(),[j,f]=e.useState(n?.zapier_webhook_url||""),[C,S]=e.useState(!1),[_,L]=e.useState(!1),[Z,T]=e.useState(null);return s.jsx(o,{open:t,onOpenChange:l,children:s.jsxs(d,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(c,{children:[s.jsxs(m,{className:"text-2xl flex items-center gap-2",children:[s.jsx(v,{className:"h-6 w-6 text-orange-500"}),"Zapier Integration"]}),s.jsx(x,{children:"Automatically send new leads to your CRM via Zapier"})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Zapier Webhook URL"}),s.jsx(h,{type:"url",placeholder:"https://hooks.zapier.com/hooks/catch/...",value:j,onChange:e=>f(e.target.value),className:"font-mono text-sm"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Paste your Zapier webhook URL here"})]}),Z&&s.jsxs("div",{className:"p-3 rounded-lg flex items-center gap-2 "+("success"===Z?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"),children:["success"===Z?s.jsx(N,{className:"h-5 w-5"}):s.jsx(b,{className:"h-5 w-5"}),s.jsx("span",{className:"text-sm font-medium",children:"success"===Z?"Webhook test successful!":"Webhook test failed. Check your URL."})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(p,{onClick:async()=>{if(j){L(!0),T(null);try{const e={test:!0,lead_id:"test-lead-id",name:"Test Lead",email:"test@example.com",phone:"+1 555-123-4567",message:"This is a test lead from AgentBio.net",lead_type:"contact",created_at:(new Date).toISOString()},s=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error(`HTTP ${s.status}`);T("success"),i({title:"Test successful!",description:"Your Zapier webhook is working correctly"})}catch(e){T("error"),i({title:"Test failed",description:"Could not reach your webhook. Check the URL and try again.",variant:"destructive"})}finally{L(!1)}}else i({title:"Error",description:"Please enter a webhook URL first",variant:"destructive"})},variant:"outline",disabled:_||!j,className:"flex-1",children:_?s.jsxs(s.Fragment,{children:[s.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Testing..."]}):s.jsxs(s.Fragment,{children:[s.jsx(v,{className:"h-4 w-4 mr-2"}),"Test Webhook"]})}),s.jsx(p,{onClick:async()=>{S(!0);try{const{data:{user:e}}=await r.auth.getUser();if(!e)throw new Error("Not authenticated");const{error:s}=await r.from("profiles").update({zapier_webhook_url:j||null}).eq("id",e.id);if(s)throw s;await u(),i({title:"Saved!",description:j?"Zapier webhook configured successfully":"Zapier webhook removed"})}catch(e){i({title:"Error",description:"Failed to save webhook URL",variant:"destructive"})}finally{S(!1)}},disabled:C,className:"flex-1",children:C?s.jsxs(s.Fragment,{children:[s.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Configuration"})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(w,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{className:"font-semibold text-blue-900 mb-2",children:"How to set up Zapier integration:"}),s.jsxs("ol",{className:"text-blue-800 space-y-2 list-decimal list-inside",children:[s.jsxs("li",{children:["Go to"," ",s.jsxs("a",{href:"https://zapier.com",target:"_blank",rel:"noopener noreferrer",className:"underline inline-flex items-center gap-1",children:["Zapier.com",s.jsx(k,{className:"h-3 w-3"})]})," ","and create a new Zap"]}),s.jsx("li",{children:'Choose "Webhooks by Zapier" as the trigger'}),s.jsx("li",{children:'Select "Catch Hook" as the event'}),s.jsx("li",{children:"Copy the webhook URL Zapier provides"}),s.jsx("li",{children:"Paste it in the field above and save"}),s.jsx("li",{children:"Connect your CRM (Salesforce, HubSpot, etc.) as the action"}),s.jsx("li",{children:"Map the lead fields to your CRM fields"}),s.jsx("li",{children:"Turn on your Zap!"})]})]})]})}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Available Fields in Webhook Payload:"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs font-mono",children:[s.jsx("div",{className:"text-gray-600",children:"lead_id"}),s.jsx("div",{className:"text-gray-600",children:"name"}),s.jsx("div",{className:"text-gray-600",children:"email"}),s.jsx("div",{className:"text-gray-600",children:"phone"}),s.jsx("div",{className:"text-gray-600",children:"message"}),s.jsx("div",{className:"text-gray-600",children:"lead_type"}),s.jsx("div",{className:"text-gray-600",children:"price_range"}),s.jsx("div",{className:"text-gray-600",children:"timeline"}),s.jsx("div",{className:"text-gray-600",children:"property_address"}),s.jsx("div",{className:"text-gray-600",children:"preapproved"}),s.jsx("div",{className:"text-gray-600",children:"referrer_url"}),s.jsx("div",{className:"text-gray-600",children:"utm_source"}),s.jsx("div",{className:"text-gray-600",children:"utm_medium"}),s.jsx("div",{className:"text-gray-600",children:"utm_campaign"}),s.jsx("div",{className:"text-gray-600",children:"device"}),s.jsx("div",{className:"text-gray-600",children:"created_at"})]})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-sm mb-2 text-purple-900",children:"⚡ Benefits of Zapier Integration:"}),s.jsxs("ul",{className:"text-sm text-purple-800 space-y-1",children:[s.jsx("li",{children:"• Automatically sync leads to 5,000+ apps"}),s.jsx("li",{children:"• Connect to popular CRMs (Salesforce, HubSpot, Zoho)"}),s.jsx("li",{children:"• Send leads to Google Sheets for easy tracking"}),s.jsx("li",{children:"• Get instant Slack/Teams notifications for new leads"}),s.jsx("li",{children:"• Create tasks in your project management tools"})]})]})]})]})})}function P(){const[o,d]=e.useState(""),[c,m]=e.useState(!1),[x,h]=e.useState(!1),{user:g}=l(),{toast:N}=a(),{subscription:b}=i(),{data:y,isLoading:w}=t({queryKey:["leads",g?.id],queryFn:async()=>{if(!g?.id)return[];const{data:e,error:s}=await r.from("leads").select("*").eq("user_id",g.id).order("created_at",{ascending:!1});if(s)throw s;return e},enabled:!!g?.id}),k=e=>{const a={new:{variant:"default",label:"New"},contacted:{variant:"secondary",label:"Contacted"},qualified:{variant:"outline",label:"Qualified"},converted:{variant:"default",label:"Converted"}}[e]||{variant:"outline",label:e};return s.jsx(u,{variant:a.variant,children:a.label})},P=e=>{switch(e){case"buyer":return s.jsx(R,{className:"h-4 w-4"});case"seller":return s.jsx(L,{className:"h-4 w-4"});case"valuation":return s.jsx(_,{className:"h-4 w-4"});default:return s.jsx(T,{className:"h-4 w-4"})}},O=y?.filter(e=>!o||(e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())));return s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Lead Management"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-0.5 sm:mt-1",children:"Track and follow up with your inquiries"})]}),s.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[s.jsxs(p,{onClick:()=>h(!0),variant:"outline",className:"flex-1 sm:flex-none min-h-[44px] active:scale-95 transition-all",children:[s.jsx(v,{className:"h-4 w-4 mr-2 text-orange-500"}),s.jsx("span",{className:"text-sm sm:text-base",children:"Zapier"})]}),s.jsxs(p,{onClick:()=>{if("free"===b?.plan_name)return void m(!0);if(!y||0===y.length)return void N({title:"No leads to export",description:"You don't have any leads yet.",variant:"destructive"});const e=[["Name","Email","Phone","Type","Message","Status","Created At"].join(","),...y.map(e=>[e.name,e.email,e.phone||"",e.lead_type,`"${(e.message||"").replace(/"/g,'""')}"`,e.status,new Date(e.created_at).toLocaleDateString()].join(","))].join("\n"),s=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`leads-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),N({title:"Leads exported",description:`Successfully exported ${y.length} leads to CSV`})},variant:"outline",disabled:!y||0===y.length,className:"flex-1 sm:flex-none min-h-[44px] active:scale-95 transition-all",children:[s.jsx(C,{className:"h-4 w-4 mr-2"}),s.jsx("span",{className:"text-sm sm:text-base",children:"Export CSV"}),"free"===b?.plan_name&&s.jsx(u,{variant:"secondary",className:"ml-2",children:"Pro"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4",children:[s.jsx(j,{className:"hover:shadow-md transition-shadow",children:s.jsxs(f,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:y?.length||0}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Total Leads"})]})}),s.jsx(j,{className:"hover:shadow-md transition-shadow",children:s.jsxs(f,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:y?.filter(e=>"new"===e.status).length||0}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"New"})]})}),s.jsx(j,{className:"hover:shadow-md transition-shadow",children:s.jsxs(f,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:y?.filter(e=>"contacted"===e.status).length||0}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Contacted"})]})}),s.jsx(j,{className:"hover:shadow-md transition-shadow",children:s.jsxs(f,{className:"pt-4 sm:pt-6 pb-4 sm:pb-6",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:y?.filter(e=>"converted"===e.status).length||0}),s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"Converted"})]})})]}),s.jsxs("div",{className:"relative",children:[s.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),s.jsx("input",{type:"text",placeholder:"Search leads by name or email...",value:o,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2.5 sm:py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm sm:text-base min-h-[44px]"})]}),s.jsx("div",{className:"space-y-2 sm:space-y-3",children:w?s.jsx(j,{children:s.jsx(f,{className:"p-6 sm:p-8 text-center text-muted-foreground text-sm sm:text-base",children:"Loading leads..."})}):O&&O.length>0?O.map(e=>s.jsx(j,{className:"hover:shadow-md active:shadow-lg transition-all",children:s.jsx(f,{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[s.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[s.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:P(e.lead_type)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[s.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground truncate",children:e.name}),k(e.status),s.jsx(u,{variant:"outline",className:"capitalize text-xs",children:e.lead_type})]}),s.jsxs("div",{className:"space-y-1.5 text-xs sm:text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-2 min-h-[32px]",children:[s.jsx(_,{className:"h-3 w-3 flex-shrink-0"}),s.jsx("a",{href:`mailto:${e.email}`,className:"hover:text-primary active:text-primary-dark break-all",children:e.email})]}),e.phone&&s.jsxs("div",{className:"flex items-center gap-2 min-h-[32px]",children:[s.jsx(L,{className:"h-3 w-3 flex-shrink-0"}),s.jsx("a",{href:`tel:${e.phone}`,className:"hover:text-primary active:text-primary-dark",children:e.phone})]}),e.message&&s.jsx("p",{className:"mt-2 text-foreground line-clamp-2 text-xs sm:text-sm leading-relaxed",children:e.message})]})]})]}),s.jsx("div",{className:"text-left sm:text-right flex-shrink-0 pl-12 sm:pl-0",children:s.jsxs("div",{className:"flex sm:justify-end items-center gap-1 text-xs text-muted-foreground",children:[s.jsx(Z,{className:"h-3 w-3"}),s.jsx("span",{children:new Date(e.created_at).toLocaleDateString()})]})})]})})},e.id)):s.jsx(j,{children:s.jsxs(f,{className:"p-8 sm:p-12 text-center",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-accent rounded-full mb-3 sm:mb-4",children:s.jsx(T,{className:"h-7 w-7 sm:h-8 sm:w-8 text-muted-foreground"})}),s.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground mb-1 sm:mb-2",children:"No leads yet"}),s.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto",children:"Leads will appear here when visitors contact you through your profile"})]})})}),s.jsx(n,{open:c,onOpenChange:m,feature:"lead_export",currentPlan:b?.plan_name||"Free",requiredPlan:"Starter"}),s.jsx(U,{open:x,onOpenChange:h})]})}export{P as default};
