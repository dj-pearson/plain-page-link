import{j as e}from"./ui-components-DtyTDbSg.js";import{r as t}from"./react-vendor-B_Chv4nK.js";import{D as r,n as s,o as i,p as a,q as n,L as l,I as o,T as d,r as c,B as m,s as u}from"./index-DxTo7WPx.js";import{s as x,a9 as p,X as h,aa as g,Q as j,ac as v,ad as f}from"./icons-K_BhWJ_Z.js";import{u as b}from"./use-toast-BIxl6y56.js";import{u as y}from"./useTestimonials-CBPs3KPq.js";import{u as N,U as w}from"./UpgradeModal-CFOSkjmS.js";import{L as C}from"./LimitBanner-C85UxyFy.js";import"./three-t2PEh41g.js";import"./charts-CeHnXkIf.js";import"./utils-D6PrBqaA.js";import"./data-ChU7VID-.js";import"./supabase-D4JaKbf_.js";import"./forms-yc2f2ZZT.js";import"./alert-B6eQrAWz.js";import"./progress-CqvpSpaq.js";function _({open:u,onOpenChange:g,onSave:j}){const[v,f]=t.useState({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),[b,y]=t.useState(null),N=e=>{const{name:t,value:r}=e.target;f(e=>({...e,[t]:r}))};return e.jsx(r,{open:u,onOpenChange:g,children:e.jsxs(s,{className:"max-w-2xl",children:[e.jsxs(i,{children:[e.jsx(a,{children:"Add Client Testimonial"}),e.jsx(n,{children:"Share feedback from satisfied clients to build credibility"})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),null==j||j(v),g(!1),f({clientName:"",rating:5,review:"",propertyType:"",featured:!1}),y(null)},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(o,{id:"clientName",name:"clientName",value:v.clientName,onChange:N,placeholder:"John Smith",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'You can use initials for privacy (e.g., "John S.")'})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"propertyType",children:"Property Type *"}),e.jsx(o,{id:"propertyType",name:"propertyType",value:v.propertyType,onChange:N,placeholder:"Single Family Home, Condo, etc.",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>f(e=>({...e,rating:t})),className:"focus:outline-none",children:e.jsx(x,{className:"h-8 w-8 transition-colors "+(t<=v.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")})},t))})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"review",children:"Testimonial Text *"}),e.jsx(d,{id:"review",name:"review",value:v.review,onChange:N,rows:6,maxLength:500,placeholder:"Share what the client said about working with you...",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.review.length,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"Client Photo (Optional)"}),b?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:b,alt:"Client preview",className:"w-24 h-24 rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{f(e=>({...e,clientPhoto:void 0})),y(null)},className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full",children:e.jsx(h,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];if(r){f(e=>({...e,clientPhoto:r}));const e=new FileReader;e.onloadend=()=>{y(e.result)},e.readAsDataURL(r)}},className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx(p,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload client photo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 2MB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"featured",checked:v.featured,onChange:e=>f(t=>({...t,featured:e.target.checked})),className:"rounded border-border"}),e.jsx(l,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this testimonial on my profile"})]}),e.jsxs(c,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(m,{type:"submit",children:"Add Testimonial"})]})]})]})})}function T({isOpen:r,onClose:s,onSubmit:i,initialData:a}){const[n,c]=t.useState(a);if(t.useEffect(()=>{c(a)},[a]),!r)return null;return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Testimonial"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(h,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),i(n)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"client_name",children:"Client Name *"}),e.jsx(o,{id:"client_name",value:n.client_name,onChange:e=>c({...n,client_name:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"client_title",children:"Client Title"}),e.jsx(o,{id:"client_title",value:n.client_title||"",onChange:e=>c({...n,client_title:e.target.value}),placeholder:"e.g., First-Time Homebuyer"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"rating",children:"Rating *"}),e.jsx(o,{id:"rating",type:"number",min:"1",max:"5",value:n.rating,onChange:e=>c({...n,rating:parseInt(e.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"review",children:"Review *"}),e.jsx(d,{id:"review",value:n.review,onChange:e=>c({...n,review:e.target.value}),rows:6,required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"property_type",children:"Property Type"}),e.jsx(o,{id:"property_type",value:n.property_type||"",onChange:e=>c({...n,property_type:e.target.value}),placeholder:"e.g., Single Family Home"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"transaction_type",children:"Transaction Type"}),e.jsxs("select",{id:"transaction_type",value:n.transaction_type||"",onChange:e=>c({...n,transaction_type:e.target.value}),className:"w-full px-3 py-2 bg-background border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"seller",children:"Seller"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:s,className:"flex-1",children:"Cancel"}),e.jsx(m,{type:"submit",className:"flex-1",children:"Save Changes"})]})]})]})})}function S(){const[r,s]=t.useState(!1),[i,a]=t.useState(null),[n,l]=t.useState(!1),{toast:o}=b(),{testimonials:d,addTestimonial:c,deleteTestimonial:m}=y(),{subscription:p,canAdd:h,getLimit:S,getUsage:F}=N(),k=d.length>0?(d.reduce((e,t)=>e+t.rating,0)/d.length).toFixed(1):"0.0",A=t=>e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((r,s)=>e.jsx(x,{className:"h-4 w-4 "+(s<t?"fill-yellow-400 text-yellow-400":"text-gray-300")},s))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Testimonials"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Showcase client reviews and success stories"})]}),e.jsxs("button",{onClick:()=>{h("testimonials")?s(!0):l(!0)},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(g,{className:"h-4 w-4"}),"Add Testimonial"]})]}),p&&S("testimonials")!==1/0&&e.jsx(C,{feature:"testimonials",current:F("testimonials"),limit:S("testimonials")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:k}),e.jsx("div",{className:"flex",children:A(Math.round(parseFloat(k)))})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Rating"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:d.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:d.map(t=>e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 hover:shadow-lg transition-shadow relative",children:[e.jsx("div",{className:"mb-4",children:e.jsx(j,{className:"h-8 w-8 text-primary opacity-20"})}),e.jsxs("p",{className:"text-foreground mb-6 leading-relaxed",children:['"',t.review,'"']}),e.jsx("div",{className:"mb-4",children:A(t.rating)}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold",children:t.client_name.split(" ").map(e=>e[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:t.client_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.property_type||"Client"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>a(t),className:"p-2 hover:bg-accent rounded-lg transition-colors",children:e.jsx(v,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this testimonial?"))try{await m.mutateAsync(e),o({title:"Testimonial deleted",description:"Client review has been removed."})}catch(t){o({title:"Error",description:"Failed to delete testimonial.",variant:"destructive"})}})(t.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(f,{className:"h-4 w-4 text-red-500"})})]})]})]},t.id))}),0===d.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-accent rounded-full mb-4",children:e.jsx(x,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No testimonials yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Start building social proof by adding client reviews"}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(g,{className:"h-5 w-5"}),"Add Your First Testimonial"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Featured testimonials will be prominently displayed on your public profile. Ask satisfied clients for reviews after successful transactions!"]})}),e.jsx(_,{open:r,onOpenChange:s,onSave:async e=>{try{await c.mutateAsync(e),o({title:"Testimonial added!",description:"Client review has been added successfully."}),s(!1)}catch(t){o({title:"Error",description:"Failed to add testimonial. Please try again.",variant:"destructive"})}}}),i&&e.jsx(T,{isOpen:!!i,onClose:()=>a(null),onSubmit:async e=>{if(i)try{const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:r}=await u.from("testimonials").update({client_name:e.client_name,client_title:e.client_title,rating:e.rating,review:e.review,property_type:e.property_type,transaction_type:e.transaction_type,updated_at:(new Date).toISOString()}).eq("id",i.id).eq("user_id",t.id);if(r)throw r;o({title:"Testimonial updated!",description:"Client review has been updated successfully."}),a(null),window.location.reload()}catch(t){o({title:"Error",description:"Failed to update testimonial. Please try again.",variant:"destructive"})}},initialData:{client_name:i.client_name,review:i.review,rating:i.rating,client_title:i.client_title,property_type:i.property_type,transaction_type:i.transaction_type}}),e.jsx(w,{open:n,onOpenChange:l,feature:"testimonials",currentPlan:(null==p?void 0:p.plan_name)||"Free",requiredPlan:"Starter"})]})}export{S as default};
