{"version":3,"file":"useSubscription-CH3N_k8K.js","sources":["../../src/hooks/useSubscription.ts"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\nexport interface SubscriptionPlan {\n  id: string;\n  name: string;\n  price_monthly: number;\n  price_yearly: number;\n  limits: {\n    listings?: number;\n    sold_properties?: number;\n    links?: number;\n    testimonials?: number;\n    analytics_days?: number;\n    themes?: number;\n  };\n  features: Record<string, any>;\n}\n\nexport interface UserSubscription {\n  plan_name: string;\n  limits: Record<string, number>;\n  features: Record<string, any>;\n  status: string;\n  current_period_end?: string;\n}\n\nexport const useSubscription = () => {\n  const { data: session } = useQuery({\n    queryKey: ['session'],\n    queryFn: async () => {\n      const { data } = await supabase.auth.getSession();\n      return data.session;\n    },\n  });\n\n  const { data: userSubscription, isLoading } = useQuery({\n    queryKey: ['user-subscription', session?.user?.id],\n    queryFn: async () => {\n      if (!session?.user?.id) return null;\n      \n      const { data, error } = await supabase.rpc('get_user_plan', {\n        _user_id: session.user.id,\n      });\n\n      if (error) throw error;\n      return data as UserSubscription;\n    },\n    enabled: !!session?.user?.id,\n  });\n\n  const { data: plans } = useQuery({\n    queryKey: ['subscription-plans'],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('subscription_plans')\n        .select('*')\n        .eq('is_active', true)\n        .order('sort_order');\n\n      if (error) throw error;\n      return data as SubscriptionPlan[];\n    },\n  });\n\n  const checkLimit = (resource: string, currentCount: number): boolean => {\n    if (!userSubscription?.limits) return currentCount < 3; // Free tier default\n    \n    const limit = userSubscription.limits[resource];\n    if (limit === -1) return true; // Unlimited\n    if (limit === undefined) return false; // Not allowed\n    \n    return currentCount < limit;\n  };\n\n  const hasFeature = (feature: string): boolean => {\n    if (!userSubscription?.features) return false;\n    return userSubscription.features[feature] === true;\n  };\n\n  return {\n    subscription: userSubscription,\n    plans,\n    isLoading,\n    checkLimit,\n    hasFeature,\n    isPro: userSubscription?.plan_name === 'professional' || \n           userSubscription?.plan_name === 'team' || \n           userSubscription?.plan_name === 'enterprise',\n    isTeam: userSubscription?.plan_name === 'team' || \n            userSubscription?.plan_name === 'enterprise',\n  };\n};"],"names":["useSubscription","session","useQuery","data","supabase","userSubscription","isLoading","error","plans","resource","currentCount","limit","feature"],"mappings":"uFA2BO,MAAMA,EAAkB,IAAM,CACnC,KAAM,CAAE,KAAMC,CAAA,EAAYC,EAAS,CACjC,SAAU,CAAC,SAAS,EACpB,QAAS,SAAY,CACnB,KAAM,CAAE,KAAAC,CAAA,EAAS,MAAMC,EAAS,KAAK,WAAA,EACrC,OAAOD,EAAK,OACd,CAAA,CACD,EAEK,CAAE,KAAME,EAAkB,UAAAC,CAAA,EAAcJ,EAAS,CACrD,SAAU,CAAC,oBAAqBD,GAAS,MAAM,EAAE,EACjD,QAAS,SAAY,CACnB,GAAI,CAACA,GAAS,MAAM,GAAI,OAAO,KAE/B,KAAM,CAAE,KAAAE,EAAM,MAAAI,CAAA,EAAU,MAAMH,EAAS,IAAI,gBAAiB,CAC1D,SAAUH,EAAQ,KAAK,EAAA,CACxB,EAED,GAAIM,EAAO,MAAMA,EACjB,OAAOJ,CACT,EACA,QAAS,CAAC,CAACF,GAAS,MAAM,EAAA,CAC3B,EAEK,CAAE,KAAMO,CAAA,EAAUN,EAAS,CAC/B,SAAU,CAAC,oBAAoB,EAC/B,QAAS,SAAY,CACnB,KAAM,CAAE,KAAAC,EAAM,MAAAI,CAAA,EAAU,MAAMH,EAC3B,KAAK,oBAAoB,EACzB,OAAO,GAAG,EACV,GAAG,YAAa,EAAI,EACpB,MAAM,YAAY,EAErB,GAAIG,EAAO,MAAMA,EACjB,OAAOJ,CACT,CAAA,CACD,EAiBD,MAAO,CACL,aAAcE,EACd,MAAAG,EACA,UAAAF,EACA,WAnBiB,CAACG,EAAkBC,IAAkC,CACtE,GAAI,CAACL,GAAkB,OAAQ,OAAOK,EAAe,EAErD,MAAMC,EAAQN,EAAiB,OAAOI,CAAQ,EAC9C,OAAIE,IAAU,GAAW,GACrBA,IAAU,OAAkB,GAEzBD,EAAeC,CACxB,EAYE,WAVkBC,GACbP,GAAkB,SAChBA,EAAiB,SAASO,CAAO,IAAM,GADN,GAUxC,MAAOP,GAAkB,YAAc,gBAChCA,GAAkB,YAAc,QAChCA,GAAkB,YAAc,aACvC,OAAQA,GAAkB,YAAc,QAChCA,GAAkB,YAAc,YAAA,CAE5C"}