import{q as p,b3 as h,b as v,G as q,s as o}from"./index-CbXwE5cx.js";import{u as d}from"./useMutation-BeLtmIn6.js";function g(){const{user:i}=p(),a=h(),{toast:s}=v(),{data:u=[],isLoading:c}=q({queryKey:["links",i?.id],queryFn:async()=>{if(!i?.id)return[];const{data:e,error:t}=await o.from("links").select("*").eq("user_id",i.id).order("position",{ascending:!0});if(t)throw t;return e},enabled:!!i?.id}),l=d({mutationFn:async e=>{if(!i?.id)throw new Error("User not authenticated");const t=u.length>0?Math.max(...u.map(m=>m.position)):-1,{data:n,error:r}=await o.from("links").insert({user_id:i.id,title:e.title,url:e.url,icon:e.icon,position:t+1,is_active:e.active}).select().single();if(r)throw r;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]}),s({title:"Link Added",description:"Your custom link has been added successfully."})},onError:e=>{s({title:"Failed to Add Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),y=d({mutationFn:async({id:e,...t})=>{const{data:n,error:r}=await o.from("links").update(t).eq("id",e).select().single();if(r)throw r;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]}),s({title:"Link Updated",description:"Your link has been updated successfully."})},onError:e=>{s({title:"Failed to Update Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),f=d({mutationFn:async e=>{const{error:t}=await o.from("links").delete().eq("id",e);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]}),s({title:"Link Deleted",description:"Your link has been deleted successfully."})},onError:e=>{s({title:"Failed to Delete Link",description:e instanceof Error?e.message:"An error occurred",variant:"destructive"})}}),k=d({mutationFn:async({id:e,is_active:t})=>{const{error:n}=await o.from("links").update({is_active:t}).eq("id",e);if(n)throw n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i?.id]})}});return{links:u,isLoading:c,addLink:l,updateLink:y,deleteLink:f,toggleActive:k}}export{g as u};
