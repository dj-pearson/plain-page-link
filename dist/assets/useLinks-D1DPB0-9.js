import{K as k,a8 as w,u as p,s}from"./index-CH8a_jH7.js";import{u as r}from"./useMutation-DQof0gk2.js";function g(){const{user:i}=k(),a=w(),{data:c=[],isLoading:d}=p({queryKey:["links",i==null?void 0:i.id],queryFn:async()=>{if(!(i!=null&&i.id))return[];const{data:t,error:e}=await s.from("links").select("*").eq("user_id",i.id).order("position",{ascending:!0});if(e)throw e;return t},enabled:!!(i!=null&&i.id)}),u=r({mutationFn:async t=>{if(!(i!=null&&i.id))throw new Error("User not authenticated");const e=c.length>0?Math.max(...c.map(f=>f.position)):-1,{data:n,error:o}=await s.from("links").insert({user_id:i.id,title:t.title,url:t.url,icon:t.icon,position:e+1,is_active:t.active}).select().single();if(o)throw o;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i==null?void 0:i.id]})}}),l=r({mutationFn:async({id:t,...e})=>{const{data:n,error:o}=await s.from("links").update(e).eq("id",t).select().single();if(o)throw o;return n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i==null?void 0:i.id]})}}),y=r({mutationFn:async t=>{const{error:e}=await s.from("links").delete().eq("id",t);if(e)throw e},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i==null?void 0:i.id]})}}),m=r({mutationFn:async({id:t,is_active:e})=>{const{error:n}=await s.from("links").update({is_active:e}).eq("id",t);if(n)throw n},onSuccess:()=>{a.invalidateQueries({queryKey:["links",i==null?void 0:i.id]})}});return{links:c,isLoading:d,addLink:u,updateLink:l,deleteLink:y,toggleActive:m}}export{g as u};
