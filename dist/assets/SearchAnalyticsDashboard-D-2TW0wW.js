import{j as e}from"./ui-vendor-DfpuNOa7.js";import{b as E}from"./react-vendor-ctj0ExSI.js";import{u as S,s as _,C as m,a as g,b as p,c as f,d as j,G as b,ap as oe,O as ce,B as N,aj as H,j as le,af as de,a3 as he,R as Q,V as M,J as xe,f as ue,ad as me}from"./index-ChZTfseL.js";import{T as Y,a as X,b as y,c as v}from"./tabs-C7rAKPjQ.js";import{b as J,d as U,u as Z}from"./state-vendor-BElgh7Si.js";import{C as ge}from"./circle-x-D4H2Ku3s.js";import{M as pe}from"./mouse-pointer-xOdcwssI.js";import{F as q}from"./file-text-Bppdu57h.js";import{T as k}from"./trending-down-DXVBOGjg.js";import{M as O}from"./minus-Clae-M4V.js";import{R as F,A as je,C as A,X as I,Y as C,T as L,e as R,d as $,L as K,a as D}from"./charts-vendor-DGVahL1I.js";import{T as ee,a as se,b as T,c as x,d as te,e as u}from"./table-BGgRRZHp.js";import{P as ae,a as ne,b as re}from"./popover-CyTqRhtO.js";import{a as B}from"./date-vendor-Xm6TBh54.js";import{C as fe}from"./checkbox-er1Ftalr.js";import{F as ye}from"./filter-C2J43EtA.js";import{f as z,e as ve,a as Ne}from"./exportUtils-dP2nAW1h.js";import{D as we,a as be,b as _e,c as W}from"./dropdown-menu-BzmyVmpD.js";import{R as Ce}from"./refresh-cw-C0A3Mddp.js";import{S as De}from"./settings-B133Eh4J.js";function ke(){return Z({queryKey:["connected-platforms"],queryFn:async()=>{const{data:{user:i}}=await _.auth.getUser();if(!i)throw new Error("Not authenticated");const{data:a,error:d}=await _.rpc("get_connected_search_platforms",{p_user_id:i.id});if(d)throw d;return a}})}function Te(){const{toast:i}=S();return U({mutationFn:async a=>{const d={google_analytics:`${window.location.origin}/admin/search-analytics/oauth/callback/google-analytics`,google_search_console:`${window.location.origin}/admin/search-analytics/oauth/callback/google-search-console`,bing_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/bing-webmaster`,yandex_webmaster:`${window.location.origin}/admin/search-analytics/oauth/callback/yandex-webmaster`},s={google_analytics:"https://accounts.google.com/o/oauth2/v2/auth",google_search_console:"https://accounts.google.com/o/oauth2/v2/auth",bing_webmaster:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",yandex_webmaster:"https://oauth.yandex.ru/authorize"},n=new URLSearchParams({client_id:(a.includes("google"),""),redirect_uri:d[a],response_type:"code",scope:a==="google_analytics"?"https://www.googleapis.com/auth/analytics.readonly":a==="google_search_console"?"https://www.googleapis.com/auth/webmasters.readonly":a==="bing_webmaster"?"https://api.bing.microsoft.com/webmaster.read offline_access":"webmaster:read",access_type:"offline",prompt:"consent"}),t=`${s[a]}?${n.toString()}`;window.location.href=t},onError:a=>{i({title:"OAuth Error",description:a.message,variant:"destructive"})}})}function Se(){const{toast:i}=S(),a=J();return U({mutationFn:async({platform:d,property_id:s,site_id:n,start_date:t,end_date:r})=>{const{data:{session:l}}=await _.auth.getSession();if(!l)throw new Error("Not authenticated");const o=d==="google_analytics"?"google-analytics-sync":d==="google_search_console"?"google-search-console-sync":d==="bing_webmaster"?"bing-webmaster-sync":"yandex-webmaster-sync",{data:c,error:h}=await edgeFunctions.invoke(o,{body:{property_id:s,site_id:n,start_date:t,end_date:r},headers:{Authorization:`Bearer ${l.access_token}`}});if(h)throw h;return c},onSuccess:()=>{i({title:"Sync Started",description:"Data synchronization started successfully"}),a.invalidateQueries({queryKey:["search-analytics"]})},onError:d=>{i({title:"Sync Failed",description:d.message,variant:"destructive"})}})}function Pe(){const{toast:i}=S(),a=J();return U({mutationFn:async({start_date:d,end_date:s,force_refresh:n})=>{const{data:{session:t}}=await _.auth.getSession();if(!t)throw new Error("Not authenticated");const{data:r,error:l}=await edgeFunctions.invoke("aggregate-search-analytics",{body:{start_date:d,end_date:s,force_refresh:n},headers:{Authorization:`Bearer ${t.access_token}`}});if(l)throw l;return r},onSuccess:()=>{i({title:"Aggregation Complete",description:"Analytics data aggregated successfully"}),a.invalidateQueries({queryKey:["unified-analytics"]})},onError:d=>{i({title:"Aggregation Failed",description:d.message,variant:"destructive"})}})}function P(i){return Z({queryKey:["unified-analytics",i],queryFn:async()=>{const{data:{user:a}}=await _.auth.getUser();if(!a)throw new Error("Not authenticated");let d=_.from("unified_search_analytics").select("*").eq("user_id",a.id).gte("date",i.startDate).lte("date",i.endDate);i.platforms&&i.platforms.length>0&&(d=d.in("source_platform",i.platforms));const{data:s,error:n}=await d.order("date",{ascending:!1});if(n)throw n;return s}})}function Fe(i){const{data:a}=P(i);return a?{total_clicks:a.reduce((s,n)=>s+(n.clicks||0),0),total_impressions:a.reduce((s,n)=>s+(n.impressions||0),0),total_sessions:a.reduce((s,n)=>s+(n.sessions||0),0),total_users:a.reduce((s,n)=>s+(n.users||0),0),total_pageviews:a.reduce((s,n)=>s+(n.pageviews||0),0),average_ctr:a.length>0?a.reduce((s,n)=>s+(n.ctr||0),0)/a.length:0,average_position:a.length>0?a.reduce((s,n)=>s+(n.average_position||0),0)/a.length:0,average_bounce_rate:a.length>0?a.reduce((s,n)=>s+(n.bounce_rate||0),0)/a.length:0,clicks_change:0,impressions_change:0,sessions_change:0}:null}function Ae(i){const{data:a}=P(i);if(!a)return null;const d=a.reduce((s,n)=>{const t=n.date;return s[t]||(s[t]={date:t,clicks:0,impressions:0,sessions:0,users:0,ctr:0,position:0,count:0}),s[t].clicks+=n.clicks||0,s[t].impressions+=n.impressions||0,s[t].sessions+=n.sessions||0,s[t].users+=n.users||0,s[t].ctr+=n.ctr||0,s[t].position+=n.average_position||0,s[t].count+=1,s},{});return Object.values(d).map(s=>({date:s.date,clicks:s.clicks,impressions:s.impressions,sessions:s.sessions,users:s.users,ctr:s.count>0?s.ctr/s.count:0,position:s.count>0?s.position/s.count:0}))}function ie(i){const{data:a}=P(i);if(!a)return null;const s=a.filter(t=>t.query).reduce((t,r)=>{const l=r.query;return t[l]||(t[l]={query:l,clicks:0,impressions:0,ctr:0,position:0,count:0,change:0}),t[l].clicks+=r.clicks||0,t[l].impressions+=r.impressions||0,t[l].ctr+=r.ctr||0,t[l].position+=r.average_position||0,t[l].count+=1,t},{});return Object.values(s).map(t=>({query:t.query,clicks:t.clicks,impressions:t.impressions,ctr:t.count>0?t.ctr/t.count:0,position:t.count>0?t.position/t.count:0,change:0})).sort((t,r)=>r.clicks-t.clicks).slice(0,i.limit||10)}function Ie(i){const{data:a}=P(i);if(!a)return null;const s=a.filter(t=>t.page_url).reduce((t,r)=>{const l=r.page_url;return t[l]||(t[l]={url:l,title:r.page_title,clicks:0,impressions:0,sessions:0,ctr:0,position:0,count:0,change:0}),t[l].clicks+=r.clicks||0,t[l].impressions+=r.impressions||0,t[l].sessions+=r.sessions||0,t[l].ctr+=r.ctr||0,t[l].position+=r.average_position||0,t[l].count+=1,t},{});return Object.values(s).map(t=>({url:t.url,title:t.title,clicks:t.clicks,impressions:t.impressions,sessions:t.sessions,ctr:t.count>0?t.ctr/t.count:0,position:t.count>0?t.position/t.count:0,change:0})).sort((t,r)=>r.clicks-t.clicks).slice(0,i.limit||10)}const Le={google_search_console:{name:"Google Search Console",description:"Search performance and indexing data",icon:"ðŸ”"},google_analytics:{name:"Google Analytics 4",description:"Website traffic and user behavior",icon:"ðŸ“Š"},bing_webmaster:{name:"Bing Webmaster Tools",description:"Bing search performance data",icon:"ðŸ…±ï¸"},yandex_webmaster:{name:"Yandex Webmaster",description:"Yandex search performance data",icon:"ðŸ‡·ðŸ‡º"}};function Re(){const{data:i,isLoading:a}=ke(),d=Te(),s=Se(),n=r=>{d.mutate(r)},t=r=>{s.mutate({platform:r})};return a?e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Platform Connections"}),e.jsx(f,{children:"Loading connection status..."})]}),e.jsx(j,{children:e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Platform Connections"}),e.jsx(f,{children:"Connect and manage your analytics platforms"})]}),e.jsx(j,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:i?.map(r=>{const l=Le[r.platform],o=r.is_connected,c=r.credential_status==="active",h=r.credential_status==="expired";return e.jsxs(m,{className:"relative",children:[e.jsxs(g,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("div",{children:e.jsx(p,{className:"text-sm",children:l.name})})]}),c&&e.jsxs(b,{variant:"default",className:"text-xs",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Connected"]}),h&&e.jsxs(b,{variant:"destructive",className:"text-xs",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Expired"]}),!o&&e.jsxs(b,{variant:"secondary",className:"text-xs",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Not Connected"]})]}),e.jsx(f,{className:"text-xs mt-1",children:l.description})]}),e.jsxs(j,{className:"pt-0",children:[r.last_sync&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Last sync: ",new Date(r.last_sync).toLocaleDateString()]}),e.jsx("div",{className:"flex flex-col gap-2",children:!o||h?e.jsxs(N,{size:"sm",onClick:()=>n(r.platform),disabled:d.isPending,className:"w-full",children:[e.jsx(H,{className:"h-3 w-3 mr-2"}),h?"Reconnect":"Connect"]}):e.jsx(N,{size:"sm",variant:"outline",onClick:()=>t(r.platform),disabled:s.isPending,className:"w-full",children:"Sync Data"})})]})]},r.platform)})})})]})}function $e({startDate:i,endDate:a,platforms:d}){const s=Fe({startDate:i,endDate:a,platforms:d});if(!s)return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(o=>e.jsxs(m,{children:[e.jsx(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:"Loading..."})}),e.jsx(j,{children:e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded"})})]},o))});const n=o=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(o),t=o=>`${(o*100).toFixed(2)}%`,r=o=>{if(o===0)return{icon:O,color:"text-muted-foreground",text:"0%"};const c=o>0;return{icon:c?M:k,color:c?"text-green-600":"text-red-600",text:`${c?"+":""}${t(o/100)}`}},l=[{title:"Total Clicks",value:s.total_clicks,change:s.clicks_change,icon:pe,description:"Users who clicked through"},{title:"Total Impressions",value:s.total_impressions,change:s.impressions_change,icon:le,description:"Times your site appeared"},{title:"Avg. CTR",value:s.average_ctr,change:0,icon:de,description:"Click-through rate",isPercentage:!0},{title:"Avg. Position",value:s.average_position,change:0,icon:he,description:"Average search position",decimals:1},{title:"Total Sessions",value:s.total_sessions,change:s.sessions_change,icon:Q,description:"Website sessions"},{title:"Total Users",value:s.total_users,change:0,icon:Q,description:"Unique visitors"},{title:"Total Pageviews",value:s.total_pageviews,change:0,icon:q,description:"Pages viewed"},{title:"Bounce Rate",value:s.average_bounce_rate,change:0,icon:k,description:"Visitors who left quickly",isPercentage:!0}];return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:l.map(o=>{const c=r(o.change),h=o.icon,w=c.icon;return e.jsxs(m,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:o.title}),e.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.isPercentage?t(o.value):o.decimals?o.value.toFixed(o.decimals):n(o.value)}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(w,{className:`h-3 w-3 ${c.color}`}),e.jsx("span",{className:c.color,children:c.text}),e.jsx("span",{children:"vs. previous period"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:o.description})]})]},o.title)})})}function Ee({startDate:i,endDate:a,platforms:d}){const s=Ae({startDate:i,endDate:a,platforms:d});return!s||s.length===0?e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Performance Trends"}),e.jsx(f,{children:"No data available for the selected period"})]}),e.jsx(j,{children:e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:e.jsx("p",{children:"Connect your platforms and sync data to see performance trends"})})})]}):e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Performance Trends"}),e.jsx(f,{children:"Track your search and traffic metrics over time"})]}),e.jsx(j,{children:e.jsxs(Y,{defaultValue:"traffic",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(y,{value:"traffic",children:"Traffic"}),e.jsx(y,{value:"search",children:"Search Performance"}),e.jsx(y,{value:"engagement",children:"Engagement"})]}),e.jsx(v,{value:"traffic",className:"space-y-4",children:e.jsx(F,{width:"100%",height:350,children:e.jsxs(je,{data:s,children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(C,{}),e.jsx(L,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:n=>[new Intl.NumberFormat().format(n),""]}),e.jsx(R,{}),e.jsx($,{type:"monotone",dataKey:"sessions",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Sessions"}),e.jsx($,{type:"monotone",dataKey:"users",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",name:"Users"}),e.jsx($,{type:"monotone",dataKey:"pageviews",stackId:"3",stroke:"#ffc658",fill:"#ffc658",name:"Pageviews"})]})})}),e.jsx(v,{value:"search",className:"space-y-4",children:e.jsx(F,{width:"100%",height:350,children:e.jsxs(K,{data:s,children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(C,{yAxisId:"left"}),e.jsx(C,{yAxisId:"right",orientation:"right"}),e.jsx(L,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:(n,t)=>t==="CTR"?[`${(n*100).toFixed(2)}%`,t]:t==="Avg Position"?[n.toFixed(1),t]:[new Intl.NumberFormat().format(n),t]}),e.jsx(R,{}),e.jsx(D,{yAxisId:"left",type:"monotone",dataKey:"clicks",stroke:"#8884d8",name:"Clicks",strokeWidth:2}),e.jsx(D,{yAxisId:"left",type:"monotone",dataKey:"impressions",stroke:"#82ca9d",name:"Impressions",strokeWidth:2}),e.jsx(D,{yAxisId:"right",type:"monotone",dataKey:"ctr",stroke:"#ffc658",name:"CTR",strokeWidth:2})]})})}),e.jsxs(v,{value:"engagement",className:"space-y-4",children:[e.jsx(F,{width:"100%",height:350,children:e.jsxs(K,{data:s,children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(C,{}),e.jsx(L,{labelFormatter:n=>new Date(n).toLocaleDateString(),formatter:(n,t)=>t==="Avg Position"?[n.toFixed(1),t]:[new Intl.NumberFormat().format(n),t]}),e.jsx(R,{}),e.jsx(D,{type:"monotone",dataKey:"position",stroke:"#8884d8",name:"Avg Position",strokeWidth:2})]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Lower position values are better (position 1 is the top result)"})]})]})})]})}function V({startDate:i,endDate:a,platforms:d,limit:s=10}){const n=ie({startDate:i,endDate:a,platforms:d,limit:s});if(!n||n.length===0)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No query data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top queries"})]});const t=o=>new Intl.NumberFormat("en-US").format(o),r=o=>`${(o*100).toFixed(2)}%`,l=o=>o>0?e.jsx(M,{className:"h-3 w-3 text-green-600"}):o<0?e.jsx(k,{className:"h-3 w-3 text-red-600"}):e.jsx(O,{className:"h-3 w-3 text-muted-foreground"});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(T,{children:[e.jsx(x,{className:"w-[40%]",children:"Query"}),e.jsx(x,{className:"text-right",children:"Clicks"}),e.jsx(x,{className:"text-right",children:"Impressions"}),e.jsx(x,{className:"text-right",children:"CTR"}),e.jsx(x,{className:"text-right",children:"Position"}),e.jsx(x,{className:"text-right",children:"Trend"})]})}),e.jsx(te,{children:n.map((o,c)=>e.jsxs(T,{children:[e.jsx(u,{className:"font-medium max-w-xs truncate",children:o.query}),e.jsx(u,{className:"text-right",children:t(o.clicks)}),e.jsx(u,{className:"text-right",children:t(o.impressions)}),e.jsx(u,{className:"text-right",children:e.jsx(b,{variant:"outline",children:r(o.ctr)})}),e.jsx(u,{className:"text-right",children:e.jsx(b,{variant:"secondary",children:o.position.toFixed(1)})}),e.jsx(u,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:l(o.change)})})]},`${o.query}-${c}`))})]})})}function G({startDate:i,endDate:a,platforms:d,limit:s=10}){const n=Ie({startDate:i,endDate:a,platforms:d,limit:s});if(!n||n.length===0)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No page data available for the selected period"}),e.jsx("p",{className:"text-sm mt-2",children:"Connect platforms and sync data to see top pages"})]});const t=c=>new Intl.NumberFormat("en-US").format(c),r=c=>`${(c*100).toFixed(2)}%`,l=c=>c>0?e.jsx(M,{className:"h-3 w-3 text-green-600"}):c<0?e.jsx(k,{className:"h-3 w-3 text-red-600"}):e.jsx(O,{className:"h-3 w-3 text-muted-foreground"}),o=(c,h=50)=>c.length<=h?c:c.substring(0,h)+"...";return e.jsx("div",{className:"rounded-md border",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(T,{children:[e.jsx(x,{className:"w-[35%]",children:"Page"}),e.jsx(x,{className:"text-right",children:"Clicks"}),e.jsx(x,{className:"text-right",children:"Sessions"}),e.jsx(x,{className:"text-right",children:"Impressions"}),e.jsx(x,{className:"text-right",children:"CTR"}),e.jsx(x,{className:"text-right",children:"Position"}),e.jsx(x,{className:"text-right",children:"Trend"}),e.jsx(x,{className:"w-[50px]"})]})}),e.jsx(te,{children:n.map((c,h)=>e.jsxs(T,{children:[e.jsx(u,{className:"max-w-xs",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm truncate",title:c.url,children:o(c.url)}),c.title&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",title:c.title,children:c.title})]})}),e.jsx(u,{className:"text-right",children:t(c.clicks)}),e.jsx(u,{className:"text-right",children:t(c.sessions)}),e.jsx(u,{className:"text-right",children:t(c.impressions)}),e.jsx(u,{className:"text-right",children:e.jsx(b,{variant:"outline",children:r(c.ctr)})}),e.jsx(u,{className:"text-right",children:e.jsx(b,{variant:"secondary",children:c.position.toFixed(1)})}),e.jsx(u,{className:"text-right",children:e.jsx("div",{className:"flex justify-end",children:l(c.change)})}),e.jsx(u,{children:e.jsx("a",{href:c.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80",children:e.jsx(H,{className:"h-4 w-4"})})})]},`${c.url}-${h}`))})]})})}function qe({startDate:i,endDate:a,onChange:d}){const[s,n]=E.useState(!1),t=l=>{const o=new Date,c=new Date;c.setDate(c.getDate()-l),d(c.toISOString().split("T")[0],o.toISOString().split("T")[0]),n(!1)},r=[{label:"Last 7 days",days:7},{label:"Last 30 days",days:30},{label:"Last 90 days",days:90},{label:"Last 6 months",days:180},{label:"Last year",days:365}];return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ae,{open:s,onOpenChange:n,children:[e.jsx(ne,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),B(new Date(i),"MMM dd, yyyy")," - ",B(new Date(a),"MMM dd, yyyy")]})}),e.jsx(re,{className:"w-auto p-4",align:"start",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Quick Select"}),e.jsx("div",{className:"grid gap-2",children:r.map(l=>e.jsx(N,{variant:"ghost",className:"justify-start",onClick:()=>t(l.days),children:l.label},l.label))})]})})})]})})}const Me=[{value:"google_search_console",label:"Google Search Console"},{value:"google_analytics",label:"Google Analytics"},{value:"bing_webmaster",label:"Bing Webmaster"},{value:"yandex_webmaster",label:"Yandex Webmaster"}];function Ue({selectedPlatforms:i,onChange:a}){const d=s=>{i.includes(s)?a(i.filter(n=>n!==s)):a([...i,s])};return e.jsxs(ae,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Platforms (",i.length,")"]})}),e.jsx(re,{className:"w-64",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Filter by Platform"}),e.jsx("div",{className:"space-y-3",children:Me.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{id:s.value,checked:i.includes(s.value),onCheckedChange:()=>d(s.value)}),e.jsx(ue,{htmlFor:s.value,className:"text-sm font-normal cursor-pointer",children:s.label})]},s.value))})]})})]})}function os(){const{toast:i}=S(),[a,d]=E.useState({start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[s,n]=E.useState(["google_search_console","google_analytics"]),t=Pe(),r=ie({startDate:a.start,endDate:a.end,platforms:s,limit:100}),l=async()=>{try{await t.mutateAsync({start_date:a.start,end_date:a.end,force_refresh:!0})}catch(h){console.error("Failed to refresh data:",h)}},o=()=>{if(!r||r.length===0){i({title:"No Data to Export",description:"Connect a platform and sync data before exporting.",variant:"destructive"});return}const h=`${a.start} to ${a.end}`,w=z(r,"Search Analytics Report",h);ve(w),i({title:"Exported to CSV",description:`Exported ${r.length} queries to CSV.`})},c=()=>{if(!r||r.length===0){i({title:"No Data to Export",description:"Connect a platform and sync data before exporting.",variant:"destructive"});return}const h=`${a.start} to ${a.end}`,w=z(r,"Search Analytics Report",h);Ne(w),i({title:"Opening PDF",description:`Preparing PDF report with ${r.length} queries.`})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 flex-wrap",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:l,disabled:t.isPending,children:[e.jsx(Ce,{className:`h-4 w-4 mr-2 ${t.isPending?"animate-spin":""}`}),"Refresh Data"]}),e.jsxs(we,{children:[e.jsx(be,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(_e,{align:"end",children:[e.jsxs(W,{onClick:o,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Export to CSV"]}),e.jsxs(W,{onClick:c,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Export to PDF"]})]})]}),e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),e.jsx(Re,{}),e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Filters"}),e.jsx(f,{children:"Customize your analytics view"})]}),e.jsxs(j,{className:"flex flex-wrap gap-4",children:[e.jsx(qe,{startDate:a.start,endDate:a.end,onChange:(h,w)=>d({start:h,end:w})}),e.jsx(Ue,{selectedPlatforms:s,onChange:n})]})]}),e.jsxs(Y,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(y,{value:"overview",children:"Overview"}),e.jsx(y,{value:"queries",children:"Top Queries"}),e.jsx(y,{value:"pages",children:"Top Pages"}),e.jsx(y,{value:"devices",children:"Devices"}),e.jsx(y,{value:"countries",children:"Countries"})]}),e.jsxs(v,{value:"overview",className:"space-y-4",children:[e.jsx($e,{startDate:a.start,endDate:a.end,platforms:s}),e.jsx(Ee,{startDate:a.start,endDate:a.end,platforms:s}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Top 10 Queries"}),e.jsx(f,{children:"Highest performing search queries"})]}),e.jsx(j,{children:e.jsx(V,{startDate:a.start,endDate:a.end,platforms:s,limit:10})})]}),e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Top 10 Pages"}),e.jsx(f,{children:"Highest performing pages"})]}),e.jsx(j,{children:e.jsx(G,{startDate:a.start,endDate:a.end,platforms:s,limit:10})})]})]})]}),e.jsx(v,{value:"queries",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"All Search Queries"}),e.jsx(f,{children:"Complete list of search queries with performance metrics"})]}),e.jsx(j,{children:e.jsx(V,{startDate:a.start,endDate:a.end,platforms:s,limit:100})})]})}),e.jsx(v,{value:"pages",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"All Pages"}),e.jsx(f,{children:"Complete list of pages with traffic metrics"})]}),e.jsx(j,{children:e.jsx(G,{startDate:a.start,endDate:a.end,platforms:s,limit:100})})]})}),e.jsx(v,{value:"devices",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Device Breakdown"}),e.jsx(f,{children:"Performance metrics by device type"})]}),e.jsx(j,{children:e.jsx("p",{className:"text-muted-foreground",children:"Device analytics coming soon..."})})]})}),e.jsx(v,{value:"countries",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(p,{children:"Geographic Distribution"}),e.jsx(f,{children:"Performance metrics by country"})]}),e.jsx(j,{children:e.jsx("p",{className:"text-muted-foreground",children:"Geographic analytics coming soon..."})})]})})]})]})}export{os as S};
