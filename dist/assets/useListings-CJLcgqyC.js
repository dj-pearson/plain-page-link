import{b as m,u as h,d as a}from"./state-vendor-BElgh7Si.js";import{l as q,s}from"./index-DMBvLcus.js";function Q(){const{user:e}=q(),n=m(),{data:u=[],isLoading:d,isError:c,error:l,refetch:g}=h({queryKey:["listings",e?.id],queryFn:async()=>{if(!e?.id)return[];const{data:i,error:r}=await s.from("listings").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return i},enabled:!!e?.id,staleTime:300*1e3,gcTime:600*1e3}),f=a({mutationFn:async i=>{if(!e?.id)throw new Error("User not authenticated");const{data:r,error:t}=await s.from("listings").insert({user_id:e.id,...i}).select().single();if(t)throw t;return r},onSuccess:()=>{n.invalidateQueries({queryKey:["listings",e?.id]})}}),y=a({mutationFn:async({id:i,...r})=>{if(!e?.id)throw new Error("User not authenticated");const{data:t,error:o}=await s.from("listings").update(r).eq("id",i).eq("user_id",e.id).select().single();if(o)throw o;return t},onSuccess:()=>{n.invalidateQueries({queryKey:["listings",e?.id]})}}),w=a({mutationFn:async i=>{if(!e?.id)throw new Error("User not authenticated");const{error:r}=await s.from("listings").delete().eq("id",i).eq("user_id",e.id);if(r)throw r},onSuccess:()=>{n.invalidateQueries({queryKey:["listings",e?.id]})}});return{listings:u,isLoading:d,isError:c,error:l,refetch:g,addListing:f,updateListing:y,deleteListing:w}}export{Q as u};
