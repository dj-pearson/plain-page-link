import{b as i,u as e,d as t}from"./data-hbyXtiTU.js";import{u as n,s as r}from"./index-B6WqPLum.js";function s(){const{user:s}=n(),a=i(),{data:o=[],isLoading:d}=e({queryKey:["links",s?.id],queryFn:async()=>{if(!s?.id)return[];const{data:i,error:e}=await r.from("links").select("*").eq("user_id",s.id).order("position",{ascending:!0});if(e)throw e;return i},enabled:!!s?.id}),u=t({mutationFn:async i=>{if(!s?.id)throw new Error("User not authenticated");const e=o.length>0?Math.max(...o.map(i=>i.position)):-1,{data:t,error:n}=await r.from("links").insert({user_id:s.id,title:i.title,url:i.url,icon:i.icon,position:e+1,is_active:i.active}).select().single();if(n)throw n;return t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",s?.id]})}}),c=t({mutationFn:async({id:i,...e})=>{const{data:t,error:n}=await r.from("links").update(e).eq("id",i).select().single();if(n)throw n;return t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",s?.id]})}}),l=t({mutationFn:async i=>{const{error:e}=await r.from("links").delete().eq("id",i);if(e)throw e},onSuccess:()=>{a.invalidateQueries({queryKey:["links",s?.id]})}}),y=t({mutationFn:async({id:i,is_active:e})=>{const{error:t}=await r.from("links").update({is_active:e}).eq("id",i);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["links",s?.id]})}});return{links:o,isLoading:d,addLink:u,updateLink:c,deleteLink:l,toggleActive:y}}export{s as u};
